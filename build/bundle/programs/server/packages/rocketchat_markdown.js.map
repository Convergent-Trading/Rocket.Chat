{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:markdown/settings.js","meteor://ðŸ’»app/packages/rocketchat:markdown/markdown.js","meteor://ðŸ’»app/packages/rocketchat:markdown/parser/marked/marked.js","meteor://ðŸ’»app/packages/rocketchat:markdown/parser/original/code.js","meteor://ðŸ’»app/packages/rocketchat:markdown/parser/original/markdown.js","meteor://ðŸ’»app/packages/rocketchat:markdown/parser/original/original.js"],"names":["Meteor","module","watch","require","v","RocketChat","startup","settings","add","type","values","key","i18nLabel","group","section","public","enableQueryOriginal","_id","value","enableQuery","i18nDescription","enableQueryMarked","s","default","Blaze","marked","original","code","parsers","MarkdownClass","parse","text","message","html","escapeHTML","mountTokensBack","parseMessageNotEscaped","parseNotEscaped","parser","get","useHtml","tokens","length","token","noHtml","replace","args","Markdown","MarkdownMessage","trim","undefined","callbacks","priority","HIGH","isClient","registerHelper","output","export","Random","_","hljs","_marked","renderer","Renderer","msg","lang","escaped","options","highlight","out","escape","isString","id","push","codespan","blockquote","quote","e","gfm","tables","breaks","pedantic","smartLists","smartypants","unescapeHTML","sanitize","inlinecode","match","p1","p2","codeblocks","count","msgParts","split","index","part","codeMatch","singleLine","indexOf","Array","from","listLanguages","includes","emptyLanguage","result","highlightAuto","language","join","markdown","addAsToken","schemes","RegExp","title","url","target","absoluteUrl"],"mappings":"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","file":"/packages/rocketchat_markdown.js","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nMeteor.startup(() => {\n\tRocketChat.settings.add('Markdown_Parser', 'original', {\n\t\ttype: 'select',\n\t\tvalues: [{\n\t\t\tkey: 'disabled',\n\t\t\ti18nLabel: 'Disabled',\n\t\t}, {\n\t\t\tkey: 'original',\n\t\t\ti18nLabel: 'Original',\n\t\t}, {\n\t\t\tkey: 'marked',\n\t\t\ti18nLabel: 'Marked',\n\t\t}],\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t});\n\n\tconst enableQueryOriginal = { _id: 'Markdown_Parser', value: 'original' };\n\tRocketChat.settings.add('Markdown_Headers', false, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryOriginal,\n\t});\n\tRocketChat.settings.add('Markdown_SupportSchemesForLink', 'http,https', {\n\t\ttype: 'string',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\ti18nDescription: 'Markdown_SupportSchemesForLink_Description',\n\t\tenableQuery: enableQueryOriginal,\n\t});\n\n\tconst enableQueryMarked = { _id: 'Markdown_Parser', value: 'marked' };\n\tRocketChat.settings.add('Markdown_Marked_GFM', true, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryMarked,\n\t});\n\tRocketChat.settings.add('Markdown_Marked_Tables', true, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryMarked,\n\t});\n\tRocketChat.settings.add('Markdown_Marked_Breaks', true, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryMarked,\n\t});\n\tRocketChat.settings.add('Markdown_Marked_Pedantic', false, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: [{\n\t\t\t_id: 'Markdown_Parser',\n\t\t\tvalue: 'marked',\n\t\t}, {\n\t\t\t_id: 'Markdown_Marked_GFM',\n\t\t\tvalue: false,\n\t\t}],\n\t});\n\tRocketChat.settings.add('Markdown_Marked_SmartLists', true, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryMarked,\n\t});\n\tRocketChat.settings.add('Markdown_Marked_Smartypants', true, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryMarked,\n\t});\n});\n","/*\n * Markdown is a named function that will parse markdown syntax\n * @param {Object} message - The message object\n */\nimport s from 'underscore.string';\nimport { Meteor } from 'meteor/meteor';\nimport { Blaze } from 'meteor/blaze';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { marked } from './parser/marked/marked.js';\nimport { original } from './parser/original/original.js';\n\nimport { code } from './parser/original/code.js';\n\nconst parsers = {\n\toriginal,\n\tmarked,\n};\n\nclass MarkdownClass {\n\tparse(text) {\n\t\tconst message = {\n\t\t\thtml: s.escapeHTML(text),\n\t\t};\n\t\treturn this.mountTokensBack(this.parseMessageNotEscaped(message)).html;\n\t}\n\n\tparseNotEscaped(text) {\n\t\tconst message = {\n\t\t\thtml: text,\n\t\t};\n\t\treturn this.mountTokensBack(this.parseMessageNotEscaped(message)).html;\n\t}\n\n\tparseMessageNotEscaped(message) {\n\t\tconst parser = RocketChat.settings.get('Markdown_Parser');\n\n\t\tif (parser === 'disabled') {\n\t\t\treturn message;\n\t\t}\n\n\t\tif (typeof parsers[parser] === 'function') {\n\t\t\treturn parsers[parser](message);\n\t\t}\n\t\treturn parsers.original(message);\n\t}\n\n\tmountTokensBack(message, useHtml = true) {\n\t\tif (message.tokens && message.tokens.length > 0) {\n\t\t\tfor (const { token, text, noHtml } of message.tokens) {\n\t\t\t\tmessage.html = message.html.replace(token, () => (useHtml ? text : noHtml)); // Uses lambda so doesn't need to escape $\n\t\t\t}\n\t\t}\n\n\t\treturn message;\n\t}\n\n\tcode(...args) {\n\t\treturn code(...args);\n\t}\n}\n\nconst Markdown = new MarkdownClass;\nRocketChat.Markdown = Markdown;\n\n// renderMessage already did html escape\nconst MarkdownMessage = (message) => {\n\tif (s.trim(message != null ? message.html : undefined)) {\n\t\tmessage = Markdown.parseMessageNotEscaped(message);\n\t}\n\n\treturn message;\n};\n\nRocketChat.callbacks.add('renderMessage', MarkdownMessage, RocketChat.callbacks.priority.HIGH, 'markdown');\n\nif (Meteor.isClient) {\n\tBlaze.registerHelper('RocketChatMarkdown', (text) => Markdown.parse(text));\n\tBlaze.registerHelper('RocketChatMarkdownUnescape', (text) => Markdown.parseNotEscaped(text));\n\tBlaze.registerHelper('RocketChatMarkdownInline', (text) => {\n\t\tconst output = Markdown.parse(text);\n\t\treturn output.replace(/^<p>/, '').replace(/<\\/p>$/, '');\n\t});\n}\n","import { RocketChat } from 'meteor/rocketchat:lib';\nimport { Random } from 'meteor/random';\nimport _ from 'underscore';\nimport s from 'underscore.string';\nimport hljs from 'highlight.js';\nimport _marked from 'marked';\n\nconst renderer = new _marked.Renderer();\n\nlet msg = null;\n\nrenderer.code = function(code, lang, escaped) {\n\tif (this.options.highlight) {\n\t\tconst out = this.options.highlight(code, lang);\n\t\tif (out != null && out !== code) {\n\t\t\tescaped = true;\n\t\t\tcode = out;\n\t\t}\n\t}\n\n\tlet text = null;\n\n\tif (!lang) {\n\t\ttext = `<pre><code class=\"code-colors hljs\">${ (escaped ? code : s.escapeHTML(code, true)) }</code></pre>`;\n\t} else {\n\t\ttext = `<pre><code class=\"code-colors hljs ${ escape(lang, true) }\">${ (escaped ? code : s.escapeHTML(code, true)) }</code></pre>`;\n\t}\n\n\tif (_.isString(msg)) {\n\t\treturn text;\n\t}\n\n\tconst token = `=!=${ Random.id() }=!=`;\n\tmsg.tokens.push({\n\t\thighlight: true,\n\t\ttoken,\n\t\ttext,\n\t});\n\n\treturn token;\n};\n\nrenderer.codespan = function(text) {\n\ttext = `<code class=\"code-colors inline\">${ text }</code>`;\n\tif (_.isString(msg)) {\n\t\treturn text;\n\t}\n\n\tconst token = `=!=${ Random.id() }=!=`;\n\tmsg.tokens.push({\n\t\ttoken,\n\t\ttext,\n\t});\n\n\treturn token;\n};\n\nrenderer.blockquote = function(quote) {\n\treturn `<blockquote class=\"background-transparent-darker-before\">${ quote }</blockquote>`;\n};\n\nconst highlight = function(code, lang) {\n\tif (!lang) {\n\t\treturn code;\n\t}\n\ttry {\n\t\treturn hljs.highlight(lang, code).value;\n\t} catch (e) {\n\t\t// Unknown language\n\t\treturn code;\n\t}\n};\n\nlet gfm = null;\nlet tables = null;\nlet breaks = null;\nlet pedantic = null;\nlet smartLists = null;\nlet smartypants = null;\n\nexport const marked = (message) => {\n\tmsg = message;\n\n\tif (!msg.tokens) {\n\t\tmsg.tokens = [];\n\t}\n\n\tif (gfm == null) { gfm = RocketChat.settings.get('Markdown_Marked_GFM'); }\n\tif (tables == null) { tables = RocketChat.settings.get('Markdown_Marked_Tables'); }\n\tif (breaks == null) { breaks = RocketChat.settings.get('Markdown_Marked_Breaks'); }\n\tif (pedantic == null) { pedantic = RocketChat.settings.get('Markdown_Marked_Pedantic'); }\n\tif (smartLists == null) { smartLists = RocketChat.settings.get('Markdown_Marked_SmartLists'); }\n\tif (smartypants == null) { smartypants = RocketChat.settings.get('Markdown_Marked_Smartypants'); }\n\n\tmsg.html = _marked(s.unescapeHTML(msg.html), {\n\t\tgfm,\n\t\ttables,\n\t\tbreaks,\n\t\tpedantic,\n\t\tsmartLists,\n\t\tsmartypants,\n\t\trenderer,\n\t\tsanitize: true,\n\t\thighlight,\n\t});\n\n\treturn msg;\n};\n","/*\n * code() is a named function that will parse `inline code` and ```codeblock``` syntaxes\n * @param {Object} message - The message object\n */\nimport { Random } from 'meteor/random';\nimport s from 'underscore.string';\nimport hljs from 'highlight.js';\n\nconst inlinecode = (message) =>\n\t// Support `text`\n\tmessage.html = message.html.replace(/\\`([^`\\r\\n]+)\\`([<_*~]|\\B|\\b|$)/gm, (match, p1, p2) => {\n\t\tconst token = ` =!=${ Random.id() }=!=`;\n\n\t\tmessage.tokens.push({\n\t\t\ttoken,\n\t\t\ttext: `<span class=\\\"copyonly\\\">\\`</span><span><code class=\\\"code-colors inline\\\">${ p1 }</code></span><span class=\\\"copyonly\\\">\\`</span>${ p2 }`,\n\t\t\tnoHtml: match,\n\t\t});\n\n\t\treturn token;\n\t})\n;\n\nconst codeblocks = (message) => {\n\t// Count occurencies of ```\n\tconst count = (message.html.match(/```/g) || []).length;\n\n\tif (count) {\n\n\t\t// Check if we need to add a final ```\n\t\tif ((count % 2) > 0) {\n\t\t\tmessage.html = `${ message.html }\\n\\`\\`\\``;\n\t\t\tmessage.msg = `${ message.msg }\\n\\`\\`\\``;\n\t\t}\n\n\t\t// Separate text in code blocks and non code blocks\n\t\tconst msgParts = message.html.split(/(^.*)(```(?:[a-zA-Z]+)?(?:(?:.|\\r|\\n)*?)```)(.*\\n?)$/gm);\n\n\t\tfor (let index = 0; index < msgParts.length; index++) {\n\t\t\t// Verify if this part is code\n\t\t\tconst part = msgParts[index];\n\t\t\tconst codeMatch = part.match(/^```[\\r\\n]*(.*[\\r\\n\\ ]?)[\\r\\n]*([\\s\\S]*?)```+?$/);\n\n\t\t\tif (codeMatch != null) {\n\t\t\t\t// Process highlight if this part is code\n\t\t\t\tconst singleLine = codeMatch[0].indexOf('\\n') === -1;\n\t\t\t\tconst lang = !singleLine && Array.from(hljs.listLanguages()).includes(s.trim(codeMatch[1])) ? s.trim(codeMatch[1]) : '';\n\t\t\t\tconst emptyLanguage = lang === '' ? s.unescapeHTML(codeMatch[1] + codeMatch[2]) : s.unescapeHTML(codeMatch[2]);\n\t\t\t\tconst code = singleLine ? s.unescapeHTML(codeMatch[1]) : emptyLanguage;\n\n\t\t\t\tconst result = lang === '' ? hljs.highlightAuto((lang + code)) : hljs.highlight(lang, code);\n\t\t\t\tconst token = `=!=${ Random.id() }=!=`;\n\n\t\t\t\tmessage.tokens.push({\n\t\t\t\t\thighlight: true,\n\t\t\t\t\ttoken,\n\t\t\t\t\ttext: `<pre><code class='code-colors hljs ${ result.language }'><span class='copyonly'>\\`\\`\\`<br></span>${ result.value }<span class='copyonly'><br>\\`\\`\\`</span></code></pre>`,\n\t\t\t\t\tnoHtml: codeMatch[0],\n\t\t\t\t});\n\n\t\t\t\tmsgParts[index] = token;\n\t\t\t} else {\n\t\t\t\tmsgParts[index] = part;\n\t\t\t}\n\t\t}\n\n\t\t// Re-mount message\n\t\treturn message.html = msgParts.join('');\n\t}\n};\n\nexport const code = (message) => {\n\tif (s.trim(message.html)) {\n\t\tif (message.tokens == null) {\n\t\t\tmessage.tokens = [];\n\t\t}\n\n\t\tcodeblocks(message);\n\t\tinlinecode(message);\n\t}\n\n\treturn message;\n};\n","/*\n * Markdown is a named function that will parse markdown syntax\n * @param {String} msg - The message html\n */\nimport { Meteor } from 'meteor/meteor';\nimport { Random } from 'meteor/random';\nimport { RocketChat } from 'meteor/rocketchat:lib';\nimport s from 'underscore.string';\n\nconst parseNotEscaped = function(msg, message) {\n\tif (message && message.tokens == null) {\n\t\tmessage.tokens = [];\n\t}\n\n\tconst addAsToken = function(html) {\n\t\tconst token = `=!=${ Random.id() }=!=`;\n\t\tmessage.tokens.push({\n\t\t\ttoken,\n\t\t\ttext: html,\n\t\t});\n\n\t\treturn token;\n\t};\n\n\tconst schemes = RocketChat.settings.get('Markdown_SupportSchemesForLink').split(',').join('|');\n\n\tif (RocketChat.settings.get('Markdown_Headers')) {\n\t\t// Support # Text for h1\n\t\tmsg = msg.replace(/^# (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm, '<h1>$1</h1>');\n\n\t\t// Support # Text for h2\n\t\tmsg = msg.replace(/^## (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm, '<h2>$1</h2>');\n\n\t\t// Support # Text for h3\n\t\tmsg = msg.replace(/^### (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm, '<h3>$1</h3>');\n\n\t\t// Support # Text for h4\n\t\tmsg = msg.replace(/^#### (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm, '<h4>$1</h4>');\n\t}\n\n\t// Support *text* to make bold\n\tmsg = msg.replace(/(^|&gt;|[ >_~`])\\*{1,2}([^\\*\\r\\n]+)\\*{1,2}([<_~`]|\\B|\\b|$)/gm, '$1<span class=\"copyonly\">*</span><strong>$2</strong><span class=\"copyonly\">*</span>$3');\n\n\t// Support _text_ to make italics\n\tmsg = msg.replace(/(^|&gt;|[ >*~`])\\_{1,2}([^\\_\\r\\n]+)\\_{1,2}([<*~`]|\\B|\\b|$)/gm, '$1<span class=\"copyonly\">_</span><em>$2</em><span class=\"copyonly\">_</span>$3');\n\n\t// Support ~text~ to strike through text\n\tmsg = msg.replace(/(^|&gt;|[ >_*`])\\~{1,2}([^~\\r\\n]+)\\~{1,2}([<_*`]|\\B|\\b|$)/gm, '$1<span class=\"copyonly\">~</span><strike>$2</strike><span class=\"copyonly\">~</span>$3');\n\n\t// Support for block quote\n\t// >>>\n\t// Text\n\t// <<<\n\tmsg = msg.replace(/(?:&gt;){3}\\n+([\\s\\S]*?)\\n+(?:&lt;){3}/g, '<blockquote class=\"background-transparent-darker-before\"><span class=\"copyonly\">&gt;&gt;&gt;</span>$1<span class=\"copyonly\">&lt;&lt;&lt;</span></blockquote>');\n\n\t// Support >Text for quote\n\tmsg = msg.replace(/^&gt;(.*)$/gm, '<blockquote class=\"background-transparent-darker-before\"><span class=\"copyonly\">&gt;</span>$1</blockquote>');\n\n\t// Remove white-space around blockquote (prevent <br>). Because blockquote is block element.\n\tmsg = msg.replace(/\\s*<blockquote class=\"background-transparent-darker-before\">/gm, '<blockquote class=\"background-transparent-darker-before\">');\n\tmsg = msg.replace(/<\\/blockquote>\\s*/gm, '</blockquote>');\n\n\t// Remove new-line between blockquotes.\n\tmsg = msg.replace(/<\\/blockquote>\\n<blockquote/gm, '</blockquote><blockquote');\n\n\t// Support ![alt text](http://image url)\n\tmsg = msg.replace(new RegExp(`!\\\\[([^\\\\]]+)\\\\]\\\\(((?:${ schemes }):\\\\/\\\\/[^\\\\)]+)\\\\)`, 'gm'), (match, title, url) => {\n\t\tconst target = url.indexOf(Meteor.absoluteUrl()) === 0 ? '' : '_blank';\n\t\treturn addAsToken(`<a href=\"${ s.escapeHTML(url) }\" title=\"${ s.escapeHTML(title) }\" target=\"${ s.escapeHTML(target) }\" rel=\"noopener noreferrer\"><div class=\"inline-image\" style=\"background-image: url(${ s.escapeHTML(url) });\"></div></a>`);\n\t});\n\n\t// Support [Text](http://link)\n\tmsg = msg.replace(new RegExp(`\\\\[([^\\\\]]+)\\\\]\\\\(((?:${ schemes }):\\\\/\\\\/[^\\\\)]+)\\\\)`, 'gm'), (match, title, url) => {\n\t\tconst target = url.indexOf(Meteor.absoluteUrl()) === 0 ? '' : '_blank';\n\t\treturn addAsToken(`<a href=\"${ s.escapeHTML(url) }\" target=\"${ s.escapeHTML(target) }\" rel=\"noopener noreferrer\">${ s.escapeHTML(title) }</a>`);\n\t});\n\n\t// Support <http://link|Text>\n\tmsg = msg.replace(new RegExp(`(?:<|&lt;)((?:${ schemes }):\\\\/\\\\/[^\\\\|]+)\\\\|(.+?)(?=>|&gt;)(?:>|&gt;)`, 'gm'), (match, url, title) => {\n\t\tconst target = url.indexOf(Meteor.absoluteUrl()) === 0 ? '' : '_blank';\n\t\treturn addAsToken(`<a href=\"${ s.escapeHTML(url) }\" target=\"${ s.escapeHTML(target) }\" rel=\"noopener noreferrer\">${ s.escapeHTML(title) }</a>`);\n\t});\n\n\treturn msg;\n};\n\nexport const markdown = function(message) {\n\tmessage.html = parseNotEscaped(message.html, message);\n\treturn message;\n};\n","/*\n * Markdown is a named function that will parse markdown syntax\n * @param {Object} message - The message object\n */\nimport { markdown } from './markdown.js';\nimport { code } from './code.js';\n\nexport const original = (message) => {\n\t// Parse markdown code\n\tmessage = code(message);\n\n\t// Parse markdown\n\tmessage = markdown(message);\n\n\t// Replace linebreak to br\n\tmessage.html = message.html.replace(/\\n/gm, '<br>');\n\n\treturn message;\n};\n"]}