{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:ui-master/server/inject.js"],"names":["_","module","watch","require","default","v","s","renderDynamicCssList","debounce","Meteor","bindEnvironment","colors","RocketChat","models","Settings","find","_id","fields","value","editor","fetch","filter","color","css","map","replace","join","Inject","rawBody","observe","changed","rawHead","Assets","getText","process","env","DISABLE_ANIMATION","TEST_MODE","settings","get","key","standardFavicons","escapedValue","escapeHTML","rawModHtml","html","script","defer","baseUrl","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","trim","test"],"mappings":"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","file":"/packages/rocketchat_ui-master.js","sourcesContent":["/* globals Inject */\nimport _ from 'underscore';\nimport s from 'underscore.string';\n\nconst renderDynamicCssList = _.debounce(Meteor.bindEnvironment(() => {\n\t// const variables = RocketChat.models.Settings.findOne({_id:'theme-custom-variables'}, {fields: { value: 1}});\n\tconst colors = RocketChat.models.Settings.find({ _id:/theme-color-rc/i }, { fields: { value: 1, editor: 1 } }).fetch().filter((color) => color && color.value);\n\n\tif (!colors) {\n\t\treturn;\n\t}\n\tconst css = colors.map(({ _id, value, editor }) => {\n\t\tif (editor === 'expression') {\n\t\t\treturn `--${ _id.replace('theme-color-', '') }: var(--${ value });`;\n\t\t}\n\t\treturn `--${ _id.replace('theme-color-', '') }: ${ value };`;\n\t}).join('\\n');\n\tInject.rawBody('dynamic-variables', `<style id='css-variables'> :root {${ css }}</style>`);\n}), 500);\n\nrenderDynamicCssList();\n\n// RocketChat.models.Settings.find({_id:'theme-custom-variables'}, {fields: { value: 1}}).observe({\n// \tchanged: renderDynamicCssList\n// });\n\nRocketChat.models.Settings.find({ _id:/theme-color-rc/i }, { fields: { value: 1 } }).observe({\n\tchanged: renderDynamicCssList,\n});\n\nInject.rawHead('noreferrer', '<meta name=\"referrer\" content=\"origin-when-crossorigin\">');\nInject.rawHead('dynamic', `<script>${ Assets.getText('server/dynamic-css.js') }</script>`);\n\nInject.rawBody('icons', Assets.getText('public/icons.svg'));\n\nInject.rawBody('page-loading-div', `\n<div id=\"initial-page-loading\" class=\"page-loading\">\n\t<div class=\"loading-animation\">\n\t\t<div class=\"bounce bounce1\"></div>\n\t\t<div class=\"bounce bounce2\"></div>\n\t\t<div class=\"bounce bounce3\"></div>\n\t</div>\n</div>`);\n\nif (process.env.DISABLE_ANIMATION || process.env.TEST_MODE === 'true') {\n\tInject.rawHead('disable-animation', `\n\t<style>\n\t\tbody, body * {\n\t\t\tanimation: none !important;\n\t\t\ttransition: none !important;\n\t\t}\n\t</style>\n\t<script>\n\t\twindow.DISABLE_ANIMATION = true;\n\t</script>\n\t`);\n}\n\nRocketChat.settings.get('Assets_SvgFavicon_Enable', (key, value) => {\n\tconst standardFavicons = `\n\t\t<link rel=\"icon\" sizes=\"16x16\" type=\"image/png\" href=\"assets/favicon_16.png\" />\n\t\t<link rel=\"icon\" sizes=\"32x32\" type=\"image/png\" href=\"assets/favicon_32.png\" />`;\n\n\tif (value) {\n\t\tInject.rawHead(key,\n\t\t\t`${ standardFavicons }\n\t\t\t<link rel=\"icon\" sizes=\"any\" type=\"image/svg+xml\" href=\"assets/favicon.svg\" />`);\n\t} else {\n\t\tInject.rawHead(key, standardFavicons);\n\t}\n});\n\nRocketChat.settings.get('theme-color-sidebar-background', (key, value) => {\n\tconst escapedValue = s.escapeHTML(value);\n\tInject.rawHead(key, `<meta name=\"msapplication-TileColor\" content=\"${ escapedValue }\" />` +\n\t\t\t\t\t\t`<meta name=\"theme-color\" content=\"${ escapedValue }\" />`);\n});\n\nRocketChat.settings.get('Accounts_ForgetUserSessionOnWindowClose', (key, value) => {\n\tif (value) {\n\t\tInject.rawModHtml(key, (html) => {\n\t\t\tconst script = `\n\t\t\t\t<script>\n\t\t\t\t\tif (Meteor._localStorage._data === undefined && window.sessionStorage) {\n\t\t\t\t\t\tMeteor._localStorage = window.sessionStorage;\n\t\t\t\t\t}\n\t\t\t\t</script>\n\t\t\t`;\n\t\t\treturn html.replace(/<\\/body>/, `${ script }\\n</body>`);\n\t\t});\n\t} else {\n\t\tInject.rawModHtml(key, (html) => html);\n\t}\n});\n\nRocketChat.settings.get('Site_Name', (key, value = 'Rocket.Chat') => {\n\tconst escapedValue = s.escapeHTML(value);\n\tInject.rawHead(key,\n\t\t`<title>${ escapedValue }</title>` +\n\t\t`<meta name=\"application-name\" content=\"${ escapedValue }\">` +\n\t\t`<meta name=\"apple-mobile-web-app-title\" content=\"${ escapedValue }\">`);\n});\n\nRocketChat.settings.get('Meta_language', (key, value = '') => {\n\tconst escapedValue = s.escapeHTML(value);\n\tInject.rawHead(key,\n\t\t`<meta http-equiv=\"content-language\" content=\"${ escapedValue }\">` +\n\t\t`<meta name=\"language\" content=\"${ escapedValue }\">`);\n});\n\nRocketChat.settings.get('Meta_robots', (key, value = '') => {\n\tconst escapedValue = s.escapeHTML(value);\n\tInject.rawHead(key, `<meta name=\"robots\" content=\"${ escapedValue }\">`);\n});\n\nRocketChat.settings.get('Meta_msvalidate01', (key, value = '') => {\n\tconst escapedValue = s.escapeHTML(value);\n\tInject.rawHead(key, `<meta name=\"msvalidate.01\" content=\"${ escapedValue }\">`);\n});\n\nRocketChat.settings.get('Meta_google-site-verification', (key, value = '') => {\n\tconst escapedValue = s.escapeHTML(value);\n\tInject.rawHead(key, `<meta name=\"google-site-verification\" content=\"${ escapedValue }\">`);\n});\n\nRocketChat.settings.get('Meta_fb_app_id', (key, value = '') => {\n\tconst escapedValue = s.escapeHTML(value);\n\tInject.rawHead(key, `<meta property=\"fb:app_id\" content=\"${ escapedValue }\">`);\n});\n\nRocketChat.settings.get('Meta_custom', (key, value = '') => {\n\tInject.rawHead(key, value);\n});\n\nMeteor.defer(() => {\n\tlet baseUrl;\n\tif (__meteor_runtime_config__.ROOT_URL_PATH_PREFIX && __meteor_runtime_config__.ROOT_URL_PATH_PREFIX.trim() !== '') {\n\t\tbaseUrl = __meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\n\t} else {\n\t\tbaseUrl = '/';\n\t}\n\tif (/\\/$/.test(baseUrl) === false) {\n\t\tbaseUrl += '/';\n\t}\n\tInject.rawHead('base', `<base href=\"${ baseUrl }\">`);\n});\n"]}