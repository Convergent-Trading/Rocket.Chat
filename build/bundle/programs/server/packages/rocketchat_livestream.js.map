{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:livestream/server/index.js","meteor://ðŸ’»app/packages/rocketchat:livestream/server/models/Rooms.js","meteor://ðŸ’»app/packages/rocketchat:livestream/server/functions/saveStreamingOptions.js","meteor://ðŸ’»app/packages/rocketchat:livestream/server/functions/livestream.js","meteor://ðŸ’»app/packages/rocketchat:livestream/server/settings.js","meteor://ðŸ’»app/packages/rocketchat:livestream/server/methods.js","meteor://ðŸ’»app/packages/rocketchat:livestream/server/routes.js"],"names":["module","watch","require","RocketChat","models","Rooms","setStreamingOptionsById","_id","streamingOptions","update","$set","saveStreamingOptions","rid","options","Match","test","String","Meteor","Error","function","check","type","Optional","url","thumbnail","isAudioOnly","message","export","getBroadcastStatus","statusStreamLiveStream","statusLiveStream","setBroadcastStatus","createLiveStream","google","default","v","OAuth2","auth","p","fn","Promise","resolve","reject","err","value","data","id","access_token","refresh_token","clientId","clientSecret","setCredentials","youtube","version","result","liveBroadcasts","list","part","items","status","lifeCycleStatus","liveStreams","streamStatus","transition","broadcastStatus","room","stream","broadcast","all","insert","resource","snippet","title","name","cdn","format","ingestionType","scheduledStartTime","Date","toISOString","privacyStatus","bind","streamId","ingestionInfo","streamName","startup","settings","addGroup","add","public","alert","enableQuery","selectLivestreamSettings","user","livestream","methods","livestreamStreamStatus","method","livestreamSettings","get","setLivestreamStatus","broadcastId","livestreamGet","findOne","API","v1","addRoute","functionName","clientAuth","replace","userId","queryParams","generateAuthUrl","access_type","scope","state","JSON","stringify","statusCode","headers","Location","body","code","parse","ret","wrapAsync","getToken","Users"],"mappings":"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","file":"/packages/rocketchat_livestream.js","sourcesContent":["import './routes.js';\nimport './methods.js';\n","RocketChat.models.Rooms.setStreamingOptionsById = function(_id, streamingOptions) {\n\tconst update = {\n\t\t$set: {\n\t\t\tstreamingOptions,\n\t\t},\n\t};\n\treturn this.update({ _id }, update);\n};\n","RocketChat.saveStreamingOptions = function(rid, options) {\n\tif (!Match.test(rid, String)) {\n\t\tthrow new Meteor.Error('invalid-room', 'Invalid room', {\n\t\t\tfunction: 'RocketChat.saveStreamingOptions',\n\t\t});\n\t}\n\n\tcheck(options, {\n\t\ttype: Match.Optional(String),\n\t\turl: Match.Optional(String),\n\t\tthumbnail: Match.Optional(String),\n\t\tisAudioOnly: Match.Optional(String),\n\t\tmessage: Match.Optional(String),\n\t});\n\n\tRocketChat.models.Rooms.setStreamingOptionsById(rid, options);\n};\n","import google from 'googleapis';\nconst { OAuth2 } = google.auth;\n\n\nconst p = (fn) => new Promise(function(resolve, reject) {\n\tfn(function(err, value) {\n\t\tif (err) {\n\t\t\treturn reject(err);\n\t\t}\n\t\tresolve(value.data);\n\t});\n});\n\nexport const getBroadcastStatus = async({\n\tid,\n\taccess_token,\n\trefresh_token,\n\tclientId,\n\tclientSecret,\n}) => {\n\tconst auth = new OAuth2(clientId, clientSecret);\n\n\tauth.setCredentials({\n\t\taccess_token,\n\t\trefresh_token,\n\t});\n\tconst youtube = google.youtube({ version:'v3', auth });\n\tconst result = await p((resolve) => youtube.liveBroadcasts.list({\n\t\tpart:'id,status',\n\t\tid,\n\t}, resolve));\n\treturn result.items && result.items[0] && result.items[0].status.lifeCycleStatus;\n};\n\nexport const statusStreamLiveStream = async({\n\tid,\n\taccess_token,\n\trefresh_token,\n\tclientId,\n\tclientSecret,\n}) => {\n\tconst auth = new OAuth2(clientId, clientSecret);\n\n\tauth.setCredentials({\n\t\taccess_token,\n\t\trefresh_token,\n\t});\n\n\tconst youtube = google.youtube({ version:'v3', auth });\n\tconst result = await p((resolve) => youtube.liveStreams.list({\n\t\tpart:'id,status',\n\t\tid,\n\t}, resolve));\n\treturn result.items && result.items[0].status.streamStatus;\n};\n\nexport const statusLiveStream = ({\n\tid,\n\taccess_token,\n\trefresh_token,\n\tclientId,\n\tclientSecret,\n\tstatus,\n}) => {\n\tconst auth = new OAuth2(clientId, clientSecret);\n\n\tauth.setCredentials({\n\t\taccess_token,\n\t\trefresh_token,\n\t});\n\n\tconst youtube = google.youtube({ version:'v3', auth });\n\n\treturn p((resolve) => youtube.liveBroadcasts.transition({\n\t\tpart:'id,status',\n\t\tid,\n\t\tbroadcastStatus: status,\n\t}, resolve));\n};\n\nexport const setBroadcastStatus = ({\n\tid,\n\taccess_token,\n\trefresh_token,\n\tclientId,\n\tclientSecret,\n\tstatus,\n}) => {\n\tconst auth = new OAuth2(clientId, clientSecret);\n\n\tauth.setCredentials({\n\t\taccess_token,\n\t\trefresh_token,\n\t});\n\n\tconst youtube = google.youtube({ version:'v3', auth });\n\n\treturn p((resolve) => youtube.liveBroadcasts.transition({\n\t\tpart:'id,status',\n\t\tid,\n\t\tbroadcastStatus: status,\n\t}, resolve));\n};\n\nexport const createLiveStream = async({\n\troom,\n\taccess_token,\n\trefresh_token,\n\tclientId,\n\tclientSecret,\n}) => {\n\tconst auth = new OAuth2(clientId, clientSecret);\n\tauth.setCredentials({\n\t\taccess_token,\n\t\trefresh_token,\n\t});\n\tconst youtube = google.youtube({ version:'v3', auth });\n\n\tconst [stream, broadcast] = await Promise.all([p((resolve) => youtube.liveStreams.insert({\n\t\tpart: 'id,snippet,cdn,contentDetails,status',\n\t\tresource: {\n\t\t\tsnippet: {\n\t\t\t\ttitle: room.name || 'RocketChat Broadcast',\n\t\t\t},\n\t\t\tcdn: {\n\t\t\t\tformat: '480p',\n\t\t\t\tingestionType: 'rtmp',\n\t\t\t},\n\t\t},\n\t}, resolve)), p((resolve) => youtube.liveBroadcasts.insert({\n\t\tpart: 'id,snippet,contentDetails,status',\n\t\tresource: {\n\t\t\tsnippet: {\n\t\t\t\ttitle: room.name || 'RocketChat Broadcast',\n\t\t\t\tscheduledStartTime : new Date().toISOString(),\n\t\t\t},\n\t\t\tstatus: {\n\t\t\t\tprivacyStatus: 'unlisted',\n\t\t\t},\n\t\t},\n\t}, resolve))]);\n\n\tawait p((resolve) => youtube.liveBroadcasts.bind({\n\t\tpart: 'id,snippet,status',\n\t\t// resource: {\n\t\tid: broadcast.id,\n\t\tstreamId: stream.id,\n\t}, resolve));\n\n\treturn { id: stream.cdn.ingestionInfo.streamName, stream, broadcast };\n};\n","Meteor.startup(function() {\n\tRocketChat.settings.addGroup('LiveStream & Broadcasting', function() {\n\n\t\tthis.add('Livestream_enabled', false, {\n\t\t\ttype: 'boolean',\n\t\t\tpublic: true,\n\t\t\talert: 'This feature is currently in beta! Please report bugs to github.com/RocketChat/Rocket.Chat/issues',\n\t\t});\n\n\t\tthis.add('Broadcasting_enabled', false, {\n\t\t\ttype: 'boolean',\n\t\t\tpublic: true,\n\t\t\talert: 'This feature is currently in beta! Please report bugs to github.com/RocketChat/Rocket.Chat/issues',\n\t\t\tenableQuery: { _id: 'Livestream_enabled', value: true },\n\t\t});\n\n\t\tthis.add('Broadcasting_client_id', '', { type: 'string', public: false, enableQuery: { _id: 'Broadcasting_enabled', value: true } });\n\t\tthis.add('Broadcasting_client_secret', '', { type: 'string', public: false, enableQuery: { _id: 'Broadcasting_enabled', value: true } });\n\t\tthis.add('Broadcasting_api_key', '', { type: 'string', public: false, enableQuery: { _id: 'Broadcasting_enabled', value: true } });\n\t\tthis.add('Broadcasting_media_server_url', '', { type: 'string', public: true, enableQuery: { _id: 'Broadcasting_enabled', value: true } });\n\t});\n});\n","import { Meteor } from 'meteor/meteor';\nimport { createLiveStream, statusLiveStream, statusStreamLiveStream, getBroadcastStatus, setBroadcastStatus } from './functions/livestream';\n\nconst selectLivestreamSettings = (user) => user && user.settings && user.settings.livestream;\n\nMeteor.methods({\n\n\tasync livestreamStreamStatus({ streamId }) {\n\t\tif (!streamId) {\n\t\t\t// TODO: change error\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Livestream ID not found', {\n\t\t\t\tmethod: 'livestreamStreamStatus',\n\t\t\t});\n\t\t}\n\t\tconst livestreamSettings = selectLivestreamSettings(Meteor.user());\n\n\t\tif (!livestreamSettings) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'You have no settings to stream', {\n\t\t\t\tmethod: 'livestreamStreamStatus',\n\t\t\t});\n\t\t}\n\n\t\tconst { access_token, refresh_token } = livestreamSettings;\n\n\t\treturn await statusStreamLiveStream({\n\t\t\tid: streamId,\n\t\t\taccess_token,\n\t\t\trefresh_token,\n\t\t\tclientId: RocketChat.settings.get('Broadcasting_client_id'),\n\t\t\tclientSecret: RocketChat.settings.get('Broadcasting_client_secret'),\n\t\t});\n\n\t},\n\tasync setLivestreamStatus({ broadcastId, status }) {\n\t\tif (!broadcastId) {\n\t\t\t// TODO: change error\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'You have no settings to livestream', {\n\t\t\t\tmethod: 'livestreamStart',\n\t\t\t});\n\t\t}\n\t\tconst livestreamSettings = selectLivestreamSettings(Meteor.user());\n\n\t\tif (!livestreamSettings) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'You have no settings to livestream', {\n\t\t\t\tmethod: 'livestreamStart',\n\t\t\t});\n\t\t}\n\n\t\tconst { access_token, refresh_token } = livestreamSettings;\n\n\t\treturn await statusLiveStream({\n\t\t\tid: broadcastId,\n\t\t\taccess_token,\n\t\t\trefresh_token,\n\t\t\tstatus,\n\t\t\tclientId: RocketChat.settings.get('Broadcasting_client_id'),\n\t\t\tclientSecret: RocketChat.settings.get('Broadcasting_client_secret'),\n\t\t});\n\n\t},\n\tasync livestreamGet({ rid }) {\n\t\tconst livestreamSettings = selectLivestreamSettings(Meteor.user());\n\n\t\tif (!livestreamSettings) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'You have no settings to livestream', {\n\t\t\t\tmethod: 'livestreamGet',\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOne({ _id: rid });\n\n\t\tif (!room) {\n\t\t\t// TODO: change error\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'You have no settings to livestream', {\n\t\t\t\tmethod: 'livestreamGet',\n\t\t\t});\n\t\t}\n\n\t\tconst { access_token, refresh_token } = livestreamSettings;\n\t\treturn await createLiveStream({\n\t\t\troom,\n\t\t\taccess_token,\n\t\t\trefresh_token,\n\t\t\tclientId: RocketChat.settings.get('Broadcasting_client_id'),\n\t\t\tclientSecret: RocketChat.settings.get('Broadcasting_client_secret'),\n\t\t});\n\n\t},\n\tasync getBroadcastStatus({ broadcastId }) {\n\t\tif (!broadcastId) {\n\t\t\t// TODO: change error\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Broadcast ID not found', {\n\t\t\t\tmethod: 'getBroadcastStatus',\n\t\t\t});\n\t\t}\n\t\tconst livestreamSettings = selectLivestreamSettings(Meteor.user());\n\n\t\tif (!livestreamSettings) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'You have no settings to stream', {\n\t\t\t\tmethod: 'getBroadcastStatus',\n\t\t\t});\n\t\t}\n\n\t\tconst { access_token, refresh_token } = livestreamSettings;\n\n\t\treturn await getBroadcastStatus({\n\t\t\tid: broadcastId,\n\t\t\taccess_token,\n\t\t\trefresh_token,\n\t\t\tclientId: RocketChat.settings.get('Broadcasting_client_id'),\n\t\t\tclientSecret: RocketChat.settings.get('Broadcasting_client_secret'),\n\t\t});\n\t},\n\tasync setBroadcastStatus({ broadcastId, status }) {\n\t\tif (!broadcastId) {\n\t\t\t// TODO: change error\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Broadcast ID not found', {\n\t\t\t\tmethod: 'setBroadcastStatus',\n\t\t\t});\n\t\t}\n\t\tconst livestreamSettings = selectLivestreamSettings(Meteor.user());\n\n\t\tif (!livestreamSettings) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'You have no settings to stream', {\n\t\t\t\tmethod: 'setBroadcastStatus',\n\t\t\t});\n\t\t}\n\n\t\tconst { access_token, refresh_token } = livestreamSettings;\n\n\t\treturn await setBroadcastStatus({\n\t\t\tid: broadcastId,\n\t\t\taccess_token,\n\t\t\trefresh_token,\n\t\t\tstatus,\n\t\t\tclientId: RocketChat.settings.get('Broadcasting_client_id'),\n\t\t\tclientSecret: RocketChat.settings.get('Broadcasting_client_secret'),\n\t\t});\n\n\t},\n});\n","import google from 'googleapis';\nconst { OAuth2 } = google.auth;\n\nRocketChat.API.v1.addRoute('livestream/oauth', {\n\tget: function functionName() {\n\t\tconst clientAuth = new OAuth2(RocketChat.settings.get('Broadcasting_client_id'), RocketChat.settings.get('Broadcasting_client_secret'), `${ RocketChat.settings.get('Site_Url') }/api/v1/livestream/oauth/callback`.replace(/\\/{2}api/g, '/api'));\n\t\tconst { userId } = this.queryParams;\n\t\tconst url = clientAuth.generateAuthUrl({\n\t\t\taccess_type: 'offline',\n\t\t\tscope: ['https://www.googleapis.com/auth/youtube'],\n\t\t\tstate: JSON.stringify({\n\t\t\t\tuserId,\n\t\t\t}),\n\t\t});\n\n\t\treturn {\n\t\t\tstatusCode: 302,\n\t\t\theaders: {\n\t\t\t\tLocation: url,\n\t\t\t}, body: 'Oauth redirect',\n\t\t};\n\t},\n});\n\nRocketChat.API.v1.addRoute('livestream/oauth/callback', {\n\tget: function functionName() {\n\t\tconst { code, state } = this.queryParams;\n\n\t\tconst { userId } = JSON.parse(state);\n\n\t\tconst clientAuth = new OAuth2(RocketChat.settings.get('Broadcasting_client_id'), RocketChat.settings.get('Broadcasting_client_secret'), `${ RocketChat.settings.get('Site_Url') }/api/v1/livestream/oauth/callback`.replace(/\\/{2}api/g, '/api'));\n\n\t\tconst ret = Meteor.wrapAsync(clientAuth.getToken.bind(clientAuth))(code);\n\n\t\tRocketChat.models.Users.update({ _id: userId }, { $set: {\n\t\t\t'settings.livestream' : ret,\n\t\t} });\n\n\t\treturn {\n\t\t\theaders: {\n\t\t\t\t'content-type' : 'text/html',\n\t\t\t}, body: '<script>window.close()</script>',\n\t\t};\n\t},\n});\n"]}