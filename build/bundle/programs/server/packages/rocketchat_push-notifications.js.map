{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:push-notifications/server/methods/saveNotificationSettings.js","meteor://ðŸ’»app/packages/rocketchat:push-notifications/server/models/Subscriptions.js"],"names":["Meteor","methods","saveNotificationSettings","roomId","field","value","userId","Error","method","check","String","notifications","audioNotifications","updateMethod","subscription","RocketChat","models","Subscriptions","updateAudioNotificationsById","_id","desktopNotifications","userPref","getUserNotificationPreference","updateDesktopNotificationsById","origin","mobilePushNotifications","updateMobilePushNotificationsById","emailNotifications","updateEmailNotificationsById","unreadAlert","updateUnreadAlertById","disableNotifications","updateDisableNotificationsById","hideUnreadStatus","updateHideUnreadStatusById","muteGroupMentions","updateMuteGroupMentions","desktopNotificationDuration","updateDesktopNotificationDurationById","audioNotificationValue","updateAudioNotificationValueById","isInvalidNotification","Object","keys","includes","basicValuesForNotifications","fieldsMustHaveBasicValues","findOneByRoomIdAndUserId","saveAudioNotificationValue","rid","saveDesktopNotificationDuration","query","update","$unset","$set","desktopPrefOrigin","parseInt","mobilePrefOrigin","emailPrefOrigin","findAlwaysNotifyAudioUsersByRoomId","find","findAlwaysNotifyDesktopUsersByRoomId","findDontNotifyDesktopUsersByRoomId","findAlwaysNotifyMobileUsersByRoomId","findDontNotifyMobileUsersByRoomId","findWithSendEmailByRoomId","$exists","fields","u","findNotificationPreferencesByRoom","_db","t","name","fname","code","ignored","userHighlights","findAllMessagesNotificationPreferencesByRoom","$or","$in"],"mappings":"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","file":"/packages/rocketchat_push-notifications.js","sourcesContent":["Meteor.methods({\n\tsaveNotificationSettings(roomId, field, value) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'saveNotificationSettings' });\n\t\t}\n\t\tcheck(roomId, String);\n\t\tcheck(field, String);\n\t\tcheck(value, String);\n\n\t\tconst notifications = {\n\t\t\taudioNotifications: {\n\t\t\t\tupdateMethod: (subscription, value) => RocketChat.models.Subscriptions.updateAudioNotificationsById(subscription._id, value),\n\t\t\t},\n\t\t\tdesktopNotifications: {\n\t\t\t\tupdateMethod: (subscription, value) => {\n\t\t\t\t\tif (value === 'default') {\n\t\t\t\t\t\tconst userPref = RocketChat.getUserNotificationPreference(Meteor.userId(), 'desktop');\n\t\t\t\t\t\tRocketChat.models.Subscriptions.updateDesktopNotificationsById(subscription._id, userPref.origin === 'server' ? null : userPref);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tRocketChat.models.Subscriptions.updateDesktopNotificationsById(subscription._id, { value, origin: 'subscription' });\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tmobilePushNotifications: {\n\t\t\t\tupdateMethod: (subscription, value) => {\n\t\t\t\t\tif (value === 'default') {\n\t\t\t\t\t\tconst userPref = RocketChat.getUserNotificationPreference(Meteor.userId(), 'mobile');\n\t\t\t\t\t\tRocketChat.models.Subscriptions.updateMobilePushNotificationsById(subscription._id, userPref.origin === 'server' ? null : userPref);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tRocketChat.models.Subscriptions.updateMobilePushNotificationsById(subscription._id, { value, origin: 'subscription' });\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\temailNotifications: {\n\t\t\t\tupdateMethod: (subscription, value) => {\n\t\t\t\t\tif (value === 'default') {\n\t\t\t\t\t\tconst userPref = RocketChat.getUserNotificationPreference(Meteor.userId(), 'email');\n\t\t\t\t\t\tRocketChat.models.Subscriptions.updateEmailNotificationsById(subscription._id, userPref.origin === 'server' ? null : userPref);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tRocketChat.models.Subscriptions.updateEmailNotificationsById(subscription._id, { value, origin: 'subscription' });\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tunreadAlert: {\n\t\t\t\tupdateMethod: (subscription, value) => RocketChat.models.Subscriptions.updateUnreadAlertById(subscription._id, value),\n\t\t\t},\n\t\t\tdisableNotifications: {\n\t\t\t\tupdateMethod: (subscription, value) => RocketChat.models.Subscriptions.updateDisableNotificationsById(subscription._id, value === '1'),\n\t\t\t},\n\t\t\thideUnreadStatus: {\n\t\t\t\tupdateMethod: (subscription, value) => RocketChat.models.Subscriptions.updateHideUnreadStatusById(subscription._id, value === '1'),\n\t\t\t},\n\t\t\tmuteGroupMentions: {\n\t\t\t\tupdateMethod: (subscription, value) => RocketChat.models.Subscriptions.updateMuteGroupMentions(subscription._id, value === '1'),\n\t\t\t},\n\t\t\tdesktopNotificationDuration: {\n\t\t\t\tupdateMethod: (subscription, value) => RocketChat.models.Subscriptions.updateDesktopNotificationDurationById(subscription._id, value),\n\t\t\t},\n\t\t\taudioNotificationValue: {\n\t\t\t\tupdateMethod: (subscription, value) => RocketChat.models.Subscriptions.updateAudioNotificationValueById(subscription._id, value),\n\t\t\t},\n\t\t};\n\t\tconst isInvalidNotification = !Object.keys(notifications).includes(field);\n\t\tconst basicValuesForNotifications = ['all', 'mentions', 'nothing', 'default'];\n\t\tconst fieldsMustHaveBasicValues = ['emailNotifications', 'audioNotifications', 'mobilePushNotifications', 'desktopNotifications'];\n\n\t\tif (isInvalidNotification) {\n\t\t\tthrow new Meteor.Error('error-invalid-settings', 'Invalid settings field', { method: 'saveNotificationSettings' });\n\t\t}\n\n\t\tif (fieldsMustHaveBasicValues.includes(field) && !basicValuesForNotifications.includes(value)) {\n\t\t\tthrow new Meteor.Error('error-invalid-settings', 'Invalid settings value', { method: 'saveNotificationSettings' });\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(roomId, Meteor.userId());\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-subscription', 'Invalid subscription', { method: 'saveNotificationSettings' });\n\t\t}\n\n\t\tnotifications[field].updateMethod(subscription, value);\n\n\t\treturn true;\n\t},\n\n\tsaveAudioNotificationValue(rid, value) {\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, Meteor.userId());\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-subscription', 'Invalid subscription', { method: 'saveAudioNotificationValue' });\n\t\t}\n\t\tRocketChat.models.Subscriptions.updateAudioNotificationValueById(subscription._id, value);\n\t\treturn true;\n\t},\n\n\tsaveDesktopNotificationDuration(rid, value) {\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, Meteor.userId());\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-subscription', 'Invalid subscription', { method: 'saveDesktopNotificationDuration' });\n\t\t}\n\t\tRocketChat.models.Subscriptions.updateDesktopNotificationDurationById(subscription._id, value);\n\t\treturn true;\n\t},\n});\n","RocketChat.models.Subscriptions.updateAudioNotificationsById = function(_id, audioNotifications) {\n\tconst query = {\n\t\t_id,\n\t};\n\n\tconst update = {};\n\n\tif (audioNotifications === 'default') {\n\t\tupdate.$unset = { audioNotifications: 1 };\n\t} else {\n\t\tupdate.$set = { audioNotifications };\n\t}\n\n\treturn this.update(query, update);\n};\n\nRocketChat.models.Subscriptions.updateAudioNotificationValueById = function(_id, audioNotificationValue) {\n\tconst query = {\n\t\t_id,\n\t};\n\n\tconst update = {\n\t\t$set: {\n\t\t\taudioNotificationValue,\n\t\t},\n\t};\n\n\treturn this.update(query, update);\n};\n\nRocketChat.models.Subscriptions.updateDesktopNotificationsById = function(_id, desktopNotifications) {\n\tconst query = {\n\t\t_id,\n\t};\n\n\tconst update = {};\n\n\tif (desktopNotifications === null) {\n\t\tupdate.$unset = {\n\t\t\tdesktopNotifications: 1,\n\t\t\tdesktopPrefOrigin: 1,\n\t\t};\n\t} else {\n\t\tupdate.$set = {\n\t\t\tdesktopNotifications: desktopNotifications.value,\n\t\t\tdesktopPrefOrigin: desktopNotifications.origin,\n\t\t};\n\t}\n\n\treturn this.update(query, update);\n};\n\nRocketChat.models.Subscriptions.updateDesktopNotificationDurationById = function(_id, value) {\n\tconst query = {\n\t\t_id,\n\t};\n\n\tconst update = {\n\t\t$set: {\n\t\t\tdesktopNotificationDuration: parseInt(value),\n\t\t},\n\t};\n\n\treturn this.update(query, update);\n};\n\nRocketChat.models.Subscriptions.updateMobilePushNotificationsById = function(_id, mobilePushNotifications) {\n\tconst query = {\n\t\t_id,\n\t};\n\n\tconst update = {};\n\n\tif (mobilePushNotifications === null) {\n\t\tupdate.$unset = {\n\t\t\tmobilePushNotifications: 1,\n\t\t\tmobilePrefOrigin: 1,\n\t\t};\n\t} else {\n\t\tupdate.$set = {\n\t\t\tmobilePushNotifications: mobilePushNotifications.value,\n\t\t\tmobilePrefOrigin: mobilePushNotifications.origin,\n\t\t};\n\t}\n\n\treturn this.update(query, update);\n};\n\nRocketChat.models.Subscriptions.updateEmailNotificationsById = function(_id, emailNotifications) {\n\tconst query = {\n\t\t_id,\n\t};\n\n\tconst update = {};\n\n\tif (emailNotifications === null) {\n\t\tupdate.$unset = {\n\t\t\temailNotifications: 1,\n\t\t\temailPrefOrigin: 1,\n\t\t};\n\t} else {\n\t\tupdate.$set = {\n\t\t\temailNotifications: emailNotifications.value,\n\t\t\temailPrefOrigin: emailNotifications.origin,\n\t\t};\n\t}\n\n\treturn this.update(query, update);\n};\n\nRocketChat.models.Subscriptions.updateUnreadAlertById = function(_id, unreadAlert) {\n\tconst query = {\n\t\t_id,\n\t};\n\n\tconst update = {\n\t\t$set: {\n\t\t\tunreadAlert,\n\t\t},\n\t};\n\n\treturn this.update(query, update);\n};\n\nRocketChat.models.Subscriptions.updateDisableNotificationsById = function(_id, disableNotifications) {\n\tconst query = {\n\t\t_id,\n\t};\n\n\tconst update = {\n\t\t$set: {\n\t\t\tdisableNotifications,\n\t\t},\n\t};\n\n\treturn this.update(query, update);\n};\n\nRocketChat.models.Subscriptions.updateHideUnreadStatusById = function(_id, hideUnreadStatus) {\n\tconst query = {\n\t\t_id,\n\t};\n\n\tconst update = {\n\t\t$set: {\n\t\t\thideUnreadStatus,\n\t\t},\n\t};\n\n\treturn this.update(query, update);\n};\n\nRocketChat.models.Subscriptions.updateMuteGroupMentions = function(_id, muteGroupMentions) {\n\tconst query = {\n\t\t_id,\n\t};\n\n\tconst update = {\n\t\t$set: {\n\t\t\tmuteGroupMentions,\n\t\t},\n\t};\n\n\treturn this.update(query, update);\n};\n\nRocketChat.models.Subscriptions.findAlwaysNotifyAudioUsersByRoomId = function(roomId) {\n\tconst query = {\n\t\trid: roomId,\n\t\taudioNotifications: 'all',\n\t};\n\n\treturn this.find(query);\n};\n\nRocketChat.models.Subscriptions.findAlwaysNotifyDesktopUsersByRoomId = function(roomId) {\n\tconst query = {\n\t\trid: roomId,\n\t\tdesktopNotifications: 'all',\n\t};\n\n\treturn this.find(query);\n};\n\nRocketChat.models.Subscriptions.findDontNotifyDesktopUsersByRoomId = function(roomId) {\n\tconst query = {\n\t\trid: roomId,\n\t\tdesktopNotifications: 'nothing',\n\t};\n\n\treturn this.find(query);\n};\n\nRocketChat.models.Subscriptions.findAlwaysNotifyMobileUsersByRoomId = function(roomId) {\n\tconst query = {\n\t\trid: roomId,\n\t\tmobilePushNotifications: 'all',\n\t};\n\n\treturn this.find(query);\n};\n\nRocketChat.models.Subscriptions.findDontNotifyMobileUsersByRoomId = function(roomId) {\n\tconst query = {\n\t\trid: roomId,\n\t\tmobilePushNotifications: 'nothing',\n\t};\n\n\treturn this.find(query);\n};\n\nRocketChat.models.Subscriptions.findWithSendEmailByRoomId = function(roomId) {\n\tconst query = {\n\t\trid: roomId,\n\t\temailNotifications: {\n\t\t\t$exists: true,\n\t\t},\n\t};\n\n\treturn this.find(query, { fields: { emailNotifications: 1, u: 1 } });\n};\n\n\nRocketChat.models.Subscriptions.findNotificationPreferencesByRoom = function(query/* { roomId: rid, desktopFilter: desktopNotifications, mobileFilter: mobilePushNotifications, emailFilter: emailNotifications }*/) {\n\n\treturn this._db.find(query, {\n\t\tfields: {\n\n\t\t\t// fields needed for notifications\n\t\t\trid: 1,\n\t\t\tt: 1,\n\t\t\tu: 1,\n\t\t\tname: 1,\n\t\t\tfname: 1,\n\t\t\tcode: 1,\n\n\t\t\t// fields to define if should send a notification\n\t\t\tignored: 1,\n\t\t\taudioNotifications: 1,\n\t\t\taudioNotificationValue: 1,\n\t\t\tdesktopNotificationDuration: 1,\n\t\t\tdesktopNotifications: 1,\n\t\t\tmobilePushNotifications: 1,\n\t\t\temailNotifications: 1,\n\t\t\tdisableNotifications: 1,\n\t\t\tmuteGroupMentions: 1,\n\t\t\tuserHighlights: 1,\n\t\t},\n\t});\n};\n\nRocketChat.models.Subscriptions.findAllMessagesNotificationPreferencesByRoom = function(roomId) {\n\tconst query = {\n\t\trid: roomId,\n\t\t'u._id': { $exists: true },\n\t\t$or: [\n\t\t\t{ desktopNotifications: { $in: ['all', 'mentions'] } },\n\t\t\t{ mobilePushNotifications: { $in: ['all', 'mentions'] } },\n\t\t\t{ emailNotifications: { $in: ['all', 'mentions'] } },\n\t\t],\n\t};\n\n\treturn this._db.find(query, {\n\t\tfields: {\n\t\t\t'u._id': 1,\n\t\t\taudioNotifications: 1,\n\t\t\taudioNotificationValue: 1,\n\t\t\tdesktopNotificationDuration: 1,\n\t\t\tdesktopNotifications: 1,\n\t\t\tmobilePushNotifications: 1,\n\t\t\temailNotifications: 1,\n\t\t\tdisableNotifications: 1,\n\t\t\tmuteGroupMentions: 1,\n\t\t},\n\t});\n};\n"]}