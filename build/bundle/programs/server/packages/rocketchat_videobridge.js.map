{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:videobridge/lib/messageType.js","meteor://ðŸ’»app/packages/rocketchat:videobridge/server/settings.js","meteor://ðŸ’»app/packages/rocketchat:videobridge/server/models/Rooms.js","meteor://ðŸ’»app/packages/rocketchat:videobridge/server/methods/jitsiSetTimeout.js","meteor://ðŸ’»app/packages/rocketchat:videobridge/server/methods/bbb.js","meteor://ðŸ’»app/packages/rocketchat:videobridge/server/actionLink.js"],"names":["Meteor","startup","RocketChat","MessageTypes","registerType","id","system","message","TAPi18n","__","settings","addGroup","section","add","type","i18nLabel","alert","public","enableQuery","_id","value","models","Rooms","setJitsiTimeout","time","query","update","$set","jitsiTimeout","methods","rid","userId","Error","method","room","findOneById","currentTime","Date","getTime","Messages","createWithTypeRoomIdMessageAndUser","user","actionLinks","icon","label","method_id","params","msg","mentions","username","callbacks","run","BigBlueButtonApi","module","watch","require","default","v","HTTP","xml2js","parser","Parser","explicitRoot","parseString","wrapAsync","getBBBAPI","url","get","secret","api","bbbJoin","call","meetingID","createUrl","urlFor","name","t","attendeePW","moderatorPW","welcome","meta_html5chat","meta_html5navbar","meta_html5autoswaplayout","meta_html5autosharewebcam","meta_html5hidepresentation","createResult","doc","content","response","returncode","Users","hookApi","callbackURL","absoluteUrl","hookResult","statusCode","console","log","saveStreamingOptions","password","fullName","userID","avatarURL","clientURL","bbbEnd","endApi","endApiResult","API","v1","addRoute","authRequired","post","event","JSON","parse","bodyParams","eventType","data","attributes","meeting","replace","register"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAAA,OAAOC,OAAP,CAAe,YAAW;AACzBC,aAAWC,YAAX,CAAwBC,YAAxB,CAAqC;AACpCC,QAAI,oBADgC;AAEpCC,YAAQ,IAF4B;AAGpCC,aAASC,QAAQC,EAAR,CAAW,sBAAX;AAH2B,GAArC;AAKA,CAND,E;;;;;;;;;;;ACAAT,OAAOC,OAAP,CAAe,YAAW;AACzBC,aAAWQ,QAAX,CAAoBC,QAApB,CAA6B,kBAA7B,EAAiD,YAAW;AAE3D,SAAKC,OAAL,CAAa,eAAb,EAA8B,YAAW;AAExC,WAAKC,GAAL,CAAS,uBAAT,EAAkC,KAAlC,EAAyC;AACxCC,cAAM,SADkC;AAExCC,mBAAW,SAF6B;AAGxCC,eAAO,mGAHiC;AAIxCC,gBAAQ;AAJgC,OAAzC;AAOA,WAAKJ,GAAL,CAAS,sBAAT,EAAiC,EAAjC,EAAqC;AACpCC,cAAM,QAD8B;AAEpCC,mBAAW,QAFyB;AAGpCG,qBAAa;AACZC,eAAK,uBADO;AAEZC,iBAAO;AAFK;AAHuB,OAArC;AASA,WAAKP,GAAL,CAAS,4BAAT,EAAuC,EAAvC,EAA2C;AAC1CC,cAAM,QADoC;AAE1CC,mBAAW,eAF+B;AAG1CG,qBAAa;AACZC,eAAK,uBADO;AAEZC,iBAAO;AAFK;AAH6B,OAA3C;AASA,WAAKP,GAAL,CAAS,wBAAT,EAAmC,IAAnC,EAAyC;AACxCC,cAAM,SADkC;AAExCC,mBAAW,sBAF6B;AAGxCG,qBAAa;AACZC,eAAK,uBADO;AAEZC,iBAAO;AAFK,SAH2B;AAOxCH,gBAAQ;AAPgC,OAAzC;AAUA,WAAKJ,GAAL,CAAS,wBAAT,EAAmC,IAAnC,EAAyC;AACxCC,cAAM,SADkC;AAExCC,mBAAW,uBAF6B;AAGxCG,qBAAa;AACZC,eAAK,uBADO;AAEZC,iBAAO;AAFK,SAH2B;AAOxCH,gBAAQ;AAPgC,OAAzC;AAUA,WAAKJ,GAAL,CAAS,wBAAT,EAAmC,KAAnC,EAA0C;AACzCC,cAAM,SADmC;AAEzCC,mBAAW,uBAF8B;AAGzCG,qBAAa;AACZC,eAAK,uBADO;AAEZC,iBAAO;AAFK,SAH4B;AAOzCH,gBAAQ;AAPiC,OAA1C;AAUA,KAzDD;AA2DA,SAAKL,OAAL,CAAa,OAAb,EAAsB,YAAW;AAChC,WAAKC,GAAL,CAAS,eAAT,EAA0B,KAA1B,EAAiC;AAChCC,cAAM,SAD0B;AAEhCC,mBAAW,SAFqB;AAGhCC,eAAO,mGAHyB;AAIhCC,gBAAQ;AAJwB,OAAjC;AAOA,WAAKJ,GAAL,CAAS,cAAT,EAAyB,aAAzB,EAAwC;AACvCC,cAAM,QADiC;AAEvCI,qBAAa;AACZC,eAAK,eADO;AAEZC,iBAAO;AAFK,SAF0B;AAMvCL,mBAAW,QAN4B;AAOvCE,gBAAQ;AAP+B,OAAxC;AAUA,WAAKJ,GAAL,CAAS,uBAAT,EAAkC,YAAlC,EAAgD;AAC/CC,cAAM,QADyC;AAE/CI,qBAAa;AACZC,eAAK,eADO;AAEZC,iBAAO;AAFK,SAFkC;AAM/CL,mBAAW,iBANoC;AAO/CE,gBAAQ;AAPuC,OAAhD;AAUA,WAAKJ,GAAL,CAAS,WAAT,EAAsB,IAAtB,EAA4B;AAC3BC,cAAM,SADqB;AAE3BI,qBAAa;AACZC,eAAK,eADO;AAEZC,iBAAO;AAFK,SAFc;AAM3BL,mBAAW,KANgB;AAO3BE,gBAAQ;AAPmB,OAA5B;AAUA,WAAKJ,GAAL,CAAS,uBAAT,EAAkC,KAAlC,EAAyC;AACxCC,cAAM,SADkC;AAExCI,qBAAa;AACZC,eAAK,eADO;AAEZC,iBAAO;AAFK,SAF2B;AAMxCL,mBAAW,2BAN6B;AAOxCE,gBAAQ;AAPgC,OAAzC;AAUA,WAAKJ,GAAL,CAAS,uBAAT,EAAkC,KAAlC,EAAyC;AACxCC,cAAM,SADkC;AAExCI,qBAAa;AACZC,eAAK,eADO;AAEZC,iBAAO;AAFK,SAF2B;AAMxCL,mBAAW,uBAN6B;AAOxCE,gBAAQ;AAPgC,OAAzC;AAUA,WAAKJ,GAAL,CAAS,wBAAT,EAAmC,kCAAnC,EAAuE;AACtEC,cAAM,QADgE;AAEtEI,qBAAa;AACZC,eAAK,eADO;AAEZC,iBAAO;AAFK,SAFyD;AAMtEL,mBAAW,wBAN2D;AAOtEE,gBAAQ;AAP8D,OAAvE;AASA,KAnED;AAoEA,GAjID;AAkIA,CAnID,E;;;;;;;;;;;ACAA;;;;;AAKAf,WAAWmB,MAAX,CAAkBC,KAAlB,CAAwBC,eAAxB,GAA0C,UAASJ,GAAT,EAAcK,IAAd,EAAoB;AAC7D,QAAMC,QAAQ;AACbN;AADa,GAAd;AAIA,QAAMO,SAAS;AACdC,UAAM;AACLC,oBAAcJ;AADT;AADQ,GAAf;AAMA,SAAO,KAAKE,MAAL,CAAYD,KAAZ,EAAmBC,MAAnB,CAAP;AACA,CAZD,C;;;;;;;;;;;ACLA1B,OAAO6B,OAAP,CAAe;AACd,yBAAwBC,GAAD,IAAS;AAE/B,QAAI,CAAC9B,OAAO+B,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAI/B,OAAOgC,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAEC,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,UAAMC,OAAOhC,WAAWmB,MAAX,CAAkBC,KAAlB,CAAwBa,WAAxB,CAAoCL,GAApC,CAAb;AACA,UAAMM,cAAc,IAAIC,IAAJ,GAAWC,OAAX,EAApB;AAEA,UAAMV,eAAe,IAAIS,IAAJ,CAAUH,QAAQA,KAAKN,YAAd,IAA+BQ,WAAxC,EAAqDE,OAArD,EAArB;;AAEA,QAAIV,gBAAgBQ,WAApB,EAAiC;AAChClC,iBAAWmB,MAAX,CAAkBC,KAAlB,CAAwBC,eAAxB,CAAwCO,GAAxC,EAA6C,IAAIO,IAAJ,CAASD,cAAc,KAAK,IAA5B,CAA7C;AACA,YAAM7B,UAAUL,WAAWmB,MAAX,CAAkBkB,QAAlB,CAA2BC,kCAA3B,CAA8D,oBAA9D,EAAoFV,GAApF,EAAyF,EAAzF,EAA6F9B,OAAOyC,IAAP,EAA7F,EAA4G;AAC3HC,qBAAc,CACb;AAAEC,gBAAM,eAAR;AAAyBC,iBAAOpC,QAAQC,EAAR,CAAW,eAAX,CAAhC;AAA6DoC,qBAAW,eAAxE;AAAyFC,kBAAQ;AAAjG,SADa;AAD6G,OAA5G,CAAhB;AAKA,YAAMZ,OAAOhC,WAAWmB,MAAX,CAAkBC,KAAlB,CAAwBa,WAAxB,CAAoCL,GAApC,CAAb;AACAvB,cAAQwC,GAAR,GAAcvC,QAAQC,EAAR,CAAW,sBAAX,CAAd;AACAF,cAAQyC,QAAR,GAAmB,CAClB;AACC7B,aAAI,MADL;AAEC8B,kBAAS;AAFV,OADkB,CAAnB;AAMA/C,iBAAWgD,SAAX,CAAqBC,GAArB,CAAyB,kBAAzB,EAA6C5C,OAA7C,EAAsD2B,IAAtD;AACA,KAhBD,MAgBO,IAAI,CAACN,eAAeQ,WAAhB,IAA+B,IAA/B,IAAuC,EAA3C,EAA+C;AACrDlC,iBAAWmB,MAAX,CAAkBC,KAAlB,CAAwBC,eAAxB,CAAwCO,GAAxC,EAA6C,IAAIO,IAAJ,CAAST,eAAe,KAAK,IAA7B,CAA7C;AACA;AACD;AA/Ba,CAAf,E;;;;;;;;;;;ACAA,IAAIwB,gBAAJ;AAAqBC,OAAOC,KAAP,CAAaC,QAAQ,iCAAR,CAAb,EAAwD;AAACC,UAAQC,CAAR,EAAU;AAACL,uBAAiBK,CAAjB;AAAmB;;AAA/B,CAAxD,EAAyF,CAAzF;AAA4F,IAAIC,IAAJ;AAASL,OAAOC,KAAP,CAAaC,QAAQ,aAAR,CAAb,EAAoC;AAACG,OAAKD,CAAL,EAAO;AAACC,WAAKD,CAAL;AAAO;;AAAhB,CAApC,EAAsD,CAAtD;AAAyD,IAAIE,MAAJ;AAAWN,OAAOC,KAAP,CAAaC,QAAQ,QAAR,CAAb,EAA+B;AAACC,UAAQC,CAAR,EAAU;AAACE,aAAOF,CAAP;AAAS;;AAArB,CAA/B,EAAsD,CAAtD;AAI9L,MAAMG,SAAS,IAAID,OAAOE,MAAX,CAAkB;AAChCC,gBAAc;AADkB,CAAlB,CAAf;AAIA,MAAMC,cAAc/D,OAAOgE,SAAP,CAAiBJ,OAAOG,WAAxB,CAApB;;AAEA,MAAME,YAAY,MAAM;AACvB,QAAMC,MAAMhE,WAAWQ,QAAX,CAAoByD,GAApB,CAAwB,sBAAxB,CAAZ;AACA,QAAMC,SAASlE,WAAWQ,QAAX,CAAoByD,GAApB,CAAwB,4BAAxB,CAAf;AACA,QAAME,MAAM,IAAIjB,gBAAJ,CAAsB,GAAGc,GAAK,oBAA9B,EAAmDE,MAAnD,CAAZ;AAEA,SAAO;AAAEC,OAAF;AAAOH;AAAP,GAAP;AACA,CAND;;AAQAlE,OAAO6B,OAAP,CAAe;AACdyC,UAAQ;AAAExC;AAAF,GAAR,EAAiB;AAEhB,QAAI,CAAC,KAAKC,MAAV,EAAkB;AACjB,YAAM,IAAI/B,OAAOgC,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAEC,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,QAAI,CAACjC,OAAOuE,IAAP,CAAY,eAAZ,EAA6BzC,GAA7B,EAAkC,KAAKC,MAAvC,CAAL,EAAqD;AACpD,YAAM,IAAI/B,OAAOgC,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAEC,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,QAAI,CAAC/B,WAAWQ,QAAX,CAAoByD,GAApB,CAAwB,uBAAxB,CAAL,EAAuD;AACtD,YAAM,IAAInE,OAAOgC,KAAX,CAAiB,mBAAjB,EAAsC,aAAtC,EAAqD;AAAEC,gBAAQ;AAAV,OAArD,CAAN;AACA;;AAED,UAAM;AAAEoC,SAAF;AAAOH;AAAP,QAAeD,WAArB;AACA,UAAMO,YAAYtE,WAAWQ,QAAX,CAAoByD,GAApB,CAAwB,UAAxB,IAAsCrC,GAAxD;AACA,UAAMI,OAAOhC,WAAWmB,MAAX,CAAkBC,KAAlB,CAAwBa,WAAxB,CAAoCL,GAApC,CAAb;AACA,UAAM2C,YAAYJ,IAAIK,MAAJ,CAAW,QAAX,EAAqB;AACtCC,YAAMzC,KAAK0C,CAAL,KAAW,GAAX,GAAiB,QAAjB,GAA4B1C,KAAKyC,IADD;AAEtCH,eAFsC;AAGtCK,kBAAY,IAH0B;AAItCC,mBAAa,IAJyB;AAKtCC,eAAS,qCAL6B;AAMtCC,sBAAgB,KANsB;AAOtCC,wBAAkB,KAPoB;AAQtCC,gCAA0B,IARY;AAStCC,iCAA2B,KATW;AAUtCC,kCAA4B;AAVU,KAArB,CAAlB;AAaA,UAAMC,eAAe3B,KAAKS,GAAL,CAASM,SAAT,CAArB;AACA,UAAMa,MAAMvB,YAAYsB,aAAaE,OAAzB,CAAZ;;AAEA,QAAID,IAAIE,QAAJ,CAAaC,UAAb,CAAwB,CAAxB,CAAJ,EAAgC;AAC/B,YAAMhD,OAAOvC,WAAWmB,MAAX,CAAkBqE,KAAlB,CAAwBvD,WAAxB,CAAoC,KAAKJ,MAAzC,CAAb;AAEA,YAAM4D,UAAUtB,IAAIK,MAAJ,CAAW,cAAX,EAA2B;AAC1CF,iBAD0C;AAE1CoB,qBAAa5F,OAAO6F,WAAP,CAAoB,qCAAqCrB,SAAW,EAApE;AAF6B,OAA3B,CAAhB;AAKA,YAAMsB,aAAapC,KAAKS,GAAL,CAASwB,OAAT,CAAnB;;AAEA,UAAIG,WAAWC,UAAX,KAA0B,GAA9B,EAAmC;AAClC;AACAC,gBAAQC,GAAR,CAAY;AAAEH;AAAF,SAAZ;AACA;AACA;;AAED5F,iBAAWgG,oBAAX,CAAgCpE,GAAhC,EAAqC;AACpChB,cAAM;AAD8B,OAArC;AAIA,aAAO;AACNoD,aAAKG,IAAIK,MAAJ,CAAW,MAAX,EAAmB;AACvByB,oBAAU,IADa;AACP;AAChB3B,mBAFuB;AAGvB4B,oBAAU3D,KAAKQ,QAHQ;AAIvBoD,kBAAQ5D,KAAKtB,GAJU;AAKvBmF,qBAAWtG,OAAO6F,WAAP,CAAoB,UAAUpD,KAAKQ,QAAU,EAA7C,CALY;AAMvBsD,qBAAY,GAAGrC,GAAK;AANG,SAAnB;AADC,OAAP;AAUA;AACD,GAjEa;;AAmEdsC,SAAO;AAAE1E;AAAF,GAAP,EAAgB;AACf,QAAI,CAAC,KAAKC,MAAV,EAAkB;AACjB,YAAM,IAAI/B,OAAOgC,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAEC,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,QAAI,CAACjC,OAAOuE,IAAP,CAAY,eAAZ,EAA6BzC,GAA7B,EAAkC,KAAKC,MAAvC,CAAL,EAAqD;AACpD,YAAM,IAAI/B,OAAOgC,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAEC,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,QAAI,CAAC/B,WAAWQ,QAAX,CAAoByD,GAApB,CAAwB,uBAAxB,CAAL,EAAuD;AACtD,YAAM,IAAInE,OAAOgC,KAAX,CAAiB,mBAAjB,EAAsC,aAAtC,EAAqD;AAAEC,gBAAQ;AAAV,OAArD,CAAN;AACA;;AAED,UAAM;AAAEoC;AAAF,QAAUJ,WAAhB;AACA,UAAMO,YAAYtE,WAAWQ,QAAX,CAAoByD,GAApB,CAAwB,UAAxB,IAAsCrC,GAAxD;AACA,UAAM2E,SAASpC,IAAIK,MAAJ,CAAW,KAAX,EAAkB;AAChCF,eADgC;AAEhC2B,gBAAU,IAFsB,CAEhB;;AAFgB,KAAlB,CAAf;AAKA,UAAMO,eAAehD,KAAKS,GAAL,CAASsC,MAAT,CAArB;;AAEA,QAAIC,aAAaX,UAAb,KAA4B,GAAhC,EAAqC;AACpC;AACAC,cAAQC,GAAR,CAAY;AAAES;AAAF,OAAZ;AACA;AACA;;AAED,UAAMpB,MAAMvB,YAAY2C,aAAanB,OAAzB,CAAZ;;AAEA,QAAID,IAAIE,QAAJ,CAAaC,UAAb,CAAwB,CAAxB,MAA+B,QAAnC,EAA6C;AAC5CvF,iBAAWgG,oBAAX,CAAgCpE,GAAhC,EAAqC,EAArC;AACA;AACD;;AApGa,CAAf;AAuGA5B,WAAWyG,GAAX,CAAeC,EAAf,CAAkBC,QAAlB,CAA2B,gCAA3B,EAA6D;AAAEC,gBAAc;AAAhB,CAA7D,EAAsF;AACrFC,SAAO;AACN;AACA,UAAMC,QAAQC,KAAKC,KAAL,CAAW,KAAKC,UAAL,CAAgBH,KAA3B,EAAkC,CAAlC,CAAd;AACA,UAAMI,YAAYJ,MAAMK,IAAN,CAAWhH,EAA7B;AACA,UAAMmE,YAAYwC,MAAMK,IAAN,CAAWC,UAAX,CAAsBC,OAAtB,CAA8B,qBAA9B,CAAlB;AACA,UAAMzF,MAAM0C,UAAUgD,OAAV,CAAkBtH,WAAWQ,QAAX,CAAoByD,GAApB,CAAwB,UAAxB,CAAlB,EAAuD,EAAvD,CAAZ;AAEA6B,YAAQC,GAAR,CAAYmB,SAAZ,EAAuBtF,GAAvB;;AAEA,QAAIsF,cAAc,eAAlB,EAAmC;AAClClH,iBAAWgG,oBAAX,CAAgCpE,GAAhC,EAAqC,EAArC;AACA,KAXK,CAaN;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;;AACA;;AAnCoF,CAAtF,E;;;;;;;;;;;ACzHA5B,WAAWwC,WAAX,CAAuB+E,QAAvB,CAAgC,eAAhC,EAAiD;AAAS;AAAsB,CAE/E,CAFD,E","file":"/packages/rocketchat_videobridge.js","sourcesContent":["Meteor.startup(function() {\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'jitsi_call_started',\n\t\tsystem: true,\n\t\tmessage: TAPi18n.__('Started_a_video_call'),\n\t});\n});\n","Meteor.startup(function() {\n\tRocketChat.settings.addGroup('Video Conference', function() {\n\n\t\tthis.section('BigBlueButton', function() {\n\n\t\t\tthis.add('bigbluebutton_Enabled', false, {\n\t\t\t\ttype: 'boolean',\n\t\t\t\ti18nLabel: 'Enabled',\n\t\t\t\talert: 'This Feature is currently in beta! Please report bugs to github.com/RocketChat/Rocket.Chat/issues',\n\t\t\t\tpublic: true,\n\t\t\t});\n\n\t\t\tthis.add('bigbluebutton_server', '', {\n\t\t\t\ttype: 'string',\n\t\t\t\ti18nLabel: 'Domain',\n\t\t\t\tenableQuery: {\n\t\t\t\t\t_id: 'bigbluebutton_Enabled',\n\t\t\t\t\tvalue: true,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.add('bigbluebutton_sharedSecret', '', {\n\t\t\t\ttype: 'string',\n\t\t\t\ti18nLabel: 'Shared_Secret',\n\t\t\t\tenableQuery: {\n\t\t\t\t\t_id: 'bigbluebutton_Enabled',\n\t\t\t\t\tvalue: true,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.add('bigbluebutton_enable_d', true, {\n\t\t\t\ttype: 'boolean',\n\t\t\t\ti18nLabel: 'WebRTC_Enable_Direct',\n\t\t\t\tenableQuery: {\n\t\t\t\t\t_id: 'bigbluebutton_Enabled',\n\t\t\t\t\tvalue: true,\n\t\t\t\t},\n\t\t\t\tpublic: true,\n\t\t\t});\n\n\t\t\tthis.add('bigbluebutton_enable_p', true, {\n\t\t\t\ttype: 'boolean',\n\t\t\t\ti18nLabel: 'WebRTC_Enable_Private',\n\t\t\t\tenableQuery: {\n\t\t\t\t\t_id: 'bigbluebutton_Enabled',\n\t\t\t\t\tvalue: true,\n\t\t\t\t},\n\t\t\t\tpublic: true,\n\t\t\t});\n\n\t\t\tthis.add('bigbluebutton_enable_c', false, {\n\t\t\t\ttype: 'boolean',\n\t\t\t\ti18nLabel: 'WebRTC_Enable_Channel',\n\t\t\t\tenableQuery: {\n\t\t\t\t\t_id: 'bigbluebutton_Enabled',\n\t\t\t\t\tvalue: true,\n\t\t\t\t},\n\t\t\t\tpublic: true,\n\t\t\t});\n\n\t\t});\n\n\t\tthis.section('Jitsi', function() {\n\t\t\tthis.add('Jitsi_Enabled', false, {\n\t\t\t\ttype: 'boolean',\n\t\t\t\ti18nLabel: 'Enabled',\n\t\t\t\talert: 'This Feature is currently in beta! Please report bugs to github.com/RocketChat/Rocket.Chat/issues',\n\t\t\t\tpublic: true,\n\t\t\t});\n\n\t\t\tthis.add('Jitsi_Domain', 'meet.jit.si', {\n\t\t\t\ttype: 'string',\n\t\t\t\tenableQuery: {\n\t\t\t\t\t_id: 'Jitsi_Enabled',\n\t\t\t\t\tvalue: true,\n\t\t\t\t},\n\t\t\t\ti18nLabel: 'Domain',\n\t\t\t\tpublic: true,\n\t\t\t});\n\n\t\t\tthis.add('Jitsi_URL_Room_Prefix', 'RocketChat', {\n\t\t\t\ttype: 'string',\n\t\t\t\tenableQuery: {\n\t\t\t\t\t_id: 'Jitsi_Enabled',\n\t\t\t\t\tvalue: true,\n\t\t\t\t},\n\t\t\t\ti18nLabel: 'URL_room_prefix',\n\t\t\t\tpublic: true,\n\t\t\t});\n\n\t\t\tthis.add('Jitsi_SSL', true, {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tenableQuery: {\n\t\t\t\t\t_id: 'Jitsi_Enabled',\n\t\t\t\t\tvalue: true,\n\t\t\t\t},\n\t\t\t\ti18nLabel: 'SSL',\n\t\t\t\tpublic: true,\n\t\t\t});\n\n\t\t\tthis.add('Jitsi_Open_New_Window', false, {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tenableQuery: {\n\t\t\t\t\t_id: 'Jitsi_Enabled',\n\t\t\t\t\tvalue: true,\n\t\t\t\t},\n\t\t\t\ti18nLabel: 'Always_open_in_new_window',\n\t\t\t\tpublic: true,\n\t\t\t});\n\n\t\t\tthis.add('Jitsi_Enable_Channels', false, {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tenableQuery: {\n\t\t\t\t\t_id: 'Jitsi_Enabled',\n\t\t\t\t\tvalue: true,\n\t\t\t\t},\n\t\t\t\ti18nLabel: 'Jitsi_Enable_Channels',\n\t\t\t\tpublic: true,\n\t\t\t});\n\n\t\t\tthis.add('Jitsi_Chrome_Extension', 'nocfbnnmjnndkbipkabodnheejiegccf', {\n\t\t\t\ttype: 'string',\n\t\t\t\tenableQuery: {\n\t\t\t\t\t_id: 'Jitsi_Enabled',\n\t\t\t\t\tvalue: true,\n\t\t\t\t},\n\t\t\t\ti18nLabel: 'Jitsi_Chrome_Extension',\n\t\t\t\tpublic: true,\n\t\t\t});\n\t\t});\n\t});\n});\n","/**\n * sets jitsiTimeout to indicate a call is in progress\n * @param {string} _id - Room id\n * @parm {number} time - time to set\n */\nRocketChat.models.Rooms.setJitsiTimeout = function(_id, time) {\n\tconst query = {\n\t\t_id,\n\t};\n\n\tconst update = {\n\t\t$set: {\n\t\t\tjitsiTimeout: time,\n\t\t},\n\t};\n\n\treturn this.update(query, update);\n};\n","Meteor.methods({\n\t'jitsi:updateTimeout': (rid) => {\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'jitsi:updateTimeout' });\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\tconst currentTime = new Date().getTime();\n\n\t\tconst jitsiTimeout = new Date((room && room.jitsiTimeout) || currentTime).getTime();\n\n\t\tif (jitsiTimeout <= currentTime) {\n\t\t\tRocketChat.models.Rooms.setJitsiTimeout(rid, new Date(currentTime + 35 * 1000));\n\t\t\tconst message = RocketChat.models.Messages.createWithTypeRoomIdMessageAndUser('jitsi_call_started', rid, '', Meteor.user(), {\n\t\t\t\tactionLinks : [\n\t\t\t\t\t{ icon: 'icon-videocam', label: TAPi18n.__('Click_to_join'), method_id: 'joinJitsiCall', params: '' },\n\t\t\t\t],\n\t\t\t});\n\t\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\t\tmessage.msg = TAPi18n.__('Started_a_video_call');\n\t\t\tmessage.mentions = [\n\t\t\t\t{\n\t\t\t\t\t_id:'here',\n\t\t\t\t\tusername:'here',\n\t\t\t\t},\n\t\t\t];\n\t\t\tRocketChat.callbacks.run('afterSaveMessage', message, room);\n\t\t} else if ((jitsiTimeout - currentTime) / 1000 <= 15) {\n\t\t\tRocketChat.models.Rooms.setJitsiTimeout(rid, new Date(jitsiTimeout + 25 * 1000));\n\t\t}\n\t},\n});\n","import BigBlueButtonApi from 'meteor/rocketchat:bigbluebutton';\nimport { HTTP } from 'meteor/http';\nimport xml2js from 'xml2js';\n\nconst parser = new xml2js.Parser({\n\texplicitRoot: true,\n});\n\nconst parseString = Meteor.wrapAsync(parser.parseString);\n\nconst getBBBAPI = () => {\n\tconst url = RocketChat.settings.get('bigbluebutton_server');\n\tconst secret = RocketChat.settings.get('bigbluebutton_sharedSecret');\n\tconst api = new BigBlueButtonApi(`${ url }/bigbluebutton/api`, secret);\n\n\treturn { api, url };\n};\n\nMeteor.methods({\n\tbbbJoin({ rid }) {\n\n\t\tif (!this.userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'bbbJoin' });\n\t\t}\n\n\t\tif (!Meteor.call('canAccessRoom', rid, this.userId)) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'bbbJoin' });\n\t\t}\n\n\t\tif (!RocketChat.settings.get('bigbluebutton_Enabled')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not Allowed', { method: 'bbbJoin' });\n\t\t}\n\n\t\tconst { api, url } = getBBBAPI();\n\t\tconst meetingID = RocketChat.settings.get('uniqueID') + rid;\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\tconst createUrl = api.urlFor('create', {\n\t\t\tname: room.t === 'd' ? 'Direct' : room.name,\n\t\t\tmeetingID,\n\t\t\tattendeePW: 'ap',\n\t\t\tmoderatorPW: 'mp',\n\t\t\twelcome: '<br>Welcome to <b>%%CONFNAME%%</b>!',\n\t\t\tmeta_html5chat: false,\n\t\t\tmeta_html5navbar: false,\n\t\t\tmeta_html5autoswaplayout: true,\n\t\t\tmeta_html5autosharewebcam: false,\n\t\t\tmeta_html5hidepresentation: true,\n\t\t});\n\n\t\tconst createResult = HTTP.get(createUrl);\n\t\tconst doc = parseString(createResult.content);\n\n\t\tif (doc.response.returncode[0]) {\n\t\t\tconst user = RocketChat.models.Users.findOneById(this.userId);\n\n\t\t\tconst hookApi = api.urlFor('hooks/create', {\n\t\t\t\tmeetingID,\n\t\t\t\tcallbackURL: Meteor.absoluteUrl(`api/v1/videoconference.bbb.update/${ meetingID }`),\n\t\t\t});\n\n\t\t\tconst hookResult = HTTP.get(hookApi);\n\n\t\t\tif (hookResult.statusCode !== 200) {\n\t\t\t\t// TODO improve error logging\n\t\t\t\tconsole.log({ hookResult });\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tRocketChat.saveStreamingOptions(rid, {\n\t\t\t\ttype: 'call',\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\turl: api.urlFor('join', {\n\t\t\t\t\tpassword: 'mp', // mp if moderator ap if attendee\n\t\t\t\t\tmeetingID,\n\t\t\t\t\tfullName: user.username,\n\t\t\t\t\tuserID: user._id,\n\t\t\t\t\tavatarURL: Meteor.absoluteUrl(`avatar/${ user.username }`),\n\t\t\t\t\tclientURL: `${ url }/html5client/join`,\n\t\t\t\t}),\n\t\t\t};\n\t\t}\n\t},\n\n\tbbbEnd({ rid }) {\n\t\tif (!this.userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'bbbEnd' });\n\t\t}\n\n\t\tif (!Meteor.call('canAccessRoom', rid, this.userId)) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'bbbEnd' });\n\t\t}\n\n\t\tif (!RocketChat.settings.get('bigbluebutton_Enabled')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not Allowed', { method: 'bbbEnd' });\n\t\t}\n\n\t\tconst { api } = getBBBAPI();\n\t\tconst meetingID = RocketChat.settings.get('uniqueID') + rid;\n\t\tconst endApi = api.urlFor('end', {\n\t\t\tmeetingID,\n\t\t\tpassword: 'mp', // mp if moderator ap if attendee\n\t\t});\n\n\t\tconst endApiResult = HTTP.get(endApi);\n\n\t\tif (endApiResult.statusCode !== 200) {\n\t\t\t// TODO improve error logging\n\t\t\tconsole.log({ endApiResult });\n\t\t\treturn;\n\t\t}\n\n\t\tconst doc = parseString(endApiResult.content);\n\n\t\tif (doc.response.returncode[0] === 'FAILED') {\n\t\t\tRocketChat.saveStreamingOptions(rid, {});\n\t\t}\n\t},\n});\n\nRocketChat.API.v1.addRoute('videoconference.bbb.update/:id', { authRequired: false }, {\n\tpost() {\n\t\t// TODO check checksum\n\t\tconst event = JSON.parse(this.bodyParams.event)[0];\n\t\tconst eventType = event.data.id;\n\t\tconst meetingID = event.data.attributes.meeting['external-meeting-id'];\n\t\tconst rid = meetingID.replace(RocketChat.settings.get('uniqueID'), '');\n\n\t\tconsole.log(eventType, rid);\n\n\t\tif (eventType === 'meeting-ended') {\n\t\t\tRocketChat.saveStreamingOptions(rid, {});\n\t\t}\n\n\t\t// if (eventType === 'user-left') {\n\t\t// \tconst { api } = getBBBAPI();\n\n\t\t// \tconst getMeetingInfoApi = api.urlFor('getMeetingInfo', {\n\t\t// \t\tmeetingID\n\t\t// \t});\n\n\t\t// \tconst getMeetingInfoResult = HTTP.get(getMeetingInfoApi);\n\n\t\t// \tif (getMeetingInfoResult.statusCode !== 200) {\n\t\t// \t\t// TODO improve error logging\n\t\t// \t\tconsole.log({ getMeetingInfoResult });\n\t\t// \t}\n\n\t\t// \tconst doc = parseString(getMeetingInfoResult.content);\n\n\t\t// \tif (doc.response.returncode[0]) {\n\t\t// \t\tconst participantCount = parseInt(doc.response.participantCount[0]);\n\t\t// \t\tconsole.log(participantCount);\n\t\t// \t}\n\t\t// }\n\t},\n});\n","RocketChat.actionLinks.register('joinJitsiCall', function(/* message, params*/) {\n\n});\n"]}