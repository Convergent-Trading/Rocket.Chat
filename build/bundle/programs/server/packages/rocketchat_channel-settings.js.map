{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/functions/saveReactWhenReadOnly.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/functions/saveRoomType.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/functions/saveRoomTopic.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/functions/saveRoomCustomFields.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/functions/saveRoomAnnouncement.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/functions/saveRoomName.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/functions/saveRoomReadOnly.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/functions/saveRoomDescription.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/functions/saveRoomSystemMessages.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/methods/saveRoomSettings.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/models/Messages.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/models/Rooms.js","meteor://ðŸ’»app/packages/rocketchat:channel-settings/server/startup.js"],"names":["RocketChat","saveReactWhenReadOnly","rid","allowReact","Match","test","String","Meteor","Error","function","models","Rooms","setAllowReactingWhenReadOnlyById","saveRoomType","roomType","user","sendMessage","type","room","findOneById","_id","t","result","setTypeById","Subscriptions","updateTypeByRoomId","message","TAPi18n","__","lng","language","settings","get","Messages","createRoomSettingsChangedWithTypeRoomIdMessageAndUser","saveRoomTopic","roomTopic","update","setTopicById","saveRoomCustomFields","roomCustomFields","Object","ret","setCustomFieldsById","updateCustomFieldsByRoomId","saveRoomAnnouncement","roomAnnouncement","announcementDetails","updated","setAnnouncementById","saveRoomName","displayName","roomTypes","preventRenaming","name","slugifiedRoomName","getValidRoomName","setNameById","updateNameAndAlertByRoomId","createRoomRenamedWithRoomIdRoomNameAndUser","saveRoomReadOnly","readOnly","setReadOnlyById","saveRoomDescription","roomDescription","setDescriptionById","saveRoomSystemMessages","systemMessages","setSystemMessagesById","fields","methods","saveRoomSettings","value","userId","method","keys","every","key","includes","authz","hasPermission","action","broadcast","reactWhenReadOnly","forEach","setting","retention","enabled","maxAge","excludePinned","filesOnly","retentionMaxAge","retentionExcludePinned","retentionFilesOnly","topic","announcement","customFields","description","check","require","tokens","token","balance","saveRoomTokenpass","saveStreamingOptions","ro","sysMes","setJoinCodeById","saveDefaultById","saveRetentionEnabledById","saveRetentionMaxAgeById","saveRetentionExcludePinnedById","saveRetentionFilesOnlyById","saveRetentionOverrideGlobalById","roomId","extraData","createWithTypeRoomIdMessageAndUser","roomName","query","$set","muted","findByRoomIdWhenUsernameExists","u","push","username","$unset","length","allowReacting","startup","Permissions","upsert","$setOnInsert","roles"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAAA,WAAWC,qBAAX,GAAmC,UAASC,GAAT,EAAcC,UAAd,EAA0B;AAC5D,MAAI,CAACC,MAAMC,IAAN,CAAWH,GAAX,EAAgBI,MAAhB,CAAL,EAA8B;AAC7B,UAAM,IAAIC,OAAOC,KAAX,CAAiB,cAAjB,EAAiC,cAAjC,EAAiD;AAAEC,gBAAU;AAAZ,KAAjD,CAAN;AACA;;AAED,SAAOT,WAAWU,MAAX,CAAkBC,KAAlB,CAAwBC,gCAAxB,CAAyDV,GAAzD,EAA8DC,UAA9D,CAAP;AACA,CAND,C;;;;;;;;;;;ACCAH,WAAWa,YAAX,GAA0B,UAASX,GAAT,EAAcY,QAAd,EAAwBC,IAAxB,EAA8BC,cAAc,IAA5C,EAAkD;AAC3E,MAAI,CAACZ,MAAMC,IAAN,CAAWH,GAAX,EAAgBI,MAAhB,CAAL,EAA8B;AAC7B,UAAM,IAAIC,OAAOC,KAAX,CAAiB,cAAjB,EAAiC,cAAjC,EAAiD;AACtDC,gBAAU;AAD4C,KAAjD,CAAN;AAGA;;AACD,MAAIK,aAAa,GAAb,IAAoBA,aAAa,GAArC,EAA0C;AACzC,UAAM,IAAIP,OAAOC,KAAX,CAAiB,yBAAjB,EAA4C,yBAA5C,EAAuE;AAC5EC,gBAAU,yBADkE;AAE5EQ,YAAMH;AAFsE,KAAvE,CAAN;AAIA;;AACD,QAAMI,OAAOlB,WAAWU,MAAX,CAAkBC,KAAlB,CAAwBQ,WAAxB,CAAoCjB,GAApC,CAAb;;AACA,MAAIgB,QAAQ,IAAZ,EAAkB;AACjB,UAAM,IAAIX,OAAOC,KAAX,CAAiB,oBAAjB,EAAuC,oBAAvC,EAA6D;AAClEC,gBAAU,yBADwD;AAElEW,WAAKlB;AAF6D,KAA7D,CAAN;AAIA;;AACD,MAAIgB,KAAKG,CAAL,KAAW,GAAf,EAAoB;AACnB,UAAM,IAAId,OAAOC,KAAX,CAAiB,mBAAjB,EAAsC,oCAAtC,EAA4E;AACjFC,gBAAU;AADuE,KAA5E,CAAN;AAGA;;AACD,QAAMa,SAAStB,WAAWU,MAAX,CAAkBC,KAAlB,CAAwBY,WAAxB,CAAoCrB,GAApC,EAAyCY,QAAzC,KAAsDd,WAAWU,MAAX,CAAkBc,aAAlB,CAAgCC,kBAAhC,CAAmDvB,GAAnD,EAAwDY,QAAxD,CAArE;;AACA,MAAIQ,UAAUN,WAAd,EAA2B;AAC1B,QAAIU,OAAJ;;AACA,QAAIZ,aAAa,GAAjB,EAAsB;AACrBY,gBAAUC,QAAQC,EAAR,CAAW,SAAX,EAAsB;AAC/BC,aAAMd,QAAQA,KAAKe,QAAd,IAA2B9B,WAAW+B,QAAX,CAAoBC,GAApB,CAAwB,UAAxB,CAA3B,IAAkE;AADxC,OAAtB,CAAV;AAGA,KAJD,MAIO;AACNN,gBAAUC,QAAQC,EAAR,CAAW,eAAX,EAA4B;AACrCC,aAAMd,QAAQA,KAAKe,QAAd,IAA2B9B,WAAW+B,QAAX,CAAoBC,GAApB,CAAwB,UAAxB,CAA3B,IAAkE;AADlC,OAA5B,CAAV;AAGA;;AACDhC,eAAWU,MAAX,CAAkBuB,QAAlB,CAA2BC,qDAA3B,CAAiF,sBAAjF,EAAyGhC,GAAzG,EAA8GwB,OAA9G,EAAuHX,IAAvH;AACA;;AACD,SAAOO,MAAP;AACA,CAvCD,C;;;;;;;;;;;ACDAtB,WAAWmC,aAAX,GAA2B,UAASjC,GAAT,EAAckC,SAAd,EAAyBrB,IAAzB,EAA+BC,cAAc,IAA7C,EAAmD;AAC7E,MAAI,CAACZ,MAAMC,IAAN,CAAWH,GAAX,EAAgBI,MAAhB,CAAL,EAA8B;AAC7B,UAAM,IAAIC,OAAOC,KAAX,CAAiB,cAAjB,EAAiC,cAAjC,EAAiD;AACtDC,gBAAU;AAD4C,KAAjD,CAAN;AAGA;;AAED,QAAM4B,SAASrC,WAAWU,MAAX,CAAkBC,KAAlB,CAAwB2B,YAAxB,CAAqCpC,GAArC,EAA0CkC,SAA1C,CAAf;;AACA,MAAIC,UAAUrB,WAAd,EAA2B;AAC1BhB,eAAWU,MAAX,CAAkBuB,QAAlB,CAA2BC,qDAA3B,CAAiF,oBAAjF,EAAuGhC,GAAvG,EAA4GkC,SAA5G,EAAuHrB,IAAvH;AACA;;AACD,SAAOsB,MAAP;AACA,CAZD,C;;;;;;;;;;;ACAArC,WAAWuC,oBAAX,GAAkC,UAASrC,GAAT,EAAcsC,gBAAd,EAAgC;AACjE,MAAI,CAACpC,MAAMC,IAAN,CAAWH,GAAX,EAAgBI,MAAhB,CAAL,EAA8B;AAC7B,UAAM,IAAIC,OAAOC,KAAX,CAAiB,cAAjB,EAAiC,cAAjC,EAAiD;AACtDC,gBAAU;AAD4C,KAAjD,CAAN;AAGA;;AACD,MAAI,CAACL,MAAMC,IAAN,CAAWmC,gBAAX,EAA6BC,MAA7B,CAAL,EAA2C;AAC1C,UAAM,IAAIlC,OAAOC,KAAX,CAAiB,+BAAjB,EAAkD,+BAAlD,EAAmF;AACxFC,gBAAU;AAD8E,KAAnF,CAAN;AAGA;;AACD,QAAMiC,MAAM1C,WAAWU,MAAX,CAAkBC,KAAlB,CAAwBgC,mBAAxB,CAA4CzC,GAA5C,EAAiDsC,gBAAjD,CAAZ,CAXiE,CAajE;;AACAxC,aAAWU,MAAX,CAAkBc,aAAlB,CAAgCoB,0BAAhC,CAA2D1C,GAA3D,EAAgEsC,gBAAhE;AAEA,SAAOE,GAAP;AACA,CAjBD,C;;;;;;;;;;;;;;;ACAA1C,WAAW6C,oBAAX,GAAkC,UAAS3C,GAAT,EAAc4C,gBAAd,EAAgC/B,IAAhC,EAAsCC,cAAc,IAApD,EAA0D;AAC3F,MAAI,CAACZ,MAAMC,IAAN,CAAWH,GAAX,EAAgBI,MAAhB,CAAL,EAA8B;AAC7B,UAAM,IAAIC,OAAOC,KAAX,CAAiB,cAAjB,EAAiC,cAAjC,EAAiD;AAAEC,gBAAU;AAAZ,KAAjD,CAAN;AACA;;AAED,MAAIiB,OAAJ;AACA,MAAIqB,mBAAJ;;AACA,MAAI,OAAOD,gBAAP,KAA4B,QAAhC,EAA0C;AACzCpB,cAAUoB,gBAAV;AACA,GAFD,MAEO;AAAA,4BACiCA,gBADjC;AAAA,KACL;AAAEpB;AAAF,yBADK;AACSqB,uBADT;AAAA;AAEN;;AAED,QAAMC,UAAUhD,WAAWU,MAAX,CAAkBC,KAAlB,CAAwBsC,mBAAxB,CAA4C/C,GAA5C,EAAiDwB,OAAjD,EAA0DqB,mBAA1D,CAAhB;;AACA,MAAIC,WAAWhC,WAAf,EAA4B;AAC3BhB,eAAWU,MAAX,CAAkBuB,QAAlB,CAA2BC,qDAA3B,CAAiF,2BAAjF,EAA8GhC,GAA9G,EAAmHwB,OAAnH,EAA4HX,IAA5H;AACA;;AAED,SAAOiC,OAAP;AACA,CAnBD,C;;;;;;;;;;;ACCAhD,WAAWkD,YAAX,GAA0B,UAAShD,GAAT,EAAciD,WAAd,EAA2BpC,IAA3B,EAAiCC,cAAc,IAA/C,EAAqD;AAC9E,QAAME,OAAOlB,WAAWU,MAAX,CAAkBC,KAAlB,CAAwBQ,WAAxB,CAAoCjB,GAApC,CAAb;;AACA,MAAIF,WAAWoD,SAAX,CAAqBA,SAArB,CAA+BlC,KAAKG,CAApC,EAAuCgC,eAAvC,EAAJ,EAA8D;AAC7D,UAAM,IAAI9C,OAAOC,KAAX,CAAiB,mBAAjB,EAAsC,aAAtC,EAAqD;AAC1DC,gBAAU;AADgD,KAArD,CAAN;AAGA;;AACD,MAAI0C,gBAAgBjC,KAAKoC,IAAzB,EAA+B;AAC9B;AACA;;AAED,QAAMC,oBAAoBvD,WAAWwD,gBAAX,CAA4BL,WAA5B,EAAyCjD,GAAzC,CAA1B;AAEA,QAAMmC,SAASrC,WAAWU,MAAX,CAAkBC,KAAlB,CAAwB8C,WAAxB,CAAoCvD,GAApC,EAAyCqD,iBAAzC,EAA4DJ,WAA5D,KAA4EnD,WAAWU,MAAX,CAAkBc,aAAlB,CAAgCkC,0BAAhC,CAA2DxD,GAA3D,EAAgEqD,iBAAhE,EAAmFJ,WAAnF,CAA3F;;AAEA,MAAId,UAAUrB,WAAd,EAA2B;AAC1BhB,eAAWU,MAAX,CAAkBuB,QAAlB,CAA2B0B,0CAA3B,CAAsEzD,GAAtE,EAA2EiD,WAA3E,EAAwFpC,IAAxF;AACA;;AACD,SAAOoC,WAAP;AACA,CAnBD,C;;;;;;;;;;;ACDAnD,WAAW4D,gBAAX,GAA8B,UAAS1D,GAAT,EAAc2D,QAAd,EAAwB;AACrD,MAAI,CAACzD,MAAMC,IAAN,CAAWH,GAAX,EAAgBI,MAAhB,CAAL,EAA8B;AAC7B,UAAM,IAAIC,OAAOC,KAAX,CAAiB,cAAjB,EAAiC,cAAjC,EAAiD;AACtDC,gBAAU;AAD4C,KAAjD,CAAN;AAGA;;AACD,SAAOT,WAAWU,MAAX,CAAkBC,KAAlB,CAAwBmD,eAAxB,CAAwC5D,GAAxC,EAA6C2D,QAA7C,CAAP;AACA,CAPD,C;;;;;;;;;;;ACAA7D,WAAW+D,mBAAX,GAAiC,UAAS7D,GAAT,EAAc8D,eAAd,EAA+BjD,IAA/B,EAAqC;AACrE,MAAI,CAACX,MAAMC,IAAN,CAAWH,GAAX,EAAgBI,MAAhB,CAAL,EAA8B;AAC7B,UAAM,IAAIC,OAAOC,KAAX,CAAiB,cAAjB,EAAiC,cAAjC,EAAiD;AACtDC,gBAAU;AAD4C,KAAjD,CAAN;AAGA;;AAED,QAAM4B,SAASrC,WAAWU,MAAX,CAAkBC,KAAlB,CAAwBsD,kBAAxB,CAA2C/D,GAA3C,EAAgD8D,eAAhD,CAAf;AACAhE,aAAWU,MAAX,CAAkBuB,QAAlB,CAA2BC,qDAA3B,CAAiF,0BAAjF,EAA6GhC,GAA7G,EAAkH8D,eAAlH,EAAmIjD,IAAnI;AACA,SAAOsB,MAAP;AACA,CAVD,C;;;;;;;;;;;ACAArC,WAAWkE,sBAAX,GAAoC,UAAShE,GAAT,EAAciE,cAAd,EAA8B;AACjE,MAAI,CAAC/D,MAAMC,IAAN,CAAWH,GAAX,EAAgBI,MAAhB,CAAL,EAA8B;AAC7B,UAAM,IAAIC,OAAOC,KAAX,CAAiB,cAAjB,EAAiC,cAAjC,EAAiD;AACtDC,gBAAU;AAD4C,KAAjD,CAAN;AAGA;;AACD,SAAOT,WAAWU,MAAX,CAAkBC,KAAlB,CAAwByD,qBAAxB,CAA8ClE,GAA9C,EAAmDiE,cAAnD,CAAP;AACA,CAPD,C;;;;;;;;;;;ACAA,MAAME,SAAS,CAAC,UAAD,EAAa,WAAb,EAA0B,kBAA1B,EAA8C,kBAA9C,EAAkE,iBAAlE,EAAqF,UAArF,EAAiG,UAAjG,EAA6G,mBAA7G,EAAkI,gBAAlI,EAAoJ,SAApJ,EAA+J,UAA/J,EAA2K,WAA3K,EAAwL,kBAAxL,EAA4M,kBAA5M,EAAgO,iBAAhO,EAAmP,wBAAnP,EAA6Q,oBAA7Q,EAAmS,yBAAnS,CAAf;AACA9D,OAAO+D,OAAP,CAAe;AACdC,mBAAiBrE,GAAjB,EAAsB6B,QAAtB,EAAgCyC,KAAhC,EAAuC;AACtC,UAAMC,SAASlE,OAAOkE,MAAP,EAAf;;AAEA,QAAI,CAACA,MAAL,EAAa;AACZ,YAAM,IAAIlE,OAAOC,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAC5DC,kBAAU;AADkD,OAAvD,CAAN;AAGA;;AACD,QAAI,CAACL,MAAMC,IAAN,CAAWH,GAAX,EAAgBI,MAAhB,CAAL,EAA8B;AAC7B,YAAM,IAAIC,OAAOC,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAC5DkE,gBAAQ;AADoD,OAAvD,CAAN;AAGA;;AAED,QAAI,OAAO3C,QAAP,KAAoB,QAAxB,EAAkC;AACjCA,iBAAW;AACV,SAACA,QAAD,GAAayC;AADH,OAAX;AAGA;;AAED,QAAI,CAAC/B,OAAOkC,IAAP,CAAY5C,QAAZ,EAAsB6C,KAAtB,CAA6BC,GAAD,IAASR,OAAOS,QAAP,CAAgBD,GAAhB,CAArC,CAAL,EAAiE;AAChE,YAAM,IAAItE,OAAOC,KAAX,CAAiB,wBAAjB,EAA2C,2BAA3C,EAAwE;AAC7EkE,gBAAQ;AADqE,OAAxE,CAAN;AAGA;;AAED,QAAI,CAAC1E,WAAW+E,KAAX,CAAiBC,aAAjB,CAA+BP,MAA/B,EAAuC,WAAvC,EAAoDvE,GAApD,CAAL,EAA+D;AAC9D,YAAM,IAAIK,OAAOC,KAAX,CAAiB,0BAAjB,EAA6C,6BAA7C,EAA4E;AACjFkE,gBAAQ,kBADyE;AAEjFO,gBAAQ;AAFyE,OAA5E,CAAN;AAIA;;AAED,UAAM/D,OAAOlB,WAAWU,MAAX,CAAkBC,KAAlB,CAAwBQ,WAAxB,CAAoCjB,GAApC,CAAb;;AAEA,QAAIgB,KAAKgE,SAAL,KAAmBnD,SAAS8B,QAAT,IAAqB9B,SAASoD,iBAAjD,CAAJ,EAAyE;AACxE,YAAM,IAAI5E,OAAOC,KAAX,CAAiB,0BAAjB,EAA6C,wEAA7C,EAAuH;AAC5HkE,gBAAQ,kBADoH;AAE5HO,gBAAQ;AAFoH,OAAvH,CAAN;AAIA;;AAED,QAAI,CAAC/D,IAAL,EAAW;AACV,YAAM,IAAIX,OAAOC,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAC5DkE,gBAAQ;AADoD,OAAvD,CAAN;AAGA;;AAED,UAAM3D,OAAOR,OAAOQ,IAAP,EAAb,CAhDsC,CAkDtC;;AAEA0B,WAAOkC,IAAP,CAAY5C,QAAZ,EAAsBqD,OAAtB,CAA+BC,OAAD,IAAa;AAC1C,YAAMb,QAAQzC,SAASsD,OAAT,CAAd;;AACA,UAAItD,aAAa,SAAb,IAA0B,CAAC/B,WAAW+E,KAAX,CAAiBC,aAAjB,CAA+BP,MAA/B,EAAuC,0BAAvC,CAA/B,EAAmG;AAClG,cAAM,IAAIlE,OAAOC,KAAX,CAAiB,0BAAjB,EAA6C,4CAA7C,EAA2F;AAChGkE,kBAAQ,kBADwF;AAEhGO,kBAAQ;AAFwF,SAA3F,CAAN;AAIA;;AACD,UAAII,YAAY,UAAZ,IAA0Bb,UAAUtD,KAAKG,CAAzC,IAA8CmD,UAAU,GAAxD,IAA+D,CAACxE,WAAW+E,KAAX,CAAiBC,aAAjB,CAA+BP,MAA/B,EAAuC,UAAvC,CAApE,EAAwH;AACvH,cAAM,IAAIlE,OAAOC,KAAX,CAAiB,0BAAjB,EAA6C,6DAA7C,EAA4G;AACjHkE,kBAAQ,kBADyG;AAEjHO,kBAAQ;AAFyG,SAA5G,CAAN;AAIA;;AACD,UAAII,YAAY,UAAZ,IAA0Bb,UAAUtD,KAAKG,CAAzC,IAA8CmD,UAAU,GAAxD,IAA+D,CAACxE,WAAW+E,KAAX,CAAiBC,aAAjB,CAA+BP,MAA/B,EAAuC,UAAvC,CAApE,EAAwH;AACvH,cAAM,IAAIlE,OAAOC,KAAX,CAAiB,0BAAjB,EAA6C,4DAA7C,EAA2G;AAChHkE,kBAAQ,kBADwG;AAEhHO,kBAAQ;AAFwG,SAA3G,CAAN;AAIA;;AAED,UAAII,YAAY,kBAAZ,IAAkC,CAACrF,WAAW+E,KAAX,CAAiBC,aAAjB,CAA+BP,MAA/B,EAAuC,4BAAvC,EAAqEvE,GAArE,CAAnC,IAAgHsE,UAAUtD,KAAKoE,SAAL,CAAeC,OAA7I,EAAsJ;AACrJ,cAAM,IAAIhF,OAAOC,KAAX,CAAiB,0BAAjB,EAA6C,8CAA7C,EAA6F;AAClGkE,kBAAQ,kBAD0F;AAElGO,kBAAQ;AAF0F,SAA7F,CAAN;AAIA;;AACD,UAAII,YAAY,iBAAZ,IAAiC,CAACrF,WAAW+E,KAAX,CAAiBC,aAAjB,CAA+BP,MAA/B,EAAuC,4BAAvC,EAAqEvE,GAArE,CAAlC,IAA+GsE,UAAUtD,KAAKoE,SAAL,CAAeE,MAA5I,EAAoJ;AACnJ,cAAM,IAAIjF,OAAOC,KAAX,CAAiB,0BAAjB,EAA6C,8CAA7C,EAA6F;AAClGkE,kBAAQ,kBAD0F;AAElGO,kBAAQ;AAF0F,SAA7F,CAAN;AAIA;;AACD,UAAII,YAAY,wBAAZ,IAAwC,CAACrF,WAAW+E,KAAX,CAAiBC,aAAjB,CAA+BP,MAA/B,EAAuC,4BAAvC,EAAqEvE,GAArE,CAAzC,IAAsHsE,UAAUtD,KAAKoE,SAAL,CAAeG,aAAnJ,EAAkK;AACjK,cAAM,IAAIlF,OAAOC,KAAX,CAAiB,0BAAjB,EAA6C,8CAA7C,EAA6F;AAClGkE,kBAAQ,kBAD0F;AAElGO,kBAAQ;AAF0F,SAA7F,CAAN;AAIA;;AACD,UAAII,YAAY,oBAAZ,IAAoC,CAACrF,WAAW+E,KAAX,CAAiBC,aAAjB,CAA+BP,MAA/B,EAAuC,4BAAvC,EAAqEvE,GAArE,CAArC,IAAkHsE,UAAUtD,KAAKoE,SAAL,CAAeI,SAA/I,EAA0J;AACzJ,cAAM,IAAInF,OAAOC,KAAX,CAAiB,0BAAjB,EAA6C,8CAA7C,EAA6F;AAClGkE,kBAAQ,kBAD0F;AAElGO,kBAAQ;AAF0F,SAA7F,CAAN;AAIA;;AACD,UAAII,YAAY,yBAAhB,EAA2C;AAC1C,eAAOtD,SAAS4D,eAAhB;AACA,eAAO5D,SAAS6D,sBAAhB;AACA,eAAO7D,SAAS8D,kBAAhB;AACA;AACD,KAlDD;AAoDApD,WAAOkC,IAAP,CAAY5C,QAAZ,EAAsBqD,OAAtB,CAA+BC,OAAD,IAAa;AAC1C,YAAMb,QAAQzC,SAASsD,OAAT,CAAd;;AACA,cAAQA,OAAR;AACC,aAAK,UAAL;AACCrF,qBAAWkD,YAAX,CAAwBhD,GAAxB,EAA6BsE,KAA7B,EAAoCzD,IAApC;AACA;;AACD,aAAK,WAAL;AACC,cAAIyD,UAAUtD,KAAK4E,KAAnB,EAA0B;AACzB9F,uBAAWmC,aAAX,CAAyBjC,GAAzB,EAA8BsE,KAA9B,EAAqCzD,IAArC;AACA;;AACD;;AACD,aAAK,kBAAL;AACC,cAAIyD,UAAUtD,KAAK6E,YAAnB,EAAiC;AAChC/F,uBAAW6C,oBAAX,CAAgC3C,GAAhC,EAAqCsE,KAArC,EAA4CzD,IAA5C;AACA;;AACD;;AACD,aAAK,kBAAL;AACC,cAAIyD,UAAUtD,KAAK8E,YAAnB,EAAiC;AAChChG,uBAAWuC,oBAAX,CAAgCrC,GAAhC,EAAqCsE,KAArC;AACA;;AACD;;AACD,aAAK,iBAAL;AACC,cAAIA,UAAUtD,KAAK+E,WAAnB,EAAgC;AAC/BjG,uBAAW+D,mBAAX,CAA+B7D,GAA/B,EAAoCsE,KAApC,EAA2CzD,IAA3C;AACA;;AACD;;AACD,aAAK,UAAL;AACC,cAAIyD,UAAUtD,KAAKG,CAAnB,EAAsB;AACrBrB,uBAAWa,YAAX,CAAwBX,GAAxB,EAA6BsE,KAA7B,EAAoCzD,IAApC;AACA;;AACD;;AACD,aAAK,WAAL;AACCmF,gBAAM1B,KAAN,EAAa;AACZ2B,qBAAS7F,MADG;AAEZ8F,oBAAQ,CAAC;AACRC,qBAAO/F,MADC;AAERgG,uBAAShG;AAFD,aAAD;AAFI,WAAb;AAOAN,qBAAWuG,iBAAX,CAA6BrG,GAA7B,EAAkCsE,KAAlC;AACA;;AACD,aAAK,kBAAL;AACCxE,qBAAWwG,oBAAX,CAAgCtG,GAAhC,EAAqCsE,KAArC;AACA;;AACD,aAAK,UAAL;AACC,cAAIA,UAAUtD,KAAKuF,EAAnB,EAAuB;AACtBzG,uBAAW4D,gBAAX,CAA4B1D,GAA5B,EAAiCsE,KAAjC,EAAwCzD,IAAxC;AACA;;AACD;;AACD,aAAK,mBAAL;AACC,cAAIyD,UAAUtD,KAAKiE,iBAAnB,EAAsC;AACrCnF,uBAAWC,qBAAX,CAAiCC,GAAjC,EAAsCsE,KAAtC,EAA6CzD,IAA7C;AACA;;AACD;;AACD,aAAK,gBAAL;AACC,cAAIyD,UAAUtD,KAAKwF,MAAnB,EAA2B;AAC1B1G,uBAAWkE,sBAAX,CAAkChE,GAAlC,EAAuCsE,KAAvC,EAA8CzD,IAA9C;AACA;;AACD;;AACD,aAAK,UAAL;AACCf,qBAAWU,MAAX,CAAkBC,KAAlB,CAAwBgG,eAAxB,CAAwCzG,GAAxC,EAA6CI,OAAOkE,KAAP,CAA7C;AACA;;AACD,aAAK,SAAL;AACCxE,qBAAWU,MAAX,CAAkBC,KAAlB,CAAwBiG,eAAxB,CAAwC1G,GAAxC,EAA6CsE,KAA7C;AACA;;AACD,aAAK,kBAAL;AACCxE,qBAAWU,MAAX,CAAkBC,KAAlB,CAAwBkG,wBAAxB,CAAiD3G,GAAjD,EAAsDsE,KAAtD;AACA;;AACD,aAAK,iBAAL;AACCxE,qBAAWU,MAAX,CAAkBC,KAAlB,CAAwBmG,uBAAxB,CAAgD5G,GAAhD,EAAqDsE,KAArD;AACA;;AACD,aAAK,wBAAL;AACCxE,qBAAWU,MAAX,CAAkBC,KAAlB,CAAwBoG,8BAAxB,CAAuD7G,GAAvD,EAA4DsE,KAA5D;AACA;;AACD,aAAK,oBAAL;AACCxE,qBAAWU,MAAX,CAAkBC,KAAlB,CAAwBqG,0BAAxB,CAAmD9G,GAAnD,EAAwDsE,KAAxD;AACA;;AACD,aAAK,yBAAL;AACCxE,qBAAWU,MAAX,CAAkBC,KAAlB,CAAwBsG,+BAAxB,CAAwD/G,GAAxD,EAA6DsE,KAA7D;AACA;AA7EF;AA+EA,KAjFD;AAmFA,WAAO;AACNlD,cAAQ,IADF;AAENpB,WAAKgB,KAAKE;AAFJ,KAAP;AAIA;;AAhMa,CAAf,E;;;;;;;;;;;ACDApB,WAAWU,MAAX,CAAkBuB,QAAlB,CAA2BC,qDAA3B,GAAmF,UAASjB,IAAT,EAAeiG,MAAf,EAAuBxF,OAAvB,EAAgCX,IAAhC,EAAsCoG,SAAtC,EAAiD;AACnI,SAAO,KAAKC,kCAAL,CAAwCnG,IAAxC,EAA8CiG,MAA9C,EAAsDxF,OAAtD,EAA+DX,IAA/D,EAAqEoG,SAArE,CAAP;AACA,CAFD;;AAIAnH,WAAWU,MAAX,CAAkBuB,QAAlB,CAA2B0B,0CAA3B,GAAwE,UAASuD,MAAT,EAAiBG,QAAjB,EAA2BtG,IAA3B,EAAiCoG,SAAjC,EAA4C;AACnH,SAAO,KAAKC,kCAAL,CAAwC,GAAxC,EAA6CF,MAA7C,EAAqDG,QAArD,EAA+DtG,IAA/D,EAAqEoG,SAArE,CAAP;AACA,CAFD,C;;;;;;;;;;;ACJAnH,WAAWU,MAAX,CAAkBC,KAAlB,CAAwBsD,kBAAxB,GAA6C,UAAS7C,GAAT,EAAc6E,WAAd,EAA2B;AACvE,QAAMqB,QAAQ;AACblG;AADa,GAAd;AAGA,QAAMiB,SAAS;AACdkF,UAAM;AACLtB;AADK;AADQ,GAAf;AAKA,SAAO,KAAK5D,MAAL,CAAYiF,KAAZ,EAAmBjF,MAAnB,CAAP;AACA,CAVD;;AAYArC,WAAWU,MAAX,CAAkBC,KAAlB,CAAwBmD,eAAxB,GAA0C,UAAS1C,GAAT,EAAcyC,QAAd,EAAwB;AACjE,QAAMyD,QAAQ;AACblG;AADa,GAAd;AAGA,QAAMiB,SAAS;AACdkF,UAAM;AACLd,UAAI5C,QADC;AAEL2D,aAAO;AAFF;AADQ,GAAf;;AAMA,MAAI3D,QAAJ,EAAc;AACb7D,eAAWU,MAAX,CAAkBc,aAAlB,CAAgCiG,8BAAhC,CAA+DrG,GAA/D,EAAoE;AAAEiD,cAAQ;AAAE,iBAAS,CAAX;AAAc,sBAAc;AAA5B;AAAV,KAApE,EAAiHe,OAAjH,CAAyH,UAAS;AAAEsC,SAAG3G;AAAL,KAAT,EAAsB;AAC9I,UAAIf,WAAW+E,KAAX,CAAiBC,aAAjB,CAA+BjE,KAAKK,GAApC,EAAyC,eAAzC,CAAJ,EAA+D;AAC9D;AACA;;AACD,aAAOiB,OAAOkF,IAAP,CAAYC,KAAZ,CAAkBG,IAAlB,CAAuB5G,KAAK6G,QAA5B,CAAP;AACA,KALD;AAMA,GAPD,MAOO;AACNvF,WAAOwF,MAAP,GAAgB;AACfL,aAAO;AADQ,KAAhB;AAGA;;AAED,MAAInF,OAAOkF,IAAP,CAAYC,KAAZ,CAAkBM,MAAlB,KAA6B,CAAjC,EAAoC;AACnC,WAAOzF,OAAOkF,IAAP,CAAYC,KAAnB;AACA;;AAED,SAAO,KAAKnF,MAAL,CAAYiF,KAAZ,EAAmBjF,MAAnB,CAAP;AACA,CA5BD;;AA8BArC,WAAWU,MAAX,CAAkBC,KAAlB,CAAwBC,gCAAxB,GAA2D,UAASQ,GAAT,EAAc2G,aAAd,EAA6B;AACvF,QAAMT,QAAQ;AACblG;AADa,GAAd;AAGA,QAAMiB,SAAS;AACdkF,UAAM;AACLpC,yBAAmB4C;AADd;AADQ,GAAf;AAKA,SAAO,KAAK1F,MAAL,CAAYiF,KAAZ,EAAmBjF,MAAnB,CAAP;AACA,CAVD;;AAYArC,WAAWU,MAAX,CAAkBC,KAAlB,CAAwByD,qBAAxB,GAAgD,UAAShD,GAAT,EAAc+C,cAAd,EAA8B;AAC7E,QAAMmD,QAAQ;AACblG;AADa,GAAd;AAGA,QAAMiB,SAAS;AACdkF,UAAM;AACLb,cAAQvC;AADH;AADQ,GAAf;AAKA,SAAO,KAAK9B,MAAL,CAAYiF,KAAZ,EAAmBjF,MAAnB,CAAP;AACA,CAVD,C;;;;;;;;;;;ACtDA9B,OAAOyH,OAAP,CAAe,YAAW;AACzBhI,aAAWU,MAAX,CAAkBuH,WAAlB,CAA8BC,MAA9B,CAAqC,eAArC,EAAsD;AAAEC,kBAAc;AAAEC,aAAO,CAAC,OAAD,EAAU,OAAV,EAAmB,WAAnB;AAAT;AAAhB,GAAtD;AACApI,aAAWU,MAAX,CAAkBuH,WAAlB,CAA8BC,MAA9B,CAAqC,cAArC,EAAqD;AAAEC,kBAAc;AAAEC,aAAO,CAAC,OAAD,EAAU,OAAV;AAAT;AAAhB,GAArD;AACApI,aAAWU,MAAX,CAAkBuH,WAAlB,CAA8BC,MAA9B,CAAqC,yBAArC,EAAgE;AAAEC,kBAAc;AAAEC,aAAO,CAAC,OAAD,EAAU,OAAV;AAAT;AAAhB,GAAhE;AACA,CAJD,E","file":"/packages/rocketchat_channel-settings.js","sourcesContent":["RocketChat.saveReactWhenReadOnly = function(rid, allowReact) {\n\tif (!Match.test(rid, String)) {\n\t\tthrow new Meteor.Error('invalid-room', 'Invalid room', { function: 'RocketChat.saveReactWhenReadOnly' });\n\t}\n\n\treturn RocketChat.models.Rooms.setAllowReactingWhenReadOnlyById(rid, allowReact);\n};\n","\nRocketChat.saveRoomType = function(rid, roomType, user, sendMessage = true) {\n\tif (!Match.test(rid, String)) {\n\t\tthrow new Meteor.Error('invalid-room', 'Invalid room', {\n\t\t\tfunction: 'RocketChat.saveRoomType',\n\t\t});\n\t}\n\tif (roomType !== 'c' && roomType !== 'p') {\n\t\tthrow new Meteor.Error('error-invalid-room-type', 'error-invalid-room-type', {\n\t\t\tfunction: 'RocketChat.saveRoomType',\n\t\t\ttype: roomType,\n\t\t});\n\t}\n\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\tif (room == null) {\n\t\tthrow new Meteor.Error('error-invalid-room', 'error-invalid-room', {\n\t\t\tfunction: 'RocketChat.saveRoomType',\n\t\t\t_id: rid,\n\t\t});\n\t}\n\tif (room.t === 'd') {\n\t\tthrow new Meteor.Error('error-direct-room', 'Can\\'t change type of direct rooms', {\n\t\t\tfunction: 'RocketChat.saveRoomType',\n\t\t});\n\t}\n\tconst result = RocketChat.models.Rooms.setTypeById(rid, roomType) && RocketChat.models.Subscriptions.updateTypeByRoomId(rid, roomType);\n\tif (result && sendMessage) {\n\t\tlet message;\n\t\tif (roomType === 'c') {\n\t\t\tmessage = TAPi18n.__('Channel', {\n\t\t\t\tlng: (user && user.language) || RocketChat.settings.get('language') || 'en',\n\t\t\t});\n\t\t} else {\n\t\t\tmessage = TAPi18n.__('Private_Group', {\n\t\t\t\tlng: (user && user.language) || RocketChat.settings.get('language') || 'en',\n\t\t\t});\n\t\t}\n\t\tRocketChat.models.Messages.createRoomSettingsChangedWithTypeRoomIdMessageAndUser('room_changed_privacy', rid, message, user);\n\t}\n\treturn result;\n};\n","RocketChat.saveRoomTopic = function(rid, roomTopic, user, sendMessage = true) {\n\tif (!Match.test(rid, String)) {\n\t\tthrow new Meteor.Error('invalid-room', 'Invalid room', {\n\t\t\tfunction: 'RocketChat.saveRoomTopic',\n\t\t});\n\t}\n\n\tconst update = RocketChat.models.Rooms.setTopicById(rid, roomTopic);\n\tif (update && sendMessage) {\n\t\tRocketChat.models.Messages.createRoomSettingsChangedWithTypeRoomIdMessageAndUser('room_changed_topic', rid, roomTopic, user);\n\t}\n\treturn update;\n};\n","RocketChat.saveRoomCustomFields = function(rid, roomCustomFields) {\n\tif (!Match.test(rid, String)) {\n\t\tthrow new Meteor.Error('invalid-room', 'Invalid room', {\n\t\t\tfunction: 'RocketChat.saveRoomCustomFields',\n\t\t});\n\t}\n\tif (!Match.test(roomCustomFields, Object)) {\n\t\tthrow new Meteor.Error('invalid-roomCustomFields-type', 'Invalid roomCustomFields type', {\n\t\t\tfunction: 'RocketChat.saveRoomCustomFields',\n\t\t});\n\t}\n\tconst ret = RocketChat.models.Rooms.setCustomFieldsById(rid, roomCustomFields);\n\n\t// Update customFields of any user's Subscription related with this rid\n\tRocketChat.models.Subscriptions.updateCustomFieldsByRoomId(rid, roomCustomFields);\n\n\treturn ret;\n};\n","RocketChat.saveRoomAnnouncement = function(rid, roomAnnouncement, user, sendMessage = true) {\n\tif (!Match.test(rid, String)) {\n\t\tthrow new Meteor.Error('invalid-room', 'Invalid room', { function: 'RocketChat.saveRoomAnnouncement' });\n\t}\n\n\tlet message;\n\tlet announcementDetails;\n\tif (typeof roomAnnouncement === 'string') {\n\t\tmessage = roomAnnouncement;\n\t} else {\n\t\t({ message, ...announcementDetails } = roomAnnouncement);\n\t}\n\n\tconst updated = RocketChat.models.Rooms.setAnnouncementById(rid, message, announcementDetails);\n\tif (updated && sendMessage) {\n\t\tRocketChat.models.Messages.createRoomSettingsChangedWithTypeRoomIdMessageAndUser('room_changed_announcement', rid, message, user);\n\t}\n\n\treturn updated;\n};\n","\nRocketChat.saveRoomName = function(rid, displayName, user, sendMessage = true) {\n\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\tif (RocketChat.roomTypes.roomTypes[room.t].preventRenaming()) {\n\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\tfunction: 'RocketChat.saveRoomdisplayName',\n\t\t});\n\t}\n\tif (displayName === room.name) {\n\t\treturn;\n\t}\n\n\tconst slugifiedRoomName = RocketChat.getValidRoomName(displayName, rid);\n\n\tconst update = RocketChat.models.Rooms.setNameById(rid, slugifiedRoomName, displayName) && RocketChat.models.Subscriptions.updateNameAndAlertByRoomId(rid, slugifiedRoomName, displayName);\n\n\tif (update && sendMessage) {\n\t\tRocketChat.models.Messages.createRoomRenamedWithRoomIdRoomNameAndUser(rid, displayName, user);\n\t}\n\treturn displayName;\n};\n","RocketChat.saveRoomReadOnly = function(rid, readOnly) {\n\tif (!Match.test(rid, String)) {\n\t\tthrow new Meteor.Error('invalid-room', 'Invalid room', {\n\t\t\tfunction: 'RocketChat.saveRoomReadOnly',\n\t\t});\n\t}\n\treturn RocketChat.models.Rooms.setReadOnlyById(rid, readOnly);\n};\n","RocketChat.saveRoomDescription = function(rid, roomDescription, user) {\n\tif (!Match.test(rid, String)) {\n\t\tthrow new Meteor.Error('invalid-room', 'Invalid room', {\n\t\t\tfunction: 'RocketChat.saveRoomDescription',\n\t\t});\n\t}\n\n\tconst update = RocketChat.models.Rooms.setDescriptionById(rid, roomDescription);\n\tRocketChat.models.Messages.createRoomSettingsChangedWithTypeRoomIdMessageAndUser('room_changed_description', rid, roomDescription, user);\n\treturn update;\n};\n","RocketChat.saveRoomSystemMessages = function(rid, systemMessages) {\n\tif (!Match.test(rid, String)) {\n\t\tthrow new Meteor.Error('invalid-room', 'Invalid room', {\n\t\t\tfunction: 'RocketChat.saveRoomSystemMessages',\n\t\t});\n\t}\n\treturn RocketChat.models.Rooms.setSystemMessagesById(rid, systemMessages);\n};\n","const fields = ['roomName', 'roomTopic', 'roomAnnouncement', 'roomCustomFields', 'roomDescription', 'roomType', 'readOnly', 'reactWhenReadOnly', 'systemMessages', 'default', 'joinCode', 'tokenpass', 'streamingOptions', 'retentionEnabled', 'retentionMaxAge', 'retentionExcludePinned', 'retentionFilesOnly', 'retentionOverrideGlobal'];\nMeteor.methods({\n\tsaveRoomSettings(rid, settings, value) {\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tfunction: 'RocketChat.saveRoomName',\n\t\t\t});\n\t\t}\n\t\tif (!Match.test(rid, String)) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'saveRoomSettings',\n\t\t\t});\n\t\t}\n\n\t\tif (typeof settings !== 'object') {\n\t\t\tsettings = {\n\t\t\t\t[settings] : value,\n\t\t\t};\n\t\t}\n\n\t\tif (!Object.keys(settings).every((key) => fields.includes(key))) {\n\t\t\tthrow new Meteor.Error('error-invalid-settings', 'Invalid settings provided', {\n\t\t\t\tmethod: 'saveRoomSettings',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(userId, 'edit-room', rid)) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Editing room is not allowed', {\n\t\t\t\tmethod: 'saveRoomSettings',\n\t\t\t\taction: 'Editing_room',\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (room.broadcast && (settings.readOnly || settings.reactWhenReadOnly)) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Editing readOnly/reactWhenReadOnly are not allowed for broadcast rooms', {\n\t\t\t\tmethod: 'saveRoomSettings',\n\t\t\t\taction: 'Editing_room',\n\t\t\t});\n\t\t}\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'saveRoomSettings',\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\t// validations\n\n\t\tObject.keys(settings).forEach((setting) => {\n\t\t\tconst value = settings[setting];\n\t\t\tif (settings === 'default' && !RocketChat.authz.hasPermission(userId, 'view-room-administration')) {\n\t\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Viewing room administration is not allowed', {\n\t\t\t\t\tmethod: 'saveRoomSettings',\n\t\t\t\t\taction: 'Viewing_room_administration',\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (setting === 'roomType' && value !== room.t && value === 'c' && !RocketChat.authz.hasPermission(userId, 'create-c')) {\n\t\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Changing a private group to a public channel is not allowed', {\n\t\t\t\t\tmethod: 'saveRoomSettings',\n\t\t\t\t\taction: 'Change_Room_Type',\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (setting === 'roomType' && value !== room.t && value === 'p' && !RocketChat.authz.hasPermission(userId, 'create-p')) {\n\t\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Changing a public channel to a private room is not allowed', {\n\t\t\t\t\tmethod: 'saveRoomSettings',\n\t\t\t\t\taction: 'Change_Room_Type',\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (setting === 'retentionEnabled' && !RocketChat.authz.hasPermission(userId, 'edit-room-retention-policy', rid) && value !== room.retention.enabled) {\n\t\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Editing room retention policy is not allowed', {\n\t\t\t\t\tmethod: 'saveRoomSettings',\n\t\t\t\t\taction: 'Editing_room',\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (setting === 'retentionMaxAge' && !RocketChat.authz.hasPermission(userId, 'edit-room-retention-policy', rid) && value !== room.retention.maxAge) {\n\t\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Editing room retention policy is not allowed', {\n\t\t\t\t\tmethod: 'saveRoomSettings',\n\t\t\t\t\taction: 'Editing_room',\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (setting === 'retentionExcludePinned' && !RocketChat.authz.hasPermission(userId, 'edit-room-retention-policy', rid) && value !== room.retention.excludePinned) {\n\t\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Editing room retention policy is not allowed', {\n\t\t\t\t\tmethod: 'saveRoomSettings',\n\t\t\t\t\taction: 'Editing_room',\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (setting === 'retentionFilesOnly' && !RocketChat.authz.hasPermission(userId, 'edit-room-retention-policy', rid) && value !== room.retention.filesOnly) {\n\t\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Editing room retention policy is not allowed', {\n\t\t\t\t\tmethod: 'saveRoomSettings',\n\t\t\t\t\taction: 'Editing_room',\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (setting === 'retentionOverrideGlobal') {\n\t\t\t\tdelete settings.retentionMaxAge;\n\t\t\t\tdelete settings.retentionExcludePinned;\n\t\t\t\tdelete settings.retentionFilesOnly;\n\t\t\t}\n\t\t});\n\n\t\tObject.keys(settings).forEach((setting) => {\n\t\t\tconst value = settings[setting];\n\t\t\tswitch (setting) {\n\t\t\t\tcase 'roomName':\n\t\t\t\t\tRocketChat.saveRoomName(rid, value, user);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'roomTopic':\n\t\t\t\t\tif (value !== room.topic) {\n\t\t\t\t\t\tRocketChat.saveRoomTopic(rid, value, user);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'roomAnnouncement':\n\t\t\t\t\tif (value !== room.announcement) {\n\t\t\t\t\t\tRocketChat.saveRoomAnnouncement(rid, value, user);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'roomCustomFields':\n\t\t\t\t\tif (value !== room.customFields) {\n\t\t\t\t\t\tRocketChat.saveRoomCustomFields(rid, value);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'roomDescription':\n\t\t\t\t\tif (value !== room.description) {\n\t\t\t\t\t\tRocketChat.saveRoomDescription(rid, value, user);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'roomType':\n\t\t\t\t\tif (value !== room.t) {\n\t\t\t\t\t\tRocketChat.saveRoomType(rid, value, user);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'tokenpass':\n\t\t\t\t\tcheck(value, {\n\t\t\t\t\t\trequire: String,\n\t\t\t\t\t\ttokens: [{\n\t\t\t\t\t\t\ttoken: String,\n\t\t\t\t\t\t\tbalance: String,\n\t\t\t\t\t\t}],\n\t\t\t\t\t});\n\t\t\t\t\tRocketChat.saveRoomTokenpass(rid, value);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'streamingOptions':\n\t\t\t\t\tRocketChat.saveStreamingOptions(rid, value);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'readOnly':\n\t\t\t\t\tif (value !== room.ro) {\n\t\t\t\t\t\tRocketChat.saveRoomReadOnly(rid, value, user);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'reactWhenReadOnly':\n\t\t\t\t\tif (value !== room.reactWhenReadOnly) {\n\t\t\t\t\t\tRocketChat.saveReactWhenReadOnly(rid, value, user);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'systemMessages':\n\t\t\t\t\tif (value !== room.sysMes) {\n\t\t\t\t\t\tRocketChat.saveRoomSystemMessages(rid, value, user);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'joinCode':\n\t\t\t\t\tRocketChat.models.Rooms.setJoinCodeById(rid, String(value));\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'default':\n\t\t\t\t\tRocketChat.models.Rooms.saveDefaultById(rid, value);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'retentionEnabled':\n\t\t\t\t\tRocketChat.models.Rooms.saveRetentionEnabledById(rid, value);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'retentionMaxAge':\n\t\t\t\t\tRocketChat.models.Rooms.saveRetentionMaxAgeById(rid, value);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'retentionExcludePinned':\n\t\t\t\t\tRocketChat.models.Rooms.saveRetentionExcludePinnedById(rid, value);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'retentionFilesOnly':\n\t\t\t\t\tRocketChat.models.Rooms.saveRetentionFilesOnlyById(rid, value);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'retentionOverrideGlobal':\n\t\t\t\t\tRocketChat.models.Rooms.saveRetentionOverrideGlobalById(rid, value);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tresult: true,\n\t\t\trid: room._id,\n\t\t};\n\t},\n});\n","RocketChat.models.Messages.createRoomSettingsChangedWithTypeRoomIdMessageAndUser = function(type, roomId, message, user, extraData) {\n\treturn this.createWithTypeRoomIdMessageAndUser(type, roomId, message, user, extraData);\n};\n\nRocketChat.models.Messages.createRoomRenamedWithRoomIdRoomNameAndUser = function(roomId, roomName, user, extraData) {\n\treturn this.createWithTypeRoomIdMessageAndUser('r', roomId, roomName, user, extraData);\n};\n","RocketChat.models.Rooms.setDescriptionById = function(_id, description) {\n\tconst query = {\n\t\t_id,\n\t};\n\tconst update = {\n\t\t$set: {\n\t\t\tdescription,\n\t\t},\n\t};\n\treturn this.update(query, update);\n};\n\nRocketChat.models.Rooms.setReadOnlyById = function(_id, readOnly) {\n\tconst query = {\n\t\t_id,\n\t};\n\tconst update = {\n\t\t$set: {\n\t\t\tro: readOnly,\n\t\t\tmuted: [],\n\t\t},\n\t};\n\tif (readOnly) {\n\t\tRocketChat.models.Subscriptions.findByRoomIdWhenUsernameExists(_id, { fields: { 'u._id': 1, 'u.username': 1 } }).forEach(function({ u: user }) {\n\t\t\tif (RocketChat.authz.hasPermission(user._id, 'post-readonly')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn update.$set.muted.push(user.username);\n\t\t});\n\t} else {\n\t\tupdate.$unset = {\n\t\t\tmuted: '',\n\t\t};\n\t}\n\n\tif (update.$set.muted.length === 0) {\n\t\tdelete update.$set.muted;\n\t}\n\n\treturn this.update(query, update);\n};\n\nRocketChat.models.Rooms.setAllowReactingWhenReadOnlyById = function(_id, allowReacting) {\n\tconst query = {\n\t\t_id,\n\t};\n\tconst update = {\n\t\t$set: {\n\t\t\treactWhenReadOnly: allowReacting,\n\t\t},\n\t};\n\treturn this.update(query, update);\n};\n\nRocketChat.models.Rooms.setSystemMessagesById = function(_id, systemMessages) {\n\tconst query = {\n\t\t_id,\n\t};\n\tconst update = {\n\t\t$set: {\n\t\t\tsysMes: systemMessages,\n\t\t},\n\t};\n\treturn this.update(query, update);\n};\n","Meteor.startup(function() {\n\tRocketChat.models.Permissions.upsert('post-readonly', { $setOnInsert: { roles: ['admin', 'owner', 'moderator'] } });\n\tRocketChat.models.Permissions.upsert('set-readonly', { $setOnInsert: { roles: ['admin', 'owner'] } });\n\tRocketChat.models.Permissions.upsert('set-react-when-readonly', { $setOnInsert: { roles: ['admin', 'owner'] } });\n});\n"]}