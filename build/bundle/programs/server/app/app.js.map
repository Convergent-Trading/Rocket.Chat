{"version":3,"sources":["meteor://ğŸ’»app/imports/message-read-receipt/server/lib/ReadReceipt.js","meteor://ğŸ’»app/imports/message-read-receipt/server/api/methods/getReadReceipts.js","meteor://ğŸ’»app/imports/message-read-receipt/server/models/ReadReceipts.js","meteor://ğŸ’»app/imports/message-read-receipt/server/dbIndexes.js","meteor://ğŸ’»app/imports/message-read-receipt/server/hooks.js","meteor://ğŸ’»app/imports/message-read-receipt/server/index.js","meteor://ğŸ’»app/imports/message-read-receipt/server/settings.js","meteor://ğŸ’»app/imports/personal-access-tokens/server/api/methods/generateToken.js","meteor://ğŸ’»app/imports/personal-access-tokens/server/api/methods/index.js","meteor://ğŸ’»app/imports/personal-access-tokens/server/api/methods/regenerateToken.js","meteor://ğŸ’»app/imports/personal-access-tokens/server/api/methods/removeToken.js","meteor://ğŸ’»app/imports/personal-access-tokens/server/models/Users.js","meteor://ğŸ’»app/imports/personal-access-tokens/server/models/index.js","meteor://ğŸ’»app/imports/personal-access-tokens/server/publications/index.js","meteor://ğŸ’»app/imports/personal-access-tokens/server/publications/personalAccessTokens.js","meteor://ğŸ’»app/imports/personal-access-tokens/server/index.js","meteor://ğŸ’»app/imports/personal-access-tokens/server/settings.js","meteor://ğŸ’»app/imports/startup/server/index.js","meteor://ğŸ’»app/server/lib/cordova/facebook-login.js","meteor://ğŸ’»app/server/lib/accounts.js","meteor://ğŸ’»app/server/lib/cordova.js","meteor://ğŸ’»app/server/lib/roomFiles.js","meteor://ğŸ’»app/server/startup/migrations/v001.js","meteor://ğŸ’»app/server/startup/migrations/v002.js","meteor://ğŸ’»app/server/startup/migrations/v003.js","meteor://ğŸ’»app/server/startup/migrations/v004.js","meteor://ğŸ’»app/server/startup/migrations/v005.js","meteor://ğŸ’»app/server/startup/migrations/v006.js","meteor://ğŸ’»app/server/startup/migrations/v007.js","meteor://ğŸ’»app/server/startup/migrations/v008.js","meteor://ğŸ’»app/server/startup/migrations/v009.js","meteor://ğŸ’»app/server/startup/migrations/v010.js","meteor://ğŸ’»app/server/startup/migrations/v011.js","meteor://ğŸ’»app/server/startup/migrations/v012.js","meteor://ğŸ’»app/server/startup/migrations/v013.js","meteor://ğŸ’»app/server/startup/migrations/v014.js","meteor://ğŸ’»app/server/startup/migrations/v015.js","meteor://ğŸ’»app/server/startup/migrations/v016.js","meteor://ğŸ’»app/server/startup/migrations/v017.js","meteor://ğŸ’»app/server/startup/migrations/v018.js","meteor://ğŸ’»app/server/startup/migrations/v019.js","meteor://ğŸ’»app/server/startup/migrations/v020.js","meteor://ğŸ’»app/server/startup/migrations/v021.js","meteor://ğŸ’»app/server/startup/migrations/v022.js","meteor://ğŸ’»app/server/startup/migrations/v023.js","meteor://ğŸ’»app/server/startup/migrations/v024.js","meteor://ğŸ’»app/server/startup/migrations/v025.js","meteor://ğŸ’»app/server/startup/migrations/v026.js","meteor://ğŸ’»app/server/startup/migrations/v027.js","meteor://ğŸ’»app/server/startup/migrations/v028.js","meteor://ğŸ’»app/server/startup/migrations/v029.js","meteor://ğŸ’»app/server/startup/migrations/v030.js","meteor://ğŸ’»app/server/startup/migrations/v031.js","meteor://ğŸ’»app/server/startup/migrations/v032.js","meteor://ğŸ’»app/server/startup/migrations/v033.js","meteor://ğŸ’»app/server/startup/migrations/v034.js","meteor://ğŸ’»app/server/startup/migrations/v035.js","meteor://ğŸ’»app/server/startup/migrations/v036.js","meteor://ğŸ’»app/server/startup/migrations/v037.js","meteor://ğŸ’»app/server/startup/migrations/v038.js","meteor://ğŸ’»app/server/startup/migrations/v039.js","meteor://ğŸ’»app/server/startup/migrations/v040.js","meteor://ğŸ’»app/server/startup/migrations/v041.js","meteor://ğŸ’»app/server/startup/migrations/v042.js","meteor://ğŸ’»app/server/startup/migrations/v043.js","meteor://ğŸ’»app/server/startup/migrations/v044.js","meteor://ğŸ’»app/server/startup/migrations/v045.js","meteor://ğŸ’»app/server/startup/migrations/v046.js","meteor://ğŸ’»app/server/startup/migrations/v047.js","meteor://ğŸ’»app/server/startup/migrations/v048.js","meteor://ğŸ’»app/server/startup/migrations/v049.js","meteor://ğŸ’»app/server/startup/migrations/v050.js","meteor://ğŸ’»app/server/startup/migrations/v051.js","meteor://ğŸ’»app/server/startup/migrations/v052.js","meteor://ğŸ’»app/server/startup/migrations/v053.js","meteor://ğŸ’»app/server/startup/migrations/v054.js","meteor://ğŸ’»app/server/startup/migrations/v055.js","meteor://ğŸ’»app/server/startup/migrations/v056.js","meteor://ğŸ’»app/server/startup/migrations/v057.js","meteor://ğŸ’»app/server/startup/migrations/v058.js","meteor://ğŸ’»app/server/startup/migrations/v059.js","meteor://ğŸ’»app/server/startup/migrations/v060.js","meteor://ğŸ’»app/server/startup/migrations/v061.js","meteor://ğŸ’»app/server/startup/migrations/v062.js","meteor://ğŸ’»app/server/startup/migrations/v063.js","meteor://ğŸ’»app/server/startup/migrations/v064.js","meteor://ğŸ’»app/server/startup/migrations/v065.js","meteor://ğŸ’»app/server/startup/migrations/v066.js","meteor://ğŸ’»app/server/startup/migrations/v067.js","meteor://ğŸ’»app/server/startup/migrations/v068.js","meteor://ğŸ’»app/server/startup/migrations/v069.js","meteor://ğŸ’»app/server/startup/migrations/v070.js","meteor://ğŸ’»app/server/startup/migrations/v071.js","meteor://ğŸ’»app/server/startup/migrations/v072.js","meteor://ğŸ’»app/server/startup/migrations/v073.js","meteor://ğŸ’»app/server/startup/migrations/v074.js","meteor://ğŸ’»app/server/startup/migrations/v075.js","meteor://ğŸ’»app/server/startup/migrations/v076.js","meteor://ğŸ’»app/server/startup/migrations/v077.js","meteor://ğŸ’»app/server/startup/migrations/v078.js","meteor://ğŸ’»app/server/startup/migrations/v079.js","meteor://ğŸ’»app/server/startup/migrations/v080.js","meteor://ğŸ’»app/server/startup/migrations/v081.js","meteor://ğŸ’»app/server/startup/migrations/v082.js","meteor://ğŸ’»app/server/startup/migrations/v083.js","meteor://ğŸ’»app/server/startup/migrations/v084.js","meteor://ğŸ’»app/server/startup/migrations/v085.js","meteor://ğŸ’»app/server/startup/migrations/v086.js","meteor://ğŸ’»app/server/startup/migrations/v087.js","meteor://ğŸ’»app/server/startup/migrations/v088.js","meteor://ğŸ’»app/server/startup/migrations/v089.js","meteor://ğŸ’»app/server/startup/migrations/v090.js","meteor://ğŸ’»app/server/startup/migrations/v091.js","meteor://ğŸ’»app/server/startup/migrations/v092.js","meteor://ğŸ’»app/server/startup/migrations/v093.js","meteor://ğŸ’»app/server/startup/migrations/v094.js","meteor://ğŸ’»app/server/startup/migrations/v095.js","meteor://ğŸ’»app/server/startup/migrations/v096.js","meteor://ğŸ’»app/server/startup/migrations/v097.js","meteor://ğŸ’»app/server/startup/migrations/v098.js","meteor://ğŸ’»app/server/startup/migrations/v099.js","meteor://ğŸ’»app/server/startup/migrations/v100.js","meteor://ğŸ’»app/server/startup/migrations/v101.js","meteor://ğŸ’»app/server/startup/migrations/v102.js","meteor://ğŸ’»app/server/startup/migrations/v103.js","meteor://ğŸ’»app/server/startup/migrations/v104.js","meteor://ğŸ’»app/server/startup/migrations/v105.js","meteor://ğŸ’»app/server/startup/migrations/v106.js","meteor://ğŸ’»app/server/startup/migrations/v107.js","meteor://ğŸ’»app/server/startup/migrations/v108.js","meteor://ğŸ’»app/server/startup/migrations/v109.js","meteor://ğŸ’»app/server/startup/migrations/v110.js","meteor://ğŸ’»app/server/startup/migrations/v111.js","meteor://ğŸ’»app/server/startup/migrations/v112.js","meteor://ğŸ’»app/server/startup/migrations/v113.js","meteor://ğŸ’»app/server/startup/migrations/v114.js","meteor://ğŸ’»app/server/startup/migrations/v115.js","meteor://ğŸ’»app/server/startup/migrations/v116.js","meteor://ğŸ’»app/server/startup/migrations/v117.js","meteor://ğŸ’»app/server/startup/migrations/v118.js","meteor://ğŸ’»app/server/startup/migrations/v119.js","meteor://ğŸ’»app/server/startup/migrations/v120.js","meteor://ğŸ’»app/server/startup/migrations/v121.js","meteor://ğŸ’»app/server/startup/migrations/v122.js","meteor://ğŸ’»app/server/startup/migrations/v123.js","meteor://ğŸ’»app/server/startup/migrations/v124.js","meteor://ğŸ’»app/server/startup/migrations/v125.js","meteor://ğŸ’»app/server/startup/migrations/v126.js","meteor://ğŸ’»app/server/startup/migrations/v127.js","meteor://ğŸ’»app/server/startup/migrations/v128.js","meteor://ğŸ’»app/server/startup/migrations/v129.js","meteor://ğŸ’»app/server/startup/migrations/v130.js","meteor://ğŸ’»app/server/startup/migrations/v131.js","meteor://ğŸ’»app/server/startup/migrations/xrun.js","meteor://ğŸ’»app/server/startup/appcache.js","meteor://ğŸ’»app/server/startup/avatar.js","meteor://ğŸ’»app/server/startup/cron.js","meteor://ğŸ’»app/server/startup/i18n-validation.js","meteor://ğŸ’»app/server/startup/initialData.js","meteor://ğŸ’»app/server/startup/presence.js","meteor://ğŸ’»app/server/startup/serverRunning.js","meteor://ğŸ’»app/server/configuration/accounts_meld.js","meteor://ğŸ’»app/server/methods/OEmbedCacheCleanup.js","meteor://ğŸ’»app/server/methods/addAllUserToRoom.js","meteor://ğŸ’»app/server/methods/addRoomLeader.js","meteor://ğŸ’»app/server/methods/addRoomModerator.js","meteor://ğŸ’»app/server/methods/addRoomOwner.js","meteor://ğŸ’»app/server/methods/afterVerifyEmail.js","meteor://ğŸ’»app/server/methods/browseChannels.js","meteor://ğŸ’»app/server/methods/canAccessRoom.js","meteor://ğŸ’»app/server/methods/channelsList.js","meteor://ğŸ’»app/server/methods/createDirectMessage.js","meteor://ğŸ’»app/server/methods/deleteFileMessage.js","meteor://ğŸ’»app/server/methods/deleteUser.js","meteor://ğŸ’»app/server/methods/eraseRoom.js","meteor://ğŸ’»app/server/methods/getAvatarSuggestion.js","meteor://ğŸ’»app/server/methods/getRoomIdByNameOrId.js","meteor://ğŸ’»app/server/methods/getRoomNameById.js","meteor://ğŸ’»app/server/methods/getTotalChannels.js","meteor://ğŸ’»app/server/methods/getUsernameSuggestion.js","meteor://ğŸ’»app/server/methods/getUsersOfRoom.js","meteor://ğŸ’»app/server/methods/hideRoom.js","meteor://ğŸ’»app/server/methods/ignoreUser.js","meteor://ğŸ’»app/server/methods/loadHistory.js","meteor://ğŸ’»app/server/methods/loadLocale.js","meteor://ğŸ’»app/server/methods/loadMissedMessages.js","meteor://ğŸ’»app/server/methods/loadNextMessages.js","meteor://ğŸ’»app/server/methods/loadSurroundingMessages.js","meteor://ğŸ’»app/server/methods/logoutCleanUp.js","meteor://ğŸ’»app/server/methods/messageSearch.js","meteor://ğŸ’»app/server/methods/migrate.js","meteor://ğŸ’»app/server/methods/muteUserInRoom.js","meteor://ğŸ’»app/server/methods/openRoom.js","meteor://ğŸ’»app/server/methods/readMessages.js","meteor://ğŸ’»app/server/methods/registerUser.js","meteor://ğŸ’»app/server/methods/removeRoomLeader.js","meteor://ğŸ’»app/server/methods/removeRoomModerator.js","meteor://ğŸ’»app/server/methods/removeRoomOwner.js","meteor://ğŸ’»app/server/methods/removeUserFromRoom.js","meteor://ğŸ’»app/server/methods/reportMessage.js","meteor://ğŸ’»app/server/methods/requestDataDownload.js","meteor://ğŸ’»app/server/methods/resetAvatar.js","meteor://ğŸ’»app/server/methods/roomNameExists.js","meteor://ğŸ’»app/server/methods/saveUserPreferences.js","meteor://ğŸ’»app/server/methods/saveUserProfile.js","meteor://ğŸ’»app/server/methods/sendConfirmationEmail.js","meteor://ğŸ’»app/server/methods/sendForgotPasswordEmail.js","meteor://ğŸ’»app/server/methods/setAvatarFromService.js","meteor://ğŸ’»app/server/methods/setUserActiveStatus.js","meteor://ğŸ’»app/server/methods/setUserPassword.js","meteor://ğŸ’»app/server/methods/toogleFavorite.js","meteor://ğŸ’»app/server/methods/unmuteUserInRoom.js","meteor://ğŸ’»app/server/methods/userSetUtcOffset.js","meteor://ğŸ’»app/server/publications/activeUsers.js","meteor://ğŸ’»app/server/publications/channelAndPrivateAutocomplete.js","meteor://ğŸ’»app/server/publications/fullUserData.js","meteor://ğŸ’»app/server/publications/messages.js","meteor://ğŸ’»app/server/publications/room.js","meteor://ğŸ’»app/server/publications/roomFiles.js","meteor://ğŸ’»app/server/publications/roomFilesWithSearchText.js","meteor://ğŸ’»app/server/publications/roomSubscriptionsByRole.js","meteor://ğŸ’»app/server/publications/spotlight.js","meteor://ğŸ’»app/server/publications/subscription.js","meteor://ğŸ’»app/server/publications/userAutocomplete.js","meteor://ğŸ’»app/server/publications/userChannels.js","meteor://ğŸ’»app/server/publications/userData.js","meteor://ğŸ’»app/server/stream/messages.js","meteor://ğŸ’»app/server/stream/streamBroadcast.js","meteor://ğŸ’»app/server/main.js","meteor://ğŸ’»app/lib/RegExp.js","meteor://ğŸ’»app/lib/francocatena_fix.js"],"names":["module","export","ReadReceipt","Random","watch","require","v","ModelReadReceipts","default","rawReadReceipts","model","rawCollection","list","debounceByRoomId","fn","roomId","args","clearTimeout","setTimeout","call","updateMessages","Meteor","bindEnvironment","firstSubscription","RocketChat","models","Subscriptions","getMinimumLastSeenByRoomId","Messages","setAsRead","ls","markMessagesAsRead","userId","userLastSeen","settings","get","room","Rooms","findOneById","fields","lm","storeReadReceipts","findUnreadMessagesByRoomAndDate","markMessageAsReadBySender","message","unread","ts","setAsReadById","_id","messages","Date","receipts","map","id","messageId","length","insertMany","e","console","error","getReceipts","findByMessageId","receipt","user","Users","username","name","methods","getReadReceipts","Error","method","rid","_Base","constructor","tryEnsureIndex","unique","find","exportDefault","sparse","callbacks","add","editedAt","setAsReadByRoomIdAndUserId","u","group","type","public","enableQuery","value","Accounts","tokenName","token","secret","tokenExist","findPersonalAccessTokenByTokenNameAndUserId","addPersonalAccessTokenToUser","loginTokenObject","hashedToken","_hashLoginToken","createdAt","lastTokenPart","slice","removePersonalAccessTokenOfUser","getLoginTokensByUserId","query","$exists","$eq","update","$push","$pull","$elemMatch","findOne","publish","ready","self","getFieldsToPublish","services","resume","loginTokens","filter","loginToken","handle","observeChanges","added","tokens","changed","removed","onStop","stop","addGroup","section","_","getIdentity","accessToken","HTTP","params","access_token","data","extend","response","registerLoginHandler","loginRequest","cordova","authResponse","identity","serviceData","expiresAt","now","expiresIn","whitelisted","pick","options","profile","updateOrCreateUserFromExternalService","s","accountsConfig","forbidClientAccountCreation","loginExpirationInDays","config","emailTemplates","siteName","from","userToActivate","subject","TAPi18n","__","html","header","placeholders","replace","footer","email","reason","escapeHTML","userActivated","active","activated","action","verifyEmailHtml","verifyEmail","text","url","absoluteUrl","urls","resetPassword","enrollAccount","lng","language","emails","address","onCreateUser","run","status","firstName","lastName","service","Object","values","verified","destinations","Roles","findUsersInRole","forEach","adminUser","Array","isArray","push","to","defer","Email","send","insertUserDoc","wrap","roles","Match","test","globalRoles","String","concat","password","defaultAuthServiceRoles","split","trim","users","joinDefaultChannels","runAsUser","joinDefaultChannelsSilenced","hasAdmin","Settings","updateValueById","authz","addUserRoles","validateLoginAttempt","login","allowed","function","includes","validEmail","updateLastLoginById","validateNewUser","domainWhiteList","isEmpty","domain","inWhiteList","some","match","RegExp","escape","push_test","hasRole","Push","enabled","$and","$or","appCollection","count","title","apn","sound","sendPush","tries","post","statusCode","log","remove","SystemLogger","milli","Math","pow","configurePush","debug","allow","gcm","apiKey","projectNumber","passphrase","keyData","certData","gateway","undefined","Configure","production","sendInterval","sendBatchSize","serverSend","badge","app","topic","appName","startup","roomFiles","pub","searchText","limit","cursorFileListHandle","Uploads","findNotHiddenFilesOfRoom","record","recordChanges","hasOwnProperty","Migrations","version","up","lastLogin","generateUsernameSuggestion","setUsername","JSON","stringify","avatarOrigin","avatars","getAvatarSuggestionForUser","keys","dataURI","blob","image","contentType","RocketChatFile","dataURIParse","rs","bufferToStream","Buffer","fileStore","FileUpload","getStore","deleteByName","file","insert","setAvatarOrigin","tryDropIndex","uid","nonreactive","sub","$set","$unset","$in","uids","usernames","t","k","oldId","sort","join","removeById","multi","rn","$rename","item","toLowerCase","setNameById","$ne","msgs","$lt","removeByRoomId","$size","newUserName","findOneByUsername","floor","random","findByType","newId","id0","id1","ids","by","findOneByName","upsert","index","isString","OEmbed","rocketUrlParser","CDN_PREFIX","ENV","MAIL_URL","denyUnverifiedEmails","avatarStore","path","toMigrate","source","Mongo","Collection","target","OEmbedCache","collection","collectionName","doc","rawSource","wrapAsync","drop","err","errmsg","newUsernames","uniq","admin","findOneAdmin","oldestUser","setAllUsersActive","metaKeys","old","new","oldAndNew","oldSetting","oldValue","newSetting","newValue","oldFilesCollection","oldGridFSCollection","oldChunkCollection","newFilesCollection","newGridFSCollection","newChunkCollection","cfsRecord","nameParts","original","extension","pop","size","complete","uploading","store","uploadedAt","updatedAt","oldGridFsFile","ObjectID","copies","files","key","filename","chunkSize","uploadDate","aliases","metadata","md5","files_id","oldChunk","n","urlsItem","parsedUrl","pathname","msg","_hidden","changes","Accounts_Facebook","Accounts_Facebook_id","Accounts_Facebook_secret","Accounts_Google","Accounts_Google_id","Accounts_Google_secret","Accounts_Github","Accounts_Github_id","Accounts_Github_secret","Accounts_Gitlab","Accounts_Gitlab_id","Accounts_Gitlab_secret","Accounts_Linkedin","Accounts_Linkedin_id","Accounts_Linkedin_secret","Accounts_Meteor","Accounts_Meteor_id","Accounts_Meteor_secret","Accounts_Twitter","Accounts_Twitter_id","Accounts_Twitter_secret","ServiceConfiguration","configurations","admins","fetch","pluck","green","rooms","findByTypes","creator","msgQuery","msgOptions","cursorFileMessages","$multi","i18nLabel","upgradeEtsToEditAt","Permissions","persistent","hidden","mentions","_roles","scope","addRole","LDAP_Url","LDAP_TLS","LDAP_DN","LDAP_Bind_Search","$setOnInsert","WebRTC_STUN_Server","WebRTC_TURN_Server","WebRTC_TURN_Username","WebRTC_TURN_Password","servers","encodeURIComponent","API_Analytics","scriptAlert","integrations","Integrations","script","processIncomingRequestScript","prepareOutgoingRequestScript","processOutgoingResponseScript","integration","loginHeader","requestUrl","resolve","result","npmRequestOptions","encoding","Assets","setAsset","content","headers","addUserPermission","allowPinning","$addToSet","footerValue","packageValue","customOauth","parts","valueSource","blocked","sorter","i18nDescription","bot","__migration_assets_files","chunks","__migration_assets_chunks","oldFile","mime","updateById","defaultUrl","assets","newRoomNotification","preferences","disableNewRoomNotification","newMessageNotification","disableNewMessageNotification","optOut","favoriteRooms","lastVisitor","lastNumber","parseInt","autolinkerUrls","RocketBot_Enabled","RocketBot_Name","code","label","Statistics","installedAt","subscriptions","$not","$type","subscription","setArchivedByUsername","forward","timeout","replace1","replace2","replace3","replace4","replace5","replace6","oldColor","LivechatDepartment","showOnRegistration","GoogleSiteVerification_id","editor","setting","reactions","visitor","visitorEmails","oauth","athorizedClients","channel","OAuthApps","redirectUri","getUsersInRole","removeUserFromRoles","oldPermission","down","newPermission","rids","outgoingIntegrations","i","event","retryFailedCalls","retryCount","retryDelay","linkedin","setName","runOnEdits","emailAddress","existingUser","emailHeader","emailFooter","startWithHTML","endsWithHTML","fs","logError","insertAvatar","details","avatarsFileStore","stream","callback","Promise","batch","arr","all","splice","then","s3","direct","AmazonS3","GoogleStorage","googleCloudStorage","avatarOrigins","avatarsPathRecord","avatarStoreTypeRecord","avatarsPath","process","env","AVATARS_PATH","avatarStoreType","oldAvatarGridFS","GridFS","countSync","Number","error_box","usersTotal","current","gridFSAvatar","getFileWithReadStream","readStream","deleteFile","filePath","stat","statSync","isFile","createReadStream","unlinkSync","avatarsFiles","avatarsChunks","audioNotification","lastActivity","LDAP_Domain_Base","LDAP_Domain_Search_User_ID","LDAP_Use_Custom_Domain_Search","LDAP_Custom_Domain_Search","LDAP_Domain_Search_User","LDAP_Domain_Search_Password","LDAP_Domain_Search_Filter","LDAP_Domain_Search_Object_Class","LDAP_Domain_Search_Object_Category","Custom_Domain_Search","parse","userDN","LDAP_Sync_User_Data","LDAP_Import_Users","majorColors","newvariables","lightenDarkenColor","col","amt","usePound","num","r","b","g","toString","color","newPreference","unreadRoomsMode","settingsMap","Desktop_Notifications_Default_Alert","Mobile_Notifications_Default_Alert","Audio_Notifications_Default_Alert","Desktop_Notifications_Duration","Audio_Notifications_Value","newSettingKey","LivechatVisitors","visitors","total","deparment","userAgent","ip","host","phone","role","createOrUpdate","FileUpload_GoogleStorage_Proxy","FileUpload_S3_Proxy","idleTimeLimit","fileQuery","filesToUpdate","messageQuery","announcement","desktopNotifications","desktopPrefOrigin","mobilePushNotifications","mobilePrefOrigin","emailNotifications","emailPrefOrigin","mobileNotifications","emailNotificationMode","userHighlights","highlights","pageVisitedCollection","messageCollection","roomCollection","roomIdByToken","batchSize","migrateHistory","items","toArray","actions","reduce","page","location","href","groupable","navigation","expireAt","ops","removeMany","LivechatPageVisited","pages","close","Future","_db","originals","usersCount","findByRoomId","fname","usersByUsername","obj","updateSubscription","fut","processBatch","itens","return","wait","userOptions","userIds","subscriptionQuery","$nin","subscriptionOptions","removeFilesByRoomId","getVersion","migrateTo","MIGRATION_VERSION","control","_getControl","last","_list","_setControl","AppCache","onlineOnly","sharp","Cookies","cookie","isUserAuthenticated","req","rc_uid","rc_token","findOneByIdAndLoginToken","warnUnauthenticatedAccess","debounce","warn","userCanAccessAvatar","WebApp","connectHandlers","use","res","decodeURIComponent","cacheTime","writeHead","write","end","exec","sandstorm","picture","setHeader","Avatars","reqModifiedHeader","toUTCString","initials","getAvatarColor","substr","toUpperCase","viewSize","fontSize","svg","format","toFormat","pipe","logger","Logger","SyncedCron","opts","level","generateStatistics","statistics","save","cleanupOEmbedCache","schedule","parser","cron","getMinutes","job","getHours","start","flat","newObj","isObject","i18nValidation","l","errors","langs","TAPi18next","resStore","lang","len","present","difference","red","white","rpad","createWithIdTypeAndName","create","statusDefault","utcOffset","getBinary","ADMIN_PASS","ADMIN_NAME","ADMIN_EMAIL","re","findOneByEmailAddress","ADMIN_USERNAME","nameValidation","checkUsernameAvailability","setPassword","INITIAL_USER","initialUser","TEST_MODE","addUserToDefaultChannels","instance","port","PORT","INSTANCE_IP","InstanceStatus","registerInstance","UserPresence","UserPresenceMonitor","semver","oplogState","MongoInternals","defaultRemoteCollectionDriver","mongo","_oplogHandle","onOplogEntry","desiredNodeVersion","clean","readFileSync","cwd","desiredNodeVersionMajor","major","Info","versions","node","arch","platform","commit","hash","branch","satisfies","startup_box","exit","orig_updateOrCreateUserFromExternalService","serviceName","_OAuthCustom","primaryEmail","a","primary","findQuery","findWhere","resetPasswordAndSetRequirePasswordChange","setServiceId","setEmailVerified","apply","OEmbedCacheCleanup","date","expirationDays","setDate","getDate","removeAfterDate","addAllUserToRoom","activeUsersOnly","check","Boolean","userCount","userFilter","findOneByRoomIdAndUserId","createWithRoomAndUser","open","alert","userMentions","groupMentions","createUserJoinWithRoomIdAndUser","addRoomLeader","hasPermission","addRoleById","fromUser","createSubscriptionRoleAddedWithRoomIdAndUser","Notifications","notifyLogged","addRoomModerator","addRoomOwner","afterVerifyEmail","verifiedEmail","removeUserRoles","sortChannels","field","direction","sortUsers","browseChannels","sortBy","sortDirection","offset","regex","escapeRegExp","skip","max","results","findByNameAndType","description","lastMessage","archived","findByActiveUsersExcept","DDPRateLimiter","addRule","canAccessRoom","extraData","Maybe","channelsList","channelType","unblock","Optional","isNumber","channels","findByTypeAndNameContaining","roomIds","findByTypeAndUserId","findByTypeInIds","findByTypeInIdsAndNameContaining","userPref","getUserPreference","groupByType","createDirectMessage","me","myNotificationPref","getDefaultSubscriptionPref","upsertSubscription","customFields","toNotificationPref","RateLimiter","limitMethod","deleteFileMessage","fileID","getMessageByFileId","deleteById","deleteUser","adminCount","userIsAdmin","indexOf","eraseRoom","Apps","isLoaded","prevent","await","getBridges","getListenerBridge","roomEvent","roomTypes","canBeDeleted","facebook","google","github","pictureUrl","twitter","profile_image_url_https","gitlab","avatar_url","Gravatar","imageUrl","secure","validAvatars","avatar","getAvatarSuggestion","getRoomIdByNameOrId","getRoomNameById","getTotalChannels","slug","slugify","usernameIsAvaliable","generateSuggestion","preferredHandle","first","flatten","compact","getUsernameSuggestion","getUsersOfRoom","showAll","broadcast","findByRoomIdWhenUsernameExists","findUsersWithUsernameByIds","findUsersWithUsernameByIdsNotOffline","records","hideRoom","hideByRoomIdAndUserId","ignoreUser","ignoredUser","ignore","subscriptionIgnoredUser","hideMessagesOfType","types","loadHistory","fromId","canAnonymous","canPreview","loadMessageHistory","loadLocale","locale","getText","shift","loadMissedMessages","findVisibleByRoomIdAfterTimestamp","loadNextMessages","findVisibleByRoomId","starred","loadSurroundingMessages","ceil","recordsBefore","findVisibleByRoomIdBeforeTimestamp","moreBefore","recordsAfter","afterMessages","moreAfter","logoutCleanUp","messageSearch","docs","currentUserId","currentUserName","currentUserTimezoneOffset","filterStarred","filterUrl","filterPinned","pinned","filterLocation","$exist","filterBeforeDate","day","month","year","beforeDate","setHours","getUTCHours","getTimezoneOffset","$lte","filterAfterDate","afterDate","setUTCHours","$gte","filterOnDate","dayAfter","filterLabel","tag","sortByTimestamp","startsWith","$regex","$options","mention","$text","$search","score","$meta","findByUserId","getMigrationVersion","muteUserInRoom","ObjectIncluding","findOneByRoomIdAndUsername","mutedUser","muteUsernameByRoomId","createUserMutedWithRoomIdAndUser","openRoom","openByRoomIdAndUserId","readMessages","userSubscription","assign","registerUser","formData","AllowAnonymousRead","AllowAnonymousWrite","manuallyApproveNewUsers","_loginUser","pass","secretURL","passwordPolicy","validate","validateEmailDomain","userData","importedUser","importIds","createUser","setReason","saveCustomFields","userModel","sendVerificationEmail","removeRoomLeader","removeRoleById","createSubscriptionRoleRemovedWithRoomIdAndUser","removeRoomModerator","removeRoomOwner","numOwners","removeUserFromRoom","removedUser","removeByRoomIdAndUserId","createUserRemovedWithRoomIdAndUser","reportMessage","Reports","createWithMessageDescriptionAndUserId","tempFolder","requestDataDownload","fullExport","currentUserData","lastOperation","ExportOperations","findLastOperationByUser","yesterday","setUTCDate","getUTCDate","requested","exportOperation","existsSync","mkdirSync","subFolderName","baseFolder","folderName","assetsFolder","roomList","exportPath","assetsPath","fileList","generatedFile","resetAvatar","unsetAvatarOrigin","roomNameExists","saveUserPreferences","useEmojis","convertAsciiEmoji","saveMobileBandwidth","collapseMediaByDefault","autoImageLoad","unreadAlert","notificationsSoundVolume","enableAutoAway","desktopNotificationDuration","messageViewMode","hideUsernames","hideRoles","hideAvatars","hideFlexTab","sendOnEnter","roomCounterSidebar","sidebarShowFavorites","sidebarShowUnread","sidebarSortby","sidebarViewMode","sidebarHideAvatar","sidebarGroupByType","muteFocusedConversations","oldDesktopNotifications","oldMobileNotifications","oldEmailNotifications","clearSettings","setLanguage","setPreferences","clearDesktopNotificationUserPreferences","updateDesktopNotificationUserPreferences","clearMobileNotificationUserPreferences","updateMobileNotificationUserPreferences","clearEmailNotificationUserPreferences","updateEmailNotificationUserPreferences","updateUserHighlights","saveUserProfile","checkPassword","typedPassword","bcrypt","passCheck","_checkPassword","digest","algorithm","realname","newPassword","logout","setProfile","sendConfirmationEmail","sendForgotPasswordEmail","userEmail","sendResetPasswordEmail","setAvatarFromService","setUserAvatar","setUserActiveStatus","setUserActive","unsetLoginTokens","unsetReason","setUserPassword","requirePasswordChange","unsetRequirePasswordChange","toggleFavorite","f","setFavoriteByRoomIdAndUserId","unmuteUserInRoom","unmutedUser","unmuteUsernameByRoomId","createUserUnmutedWithRoomIdAndUser","userSetUtcOffset","setUtcOffset","findUsersNotOffline","selector","cursorHandle","findChannelAndPrivateByNameStarting","getFullUserData","publication","cursor","cursorDelete","findInvisibleByRoomId","cursorDeleteHandle","lastUpdate","latestDate","oldestDate","inclusive","unreads","updated","findForUpdates","deleted","trashFindDeletedAfter","_deletedAt","latest","oldest","cl","announcementDetails","muted","_updatedAt","jitsiTimeout","retention","livechatData","tags","sms","joinCodeRequired","ro","reactWhenReadOnly","sysMes","sentiment","tokenpass","streamingOptions","roomMap","findByDefaultAndTypes","findBySubscriptionUserIdUpdatedAfter","findBySubscriptionUserId","getRoomByTypeAndName","roomFind","getRoomFind","findByTypeAndName","on","clientAction","notifyUserInThisInstance","findByRoomIdAndRoles","fetchRooms","spotlight","searchForChannels","searchForDMs","roomOptions","findByNameAndTypeNotDefault","searchableRoomTypes","entries","roomType","includeInRoomSearch","findByUserIdAndTypes","findByNameAndTypesNotInIds","audioNotifications","audioNotificationValue","blocker","autoTranslate","autoTranslateLanguage","disableNotifications","hideUnreadStatus","muteGroupMentions","ignored","trashFindOneById","exceptions","findActiveByUsernameOrNameRegexWithExceptions","term","statusConnection","defaultRoom","requirePasswordChangeReason","statusLivechat","banners","msgStream","Streamer","allowWrite","allowRead","eventName","allowEmit","roomParticipant","publishMessage","imported","UI_Use_Real_Name","emitWithoutBroadcast","DDPCommon","connections","sections","connection","auth","_authorizeConnection","info","instanceId","ok","broadcastAuth","authorizeConnection","getCollection","startMatrixBroadcast","_createdAt","observe","extraInformation","isDocker","instanceRecord","disconnect","DDP","connect","_dontPrintErrors","LoggerManager","logLevel","onReconnect","remoteId","selfId","streamName","StreamerCentral","instances","serverOnly","emitWithScope","_emit","startStreamCastBroadcast","_stream","raw_msg","parseDDP","subscribe","startStreamBroadcast","fromInstance","connected","endpoint","conn","currentStatus","i18n_status_func"],"mappings":"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","file":"/app.js","sourcesContent":["import { Random } from 'meteor/random';\nimport ModelReadReceipts from '../models/ReadReceipts';\n\nconst rawReadReceipts = ModelReadReceipts.model.rawCollection();\n\n// debounced function by roomId, so multiple calls within 2 seconds to same roomId runs only once\nconst list = {};\nconst debounceByRoomId = function(fn) {\n\treturn function(roomId, ...args) {\n\t\tclearTimeout(list[roomId]);\n\t\tlist[roomId] = setTimeout(() => { fn.call(this, roomId, ...args); }, 2000);\n\t};\n};\n\nconst updateMessages = debounceByRoomId(Meteor.bindEnvironment((roomId) => {\n\t// @TODO maybe store firstSubscription in room object so we don't need to call the above update method\n\tconst firstSubscription = RocketChat.models.Subscriptions.getMinimumLastSeenByRoomId(roomId);\n\tRocketChat.models.Messages.setAsRead(roomId, firstSubscription.ls);\n}));\n\nexport const ReadReceipt = {\n\tmarkMessagesAsRead(roomId, userId, userLastSeen) {\n\t\tif (!RocketChat.settings.get('Message_Read_Receipt_Enabled')) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(roomId, { fields: { lm: 1 } });\n\n\t\t// if users last seen is greadebounceByRoomIdter than room's last message, it means the user already have this room marked as read\n\t\tif (userLastSeen > room.lm) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (userLastSeen) {\n\t\t\tthis.storeReadReceipts(RocketChat.models.Messages.findUnreadMessagesByRoomAndDate(roomId, userLastSeen), roomId, userId);\n\t\t}\n\n\t\tupdateMessages(roomId);\n\t},\n\n\tmarkMessageAsReadBySender(message, roomId, userId) {\n\t\tif (!RocketChat.settings.get('Message_Read_Receipt_Enabled')) {\n\t\t\treturn;\n\t\t}\n\n\t\t// this will usually happens if the message sender is the only one on the room\n\t\tconst firstSubscription = RocketChat.models.Subscriptions.getMinimumLastSeenByRoomId(roomId);\n\t\tif (message.unread && message.ts < firstSubscription.ls) {\n\t\t\tRocketChat.models.Messages.setAsReadById(message._id, firstSubscription.ls);\n\t\t}\n\n\t\tthis.storeReadReceipts([{ _id: message._id }], roomId, userId);\n\t},\n\n\tstoreReadReceipts(messages, roomId, userId) {\n\t\tif (RocketChat.settings.get('Message_Read_Receipt_Store_Users')) {\n\t\t\tconst ts = new Date();\n\t\t\tconst receipts = messages.map((message) => ({\n\t\t\t\t_id: Random.id(),\n\t\t\t\troomId,\n\t\t\t\tuserId,\n\t\t\t\tmessageId: message._id,\n\t\t\t\tts,\n\t\t\t}));\n\n\t\t\tif (receipts.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\trawReadReceipts.insertMany(receipts);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('Error inserting read receipts per user');\n\t\t\t}\n\t\t}\n\t},\n\n\tgetReceipts(message) {\n\t\treturn ModelReadReceipts.findByMessageId(message._id).map((receipt) => ({\n\t\t\t...receipt,\n\t\t\tuser: RocketChat.models.Users.findOneById(receipt.userId, { fields: { username: 1, name: 1 } }),\n\t\t}));\n\t},\n};\n","import { Meteor } from 'meteor/meteor';\n\nimport { ReadReceipt } from '../../lib/ReadReceipt';\n\nMeteor.methods({\n\tgetReadReceipts({ messageId }) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getReadReceipts' });\n\t\t}\n\n\t\tif (!messageId) {\n\t\t\tthrow new Meteor.Error('error-invalid-message', 'The required \\'messageId\\' param is missing.', { method: 'getReadReceipts' });\n\t\t}\n\n\t\tconst message = RocketChat.models.Messages.findOneById(messageId);\n\n\t\tif (!message) {\n\t\t\tthrow new Meteor.Error('error-invalid-message', 'Invalid message', { method: 'getReadReceipts' });\n\t\t}\n\n\t\tconst room = Meteor.call('canAccessRoom', message.rid, Meteor.userId());\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'getReadReceipts' });\n\t\t}\n\n\t\treturn ReadReceipt.getReceipts(message);\n\t},\n});\n","class ModelReadReceipts extends RocketChat.models._Base {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\n\t\tthis.tryEnsureIndex({\n\t\t\troomId: 1,\n\t\t\tuserId: 1,\n\t\t\tmessageId: 1,\n\t\t}, {\n\t\t\tunique: 1,\n\t\t});\n\t}\n\n\tfindByMessageId(messageId) {\n\t\treturn this.find({ messageId });\n\t}\n}\n\nexport default new ModelReadReceipts('message_read_receipt');\n","RocketChat.models.Messages.tryEnsureIndex({\n\tunread: 1,\n}, {\n\tsparse: true,\n});\n","import { ReadReceipt } from './lib/ReadReceipt';\n\nRocketChat.callbacks.add('afterSaveMessage', (message, room) => {\n\n\t// skips this callback if the message was edited\n\tif (message.editedAt) {\n\t\treturn message;\n\t}\n\n\t// set subscription as read right after message was sent\n\tRocketChat.models.Subscriptions.setAsReadByRoomIdAndUserId(room._id, message.u._id);\n\n\t// mark message as read as well\n\tReadReceipt.markMessageAsReadBySender(message, room._id, message.u._id);\n});\n","import './dbIndexes';\nimport './hooks';\nimport './settings';\n\nimport './api/methods/getReadReceipts';\n","RocketChat.settings.add('Message_Read_Receipt_Enabled', false, {\n\tgroup: 'Message',\n\ttype: 'boolean',\n\tpublic: true,\n});\n\nRocketChat.settings.add('Message_Read_Receipt_Store_Users', false, {\n\tgroup: 'Message',\n\ttype: 'boolean',\n\tpublic: true,\n\tenableQuery: { _id: 'Message_Read_Receipt_Enabled', value: true },\n});\n","import { Meteor } from 'meteor/meteor';\nimport { Random } from 'meteor/random';\nimport { Accounts } from 'meteor/accounts-base';\n\nMeteor.methods({\n\t'personalAccessTokens:generateToken'({ tokenName }) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('not-authorized', 'Not Authorized', { method: 'personalAccessTokens:generateToken' });\n\t\t}\n\t\tif (!RocketChat.settings.get('API_Enable_Personal_Access_Tokens')) {\n\t\t\tthrow new Meteor.Error('error-personal-access-tokens-are-current-disabled', 'Personal Access Tokens are currently disabled', { method: 'personalAccessTokens:generateToken' });\n\t\t}\n\n\t\tconst token = Random.secret();\n\t\tconst tokenExist = RocketChat.models.Users.findPersonalAccessTokenByTokenNameAndUserId({\n\t\t\tuserId: Meteor.userId(),\n\t\t\ttokenName,\n\t\t});\n\t\tif (tokenExist) {\n\t\t\tthrow new Meteor.Error('error-token-already-exists', 'A token with this name already exists', { method: 'personalAccessTokens:generateToken' });\n\t\t}\n\n\t\tRocketChat.models.Users.addPersonalAccessTokenToUser({\n\t\t\tuserId: Meteor.userId(),\n\t\t\tloginTokenObject: {\n\t\t\t\thashedToken: Accounts._hashLoginToken(token),\n\t\t\t\ttype: 'personalAccessToken',\n\t\t\t\tcreatedAt: new Date(),\n\t\t\t\tlastTokenPart: token.slice(-6),\n\t\t\t\tname: tokenName,\n\t\t\t},\n\t\t});\n\t\treturn token;\n\t},\n});\n","import './generateToken';\nimport './regenerateToken';\nimport './removeToken';\n","import { Meteor } from 'meteor/meteor';\n\nMeteor.methods({\n\t'personalAccessTokens:regenerateToken'({ tokenName }) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('not-authorized', 'Not Authorized', { method: 'personalAccessTokens:regenerateToken' });\n\t\t}\n\t\tif (!RocketChat.settings.get('API_Enable_Personal_Access_Tokens')) {\n\t\t\tthrow new Meteor.Error('error-personal-access-tokens-are-current-disabled', 'Personal Access Tokens are currently disabled', { method: 'personalAccessTokens:regenerateToken' });\n\t\t}\n\n\t\tconst tokenExist = RocketChat.models.Users.findPersonalAccessTokenByTokenNameAndUserId({\n\t\t\tuserId: Meteor.userId(),\n\t\t\ttokenName,\n\t\t});\n\t\tif (!tokenExist) {\n\t\t\tthrow new Meteor.Error('error-token-does-not-exists', 'Token does not exist', { method: 'personalAccessTokens:regenerateToken' });\n\t\t}\n\n\t\tMeteor.call('personalAccessTokens:removeToken', { tokenName });\n\t\treturn Meteor.call('personalAccessTokens:generateToken', { tokenName });\n\t},\n});\n","import { Meteor } from 'meteor/meteor';\n\nMeteor.methods({\n\t'personalAccessTokens:removeToken'({ tokenName }) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('not-authorized', 'Not Authorized', { method: 'personalAccessTokens:removeToken' });\n\t\t}\n\t\tif (!RocketChat.settings.get('API_Enable_Personal_Access_Tokens')) {\n\t\t\tthrow new Meteor.Error('error-personal-access-tokens-are-current-disabled', 'Personal Access Tokens are currently disabled', { method: 'personalAccessTokens:removeToken' });\n\t\t}\n\t\tconst tokenExist = RocketChat.models.Users.findPersonalAccessTokenByTokenNameAndUserId({\n\t\t\tuserId: Meteor.userId(),\n\t\t\ttokenName,\n\t\t});\n\t\tif (!tokenExist) {\n\t\t\tthrow new Meteor.Error('error-token-does-not-exists', 'Token does not exist', { method: 'personalAccessTokens:removeToken' });\n\t\t}\n\t\tRocketChat.models.Users.removePersonalAccessTokenOfUser({\n\t\t\tuserId: Meteor.userId(),\n\t\t\tloginTokenObject: {\n\t\t\t\ttype: 'personalAccessToken',\n\t\t\t\tname: tokenName,\n\t\t\t},\n\t\t});\n\t},\n});\n","RocketChat.models.Users.getLoginTokensByUserId = function(userId) {\n\tconst query = {\n\t\t'services.resume.loginTokens.type': {\n\t\t\t$exists: true,\n\t\t\t$eq: 'personalAccessToken',\n\t\t},\n\t\t_id: userId,\n\t};\n\n\treturn this.find(query, { fields: { 'services.resume.loginTokens': 1 } });\n};\n\nRocketChat.models.Users.addPersonalAccessTokenToUser = function({ userId, loginTokenObject }) {\n\treturn this.update(userId, {\n\t\t$push: {\n\t\t\t'services.resume.loginTokens': loginTokenObject,\n\t\t},\n\t});\n};\n\nRocketChat.models.Users.removePersonalAccessTokenOfUser = function({ userId, loginTokenObject }) {\n\treturn this.update(userId, {\n\t\t$pull: {\n\t\t\t'services.resume.loginTokens': loginTokenObject,\n\t\t},\n\t});\n};\n\nRocketChat.models.Users.findPersonalAccessTokenByTokenNameAndUserId = function({ userId, tokenName }) {\n\tconst query = {\n\t\t'services.resume.loginTokens': {\n\t\t\t$elemMatch: { name: tokenName, type: 'personalAccessToken' },\n\t\t},\n\t\t_id: userId,\n\t};\n\n\treturn this.findOne(query);\n};\n\n","import './Users';\n","import './personalAccessTokens';\n","import { Meteor } from 'meteor/meteor';\n\nMeteor.publish('personalAccessTokens', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\tif (!RocketChat.settings.get('API_Enable_Personal_Access_Tokens')) {\n\t\treturn this.ready();\n\t}\n\tconst self = this;\n\tconst getFieldsToPublish = (fields) => fields.services.resume.loginTokens\n\t\t.filter((loginToken) => loginToken.type && loginToken.type === 'personalAccessToken')\n\t\t.map((loginToken) => ({\n\t\t\tname: loginToken.name,\n\t\t\tcreatedAt: loginToken.createdAt,\n\t\t\tlastTokenPart: loginToken.lastTokenPart,\n\t\t}));\n\tconst handle = RocketChat.models.Users.getLoginTokensByUserId(this.userId).observeChanges({\n\t\tadded(id, fields) {\n\t\t\tself.added('personal_access_tokens', id, { tokens: getFieldsToPublish(fields) });\n\t\t},\n\t\tchanged(id, fields) {\n\t\t\tself.changed('personal_access_tokens', id, { tokens: getFieldsToPublish(fields) });\n\t\t},\n\t\tremoved(id) {\n\t\t\tself.removed('personal_access_tokens', id);\n\t\t},\n\t});\n\n\tself.ready();\n\n\tself.onStop(function() {\n\t\thandle.stop();\n\t});\n});\n","import './api/methods';\nimport './settings';\nimport './models';\nimport './publications';\n\n\n","RocketChat.settings.addGroup('General', function() {\n\tthis.section('REST API', function() {\n\t\tthis.add('API_Enable_Personal_Access_Tokens', false, { type: 'boolean', public: true });\n\t});\n});\n","import '../../message-read-receipt/server';\nimport '../../personal-access-tokens/server';\n","import _ from 'underscore';\n\nfunction getIdentity(accessToken) {\n\ttry {\n\t\treturn HTTP.get('https://graph.facebook.com/me', {\n\t\t\tparams: {\n\t\t\t\taccess_token: accessToken,\n\t\t\t},\n\t\t}).data;\n\t} catch (error) {\n\t\tthrow _.extend(new Error(`Failed to fetch identity from Facebook. ${ error.message }`), {\n\t\t\tresponse: error.response,\n\t\t});\n\t}\n}\n\nAccounts.registerLoginHandler(function(loginRequest) {\n\tif (!loginRequest.cordova) {\n\t\treturn;\n\t}\n\n\tloginRequest = loginRequest.authResponse;\n\n\tconst identity = getIdentity(loginRequest.accessToken);\n\tconst serviceData = {\n\t\taccessToken: loginRequest.accessToken,\n\t\texpiresAt: Date.now() + 1000 * loginRequest.expiresIn,\n\t};\n\n\tconst whitelisted = ['id', 'email', 'name', 'first_name', 'last_name', 'link', 'username', 'gender', 'locale', 'age_range'];\n\tconst fields = _.pick(identity, whitelisted);\n\tconst options = {\n\t\tprofile: {},\n\t};\n\n\t_.extend(serviceData, fields);\n\t_.extend(options.profile, fields);\n\n\treturn Accounts.updateOrCreateUserFromExternalService('facebook', serviceData, options);\n});\n","import _ from 'underscore';\nimport s from 'underscore.string';\n\nconst accountsConfig = {\n\tforbidClientAccountCreation: true,\n\tloginExpirationInDays: RocketChat.settings.get('Accounts_LoginExpiration'),\n};\n\nAccounts.config(accountsConfig);\n\nAccounts.emailTemplates.siteName = RocketChat.settings.get('Site_Name');\n\nAccounts.emailTemplates.from = `${ RocketChat.settings.get('Site_Name') } <${ RocketChat.settings.get('From_Email') }>`;\n\nAccounts.emailTemplates.userToActivate = {\n\tsubject() {\n\t\tconst subject = TAPi18n.__('Accounts_Admin_Email_Approval_Needed_Subject_Default');\n\t\tconst siteName = RocketChat.settings.get('Site_Name');\n\n\t\treturn `[${ siteName }] ${ subject }`;\n\t},\n\n\thtml(options = {}) {\n\t\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\t\tconst footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\n\t\tconst email = options.reason ? 'Accounts_Admin_Email_Approval_Needed_With_Reason_Default' : 'Accounts_Admin_Email_Approval_Needed_Default';\n\n\t\tconst html = RocketChat.placeholders.replace(TAPi18n.__(email), {\n\t\t\tname: s.escapeHTML(options.name),\n\t\t\temail: s.escapeHTML(options.email),\n\t\t\treason: s.escapeHTML(options.reason),\n\t\t});\n\n\t\treturn header + html + footer;\n\t},\n};\n\nAccounts.emailTemplates.userActivated = {\n\tsubject({ active, username }) {\n\t\tconst activated = username ? 'Activated' : 'Approved';\n\t\tconst action = active ? activated : 'Deactivated';\n\t\tconst subject = `Accounts_Email_${ action }_Subject`;\n\t\tconst siteName = RocketChat.settings.get('Site_Name');\n\n\t\treturn `[${ siteName }] ${ TAPi18n.__(subject) }`;\n\t},\n\n\thtml({ active, name, username }) {\n\t\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\t\tconst footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\n\t\tconst activated = username ? 'Activated' : 'Approved';\n\t\tconst action = active ? activated : 'Deactivated';\n\n\t\tconst html = RocketChat.placeholders.replace(TAPi18n.__(`Accounts_Email_${ action }`), {\n\t\t\tname: s.escapeHTML(name),\n\t\t});\n\n\t\treturn header + html + footer;\n\t},\n};\n\n\nconst verifyEmailHtml = Accounts.emailTemplates.verifyEmail.text;\n\nAccounts.emailTemplates.verifyEmail.html = function(user, url) {\n\turl = url.replace(Meteor.absoluteUrl(), `${ Meteor.absoluteUrl() }login/`);\n\treturn verifyEmailHtml(user, url);\n};\n\nAccounts.urls.resetPassword = function(token) {\n\treturn Meteor.absoluteUrl(`reset-password/${ token }`);\n};\n\nAccounts.emailTemplates.resetPassword.html = Accounts.emailTemplates.resetPassword.text;\n\nAccounts.emailTemplates.enrollAccount.subject = function(user = {}) {\n\tlet subject;\n\tif (RocketChat.settings.get('Accounts_Enrollment_Customized')) {\n\t\tsubject = RocketChat.settings.get('Accounts_Enrollment_Email_Subject');\n\t} else {\n\t\tsubject = TAPi18n.__('Accounts_Enrollment_Email_Subject_Default', {\n\t\t\tlng: user.language || RocketChat.settings.get('language') || 'en',\n\t\t});\n\t}\n\treturn RocketChat.placeholders.replace(subject);\n};\n\nAccounts.emailTemplates.enrollAccount.html = function(user = {}/* , url*/) {\n\tlet html;\n\tif (RocketChat.settings.get('Accounts_Enrollment_Customized')) {\n\t\thtml = RocketChat.settings.get('Accounts_Enrollment_Email');\n\t} else {\n\t\thtml = TAPi18n.__('Accounts_Enrollment_Email_Default', {\n\t\t\tlng: user.language || RocketChat.settings.get('language') || 'en',\n\t\t});\n\t}\n\n\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\tconst footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\n\thtml = RocketChat.placeholders.replace(html, {\n\t\tname: s.escapeHTML(user.name),\n\t\temail: user.emails && user.emails[0] && s.escapeHTML(user.emails[0].address),\n\t});\n\n\treturn header + html + footer;\n};\n\nAccounts.onCreateUser(function(options, user = {}) {\n\tRocketChat.callbacks.run('beforeCreateUser', options, user);\n\n\tuser.status = 'offline';\n\tuser.active = !RocketChat.settings.get('Accounts_ManuallyApproveNewUsers');\n\n\tif (!user.name) {\n\t\tif (options.profile) {\n\t\t\tif (options.profile.name) {\n\t\t\t\tuser.name = options.profile.name;\n\t\t\t} else if (options.profile.firstName && options.profile.lastName) {\n\t\t\t\t// LinkedIn format\n\t\t\t\tuser.name = `${ options.profile.firstName } ${ options.profile.lastName }`;\n\t\t\t} else if (options.profile.firstName) {\n\t\t\t\t// LinkedIn format\n\t\t\t\tuser.name = options.profile.firstName;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.services) {\n\t\tfor (const service of Object.values(user.services)) {\n\t\t\tif (!user.name) {\n\t\t\t\tuser.name = service.name || service.username;\n\t\t\t}\n\n\t\t\tif (!user.emails && service.email) {\n\t\t\t\tuser.emails = [{\n\t\t\t\t\taddress: service.email,\n\t\t\t\t\tverified: true,\n\t\t\t\t}];\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!user.active) {\n\t\tconst destinations = [];\n\n\t\tRocketChat.models.Roles.findUsersInRole('admin').forEach((adminUser) => {\n\t\t\tif (Array.isArray(adminUser.emails)) {\n\t\t\t\tadminUser.emails.forEach((email) => {\n\t\t\t\t\tdestinations.push(`${ adminUser.name }<${ email.address }>`);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tconst email = {\n\t\t\tto: destinations,\n\t\t\tfrom: RocketChat.settings.get('From_Email'),\n\t\t\tsubject: Accounts.emailTemplates.userToActivate.subject(),\n\t\t\thtml: Accounts.emailTemplates.userToActivate.html(options),\n\t\t};\n\n\t\tMeteor.defer(() => Email.send(email));\n\t}\n\n\treturn user;\n});\n\nAccounts.insertUserDoc = _.wrap(Accounts.insertUserDoc, function(insertUserDoc, options, user) {\n\tlet roles = [];\n\n\tif (Match.test(user.globalRoles, [String]) && user.globalRoles.length > 0) {\n\t\troles = roles.concat(user.globalRoles);\n\t}\n\n\tdelete user.globalRoles;\n\n\tif (user.services && !user.services.password) {\n\t\tconst defaultAuthServiceRoles = String(RocketChat.settings.get('Accounts_Registration_AuthenticationServices_Default_Roles')).split(',');\n\t\tif (defaultAuthServiceRoles.length > 0) {\n\t\t\troles = roles.concat(defaultAuthServiceRoles.map((s) => s.trim()));\n\t\t}\n\t}\n\n\tif (!user.type) {\n\t\tuser.type = 'user';\n\t}\n\n\tconst _id = insertUserDoc.call(Accounts, options, user);\n\n\tuser = Meteor.users.findOne({\n\t\t_id,\n\t});\n\n\tif (user.username) {\n\t\tif (options.joinDefaultChannels !== false && user.joinDefaultChannels !== false) {\n\t\t\tMeteor.runAsUser(_id, function() {\n\t\t\t\treturn Meteor.call('joinDefaultChannels', options.joinDefaultChannelsSilenced);\n\t\t\t});\n\t\t}\n\n\t\tif (user.type !== 'visitor') {\n\t\t\tMeteor.defer(function() {\n\t\t\t\treturn RocketChat.callbacks.run('afterCreateUser', user);\n\t\t\t});\n\t\t}\n\t}\n\n\tif (roles.length === 0) {\n\t\tconst hasAdmin = RocketChat.models.Users.findOne({\n\t\t\troles: 'admin',\n\t\t\ttype: 'user',\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t},\n\t\t});\n\n\t\tif (hasAdmin) {\n\t\t\troles.push('user');\n\t\t} else {\n\t\t\troles.push('admin');\n\t\t\tif (RocketChat.settings.get('Show_Setup_Wizard') === 'pending') {\n\t\t\t\tRocketChat.models.Settings.updateValueById('Show_Setup_Wizard', 'in_progress');\n\t\t\t}\n\t\t}\n\t}\n\n\tRocketChat.authz.addUserRoles(_id, roles);\n\n\treturn _id;\n});\n\nAccounts.validateLoginAttempt(function(login) {\n\tlogin = RocketChat.callbacks.run('beforeValidateLogin', login);\n\n\tif (login.allowed !== true) {\n\t\treturn login.allowed;\n\t}\n\n\tif (login.user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tif (!!login.user.active !== true) {\n\t\tthrow new Meteor.Error('error-user-is-not-activated', 'User is not activated', {\n\t\t\tfunction: 'Accounts.validateLoginAttempt',\n\t\t});\n\t}\n\n\tif (!login.user.roles || !Array.isArray(login.user.roles)) {\n\t\tthrow new Meteor.Error('error-user-has-no-roles', 'User has no roles', {\n\t\t\tfunction: 'Accounts.validateLoginAttempt',\n\t\t});\n\t}\n\n\tif (login.user.roles.includes('admin') === false && login.type === 'password' && RocketChat.settings.get('Accounts_EmailVerification') === true) {\n\t\tconst validEmail = login.user.emails.filter((email) => email.verified === true);\n\t\tif (validEmail.length === 0) {\n\t\t\tthrow new Meteor.Error('error-invalid-email', 'Invalid email __email__');\n\t\t}\n\t}\n\n\tlogin = RocketChat.callbacks.run('onValidateLogin', login);\n\n\tRocketChat.models.Users.updateLastLoginById(login.user._id);\n\tMeteor.defer(function() {\n\t\treturn RocketChat.callbacks.run('afterValidateLogin', login);\n\t});\n\n\treturn true;\n});\n\nAccounts.validateNewUser(function(user) {\n\tif (user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tif (RocketChat.settings.get('Accounts_Registration_AuthenticationServices_Enabled') === false && RocketChat.settings.get('LDAP_Enable') === false && !(user.services && user.services.password)) {\n\t\tthrow new Meteor.Error('registration-disabled-authentication-services', 'User registration is disabled for authentication services');\n\t}\n\n\treturn true;\n});\n\nAccounts.validateNewUser(function(user) {\n\tif (user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tlet domainWhiteList = RocketChat.settings.get('Accounts_AllowedDomainsList');\n\tif (_.isEmpty(s.trim(domainWhiteList))) {\n\t\treturn true;\n\t}\n\n\tdomainWhiteList = domainWhiteList.split(',').map((domain) => domain.trim());\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tconst email = user.emails[0].address;\n\t\tconst inWhiteList = domainWhiteList.some((domain) => email.match(`@${ RegExp.escape(domain) }$`));\n\n\t\tif (inWhiteList === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-domain');\n\t\t}\n\t}\n\n\treturn true;\n});\n","/* global Push, SystemLogger */\n\nMeteor.methods({\n\t// log() {\n\t// \treturn console.log(...arguments);\n\t// },\n\n\tpush_test() {\n\t\tconst user = Meteor.user();\n\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'push_test',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'push_test',\n\t\t\t});\n\t\t}\n\n\t\tif (Push.enabled !== true) {\n\t\t\tthrow new Meteor.Error('error-push-disabled', 'Push is disabled', {\n\t\t\t\tmethod: 'push_test',\n\t\t\t});\n\t\t}\n\n\t\tconst query = {\n\t\t\t$and: [{\n\t\t\t\tuserId: user._id,\n\t\t\t}, {\n\t\t\t\t$or: [{\n\t\t\t\t\t'token.apn': {\n\t\t\t\t\t\t$exists: true,\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\t'token.gcm': {\n\t\t\t\t\t\t$exists: true,\n\t\t\t\t\t},\n\t\t\t\t}],\n\t\t\t}],\n\t\t};\n\n\t\tconst tokens = Push.appCollection.find(query).count();\n\n\t\tif (tokens === 0) {\n\t\t\tthrow new Meteor.Error('error-no-tokens-for-this-user', 'There are no tokens for this user', {\n\t\t\t\tmethod: 'push_test',\n\t\t\t});\n\t\t}\n\n\t\tPush.send({\n\t\t\tfrom: 'push',\n\t\t\ttitle: `@${ user.username }`,\n\t\t\ttext: TAPi18n.__('This_is_a_push_test_messsage'),\n\t\t\tapn: {\n\t\t\t\ttext: `@${ user.username }:\\n${ TAPi18n.__('This_is_a_push_test_messsage') }`,\n\t\t\t},\n\t\t\tsound: 'default',\n\t\t\tquery: {\n\t\t\t\tuserId: user._id,\n\t\t\t},\n\t\t});\n\n\t\treturn {\n\t\t\tmessage: 'Your_push_was_sent_to_s_devices',\n\t\t\tparams: [tokens],\n\t\t};\n\t},\n});\n\nfunction sendPush(service, token, options, tries = 0) {\n\tconst data = {\n\t\tdata: {\n\t\t\ttoken,\n\t\t\toptions,\n\t\t},\n\t};\n\n\treturn HTTP.post(`${ RocketChat.settings.get('Push_gateway') }/push/${ service }/send`, data, function(error, response) {\n\t\tif (response && response.statusCode === 406) {\n\t\t\tconsole.log('removing push token', token);\n\t\t\tPush.appCollection.remove({\n\t\t\t\t$or: [{\n\t\t\t\t\t'token.apn': token,\n\t\t\t\t}, {\n\t\t\t\t\t'token.gcm': token,\n\t\t\t\t}],\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif (!error) {\n\t\t\treturn;\n\t\t}\n\n\t\tSystemLogger.error(`Error sending push to gateway (${ tries } try) ->`, error);\n\n\t\tif (tries <= 6) {\n\t\t\tconst milli = Math.pow(10, tries + 2);\n\n\t\t\tSystemLogger.log('Trying sending push to gateway again in', milli, 'milliseconds');\n\n\t\t\treturn Meteor.setTimeout(function() {\n\t\t\t\treturn sendPush(service, token, options, tries + 1);\n\t\t\t}, milli);\n\t\t}\n\t});\n}\n\nfunction configurePush() {\n\tif (RocketChat.settings.get('Push_debug')) {\n\t\tPush.debug = true;\n\t\tconsole.log('Push: configuring...');\n\t}\n\n\tif (RocketChat.settings.get('Push_enable') === true) {\n\t\tPush.allow({\n\t\t\tsend(userId/* , notification*/) {\n\t\t\t\treturn RocketChat.authz.hasRole(userId, 'admin');\n\t\t\t},\n\t\t});\n\n\t\tlet apn;\n\t\tlet gcm;\n\n\t\tif (RocketChat.settings.get('Push_enable_gateway') === false) {\n\t\t\tgcm = {\n\t\t\t\tapiKey: RocketChat.settings.get('Push_gcm_api_key'),\n\t\t\t\tprojectNumber: RocketChat.settings.get('Push_gcm_project_number'),\n\t\t\t};\n\n\t\t\tapn = {\n\t\t\t\tpassphrase: RocketChat.settings.get('Push_apn_passphrase'),\n\t\t\t\tkeyData: RocketChat.settings.get('Push_apn_key'),\n\t\t\t\tcertData: RocketChat.settings.get('Push_apn_cert'),\n\t\t\t};\n\n\t\t\tif (RocketChat.settings.get('Push_production') !== true) {\n\t\t\t\tapn = {\n\t\t\t\t\tpassphrase: RocketChat.settings.get('Push_apn_dev_passphrase'),\n\t\t\t\t\tkeyData: RocketChat.settings.get('Push_apn_dev_key'),\n\t\t\t\t\tcertData: RocketChat.settings.get('Push_apn_dev_cert'),\n\t\t\t\t\tgateway: 'gateway.sandbox.push.apple.com',\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!apn.keyData || apn.keyData.trim() === '' || !apn.certData || apn.certData.trim() === '') {\n\t\t\t\tapn = undefined;\n\t\t\t}\n\n\t\t\tif (!gcm.apiKey || gcm.apiKey.trim() === '' || !gcm.projectNumber || gcm.projectNumber.trim() === '') {\n\t\t\t\tgcm = undefined;\n\t\t\t}\n\t\t}\n\n\t\tPush.Configure({\n\t\t\tapn,\n\t\t\tgcm,\n\t\t\tproduction: RocketChat.settings.get('Push_production'),\n\t\t\tsendInterval: 5000,\n\t\t\tsendBatchSize: 10,\n\t\t});\n\n\t\tif (RocketChat.settings.get('Push_enable_gateway') === true) {\n\t\t\tPush.serverSend = function(options = { badge: 0 }) {\n\t\t\t\tif (options.from !== String(options.from)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"from\" not a string');\n\t\t\t\t}\n\t\t\t\tif (options.title !== String(options.title)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"title\" not a string');\n\t\t\t\t}\n\t\t\t\tif (options.text !== String(options.text)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"text\" not a string');\n\t\t\t\t}\n\t\t\t\tif (RocketChat.settings.get('Push_debug')) {\n\t\t\t\t\tconsole.log(`Push: send message \"${ options.title }\" via query`, options.query);\n\t\t\t\t}\n\n\t\t\t\tconst query = {\n\t\t\t\t\t$and: [options.query, {\n\t\t\t\t\t\t$or: [{\n\t\t\t\t\t\t\t'token.apn': {\n\t\t\t\t\t\t\t\t$exists: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t'token.gcm': {\n\t\t\t\t\t\t\t\t$exists: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}],\n\t\t\t\t\t}],\n\t\t\t\t};\n\n\t\t\t\treturn Push.appCollection.find(query).forEach((app) => {\n\t\t\t\t\tif (RocketChat.settings.get('Push_debug')) {\n\t\t\t\t\t\tconsole.log('Push: send to token', app.token);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (app.token.apn) {\n\t\t\t\t\t\toptions.topic = app.appName;\n\t\t\t\t\t\treturn sendPush('apn', app.token.apn, options);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (app.token.gcm) {\n\t\t\t\t\t\treturn sendPush('gcm', app.token.gcm, options);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\n\t\tPush.enabled = true;\n\t}\n}\n\nMeteor.startup(configurePush);\n","export const roomFiles = (pub, { rid, searchText, limit = 50 }) => {\n\tif (!pub.userId) {\n\t\treturn pub.ready();\n\t}\n\n\tconst cursorFileListHandle = RocketChat.models.Uploads.findNotHiddenFilesOfRoom(rid, searchText, limit).observeChanges({\n\t\tadded(_id, record) {\n\t\t\tconst { username, name } = record.userId ? RocketChat.models.Users.findOneById(record.userId) : {};\n\t\t\treturn pub.added('room_files', _id, { ...record, user: { username, name } });\n\t\t},\n\t\tchanged(_id, recordChanges) {\n\t\t\tif (!recordChanges.hasOwnProperty('user') && recordChanges.userId) {\n\t\t\t\trecordChanges.user = RocketChat.models.Users.findOneById(recordChanges.userId);\n\t\t\t}\n\t\t\treturn pub.changed('room_files', _id, recordChanges);\n\t\t},\n\t\tremoved(_id) {\n\t\t\treturn pub.removed('room_files', _id);\n\t\t},\n\t});\n\n\tpub.ready();\n\n\treturn pub.onStop(function() {\n\t\treturn cursorFileListHandle.stop();\n\t});\n};\n","RocketChat.Migrations.add({\n\tversion: 1,\n\tup() {\n\t\treturn RocketChat.models.Users.find({\n\t\t\tusername: {\n\t\t\t\t$exists: false,\n\t\t\t},\n\t\t\tlastLogin: {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t}).forEach((user) => {\n\t\t\tconst username = RocketChat.generateUsernameSuggestion(user);\n\t\t\tif (username && username.trim() !== '') {\n\t\t\t\treturn RocketChat.models.Users.setUsername(user._id, username);\n\t\t\t} else {\n\t\t\t\treturn console.log('User without username', JSON.stringify(user, null, ' '));\n\t\t\t}\n\t\t});\n\t},\n});\n","/* globals getAvatarSuggestionForUser */\n\nRocketChat.Migrations.add({\n\tversion: 2,\n\tup() {\n\t\treturn RocketChat.models.Users.find({\n\t\t\tavatarOrigin: {\n\t\t\t\t$exists: false,\n\t\t\t},\n\t\t\tusername: {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t}).forEach((user) => {\n\t\t\tconst avatars = getAvatarSuggestionForUser(user);\n\t\t\tconst services = Object.keys(avatars);\n\n\t\t\tif (services.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst service = services[0];\n\n\t\t\tconsole.log(user.username, '->', service);\n\n\t\t\tconst dataURI = avatars[service].blob;\n\t\t\tconst { image, contentType } = RocketChatFile.dataURIParse(dataURI);\n\n\t\t\tconst rs = RocketChatFile.bufferToStream(new Buffer(image, 'base64'));\n\t\t\tconst fileStore = FileUpload.getStore('Avatars');\n\t\t\tfileStore.deleteByName(user.username);\n\n\t\t\tconst file = {\n\t\t\t\tuserId: user._id,\n\t\t\t\ttype: contentType,\n\t\t\t};\n\n\t\t\tfileStore.insert(file, rs, () => RocketChat.models.Users.setAvatarOrigin(user._id, service));\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 3,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex('uid_1');\n\t\tRocketChat.models.Subscriptions.tryDropIndex('rid_1_uid_1');\n\n\t\tconsole.log('Fixing ChatSubscription uid');\n\n\t\tRocketChat.models.Subscriptions.find({\n\t\t\tuid: {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t}, {\n\t\t\tnonreactive: true,\n\t\t}).forEach((sub) => {\n\t\t\tconst update = {};\n\t\t\tconst user = RocketChat.models.Users.findOneById(sub.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tif (!update.$set) {\n\t\t\t\t\tupdate.$set = {};\n\t\t\t\t}\n\n\t\t\t\tif (!update.$unset) {\n\t\t\t\t\tupdate.$unset = {};\n\t\t\t\t}\n\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (Object.keys(update).length > 0) {\n\t\t\t\treturn RocketChat.models.Subscriptions.update(sub._id, update);\n\t\t\t}\n\t\t});\n\n\t\tconsole.log('Fixing ChatRoom uids');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\t'uids.0': {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t}, {\n\t\t\tnonreactive: true,\n\t\t}).forEach(function(room) {\n\t\t\tconst update = {};\n\t\t\tconst users = RocketChat.models.Users.find({\n\t\t\t\t_id: {\n\t\t\t\t\t$in: room.uids,\n\t\t\t\t},\n\t\t\t\tusername: {\n\t\t\t\t\t$exists: true,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tconst usernames = users.map(function(user) {\n\t\t\t\treturn user.username;\n\t\t\t});\n\n\t\t\tif (!update.$set) {\n\t\t\t\tupdate.$set = {};\n\t\t\t}\n\n\t\t\tif (!update.$unset) {\n\t\t\t\tupdate.$unset = {};\n\t\t\t}\n\n\t\t\tupdate.$set.usernames = usernames;\n\t\t\tupdate.$unset.uids = 1;\n\n\t\t\tconst user = RocketChat.models.Users.findOneById(room.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (room.t === 'd' && usernames.length === 2) {\n\t\t\t\tfor (const k of Object.keys(update.$set)) {\n\t\t\t\t\tconst v = update.$set[k];\n\t\t\t\t\troom[k] = v;\n\t\t\t\t}\n\n\t\t\t\tfor (const k of Object.keys(update.$unset)) {\n\t\t\t\t\tdelete room[k];\n\t\t\t\t}\n\n\t\t\t\tconst oldId = room._id;\n\n\t\t\t\troom._id = usernames.sort().join(',');\n\n\t\t\t\tRocketChat.models.Rooms.insert(room);\n\t\t\t\tRocketChat.models.Rooms.removeById(oldId);\n\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: oldId,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: room._id,\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.models.Messages.update({\n\t\t\t\t\trid: oldId,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: room._id,\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn RocketChat.models.Rooms.update(room._id, update);\n\t\t\t}\n\t\t});\n\n\t\tconsole.log('Fixing ChatMessage uid');\n\n\t\tRocketChat.models.Messages.find({\n\t\t\tuid: {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t}, {\n\t\t\tnonreactive: true,\n\t\t}).forEach((message) => {\n\t\t\tconst update = {};\n\t\t\tconst user = RocketChat.models.Users.findOneById(message.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tif (!update.$set) {\n\t\t\t\t\tupdate.$set = {};\n\t\t\t\t}\n\n\t\t\t\tif (!update.$unset) {\n\t\t\t\t\tupdate.$unset = {};\n\t\t\t\t}\n\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (Object.keys(update).length > 0) {\n\t\t\t\treturn RocketChat.models.Messages.update(message._id, update);\n\t\t\t}\n\t\t});\n\n\t\treturn console.log('End');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 4,\n\tup() {\n\t\tRocketChat.models.Messages.tryDropIndex('rid_1');\n\t\tRocketChat.models.Subscriptions.tryDropIndex('u._id_1');\n\n\t\tconsole.log('Rename rn to name');\n\n\t\tRocketChat.models.Subscriptions.update({\n\t\t\trn: {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t}, {\n\t\t\t$rename: {\n\t\t\t\trn: 'name',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\n\t\tconsole.log('Adding names to rooms without name');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\tname: '',\n\t\t}).forEach((item) => {\n\t\t\tconst name = Random.id().toLowerCase();\n\n\t\t\tRocketChat.models.Rooms.setNameById(item._id, name);\n\n\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\trid: item._id,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tmulti: true,\n\t\t\t});\n\t\t});\n\n\t\tconsole.log('Making room names unique');\n\n\t\tRocketChat.models.Rooms.find().forEach(function(room) {\n\n\t\t\treturn RocketChat.models.Rooms.find({\n\t\t\t\tname: room.name,\n\t\t\t\t_id: {\n\t\t\t\t\t$ne: room._id,\n\t\t\t\t},\n\t\t\t}).forEach((item) => {\n\t\t\t\tconst name = `${ room.name }-${ Random.id(2).toLowerCase() }`;\n\n\t\t\t\tRocketChat.models.Rooms.setNameById(item._id, name);\n\n\t\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: item._id,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tname,\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('End');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 5,\n\tup() {\n\t\tconsole.log('Dropping test rooms with less than 2 messages');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\tmsgs: {\n\t\t\t\t$lt: 2,\n\t\t\t},\n\t\t}).forEach((room) => {\n\t\t\tconsole.log('Dropped: ', room.name);\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\treturn RocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t});\n\n\t\tconsole.log('Dropping test rooms with less than 2 user');\n\t\tRocketChat.models.Rooms.find({\n\t\t\tusernames: {\n\t\t\t\t$size: 1,\n\t\t\t},\n\t\t}).forEach((room) => {\n\t\t\tconsole.log('Dropped: ', room.name);\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\treturn RocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t});\n\n\t\tconsole.log('Adding username to all users');\n\t\tRocketChat.models.Users.find({\n\t\t\tusername: {\n\t\t\t\t$exists: 0,\n\t\t\t},\n\t\t\temails: {\n\t\t\t\t$exists: 1,\n\t\t\t},\n\t\t}).forEach((user) => {\n\t\t\tlet newUserName = user.emails[0].address.split('@')[0];\n\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconsole.log(`Adding: username ${ newUserName } to all user ${ user._id }`);\n\t\t\treturn RocketChat.models.Users.setUsername(user._id, newUserName);\n\t\t});\n\n\t\tconsole.log('Fixing _id of direct messages rooms');\n\t\tRocketChat.models.Rooms.findByType('d').forEach(function(room) {\n\t\t\tlet newId = '';\n\t\t\tconst id0 = RocketChat.models.Users.findOneByUsername(room.usernames[0])._id;\n\t\t\tconst id1 = RocketChat.models.Users.findOneByUsername(room.usernames[1])._id;\n\t\t\tconst ids = [id0, id1];\n\n\t\t\tnewId = ids.sort().join('');\n\t\t\tif (newId !== room._id) {\n\t\t\t\tconsole.log(`Fixing: _id ${ room._id } to ${ newId }`);\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: room._id,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: newId,\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: 1,\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Messages.update({\n\t\t\t\t\trid: room._id,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: newId,\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: 1,\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\t\troom._id = newId;\n\t\t\t\tRocketChat.models.Rooms.insert(room);\n\t\t\t}\n\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id,\n\t\t\t\t'u._id': id0,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname: room.usernames[1],\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id,\n\t\t\t\t'u._id': id1,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname: room.usernames[0],\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\tconsole.log('Adding u.username to all documents');\n\t\tRocketChat.models.Users.find({}, {\n\t\t\tusername: 1,\n\t\t}).forEach((user) => {\n\t\t\tconsole.log(`Adding: u.username ${ user.username } to all document`);\n\t\t\tRocketChat.models.Rooms.update({\n\t\t\t\t'u._id': user._id,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tmulti: 1,\n\t\t\t});\n\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t'u._id': user._id,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tmulti: 1,\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\t'u._id': user._id,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tmulti: 1,\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tuid: user._id,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tu: user,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tmulti: 1,\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tby: user._id,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tu: user,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tmulti: 1,\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tuid: {\n\t\t\t\t\t$exists: 1,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\t$unset: {\n\t\t\t\t\tuid: 1,\n\t\t\t\t\tby: 1,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tmulti: 1,\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('End');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 6,\n\tup() {\n\t\tconsole.log('Changing _id of #general channel room from XXX to GENERAL');\n\n\t\tconst room = RocketChat.models.Rooms.findOneByName('general');\n\n\t\tif (room && room._id !== 'GENERAL') {\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: 'GENERAL',\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tmulti: 1,\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\trid: room._id,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: 'GENERAL',\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tmulti: 1,\n\t\t\t});\n\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\n\t\t\tdelete room._id;\n\n\t\t\tRocketChat.models.Rooms.upsert({\n\t\t\t\t_id: 'GENERAL',\n\t\t\t}, {\n\t\t\t\t$set: room,\n\t\t\t});\n\t\t}\n\n\t\treturn console.log('End');\n\t},\n});\n","/* globals OEmbed */\nimport _ from 'underscore';\n\nRocketChat.Migrations.add({\n\tversion: 7,\n\tup() {\n\t\tconsole.log('Populate urls in messages');\n\n\t\tconst query = RocketChat.models.Messages.find({\n\t\t\t'urls.0': {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t});\n\n\t\tconst count = query.count();\n\n\t\tquery.forEach((message, index) => {\n\t\t\tconsole.log(`${ index + 1 } / ${ count }`);\n\n\t\t\tmessage.urls = message.urls.map((url) => {\n\t\t\t\tif (_.isString(url)) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\turl,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn url;\n\t\t\t});\n\n\t\t\treturn OEmbed.rocketUrlParser(message);\n\t\t});\n\n\t\treturn console.log('End');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 8,\n\tup() {\n\t\tconsole.log('Load old settings record');\n\t\tconst settings = RocketChat.models.Settings.findOne({\n\t\t\t_id: 'settings',\n\t\t});\n\n\t\tif (settings) {\n\t\t\tif (settings.CDN_PREFIX) {\n\t\t\t\tRocketChat.models.Settings.insert({ _id: 'CDN_PREFIX', value: settings.CDN_PREFIX, type: 'string', group: 'General' });\n\t\t\t}\n\n\t\t\tif (settings.ENV && settings.ENV.MAIL_URL) {\n\t\t\t\tRocketChat.models.Settings.insert({ _id: 'MAIL_URL', value: settings.ENV.MAIL_URL, type: 'string', group: 'SMTP' });\n\t\t\t}\n\n\t\t\tif (settings.denyUnverifiedEmails) {\n\t\t\t\tRocketChat.models.Settings.insert({ _id: 'Accounts_denyUnverifiedEmails', value: settings.denyUnverifiedEmails, type: 'boolean', group: 'Accounts' });\n\t\t\t}\n\n\t\t\tif (settings.public && settings.public.avatarStore && settings.public.avatarStore.type) {\n\t\t\t\tRocketChat.models.Settings.insert({ _id: 'avatarStore_type', value: settings.public.avatarStore.type, type: 'string', group: 'API' });\n\t\t\t}\n\n\t\t\tif (settings.public && settings.public.avatarStore && settings.public.avatarStore.path) {\n\t\t\t\tRocketChat.models.Settings.insert({ _id: 'avatarStore_path', value: settings.public.avatarStore.path, type: 'string', group: 'API' });\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Settings.remove({\n\t\t\t\t_id: 'settings',\n\t\t\t});\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 9,\n\tup() {\n\t\t// Migrate existing source collection data to target collection\n\t\t// target collection is defined in collections.coffee using the new collection name\n\t\t// source collection is dropped after data migration\n\t\tconst toMigrate = [\n\t\t\t{\n\t\t\t\tsource: new Mongo.Collection('data.ChatRoom'),\n\t\t\t\ttarget: RocketChat.models.Rooms.model,\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('data.ChatSubscription'),\n\t\t\t\ttarget: RocketChat.models.Subscriptions.model,\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('data.ChatMessage'),\n\t\t\t\ttarget: RocketChat.models.Messages.model,\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('settings'),\n\t\t\t\ttarget: RocketChat.models.Settings.model,\n\t\t\t}, {\n\t\t\t\t// this collection may not exit\n\t\t\t\tsource: new Mongo.Collection('oembed_cache'),\n\t\t\t\ttarget: RocketChat.models.OEmbedCache.model,\n\t\t\t},\n\t\t];\n\n\t\treturn toMigrate.forEach((collection) => {\n\t\t\tconst { target, source } = collection;\n\n\t\t\t// rawCollection available as of Meteor 1.0.4\n\t\t\tconsole.log(`Migrating data from: ${ source.rawCollection().collectionName } to: ${ target.rawCollection().collectionName }`);\n\n\t\t\tsource.find().forEach((doc) =>\n\t\t\t\t// use upsert to account for GENERAL room created by initialData\n\t\t\t\ttarget.upsert({\n\t\t\t\t\t_id: doc._id,\n\t\t\t\t}, doc)\n\t\t\t);\n\n\t\t\tconst rawSource = source.rawCollection();\n\n\t\t\treturn Meteor.wrapAsync(rawSource.drop, rawSource)(function(err/* , res*/) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn console.log(`Error dropping ${ rawSource.collectionName } collection due to: ${ err.errmsg }`);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Note: the following would have been much easier, but didn't work.  The serverside\n\t\t\t// data was not published to the client for some reason.\n\t\t\t// newName = target.rawCollection().collectionName\n\t\t\t// Meteor.wrapAsync(rawSource.rename, rawSource )(newName, {dropTarget:true})\n\t\t});\n\t},\n});\n","import _ from 'underscore';\n\nRocketChat.Migrations.add({\n\tversion: 10,\n\tup() {\n\t\t/*\n\t\t * Remove duplicated usernames from rooms\n\t\t */\n\t\tlet count = 0;\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\t'usernames.0': {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tusernames: 1,\n\t\t\t},\n\t\t}).forEach((room) => {\n\t\t\tconst newUsernames = _.uniq(room.usernames);\n\t\t\tif (newUsernames.length !== room.usernames.length) {\n\t\t\t\tcount++;\n\t\t\t\treturn RocketChat.models.Rooms.update({\n\t\t\t\t\t_id: room._id,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tusernames: newUsernames,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn console.log(`Removed duplicated usernames from ${ count } rooms`);\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 11,\n\tup() {\n\t\t/*\n\t\t * Set GENERAL room to be default\n\t\t */\n\t\tRocketChat.models.Rooms.update({\n\t\t\t_id: 'GENERAL',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tdefault: true,\n\t\t\t},\n\t\t});\n\n\t\treturn console.log('Set GENERAL room to be default');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 12,\n\tup() {\n\t\t// Set oldest user as admin, if none exists yet\n\t\tconst admin = RocketChat.models.Users.findOneAdmin(true, {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t},\n\t\t});\n\n\t\tif (!admin) {\n\t\t\t// get oldest user\n\t\t\tconst oldestUser = RocketChat.models.Users.findOne({}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1,\n\t\t\t\t},\n\t\t\t\tsort: {\n\t\t\t\t\tcreatedAt: 1,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (oldestUser) {\n\t\t\t\tMeteor.users.update({\n\t\t\t\t\t_id: oldestUser._id,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tadmin: true,\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\treturn console.log(`Set ${ oldestUser.username } as admin for being the oldest user`);\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 13,\n\tup() {\n\t\t// Set all current users as active\n\t\tRocketChat.models.Users.setAllUsersActive(true);\n\t\treturn console.log('Set all users as active');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 14,\n\tup() {\n\t\t// Remove unused settings\n\t\tRocketChat.models.Settings.remove({ _id: 'API_Piwik_URL' });\n\t\tRocketChat.models.Settings.remove({ _id: 'API_Piwik_ID' });\n\t\tRocketChat.models.Settings.remove({ _id: 'Message_Edit' });\n\t\tRocketChat.models.Settings.remove({ _id: 'Message_Delete' });\n\t\tRocketChat.models.Settings.remove({ _id: 'Message_KeepStatusHistory' });\n\n\t\tRocketChat.models.Settings.update({ _id: 'Message_ShowEditedStatus' }, {\n\t\t\t$set: {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tvalue: true,\n\t\t\t},\n\t\t});\n\n\t\tRocketChat.models.Settings.update({ _id: 'Message_ShowDeletedStatus' }, {\n\t\t\t$set: {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tvalue: false,\n\t\t\t},\n\t\t});\n\n\t\tconst metaKeys = [\n\t\t\t{\n\t\t\t\told: 'Meta:language',\n\t\t\t\tnew: 'Meta_language',\n\t\t\t}, {\n\t\t\t\told: 'Meta:fb:app_id',\n\t\t\t\tnew: 'Meta_fb_app_id',\n\t\t\t}, {\n\t\t\t\told: 'Meta:robots',\n\t\t\t\tnew: 'Meta_robots',\n\t\t\t}, {\n\t\t\t\told: 'Meta:google-site-verification',\n\t\t\t\tnew: 'Meta_google-site-verification',\n\t\t\t}, {\n\t\t\t\told: 'Meta:msvalidate.01',\n\t\t\t\tnew: 'Meta_msvalidate01',\n\t\t\t},\n\t\t];\n\n\t\tfor (const oldAndNew of metaKeys) {\n\t\t\tconst oldSetting = RocketChat.models.Settings.findOne({ _id: oldAndNew.old });\n\t\t\tconst oldValue = oldSetting && oldSetting.value;\n\n\t\t\tconst newSetting = RocketChat.models.Settings.findOne({ _id: oldAndNew.new });\n\t\t\tconst newValue = newSetting && newSetting.value;\n\n\t\t\tif (oldValue && newValue) {\n\t\t\t\tRocketChat.models.Settings.update({\n\t\t\t\t\t_id: oldAndNew.new,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: newValue,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: oldAndNew.old,\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({\n\t\t\t_id: 'SMTP_Security',\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 15,\n\tup() {\n\t\tconsole.log('Starting file migration');\n\t\tconst oldFilesCollection = new Mongo.Collection('cfs.Files.filerecord');\n\t\tconst oldGridFSCollection = new Mongo.Collection('cfs_gridfs.files.files');\n\t\tconst oldChunkCollection = new Mongo.Collection('cfs_gridfs.files.chunks');\n\t\tconst newFilesCollection = RocketChat.models.Uploads;\n\t\tconst newGridFSCollection = new Mongo.Collection('rocketchat_uploads.files');\n\t\tconst newChunkCollection = new Mongo.Collection('rocketchat_uploads.chunks');\n\n\t\toldFilesCollection.find({\n\t\t\t'copies.files.key': {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t}).forEach((cfsRecord) => {\n\t\t\tconst nameParts = cfsRecord.original.name && cfsRecord.original.name.split('.');\n\t\t\tlet extension = '';\n\t\t\tlet url = `ufs/rocketchat_uploads/${ cfsRecord._id }`;\n\n\t\t\tconsole.log('migrating file', url);\n\n\t\t\tif (nameParts && nameParts.length > 1) {\n\t\t\t\textension = nameParts.pop();\n\t\t\t\turl = `${ url }.${ extension }`;\n\t\t\t}\n\n\t\t\tconst record = {\n\t\t\t\t_id: cfsRecord._id,\n\t\t\t\tname: cfsRecord.original.name || '',\n\t\t\t\tsize: cfsRecord.original.size,\n\t\t\t\ttype: cfsRecord.original.type,\n\t\t\t\tcomplete: true,\n\t\t\t\tuploading: false,\n\t\t\t\tstore: 'rocketchat_uploads',\n\t\t\t\textension,\n\t\t\t\tuserId: cfsRecord.userId,\n\t\t\t\tuploadedAt: cfsRecord.updatedAt,\n\t\t\t\turl: Meteor.absoluteUrl() + url,\n\t\t\t};\n\n\t\t\tnewFilesCollection.insert(record);\n\n\t\t\tconst oldGridFsFile = oldGridFSCollection.findOne({\n\t\t\t\t_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key),\n\t\t\t});\n\n\t\t\tnewGridFSCollection.insert({\n\t\t\t\t_id: cfsRecord._id,\n\t\t\t\tfilename: cfsRecord._id,\n\t\t\t\tcontentType: oldGridFsFile.contentType,\n\t\t\t\tlength: oldGridFsFile.length,\n\t\t\t\tchunkSize: oldGridFsFile.chunkSize,\n\t\t\t\tuploadDate: oldGridFsFile.uploadDate,\n\t\t\t\taliases: null,\n\t\t\t\tmetadata: null,\n\t\t\t\tmd5: oldGridFsFile.md5,\n\t\t\t});\n\n\t\t\toldChunkCollection.find({\n\t\t\t\tfiles_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key),\n\t\t\t}).forEach((oldChunk) => {\n\t\t\t\tnewChunkCollection.insert({\n\t\t\t\t\t_id: oldChunk._id,\n\t\t\t\t\tfiles_id: cfsRecord._id,\n\t\t\t\t\tn: oldChunk.n,\n\t\t\t\t\tdata: oldChunk.data,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.find({\n\t\t\t\t$or: [{\n\t\t\t\t\t'urls.url': `https://open.rocket.chat/cfs/files/Files/${ cfsRecord._id }`,\n\t\t\t\t}, {\n\t\t\t\t\t'urls.url': `https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`,\n\t\t\t\t}],\n\t\t\t}).forEach((message) => {\n\t\t\t\tfor (const urlsItem of message.urls) {\n\t\t\t\t\tif (urlsItem.url === (`https://open.rocket.chat/cfs/files/Files/${ cfsRecord._id }`) || urlsItem.url === (`https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`)) {\n\t\t\t\t\t\turlsItem.url = Meteor.absoluteUrl() + url;\n\t\t\t\t\t\tif (urlsItem.parsedUrl && urlsItem.parsedUrl.pathname) {\n\t\t\t\t\t\t\turlsItem.parsedUrl.pathname = `/${ url }`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tmessage.msg = message.msg.replace(`https://open.rocket.chat/cfs/files/Files/${ cfsRecord._id }`, Meteor.absoluteUrl() + url);\n\t\t\t\t\t\tmessage.msg = message.msg.replace(`https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`, Meteor.absoluteUrl() + url);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tRocketChat.models.Messages.update({ _id: message._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\turls: message.urls,\n\t\t\t\t\t\tmsg: message.msg,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\n\t\t\toldFilesCollection.remove({ _id: cfsRecord._id });\n\t\t\toldGridFSCollection.remove({ _id: oldGridFsFile._id });\n\t\t\toldChunkCollection.remove({ files_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key) });\n\t\t});\n\n\t\treturn console.log('End of file migration');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 16,\n\tup() {\n\t\treturn RocketChat.models.Messages.tryDropIndex({\n\t\t\t_hidden: 1,\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 17,\n\tup() {\n\t\treturn RocketChat.models.Messages.tryDropIndex({\n\t\t\t_hidden: 1,\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 18,\n\tup() {\n\t\tconst changes = {\n\t\t\tAccounts_Facebook: 'Accounts_OAuth_Facebook',\n\t\t\tAccounts_Facebook_id: 'Accounts_OAuth_Facebook_id',\n\t\t\tAccounts_Facebook_secret: 'Accounts_OAuth_Facebook_secret',\n\t\t\tAccounts_Google: 'Accounts_OAuth_Google',\n\t\t\tAccounts_Google_id: 'Accounts_OAuth_Google_id',\n\t\t\tAccounts_Google_secret: 'Accounts_OAuth_Google_secret',\n\t\t\tAccounts_Github: 'Accounts_OAuth_Github',\n\t\t\tAccounts_Github_id: 'Accounts_OAuth_Github_id',\n\t\t\tAccounts_Github_secret: 'Accounts_OAuth_Github_secret',\n\t\t\tAccounts_Gitlab: 'Accounts_OAuth_Gitlab',\n\t\t\tAccounts_Gitlab_id: 'Accounts_OAuth_Gitlab_id',\n\t\t\tAccounts_Gitlab_secret: 'Accounts_OAuth_Gitlab_secret',\n\t\t\tAccounts_Linkedin: 'Accounts_OAuth_Linkedin',\n\t\t\tAccounts_Linkedin_id: 'Accounts_OAuth_Linkedin_id',\n\t\t\tAccounts_Linkedin_secret: 'Accounts_OAuth_Linkedin_secret',\n\t\t\tAccounts_Meteor: 'Accounts_OAuth_Meteor',\n\t\t\tAccounts_Meteor_id: 'Accounts_OAuth_Meteor_id',\n\t\t\tAccounts_Meteor_secret: 'Accounts_OAuth_Meteor_secret',\n\t\t\tAccounts_Twitter: 'Accounts_OAuth_Twitter',\n\t\t\tAccounts_Twitter_id: 'Accounts_OAuth_Twitter_id',\n\t\t\tAccounts_Twitter_secret: 'Accounts_OAuth_Twitter_secret',\n\t\t};\n\n\t\tfor (const from of Object.keys(changes)) {\n\t\t\tconst to = changes[from];\n\t\t\tconst record = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: from,\n\t\t\t});\n\n\t\t\tif (record) {\n\t\t\t\tdelete record._id;\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: to,\n\t\t\t\t}, record);\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: from,\n\t\t\t});\n\t\t}\n\n\t\treturn ServiceConfiguration.configurations.remove({});\n\t},\n});\n","import _ from 'underscore';\n\nRocketChat.Migrations.add({\n\tversion: 19,\n\tup() {\n\t\t/*\n\t\t * Migrate existing admin users to Role based admin functionality\n\t\t * 'admin' role applies to global scope\n\t\t */\n\n\t\tconst admins = Meteor.users.find({\n\t\t\tadmin: true,\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\tusername: 1,\n\t\t\t},\n\t\t}).fetch();\n\n\t\tadmins.forEach((admin) => {\n\t\t\tRocketChat.authz.addUserRoles(admin._id, ['admin']);\n\t\t});\n\n\t\tMeteor.users.update({}, {\n\t\t\t$unset: {\n\t\t\t\tadmin: '',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\n\t\tlet usernames = _.pluck(admins, 'username').join(', ');\n\n\t\tconsole.log((`Migrate ${ usernames } from admin field to 'admin' role`).green);\n\n\t\t// Add 'user' role to all users\n\t\tconst users = Meteor.users.find().fetch();\n\t\tusers.forEach((user) => {\n\t\t\tRocketChat.authz.addUserRoles(user._id, ['user']);\n\t\t});\n\n\t\tusernames = _.pluck(users, 'username').join(', ');\n\t\tconsole.log((`Add ${ usernames } to 'user' role`).green);\n\n\t\t// Add 'moderator' role to channel/group creators\n\t\tconst rooms = RocketChat.models.Rooms.findByTypes(['c', 'p']).fetch();\n\t\treturn rooms.forEach((room) => {\n\t\t\tconst creator = room && room.u && room.u._id;\n\n\t\t\tif (creator) {\n\t\t\t\tif (Meteor.users.findOne({\n\t\t\t\t\t_id: creator,\n\t\t\t\t})) {\n\t\t\t\t\treturn RocketChat.authz.addUserRoles(creator, ['moderator'], room._id);\n\t\t\t\t} else {\n\t\t\t\t\tRocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\t\t\treturn RocketChat.models.Rooms.removeById(room._id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 20,\n\tup() {\n\t\t/*\n\t\t * Migrate existing `rocketchat_uploads` documents to include the room Id\n\t\t * where the file was uploaded to. The room Id is retrieved from the message\n\t\t * document created after the file upload.\n\t\t */\n\n\t\t// list of channel messages which were created after uploading a file\n\t\tconst msgQuery = {\n\t\t\trid: {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t\t'file._id': {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t};\n\n\t\tconst msgOptions = {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\trid: 1,\n\t\t\t\t'file._id': 1,\n\t\t\t},\n\t\t};\n\n\t\tconst cursorFileMessages = RocketChat.models.Messages.find(msgQuery, msgOptions);\n\t\tif (!cursorFileMessages.count()) {\n\t\t\treturn;\n\t\t}\n\n\t\tcursorFileMessages.fetch().forEach((msg) => RocketChat.models.Uploads.update({\n\t\t\t_id: msg.file && msg.file._id,\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\trid: msg.rid,\n\t\t\t},\n\t\t}, {\n\t\t\t$multi: true,\n\t\t}));\n\n\t\treturn console.log('Updated rocketchat_uploads documents to include the room Id in which they were sent.');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 21,\n\tup() {\n\t\t/*\n\t\t * Remove any i18nLabel from rocketchat_settings\n\t\t * They will be added again where necessary on next restart\n\t\t */\n\t\tRocketChat.models.Settings.update({\n\t\t\ti18nLabel: {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\ti18nLabel: 1,\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\n\t\treturn console.log('Removed i18nLabel from Settings. New labels will be added on next restart! Please restart your server.');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 22,\n\tup() {\n\t\t/*\n\t\t * Update message edit field\n\t\t */\n\t\tRocketChat.models.Messages.upgradeEtsToEditAt();\n\n\t\treturn console.log('Updated old messages\\' ets edited timestamp to new editedAt timestamp.');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 23,\n\tup() {\n\t\tRocketChat.models.Settings.remove({\n\t\t\t_id: 'Accounts_denyUnverifiedEmails',\n\t\t});\n\n\t\treturn console.log('Deleting not used setting Accounts_denyUnverifiedEmails');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 24,\n\tup() {\n\t\treturn RocketChat.models.Permissions.remove({\n\t\t\t_id: 'access-rocket-permissions',\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 25,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: /Accounts_OAuth_Custom/,\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tpersistent: true,\n\t\t\t},\n\t\t\t$unset: {\n\t\t\t\thidden: true,\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 26,\n\tup() {\n\t\treturn RocketChat.models.Messages.update({\n\t\t\tt: 'rm',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tmentions: [],\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 27,\n\tup() {\n\n\t\tRocketChat.models.Users.update({}, {\n\t\t\t$rename: {\n\t\t\t\troles: '_roles',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\n\t\tRocketChat.models.Users.find({\n\t\t\t_roles: {\n\t\t\t\t$exists: 1,\n\t\t\t},\n\t\t}).forEach((user) => {\n\t\t\tfor (const scope of Object.keys(user._roles)) {\n\t\t\t\tconst roles = user._roles[scope];\n\t\t\t\tRocketChat.models.Roles.addUserRoles(user._id, roles, scope);\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.models.Users.update({}, {\n\t\t\t$unset: {\n\t\t\t\t_roles: 1,\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 28,\n\tup() {\n\t\treturn RocketChat.models.Permissions.addRole('view-c-room', 'bot');\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 29,\n\tup() {\n\t\tlet LDAP_Url = (RocketChat.models.Settings.findOne('LDAP_Url') || {}).value;\n\t\tconst LDAP_TLS = (RocketChat.models.Settings.findOne('LDAP_TLS') || {}).value;\n\t\tconst LDAP_DN = (RocketChat.models.Settings.findOne('LDAP_DN') || {}).value;\n\t\tconst LDAP_Bind_Search = (RocketChat.models.Settings.findOne('LDAP_Bind_Search') || {}).value;\n\n\t\tif (LDAP_Url && LDAP_Url.trim() !== '') {\n\t\t\tLDAP_Url = LDAP_Url.replace(/ldaps?:\\/\\//i, '');\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'LDAP_Host' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_Url,\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_TLS === true) {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'LDAP_Encryption' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: 'tls',\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_DN && LDAP_DN.trim() !== '') {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'LDAP_Domain_Base' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_DN,\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'LDAP_Username_Field' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: '',\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'LDAP_Unique_Identifier_Field' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: '',\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_Bind_Search && LDAP_Bind_Search.trim() !== '') {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'LDAP_Custom_Domain_Search' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_Bind_Search,\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'LDAP_Use_Custom_Domain_Search' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: true,\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Url' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_TLS' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_DN' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Bind_Search' });\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 30,\n\tup() {\n\t\tconst WebRTC_STUN_Server = (RocketChat.models.Settings.findOne('WebRTC_STUN_Server') || {}).value;\n\t\tconst WebRTC_TURN_Server = (RocketChat.models.Settings.findOne('WebRTC_TURN_Server') || {}).value;\n\t\tconst WebRTC_TURN_Username = (RocketChat.models.Settings.findOne('WebRTC_TURN_Username') || {}).value;\n\t\tconst WebRTC_TURN_Password = (RocketChat.models.Settings.findOne('WebRTC_TURN_Password') || {}).value;\n\n\t\tRocketChat.models.Settings.remove({ _id: 'WebRTC_STUN_Server' });\n\t\tRocketChat.models.Settings.remove({ _id: 'WebRTC_TURN_Server' });\n\t\tRocketChat.models.Settings.remove({ _id: 'WebRTC_TURN_Username' });\n\t\tRocketChat.models.Settings.remove({ _id: 'WebRTC_TURN_Password' });\n\n\t\tif (WebRTC_STUN_Server === 'stun:stun.l.google.com:19302' && WebRTC_TURN_Server === 'turn:numb.viagenie.ca:3478' && WebRTC_TURN_Username === 'team@rocket.chat' && WebRTC_TURN_Password === 'demo') {\n\t\t\treturn;\n\t\t}\n\n\t\tlet servers = '';\n\t\tif (WebRTC_STUN_Server) {\n\t\t\tservers += WebRTC_STUN_Server;\n\t\t}\n\n\t\tif (WebRTC_TURN_Server) {\n\t\t\tservers += ', ';\n\t\t\tif (WebRTC_TURN_Username != null) {\n\t\t\t\tservers += `${ encodeURIComponent(WebRTC_TURN_Username) }:${ encodeURIComponent(WebRTC_TURN_Password) }@`;\n\t\t\t}\n\t\t\tservers += WebRTC_TURN_Server;\n\t\t}\n\n\t\tif (servers !== '') {\n\t\t\treturn RocketChat.models.Settings.upsert({ _id: 'WebRTC_Servers' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: servers,\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 31,\n\tup() {\n\t\tconst changes = {\n\t\t\tAPI_Analytics: 'GoogleTagManager_id',\n\t\t};\n\n\t\tfor (const from of Object.keys(changes)) {\n\t\t\tconst to = changes[from];\n\t\t\tconst record = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: from,\n\t\t\t});\n\n\t\t\tif (record) {\n\t\t\t\tdelete record._id;\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: to,\n\t\t\t\t}, record);\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: from,\n\t\t\t});\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 32,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: /Accounts_OAuth_Custom_/,\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tgroup: 'OAuth',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 33,\n\tup() {\n\t\tconst scriptAlert = '/**\\n * This script is out-of-date, convert to the new format\\n * (https://rocket.chat/docs/administrator-guides/integrations)\\n**/\\n\\n';\n\n\t\tconst integrations = RocketChat.models.Integrations.find({\n\t\t\t$or: [\n\t\t\t\t{\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false,\n\t\t\t\t\t},\n\t\t\t\t\tprocessIncomingRequestScript: {\n\t\t\t\t\t\t$exists: true,\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false,\n\t\t\t\t\t},\n\t\t\t\t\tprepareOutgoingRequestScript: {\n\t\t\t\t\t\t$exists: true,\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false,\n\t\t\t\t\t},\n\t\t\t\t\tprocessOutgoingResponseScript: {\n\t\t\t\t\t\t$exists: true,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t}).fetch();\n\n\t\tintegrations.forEach(function(integration) {\n\t\t\tlet script = '';\n\t\t\tif (integration.processIncomingRequestScript) {\n\t\t\t\tscript += `${ integration.processIncomingRequestScript }\\n\\n`;\n\t\t\t}\n\t\t\tif (integration.prepareOutgoingRequestScript) {\n\t\t\t\tscript += `${ integration.prepareOutgoingRequestScript }\\n\\n`;\n\t\t\t}\n\t\t\tif (integration.processOutgoingResponseScript) {\n\t\t\t\tscript += `${ integration.processOutgoingResponseScript }\\n\\n`;\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Integrations.update(integration._id, {\n\t\t\t\t$set: {\n\t\t\t\t\tscript: scriptAlert + script.replace(/^/gm, '// '),\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\tlet update = {\n\t\t\t$unset: {\n\t\t\t\tprocessIncomingRequestScript: 1,\n\t\t\t\tprepareOutgoingRequestScript: 1,\n\t\t\t\tprocessOutgoingResponseScript: 1,\n\t\t\t},\n\t\t};\n\n\t\tRocketChat.models.Integrations.update({}, update, {\n\t\t\tmulti: true,\n\t\t});\n\n\t\tupdate = {\n\t\t\t$set: {\n\t\t\t\tenabled: true,\n\t\t\t},\n\t\t};\n\n\t\tRocketChat.models.Integrations.update({\n\t\t\tenabled: {\n\t\t\t\t$exists: false,\n\t\t\t},\n\t\t}, update, {\n\t\t\tmulti: true,\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 34,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: 'Layout_Login_Header',\n\t\t\tvalue: '<a class=\"logo\" href=\"/\"><img src=\"/assets/logo/logo.svg?v=3\" /></a>',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tvalue: '<a class=\"logo\" href=\"/\"><img src=\"/assets/logo?v=3\" /></a>',\n\t\t\t},\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 35,\n\tup() {\n\t\treturn RocketChat.models.Messages.update({\n\t\t\t'file._id': {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t\t'attachments.title_link': {\n\t\t\t\t$exists: true,\n\t\t\t},\n\t\t\t'attachments.title_link_download': {\n\t\t\t\t$exists: false,\n\t\t\t},\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'attachments.$.title_link_download': true,\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\t},\n});\n","import url from 'url';\n\nRocketChat.Migrations.add({\n\tversion: 36,\n\tup() {\n\t\tconst loginHeader = RocketChat.models.Settings.findOne({\n\t\t\t_id: 'Layout_Login_Header',\n\t\t});\n\n\t\tif (!loginHeader || !loginHeader.value) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst match = loginHeader.value.match(/<img\\ssrc=['\"]([^'\"]+)/);\n\n\t\tif (match && match.length === 2) {\n\t\t\tlet requestUrl = match[1];\n\t\t\tif (requestUrl[0] === '/') {\n\t\t\t\trequestUrl = url.resolve(Meteor.absoluteUrl(), requestUrl);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tMeteor.startup(function() {\n\t\t\t\t\treturn Meteor.setTimeout(function() {\n\t\t\t\t\t\tconst result = HTTP.get(requestUrl, {\n\t\t\t\t\t\t\tnpmRequestOptions: {\n\t\t\t\t\t\t\t\tencoding: 'binary',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (result.statusCode === 200) {\n\t\t\t\t\t\t\treturn RocketChat.Assets.setAsset(result.content, result.headers['content-type'], 'logo');\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 30000);\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t}\n\n\t\treturn RocketChat.models.Settings.remove({\n\t\t\t_id: 'Layout_Login_Header',\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 37,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Find permission add-user (changed it to create-user)\n\t\t\tconst addUserPermission = RocketChat.models.Permissions.findOne('add-user');\n\n\t\t\tif (addUserPermission) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'create-user' }, { $set: { roles: addUserPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user' });\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 38,\n\tup() {\n\t\tif (RocketChat && RocketChat.settings && RocketChat.settings.get) {\n\t\t\tconst allowPinning = RocketChat.settings.get('Message_AllowPinningByAnyone');\n\n\t\t\t// If public pinning was allowed, add pinning permissions to 'users', else leave it to 'owners' and 'moderators'\n\t\t\tif (allowPinning) {\n\t\t\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\t\t\t\t\tRocketChat.models.Permissions.update({ _id: 'pin-message' }, { $addToSet: { roles: 'user' } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 39,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst footer = RocketChat.models.Settings.findOne({ _id: 'Layout_Sidenav_Footer' });\n\n\t\t\t// Replace footer octicons with icons\n\t\t\tif (footer && footer.value !== '') {\n\t\t\t\tlet footerValue = footer.value.replace('octicon octicon-pencil', 'icon-pencil');\n\t\t\t\tfooterValue = footerValue.replace('octicon octicon-heart', 'icon-heart');\n\t\t\t\tfooterValue = footerValue.replace('octicon octicon-mark-github', 'icon-github-circled');\n\t\t\t\tRocketChat.models.Settings.update({ _id: 'Layout_Sidenav_Footer' }, { $set: { value: footerValue, packageValue: footerValue } });\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 40,\n\tup() {\n\t\tRocketChat.models.Settings.find({ _id: /Accounts_OAuth_Custom_/, i18nLabel: 'Accounts_OAuth_Custom_Enable' }).forEach(function(customOauth) {\n\t\t\tconst parts = customOauth._id.split('_');\n\t\t\tconst name = parts[3];\n\t\t\tconst id = `Accounts_OAuth_Custom_${ name }_token_sent_via`;\n\t\t\tif (!RocketChat.models.Settings.findOne({ _id: id })) {\n\t\t\t\tRocketChat.models.Settings.insert({\n\t\t\t\t\t_id: id,\n\t\t\t\t\ttype: 'select',\n\t\t\t\t\tgroup: 'OAuth',\n\t\t\t\t\tsection: `Custom OAuth: ${ name }`,\n\t\t\t\t\ti18nLabel: 'Accounts_OAuth_Custom_Token_Sent_Via',\n\t\t\t\t\tpersistent: true,\n\t\t\t\t\tvalues: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: 'header',\n\t\t\t\t\t\t\ti18nLabel: 'Header',\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: 'payload',\n\t\t\t\t\t\t\ti18nLabel: 'Payload',\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tpackageValue: 'payload',\n\t\t\t\t\tvalueSource: 'packageValue',\n\t\t\t\t\tts: new Date(),\n\t\t\t\t\thidden: false,\n\t\t\t\t\tblocked: false,\n\t\t\t\t\tsorter: 255,\n\t\t\t\t\ti18nDescription: `Accounts_OAuth_Custom_${ name }_token_sent_via_Description`,\n\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\tvalue: 'payload',\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 41,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ bot: true }, { $set: { type: 'bot' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'profile.guest': true }, { $set: { type: 'visitor' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ type: { $exists: false } }, { $set: { type: 'user' } }, { multi: true });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 42,\n\tup() {\n\t\tconst files = RocketChat.__migration_assets_files = new Mongo.Collection('assets.files');\n\t\tconst chunks = RocketChat.__migration_assets_chunks = new Mongo.Collection('assets.chunks');\n\t\tconst list = {\n\t\t\t'favicon.ico': 'favicon_ico',\n\t\t\t'favicon.svg': 'favicon',\n\t\t\t'favicon_64.png': 'favicon_64',\n\t\t\t'favicon_96.png': 'favicon_96',\n\t\t\t'favicon_128.png': 'favicon_128',\n\t\t\t'favicon_192.png': 'favicon_192',\n\t\t\t'favicon_256.png': 'favicon_256',\n\t\t};\n\n\t\tfor (const from of Object.keys(list)) {\n\t\t\tconst to = list[from];\n\n\t\t\tconst query = {\n\t\t\t\t_id: to,\n\t\t\t};\n\n\t\t\tif (!files.findOne(query)) {\n\t\t\t\tconst oldFile = files.findOne({\n\t\t\t\t\t_id: from,\n\t\t\t\t});\n\n\t\t\t\tif (oldFile) {\n\t\t\t\t\tconst extension = RocketChat.Assets.mime.extension(oldFile.contentType);\n\t\t\t\t\tRocketChat.settings.removeById(`Assets_${ from }`);\n\t\t\t\t\tRocketChat.settings.updateById(`Assets_${ to }`, {\n\t\t\t\t\t\turl: `/assets/${ to }.${ extension }`,\n\t\t\t\t\t\tdefaultUrl: RocketChat.Assets.assets[to].defaultUrl,\n\t\t\t\t\t});\n\n\t\t\t\t\toldFile._id = to;\n\t\t\t\t\toldFile.filename = to;\n\t\t\t\t\tfiles.insert(oldFile);\n\t\t\t\t\tfiles.remove({\n\t\t\t\t\t\t_id: from,\n\t\t\t\t\t});\n\n\t\t\t\t\tchunks.update({\n\t\t\t\t\t\tfiles_id: from,\n\t\t\t\t\t}, {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\tfiles_id: to,\n\t\t\t\t\t\t},\n\t\t\t\t\t}, {\n\t\t\t\t\t\tmulti: true,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 43,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Permissions) {\n\t\t\tRocketChat.models.Permissions.update({ _id: 'pin-message' }, { $addToSet: { roles: 'admin' } });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 44,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.find({ $or: [{ 'settings.preferences.disableNewRoomNotification': { $exists: 1 } }, { 'settings.preferences.disableNewMessageNotification': { $exists: 1 } }] }).forEach(function(user) {\n\t\t\t\tconst newRoomNotification = !(user && user.settings && user.settings.preferences && user.settings.preferences.disableNewRoomNotification);\n\t\t\t\tconst newMessageNotification = !(user && user.settings && user.settings.preferences && user.settings.preferences.disableNewMessageNotification);\n\t\t\t\tRocketChat.models.Users.update({ _id: user._id }, { $unset: { 'settings.preferences.disableNewRoomNotification': 1, 'settings.preferences.disableNewMessageNotification': 1 }, $set: { 'settings.preferences.newRoomNotification': newRoomNotification, 'settings.preferences.newMessageNotification': newMessageNotification } });\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst optOut = RocketChat.models.Settings.findOne({ _id: 'Statistics_opt_out' });\n\t\t\tif (optOut) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'Statistics_opt_out' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'Statistics_reporting' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !optOut.value,\n\t\t\t\t\t\ti18nDescription: 'Statistics_reporting_Description',\n\t\t\t\t\t\tpackageValue: true,\n\t\t\t\t\t\ti18nLabel: 'Statistics_reporting',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst favoriteRooms = RocketChat.models.Settings.findOne({ _id: 'Disable_Favorite_Rooms' });\n\t\t\tif (favoriteRooms) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'Disable_Favorite_Rooms' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'Favorite_Rooms' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !favoriteRooms.value,\n\t\t\t\t\t\ti18nDescription: 'Favorite_Rooms_Description',\n\t\t\t\t\t\tpackageValue: true,\n\t\t\t\t\t\ti18nLabel: 'Favorite_Rooms',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 45,\n\tup() {\n\n\t\t// finds the latest created visitor\n\t\tconst lastVisitor = RocketChat.models.Users.find({ type: 'visitor' }, { fields: { username: 1 }, sort: { createdAt: -1 }, limit: 1 }).fetch();\n\n\t\tif (lastVisitor && lastVisitor.length > 0) {\n\t\t\tconst lastNumber = lastVisitor[0].username.replace(/^guest\\-/, '');\n\n\t\t\tRocketChat.settings.add('Livechat_guest_count', (parseInt(lastNumber) + 1), { type: 'int', group: 'Livechat' });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 46,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ type: { $exists: false } }, { $set: { type: 'user' } }, { multi: true });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 47,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst autolinkerUrls = RocketChat.models.Settings.findOne({ _id: 'AutoLinker_Urls' });\n\t\t\tif (autolinkerUrls) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'AutoLinker_Urls' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_Scheme' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !!autolinkerUrls.value,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_Scheme',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_www' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !!autolinkerUrls.value,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_www',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_TLD' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !!autolinkerUrls.value,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_TLD',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 48,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\tconst RocketBot_Enabled = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: 'RocketBot_Enabled',\n\t\t\t});\n\t\t\tif (RocketBot_Enabled) {\n\t\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t\t_id: 'RocketBot_Enabled',\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: 'InternalHubot_Enabled',\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: RocketBot_Enabled.value,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst RocketBot_Name = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: 'RocketBot_Name',\n\t\t\t});\n\t\t\tif (RocketBot_Name) {\n\t\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t\t_id: 'RocketBot_Name',\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: 'InternalHubot_Username',\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: RocketBot_Name.value,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 49,\n\tup() {\n\n\t\tlet count = 1;\n\n\t\tRocketChat.models.Rooms.find({ t: 'l' }, { sort: { ts: 1 }, fields: { _id: 1 } }).forEach(function(room) {\n\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, { $set: { code: count } });\n\t\t\tRocketChat.models.Subscriptions.update({ rid: room._id }, { $set: { code: count } }, { multi: true });\n\t\t\tcount++;\n\t\t});\n\n\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_Room_Count' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: count,\n\t\t\t\ttype: 'int',\n\t\t\t\tgroup: 'Livechat',\n\t\t\t},\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 50,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex('u._id_1_name_1_t_1');\n\t\tRocketChat.models.Subscriptions.tryEnsureIndex({ 'u._id': 1, name: 1, t: 1 });\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 51,\n\tup() {\n\t\tRocketChat.models.Rooms.find({ t: 'l', 'v.token': { $exists: true }, label: { $exists: false } }).forEach(function(room) {\n\t\t\tconst user = RocketChat.models.Users.findOne({ 'profile.token': room.v.token });\n\t\t\tif (user) {\n\t\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tlabel: user.name || user.username,\n\t\t\t\t\t\t'v._id': user._id,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Subscriptions.update({ rid: room._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tname: user.name || user.username,\n\t\t\t\t\t},\n\t\t\t\t}, { multi: true });\n\t\t\t}\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 52,\n\tup() {\n\t\tRocketChat.models.Users.update({ _id: 'rocket.cat' }, { $addToSet: { roles: 'bot' } });\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 53,\n\tup() {\n\t\tRocketChat.models.Settings.update({ _id: 'Email_Header', value: '' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: '<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" bgcolor=\"#f3f3f3\" style=\"color:#4a4a4a;font-family: Helvetica,Arial,sans-serif;font-size:14px;line-height:20px;border-collapse:callapse;border-spacing:0;margin:0 auto\"><tr><td style=\"padding:1em\"><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" width=\"100%\" style=\"width:100%;margin:0 auto;max-width:800px\"><tr><td bgcolor=\"#ffffff\" style=\"background-color:#ffffff; border: 1px solid #DDD; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\"><table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"background-color: #04436a;\"><h1 style=\"font-family: Helvetica,Arial,sans-serif; padding: 0 1em; margin: 0; line-height: 70px; color: #FFF;\">[Site_Name]</h1></td></tr><tr><td style=\"padding: 1em; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\">',\n\t\t\t},\n\t\t});\n\n\t\tRocketChat.models.Settings.update({ _id: 'Email_Footer', value: '' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: '</td></tr></table></td></tr><tr><td border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" style=\"font-family: Helvetica,Arial,sans-serif; max-width: 800px; margin: 0 auto; padding: 1.5em; text-align: center; font-size: 8pt; color: #999;\">Powered by <a href=\"https://rocket.chat\" target=\"_blank\">Rocket.Chat</a></td></tr></table></td></tr></table>',\n\t\t\t},\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 54,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\t// Set default message viewMode to 'normal' or 'cozy' depending on the users' current settings and remove the field 'compactView'\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.compactView': true }, { $set: { 'settings.preferences.viewMode': 1 }, $unset: { 'settings.preferences.compactView': 1 } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.viewMode': { $ne: 1 } }, { $set: { 'settings.preferences.viewMode': 0 } }, { multi: true });\n\t\t}\n\t},\n});\n","import s from 'underscore.string';\n\nRocketChat.Migrations.add({\n\tversion: 55,\n\tup() {\n\t\tRocketChat.models.Rooms.find({ topic: { $exists: 1, $ne: '' } }, { topic: 1 }).forEach(function(room) {\n\t\t\tconst topic = s.escapeHTML(room.topic);\n\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, { $set: { topic } });\n\t\t\tRocketChat.models.Messages.update({ t: 'room_changed_topic', rid: room._id }, { $set: { msg: topic } });\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 56,\n\tup() {\n\t\tRocketChat.models.Messages.find({ _id: /\\./ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/(.*)\\.S?(.*)/, 'slack-$1-$2');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 57,\n\tup() {\n\t\tRocketChat.models.Messages.find({ _id: /slack-([a-zA-Z0-9]+)S([0-9]+-[0-9]+)/ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/slack-([a-zA-Z0-9]+)S([0-9]+-[0-9]+)/, 'slack-$1-$2');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\n\t\tRocketChat.models.Messages.find({ _id: /slack-slack/ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace('slack-slack', 'slack');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\n\t\tRocketChat.models.Messages.find({ _id: /\\./ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/(.*)\\.?S(.*)/, 'slack-$1-$2');\n\t\t\tmessage._id = message._id.replace(/\\./g, '-');\n\t\t\tRocketChat.models.Messages.remove({ _id: message._id });\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 58,\n\tup() {\n\t\tRocketChat.models.Settings.update({ _id: 'Push_gateway', value: 'https://rocket.chat' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: 'https://gateway.rocket.chat',\n\t\t\t\tpackageValue: 'https://gateway.rocket.chat',\n\t\t\t},\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 59,\n\tup() {\n\t\tconst users = RocketChat.models.Users.find({}, { sort: { createdAt: 1 }, limit: 1 }).fetch();\n\t\tif (users && users.length > 0) {\n\t\t\tconst { createdAt } = users[0];\n\t\t\tRocketChat.models.Settings.update({ createdAt: { $exists: 0 } }, { $set: { createdAt } }, { multi: true });\n\t\t\tRocketChat.models.Statistics.update({ installedAt: { $exists: 0 } }, { $set: { installedAt: createdAt } }, { multi: true });\n\t\t}\n\t},\n});\n","import _ from 'underscore';\n\nRocketChat.Migrations.add({\n\tversion: 60,\n\tup() {\n\t\tlet subscriptions = RocketChat.models.Subscriptions.find({ $or: [{ name: { $exists: 0 } }, { name: { $not: { $type: 2 } } }] }).fetch();\n\t\tif (subscriptions && subscriptions.length > 0) {\n\t\t\tRocketChat.models.Subscriptions.remove({ _id: { $in: _.pluck(subscriptions, '_id') } });\n\t\t}\n\n\t\tsubscriptions = RocketChat.models.Subscriptions.find().forEach(function(subscription) {\n\t\t\tconst user = RocketChat.models.Users.findOne({ _id: subscription && subscription.u && subscription.u._id });\n\t\t\tif (!user) {\n\t\t\t\tRocketChat.models.Subscriptions.remove({ _id: subscription._id });\n\t\t\t}\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 61,\n\tup() {\n\t\tRocketChat.models.Users.find({ active: false }).forEach(function(user) {\n\t\t\tRocketChat.models.Subscriptions.setArchivedByUsername(user.username, true);\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 62,\n\tup() {\n\t\tRocketChat.models.Settings.remove({ _id: 'Atlassian Crowd', type: 'group' });\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 63,\n\tup() {\n\t\tconst forward = RocketChat.models.Settings.findOne({ _id:'Livechat_forward_open_chats' });\n\t\tconst timeout = RocketChat.models.Settings.findOne({ _id:'Livechat_forward_open_chats_timeout' });\n\n\t\tif (forward && forward.value) {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_agent_leave_action' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: 'forward',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tgroup: 'Livechat',\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tif (timeout && timeout.value !== 60) {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_agent_leave_action_timeout' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: timeout.value,\n\t\t\t\t\ttype: 'int',\n\t\t\t\t\tgroup: 'Livechat',\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'Livechat_forward_open_chats' });\n\t\tRocketChat.models.Settings.remove({ _id: 'Livechat_forward_open_chats_timeout' });\n\t},\n});\n","import s from 'underscore.string';\n\nRocketChat.Migrations.add({\n\tversion: 64,\n\tup() {\n\t\tRocketChat.models.Messages.find({ t: 'room_changed_topic', msg: /</ }, { msg: 1 }).forEach(function(message) {\n\t\t\tconst msg = s.escapeHTML(message.msg);\n\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $set: { msg } });\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 65,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\t// New color settings - start with old settings as defaults\n\t\t\tconst replace1 = RocketChat.models.Settings.findOne({ _id: 'theme-color-quaternary-font-color' });\n\t\t\tconst replace2 = RocketChat.models.Settings.findOne({ _id: 'theme-color-input-font-color' });\n\t\t\tconst replace3 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-online' });\n\t\t\tconst replace4 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-away' });\n\t\t\tconst replace5 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-busy' });\n\t\t\tconst replace6 = RocketChat.models.Settings.findOne({ _id: 'theme-color-info-active-font-color' });\n\t\t\tif (replace1) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-secondary-action-color' }, { $set: { value: replace1.value } });\n\t\t\t}\n\t\t\tif (replace2) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-component-color' }, { $set: { value: replace2.value } });\n\t\t\t}\n\t\t\tif (replace3) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-success-color' }, { $set: { value: replace3.value } });\n\t\t\t}\n\t\t\tif (replace4) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-pending-color' }, { $set: { value: replace4.value } });\n\t\t\t}\n\t\t\tif (replace5) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-error-color' }, { $set: { value: replace5.value } });\n\t\t\t}\n\t\t\tif (replace6) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-selection-color' }, { $set: { value: replace6.value } });\n\t\t\t}\n\n\t\t\t// Renamed color settings\n\t\t\tconst oldColor = RocketChat.models.Settings.findOne({ _id: 'theme-color-action-buttons-color' });\n\t\t\tif (oldColor) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-action-buttons-color' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-primary-action-color' }, { $set: { value: oldColor.value } });\n\t\t\t}\n\n\t\t\t// Removed color settings\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-quaternary-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-active-channel-background-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-active-channel-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-blockquote-background' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-clean-buttons-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-background' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-border' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-info-active-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-input-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-message-hover-background-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-smallprint-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-smallprint-hover-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-unread-notification-color' });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 66,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\t// New color settings - start with old settings as defaults\n\t\t\tconst replace1 = RocketChat.models.Settings.findOne({ _id: 'theme-color-tertiary-background-color' });\n\t\t\tif (replace1) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-component-color' }, { $set: { value: replace1.value } });\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 67,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.LivechatDepartment) {\n\t\t\tRocketChat.models.LivechatDepartment.model.update({}, {\n\t\t\t\t$set: {\n\t\t\t\t\tshowOnRegistration: true,\n\t\t\t\t},\n\t\t\t}, { multi: true });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 68,\n\tup() {\n\t\tconst GoogleSiteVerification_id = RocketChat.models.Settings.findOne({ _id: 'GoogleSiteVerification_id' });\n\n\t\tif (GoogleSiteVerification_id && GoogleSiteVerification_id.value) {\n\t\t\tRocketChat.models.Settings.update({ _id: 'Meta_google-site-verification' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: GoogleSiteVerification_id.value,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'GoogleSiteVerification_id' });\n\t},\n});\n\n","RocketChat.Migrations.add({\n\tversion: 69,\n\tup() {\n\t\tRocketChat.models.Settings.update({\n\t\t\t_id: 'theme-color-custom-scrollbar-color',\n\t\t\tvalue: 'rgba(255, 255, 255, 0.05)',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\teditor: 'expression',\n\t\t\t\tvalue: '@transparent-darker',\n\t\t\t},\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t_id: 'theme-color-info-font-color',\n\t\t\tvalue: '#aaaaaa',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\teditor: 'expression',\n\t\t\t\tvalue: '@secondary-font-color',\n\t\t\t},\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t_id: 'theme-color-link-font-color',\n\t\t\tvalue: '#008ce3',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\teditor: 'expression',\n\t\t\t\tvalue: '@primary-action-color',\n\t\t\t},\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t_id: 'theme-color-status-away',\n\t\t\tvalue: '#fcb316',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\teditor: 'expression',\n\t\t\t\tvalue: '@pending-color',\n\t\t\t},\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t_id: 'theme-color-status-busy',\n\t\t\tvalue: '#d30230',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\teditor: 'expression',\n\t\t\t\tvalue: '@error-color',\n\t\t\t},\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t_id: 'theme-color-status-offline',\n\t\t\tvalue: 'rgba(150, 150, 150, 0.50)',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\teditor: 'expression',\n\t\t\t\tvalue: '@transparent-darker',\n\t\t\t},\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t_id: 'theme-color-status-online',\n\t\t\tvalue: '#35ac19',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\teditor: 'expression',\n\t\t\t\tvalue: '@success-color',\n\t\t\t},\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t_id: 'theme-color-tertiary-background-color',\n\t\t\tvalue: '#eaeaea',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\teditor: 'expression',\n\t\t\t\tvalue: '@component-color',\n\t\t\t},\n\t\t});\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: 'theme-color-tertiary-font-color',\n\t\t\tvalue: 'rgba(255, 255, 255, 0.6)',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\teditor: 'expression',\n\t\t\t\tvalue: '@transparent-lightest',\n\t\t\t},\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 70,\n\tup() {\n\t\tconst settings = RocketChat.models.Settings.find({ _id: /^Accounts_OAuth_Custom_.+/ }).fetch();\n\t\tfor (const setting of settings) {\n\t\t\tconst { _id } = setting;\n\t\t\tsetting._id = setting._id.replace(/Accounts_OAuth_Custom_([A-Za-z0-9]+)_(.+)/, 'Accounts_OAuth_Custom-$1-$2');\n\t\t\tsetting._id = setting._id.replace(/Accounts_OAuth_Custom_([A-Za-z0-9]+)/, 'Accounts_OAuth_Custom-$1');\n\n\t\t\tRocketChat.models.Settings.remove({ _id });\n\t\t\tRocketChat.models.Settings.insert(setting);\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 71,\n\tup() {\n\t\t// Removes the reactions on messages which are the system type \"rm\" ;)\n\t\tRocketChat.models.Messages.find({ t: 'rm', reactions: { $exists: true, $not: { $size: 0 } } }, { t: 1 }).forEach(function(message) {\n\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $set: { reactions: [] } });\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 72,\n\tup() {\n\t\tRocketChat.models.Users.find({ type: 'visitor', 'emails.address': { $exists: true } }, { emails: 1 }).forEach(function(visitor) {\n\t\t\tRocketChat.models.Users.update({ _id: visitor._id }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvisitorEmails: visitor.emails,\n\t\t\t\t},\n\t\t\t\t$unset: {\n\t\t\t\t\temails: 1,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 73,\n\tup() {\n\t\tRocketChat.models.Users.find({ 'oauth.athorizedClients': { $exists: true } }, { oauth: 1 }).forEach(function(user) {\n\t\t\tRocketChat.models.Users.update({ _id: user._id }, {\n\t\t\t\t$set: {\n\t\t\t\t\t'oauth.authorizedClients': user.oauth.athorizedClients,\n\t\t\t\t},\n\t\t\t\t$unset: {\n\t\t\t\t\t'oauth.athorizedClients': 1,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 74,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.remove({ _id: 'Assets_favicon_64' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'Assets_favicon_96' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'Assets_favicon_128' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'Assets_favicon_256' });\n\t\t\tRocketChat.models.Settings.update({ _id: 'Assets_favicon_192' }, {\n\t\t\t\t$set: {\n\t\t\t\t\ti18nLabel: 'android-chrome 192x192 (png)',\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 71.1,\n\tup() {\n\t\tServiceConfiguration.configurations.remove({});\n\t},\n});\n\nRocketChat.Migrations.add({\n\tversion: 75,\n\tup() {\n\t\tServiceConfiguration.configurations.remove({});\n\t},\n});\n\n","RocketChat.Migrations.add({\n\tversion: 76,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.find({ section: 'Colors (alphas)' }).forEach((setting) => {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: setting._id });\n\t\t\t});\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 77,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Rooms) {\n\t\t\tRocketChat.models.Rooms.find({\n\t\t\t\tt: 'l',\n\t\t\t\t'v._id': { $exists: true },\n\t\t\t\t'v.username': { $exists: false },\n\t\t\t}, { fields: { 'v._id': 1 } }).forEach(function(room) {\n\t\t\t\tconst user = RocketChat.models.Users.findOne({ _id: room.v._id }, { username: 1 });\n\n\t\t\t\tif (user && user.username) {\n\t\t\t\t\tRocketChat.models.Rooms.update({\n\t\t\t\t\t\t_id: room._id,\n\t\t\t\t\t}, {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\t'v.username': user.username,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n});\n\n","RocketChat.Migrations.add({\n\tversion: 78,\n\tup() {\n\t\tRocketChat.models.Permissions.update({ _id: { $in: ['create-c', 'create-d', 'create-p'] } }, { $addToSet: { roles: 'bot' } }, { multi: true });\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 79,\n\tup() {\n\t\tconst integrations = RocketChat.models.Integrations.find({ type: 'webhook-incoming' }).fetch();\n\n\t\tfor (const integration of integrations) {\n\t\t\tif (typeof integration.channel === 'string') {\n\t\t\t\tRocketChat.models.Integrations.update({ _id: integration._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tchannel: integration.channel.split(',').map((channel) => channel.trim()),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 80,\n\tup() {\n\t\tconst query = {\n\t\t\ttype: 'webhook-outgoing',\n\t\t\t$or: [{\n\t\t\t\tchannel: [],\n\t\t\t}, {\n\t\t\t\tchannel: '',\n\t\t\t}, {\n\t\t\t\tchannel: {\n\t\t\t\t\t$exists: false,\n\t\t\t\t},\n\t\t\t}],\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tchannel: ['all_public_channels'],\n\t\t\t},\n\t\t};\n\n\t\tRocketChat.models.Integrations.update(query, update, { multi: true });\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 81,\n\tup() {\n\t\tRocketChat.models.OAuthApps.update({ _id: 'zapier' }, {\n\t\t\t$set: {\n\t\t\t\tactive: true,\n\t\t\t\tredirectUri: 'https://zapier.com/dashboard/auth/oauth/return/App32270API/',\n\t\t\t},\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 82,\n\tup() {\n\t\tconst admins = RocketChat.authz.getUsersInRole('admin').fetch();\n\t\tif (admins.length === 1 && admins[0]._id === 'rocket.cat') {\n\t\t\tRocketChat.authz.removeUserFromRoles('rocket.cat', 'admin');\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 83,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings && RocketChat.models.Users) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'InternalHubot_Username' });\n\t\t\tif (setting && setting.value) {\n\t\t\t\tconst username = setting.value;\n\t\t\t\tconst user = RocketChat.models.Users.findOne({ username });\n\t\t\t\tif (!user && setting.value === 'Rocket.Cat') {\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'InternalHubot_Username' }, { $set: { value: 'rocket.cat', packageValue: 'rocket.cat' } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 84,\n\tup() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Update permission name, copy values from old name\n\t\t\tconst oldPermission = RocketChat.models.Permissions.findOne('add-user-to-room');\n\t\t\tif (oldPermission && oldPermission.roles.length) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'add-user-to-joined-room' }, { $set: { roles: oldPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user-to-room' });\n\t\t\t}\n\t\t}\n\t},\n\n\tdown() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Revert permission name, copy values from updated name\n\t\t\tconst newPermission = RocketChat.models.Permissions.findOne('add-user-to-joined-room');\n\t\t\tif (newPermission && newPermission.roles.length) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'add-user-to-room' }, { $set: { roles: newPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user-to-joined-room' });\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 85,\n\tup() {\n\t\tconst query = {\n\t\t\tt: 'p',\n\t\t\tusernames: { $size: 2 },\n\t\t\tu: { $exists: false },\n\t\t\tname: { $exists: false },\n\t\t};\n\n\t\tconst rooms = RocketChat.models.Rooms.find(query).fetch();\n\n\t\tif (rooms.length > 0) {\n\t\t\tconst rids = rooms.map((room) => room._id);\n\t\t\tRocketChat.models.Rooms.update({ _id: { $in: rids } }, { $set: { t: 'd' } }, { multi: true });\n\t\t\tRocketChat.models.Subscriptions.update({ rid: { $in: rids } }, { $set: { t: 'd' } }, { multi: true });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 86,\n\tup() {\n\t\t// Disabled this migration for it was not updating any user\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 87,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newMessageNotification': false }, { $set: { 'settings.preferences.newMessageNotification': 'none' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newMessageNotification': true }, { $unset: { 'settings.preferences.newMessageNotification': 1 } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newRoomNotification': false }, { $set: { 'settings.preferences.newRoomNotification': 'none' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newRoomNotification': true }, { $unset: { 'settings.preferences.newRoomNotification': 1 } }, { multi: true });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 88,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Layout_Sidenav_Footer' });\n\t\t\tif (setting && setting.value && setting.packageValue) {\n\t\t\t\tif (setting.value === '<img style=\"left: 10px; position: absolute;\" src=\"/assets/logo.png\" />') {\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'Layout_Sidenav_Footer' }, { $set: { value: setting.packageValue } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 89,\n\tup() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing' }, { fields: { name: 1 } }).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { event: 'sendMessage', retryFailedCalls: true, retryCount: 6, retryDelay: 'powers-of-ten' } });\n\t\t});\n\t},\n\tdown() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing', event: { $ne: 'sendMessage' } }, { fields: { name: 1 } }).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { enabled: false } });\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 90,\n\tup() {\n\t\tRocketChat.models.Settings.remove({ _id: 'Piwik', type: 'group' });\n\n\t\tconst settings = RocketChat.models.Settings.find({ $or: [{ _id: 'PiwikAnalytics_url', value: { $ne: null } }, { _id: 'PiwikAnalytics_siteId', value: { $ne: null } }] }).fetch();\n\n\t\tif (settings && settings.length === 2) {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'PiwikAnalytics_enabled' }, { $set: { value: true } });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 91,\n\tup() {\n\t\tconst query = {\n\t\t\t'services.linkedin': {\n\t\t\t\t$exists: 1,\n\t\t\t},\n\t\t\t$or: [{\n\t\t\t\tname: {\n\t\t\t\t\t$exists: 0,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tname: null,\n\t\t\t}],\n\t\t};\n\n\t\tRocketChat.models.Users.find(query, { 'services.linkedin.firstName': 1, username: 1 }).forEach((user) => {\n\t\t\tconst name = `${ user.services.linkedin.firstName } ${ user.services.linkedin.lastName }`;\n\n\t\t\tRocketChat.models.Users.setName(user._id, name);\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 92,\n\tup() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing', event: 'sendMessage' }, { fields: { name: 1 } }).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { runOnEdits: true } });\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 93,\n\tup() {\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Accounts_AllowAnonymousAccess' });\n\t\t\tif (setting && setting.value === true) {\n\t\t\t\tRocketChat.models.Settings.update({ _id: 'Accounts_AllowAnonymousRead' }, { $set: { value: setting.value } });\n\t\t\t}\n\t\t}\n\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: [\n\t\t\t\t\t'view-c-room',\n\t\t\t\t\t'view-history',\n\t\t\t\t\t'view-joined-room',\n\t\t\t\t\t'view-p-room',\n\t\t\t\t\t'preview-c-room',\n\t\t\t\t],\n\t\t\t},\n\t\t};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\troles: 'anonymous',\n\t\t\t},\n\t\t};\n\n\t\tRocketChat.models.Permissions.update(query, update, { multi: true });\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 94,\n\tup() {\n\t\tconst query = {\n\t\t\t'emails.address.address': { $exists: true },\n\t\t};\n\n\t\tRocketChat.models.Users.find(query, { 'emails.address.address': 1 }).forEach((user) => {\n\t\t\tlet emailAddress;\n\t\t\tuser.emails.some((email) => {\n\t\t\t\tif (email.address && email.address.address) {\n\t\t\t\t\temailAddress = email.address.address;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\tconst existingUser = RocketChat.models.Users.findOne({ 'emails.address': emailAddress }, { fields: { _id: 1 } });\n\t\t\tif (existingUser) {\n\t\t\t\tRocketChat.models.Users.update({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\t'emails.address.address': emailAddress,\n\t\t\t\t}, {\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\t'emails.$': 1,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tRocketChat.models.Users.update({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\t'emails.address.address': emailAddress,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\t'emails.$.address': emailAddress,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 95,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst emailHeader = RocketChat.models.Settings.findOne({ _id: 'Email_Header' });\n\t\t\tconst emailFooter = RocketChat.models.Settings.findOne({ _id: 'Email_Footer' });\n\t\t\tconst startWithHTML = emailHeader.value.match(/^<html>/);\n\t\t\tconst endsWithHTML = emailFooter.value.match(/<\\/html>$/);\n\n\t\t\tif (!startWithHTML) {\n\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t{ _id: 'Email_Header' },\n\t\t\t\t\t{ $set: { value: `<html>${ emailHeader.value }` } }\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (!endsWithHTML) {\n\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t{ _id: 'Email_Footer' },\n\t\t\t\t\t{ $set: { value: `${ emailFooter.value }</html>` } }\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 96,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.update({ _id: 'InternalHubot_ScriptsToLoad' }, { $set: { value: '' } });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 97,\n\tup() {\n\t\t// Migration moved to 099.js to fix a bug\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 98,\n\tup() {\n\t\tRocketChat.models.OAuthApps.update({ _id: 'zapier' }, {\n\t\t\t$set: {\n\t\t\t\tredirectUri: 'https://zapier.com/dashboard/auth/oauth/return/RocketChatDevAPI/',\n\t\t\t},\n\t\t});\n\t},\n});\n","/* globals SystemLogger */\n\nimport fs from 'fs';\nimport path from 'path';\n\nfunction log(...args) {\n\tconsole.log('[AVATAR]', ...args);\n}\n\nfunction logError(...args) {\n\tconsole.error('[AVATAR]', ...args);\n}\n\nfunction insertAvatar({ details, avatarsFileStore, stream, callback = () => {} }) {\n\treturn new Promise((resolve) => {\n\t\tMeteor.defer(() => {\n\t\t\tMeteor.runAsUser('rocket.cat', () => {\n\t\t\t\tavatarsFileStore.insert(details, stream, (err) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tlogError({ err });\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tMeteor.setTimeout(() => {\n\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t}, 200);\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n}\n\nfunction batch(arr, limit, fn) {\n\tif (!arr.length) {\n\t\treturn Promise.resolve();\n\t}\n\treturn Promise.all(arr.splice(0, limit).map((item) => fn(item))).then(() => batch(arr, limit, fn));\n}\n\nRocketChat.Migrations.add({\n\tversion: 99,\n\tup() {\n\t\tlog('Migrating avatars. This might take a while.');\n\n\t\tconst query = {\n\t\t\t$or: [{\n\t\t\t\t's3.path': {\n\t\t\t\t\t$exists: true,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\t'googleCloudStorage.path': {\n\t\t\t\t\t$exists: true,\n\t\t\t\t},\n\t\t\t}],\n\t\t};\n\n\t\tRocketChat.models.Uploads.find(query).forEach((record) => {\n\t\t\tif (record.s3) {\n\t\t\t\tRocketChat.models.Uploads.model.direct.update({ _id: record._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tstore: 'AmazonS3:Uploads',\n\t\t\t\t\t\tAmazonS3: {\n\t\t\t\t\t\t\tpath: record.s3.path + record._id,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\ts3: 1,\n\t\t\t\t\t},\n\t\t\t\t}, { multi: true });\n\t\t\t} else {\n\t\t\t\tRocketChat.models.Uploads.model.direct.update({ _id: record._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tstore: 'GoogleCloudStorage:Uploads',\n\t\t\t\t\t\tGoogleStorage: {\n\t\t\t\t\t\t\tpath: record.googleCloudStorage.path + record._id,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\tgoogleCloudStorage: 1,\n\t\t\t\t\t},\n\t\t\t\t}, { multi: true });\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Uploads.model.direct.update({\n\t\t\tstore: 'fileSystem',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tstore: 'FileSystem:Uploads',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\t\tRocketChat.models.Uploads.model.direct.update({\n\t\t\tstore: 'rocketchat_uploads',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tstore: 'GridFS:Uploads',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\n\t\tconst avatarOrigins = [\n\t\t\t'upload',\n\t\t\t'gravatar',\n\t\t\t'facebook',\n\t\t\t'twitter',\n\t\t\t'github',\n\t\t\t'google',\n\t\t\t'url',\n\t\t\t'gitlab',\n\t\t\t'linkedin',\n\t\t];\n\n\t\tconst avatarsPathRecord = RocketChat.models.Settings.findOne({ _id: 'Accounts_AvatarStorePath' });\n\t\tconst avatarStoreTypeRecord = RocketChat.models.Settings.findOne({ _id: 'Accounts_AvatarStoreType' });\n\n\t\tconst avatarsPath = avatarsPathRecord ? avatarsPathRecord.value : process.env.AVATARS_PATH;\n\t\tlet avatarStoreType = avatarStoreTypeRecord && avatarStoreTypeRecord.value;\n\n\t\tconst oldAvatarGridFS = new RocketChatFile.GridFS({\n\t\t\tname: 'avatars',\n\t\t});\n\n\t\tif (avatarStoreType == null) {\n\t\t\tconst count = oldAvatarGridFS.countSync();\n\t\t\tif (Match.test(count, Number) && count > 0) {\n\t\t\t\tavatarStoreType = 'GridFS';\n\t\t\t} else if (Match.test(avatarsPath, String) && avatarsPath.length > 0) {\n\t\t\t\tavatarStoreType = 'FileSystem';\n\t\t\t} else {\n\t\t\t\tSystemLogger.error_box('Can\\'t define the avatar\\'s storage type.\\nIf you have avatars missing and they was stored in your file system\\nrun the process including the following environment variables: \\n  AVATARS_PATH=\\'YOUR AVATAR\\'S DIRECTORY\\'\\n  MIGRATION_VERSION=99,rerun', 'WARNING');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tMeteor.startup(function() {\n\t\t\tMeteor.setTimeout(function() {\n\t\t\t\tconst avatarsFileStore = FileUpload.getStore('Avatars');\n\n\t\t\t\tconst users = RocketChat.models.Users.find({ avatarOrigin: { $in: avatarOrigins } }, { avatarOrigin: 1, username: 1 }).fetch();\n\n\t\t\t\tconst usersTotal = users.length;\n\n\t\t\t\tlog('Total users to migrate avatars ->', usersTotal);\n\n\t\t\t\tlet current = 0;\n\n\t\t\t\tbatch(users, 300, (user) => {\n\t\t\t\t\tconst id = `${ user.username }.jpg`;\n\n\t\t\t\t\tconst gridFSAvatar = oldAvatarGridFS.getFileWithReadStream(id);\n\n\t\t\t\t\tlog('Migrating', ++current, 'of', usersTotal);\n\n\t\t\t\t\tif (gridFSAvatar) {\n\t\t\t\t\t\tconst details = {\n\t\t\t\t\t\t\tuserId: user._id,\n\t\t\t\t\t\t\ttype: gridFSAvatar.contentType,\n\t\t\t\t\t\t\tsize: gridFSAvatar.length,\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\treturn insertAvatar({\n\t\t\t\t\t\t\tdetails,\n\t\t\t\t\t\t\tavatarsFileStore,\n\t\t\t\t\t\t\tstream: gridFSAvatar.readStream,\n\t\t\t\t\t\t\tcallback() {\n\t\t\t\t\t\t\t\toldAvatarGridFS.deleteFile(id);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (avatarStoreType === 'FileSystem' && avatarsPath && avatarsPath.trim()) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst filePath = path.join(avatarsPath, id);\n\t\t\t\t\t\t\tconst stat = fs.statSync(filePath);\n\t\t\t\t\t\t\tif (stat && stat.isFile()) {\n\t\t\t\t\t\t\t\tconst details = {\n\t\t\t\t\t\t\t\t\tuserId: user._id,\n\t\t\t\t\t\t\t\t\ttype: 'image/jpeg',\n\t\t\t\t\t\t\t\t\tsize: stat.size,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\treturn insertAvatar({\n\t\t\t\t\t\t\t\t\tdetails,\n\t\t\t\t\t\t\t\t\tavatarsFileStore,\n\t\t\t\t\t\t\t\t\tstream: fs.createReadStream(filePath),\n\t\t\t\t\t\t\t\t\tcallback() {\n\t\t\t\t\t\t\t\t\t\tfs.unlinkSync(filePath);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tlogError('Error migrating old avatar', e);\n\t\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).then(() => {\n\t\t\t\t\tconst avatarsFiles = new Mongo.Collection('avatars.files');\n\t\t\t\t\tconst avatarsChunks = new Mongo.Collection('avatars.chunks');\n\t\t\t\t\tavatarsFiles.rawCollection().drop();\n\t\t\t\t\tavatarsChunks.rawCollection().drop();\n\t\t\t\t\tRocketChat.models.Settings.remove({ _id: 'Accounts_AvatarStoreType' });\n\t\t\t\t\tRocketChat.models.Settings.remove({ _id: 'Accounts_AvatarStorePath' });\n\t\t\t\t});\n\t\t\t}, 1000);\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 100,\n\tup() {\n\t\tRocketChat.models.Subscriptions.update({ audioNotification:{ $exists:1 } }, { $rename: { audioNotification: 'audioNotifications' } });\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 101,\n\tup() {\n\t\tRocketChat.models.Subscriptions.update({ lastActivity:{ $exists:1 } }, { $unset: { lastActivity: '' } }, { multi: true });\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 102,\n\tup() {\n\t\tif (!RocketChat || !RocketChat.models || !RocketChat.models.Settings) {\n\t\t\treturn;\n\t\t}\n\n\t\tRocketChat.models.Settings.update(\n\t\t\t{ _id: 'LDAP_Connect_Timeout', value: 600000 },\n\t\t\t{ $set: { value: 1000 } }\n\t\t);\n\n\t\tRocketChat.models.Settings.update(\n\t\t\t{ _id: 'LDAP_Idle_Timeout', value: 600000 },\n\t\t\t{ $set: { value: 1000 } }\n\t\t);\n\n\t\tconst LDAP_Domain_Base = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Base' });\n\t\tif (LDAP_Domain_Base) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_BaseDN' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Base.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Base' });\n\n\t\tconst LDAP_Domain_Search_User_ID = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_User_ID' });\n\t\tif (LDAP_Domain_Search_User_ID) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_User_Search_Field' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_User_ID.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_User_ID' });\n\n\t\tconst LDAP_Use_Custom_Domain_Search = RocketChat.models.Settings.findOne({ _id: 'LDAP_Use_Custom_Domain_Search' });\n\t\tconst LDAP_Custom_Domain_Search = RocketChat.models.Settings.findOne({ _id: 'LDAP_Custom_Domain_Search' });\n\n\t\tconst LDAP_Domain_Search_User = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_User' });\n\t\tconst LDAP_Domain_Search_Password = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Password' });\n\t\tconst LDAP_Domain_Search_Filter = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Filter' });\n\n\t\tconst LDAP_Domain_Search_Object_Class = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Object_Class' });\n\t\tconst LDAP_Domain_Search_Object_Category = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Object_Category' });\n\n\t\tif (LDAP_Use_Custom_Domain_Search) {\n\t\t\tif (LDAP_Use_Custom_Domain_Search.value === true) {\n\t\t\t\tlet Custom_Domain_Search;\n\t\t\t\ttry {\n\t\t\t\t\tCustom_Domain_Search = JSON.parse(LDAP_Custom_Domain_Search.value);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthrow new Error('Invalid Custom Domain Search JSON');\n\t\t\t\t}\n\n\t\t\t\tLDAP_Domain_Search_User.value = Custom_Domain_Search.userDN || '';\n\t\t\t\tLDAP_Domain_Search_Password.value = Custom_Domain_Search.password || '';\n\t\t\t\tLDAP_Domain_Search_Filter.value = Custom_Domain_Search.filter;\n\t\t\t} else {\n\t\t\t\tconst filter = [];\n\n\t\t\t\tif (LDAP_Domain_Search_Object_Category.value !== '') {\n\t\t\t\t\tfilter.push(`(objectCategory=${ LDAP_Domain_Search_Object_Category.value })`);\n\t\t\t\t}\n\n\t\t\t\tif (LDAP_Domain_Search_Object_Class.value !== '') {\n\t\t\t\t\tfilter.push(`(objectclass=${ LDAP_Domain_Search_Object_Class.value })`);\n\t\t\t\t}\n\n\t\t\t\tif (LDAP_Domain_Search_Filter.value !== '') {\n\t\t\t\t\tfilter.push(`(${ LDAP_Domain_Search_Filter.value })`);\n\t\t\t\t}\n\n\t\t\t\tif (filter.length === 1) {\n\t\t\t\t\tLDAP_Domain_Search_Filter.value = filter[0];\n\t\t\t\t} else if (filter.length > 1) {\n\t\t\t\t\tLDAP_Domain_Search_Filter.value = `(&${ filter.join('') })`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (LDAP_Domain_Search_Filter && LDAP_Domain_Search_Filter.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_User_Search_Filter' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_Filter.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Filter' });\n\n\t\tif (LDAP_Domain_Search_User && LDAP_Domain_Search_User.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Authentication_UserDN' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_User.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_User' });\n\n\n\t\tif (LDAP_Domain_Search_Password && LDAP_Domain_Search_Password.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Authentication_Password' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_Password.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Password' });\n\n\t\tif (LDAP_Domain_Search_User && LDAP_Domain_Search_User.value && LDAP_Domain_Search_Password && LDAP_Domain_Search_Password.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Authentication' },\n\t\t\t\t{ $set: { value: true } }\n\t\t\t);\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Use_Custom_Domain_Search' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Custom_Domain_Search' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Object_Class' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Object_Category' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Sync_Users' }); // Button\n\n\t\tconst LDAP_Sync_User_Data = RocketChat.models.Settings.findOne({ _id: 'LDAP_Sync_User_Data' });\n\t\tif (LDAP_Sync_User_Data && LDAP_Sync_User_Data.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Background_Sync' },\n\t\t\t\t{ $set: { value: true } }\n\t\t\t);\n\t\t}\n\n\t\tconst LDAP_Import_Users = RocketChat.models.Settings.findOne({ _id: 'LDAP_Import_Users' });\n\t\tif (LDAP_Import_Users && LDAP_Import_Users.value === false) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Background_Sync_Import_New_Users' },\n\t\t\t\t{ $set: { value: false } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Import_Users' });\n\t},\n});\n","const majorColors = {\n\t'content-background-color': '#FFFFFF',\n\t'primary-background-color': '#04436A',\n\t'primary-font-color': '#444444',\n\t'primary-action-color': '#13679A', // was action-buttons-color\n\t'secondary-background-color': '#F4F4F4',\n\t'secondary-font-color': '#A0A0A0',\n\t'secondary-action-color': '#DDDDDD',\n\t'component-color': '#EAEAEA',\n\t'success-color': '#4dff4d',\n\t'pending-color': '#FCB316',\n\t'error-color': '#BC2031',\n\t'selection-color': '#02ACEC',\n\t'attention-color': '#9C27B0',\n};\n\n// Minor colours implement major colours by default, but can be overruled\n// const minorColors = {\n// \t'tertiary-background-color': '@component-color',\n// \t'tertiary-font-color': '@transparent-lightest',\n// \t'link-font-color': '@primary-action-color',\n// \t'info-font-color': '@secondary-font-color',\n// \t'custom-scrollbar-color': '@transparent-darker',\n// \t'status-online': '@success-color',\n// \t'status-away': '@pending-color',\n// \t'status-busy': '@error-color',\n// \t'status-offline': '@transparent-darker'\n// };\n\nconst newvariables = {\n\t'content-background-color': 'rc-color-primary-lightest',\n\t'primary-background-color': 'rc-color-primary',\n\t'success-color': 'rc-color-success',\n\t'pending-color': 'rc-color-alert',\n\t'error-color': 'rc-color-error',\n\t'status-online': 'rc-color-success',\n\t'status-away': 'rc-color-alert',\n\t'status-busy': 'rc-color-error',\n\t'status-offline': 'rc-color-primary-darkest',\n};\n\nfunction lightenDarkenColor(col, amt) {\n\tlet usePound = false;\n\tif (col[0] === '#') {\n\t\tcol = col.slice(1);\n\t\tusePound = true;\n\t}\n\n\tconst num = parseInt(col, 16);\n\tlet r = (num >> 16) + amt;\n\n\tif (r > 255) { r = 255; } else if (r < 0) { r = 0; }\n\n\tlet b = ((num >> 8) & 0x00FF) + amt;\n\n\tif (b > 255) { b = 255; } else if (b < 0) { b = 0; }\n\n\tlet g = (num & 0x0000FF) + amt;\n\n\tif (g > 255) { g = 255; } else if (g < 0) { g = 0; }\n\n\treturn (usePound ? '#' : '') + (g | (b << 8) | (r << 16)).toString(16);\n}\n\nRocketChat.Migrations.add({\n\tversion: 103,\n\tup() {\n\t\tObject.keys(majorColors).forEach(function(_id) {\n\t\t\tconst color = RocketChat.models.Settings.findOne({ _id: `theme-color-${ _id }` });\n\t\t\tconst key = newvariables[_id];\n\t\t\tif (color && color.value !== majorColors[_id] && key) {\n\t\t\t\tif (/^@.+/.test(color.value)) {\n\t\t\t\t\tcolor.value = newvariables[color.value.replace('@', '')];\n\t\t\t\t}\n\t\t\t\tconst id = `theme-color-${ key }`;\n\t\t\t\tRocketChat.models.Settings.update({ _id: id }, { $set: { value : color.value, editor: /^#.+/.test(color.value) ? 'color' : 'expression' } });\n\t\t\t\tif (key === 'rc-color-primary') {\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'theme-color-rc-color-primary-darkest' }, { $set: { editor: 'color', value: lightenDarkenColor(color.value, -16) } });\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'theme-color-rc-color-primary-dark' }, { $set: { editor: 'color', value: lightenDarkenColor(color.value, 18) } });\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'theme-color-rc-color-primary-light' }, { $set: { editor: 'color', value: lightenDarkenColor(color.value, 110) } });\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'theme-color-rc-color-primary-light-medium' }, { $set: { editor: 'color', value: lightenDarkenColor(color.value, 156) } });\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'theme-color-rc-color-primary-lightest' }, { $set: { editor: 'color', value: lightenDarkenColor(color.value, 200) } });\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n});\n","RocketChat.Migrations.add({\n\tversion: 104,\n\tup() {\n\t\tif ((RocketChat.models.Settings.findOne({ _id: 'theme-color-rc-color-primary' }) || {}).value === '#04436A' &&\n\t\t\t(RocketChat.models.Settings.findOne({ _id: 'theme-color-rc-color-primary-darkest' }) || {}).value === '#335a' &&\n\t\t\t(RocketChat.models.Settings.findOne({ _id: 'theme-color-rc-color-primary-dark' }) || {}).value === '#16557c' &&\n\t\t\t(RocketChat.models.Settings.findOne({ _id: 'theme-color-rc-color-primary-light' }) || {}).value === '#72b1d8' &&\n\t\t\t(RocketChat.models.Settings.findOne({ _id: 'theme-color-rc-color-primary-light-medium' }) || {}).value === '#a0dfff' &&\n\t\t\t(RocketChat.models.Settings.findOne({ _id: 'theme-color-rc-color-primary-lightest' }) || {}).value === '#ccffff'\n\t\t) {\n\t\t\tRocketChat.models.Settings.update({ _id: 'theme-color-rc-color-primary' }, { $set: { editor: 'expression', value: 'color-dark' } });\n\t\t\tRocketChat.models.Settings.update({ _id: 'theme-color-rc-color-primary-darkest' }, { $set: { editor: 'expression', value: 'color-darkest' } });\n\t\t\tRocketChat.models.Settings.update({ _id: 'theme-color-rc-color-primary-dark' }, { $set: { editor: 'expression', value: 'color-dark-medium' } });\n\t\t\tRocketChat.models.Settings.update({ _id: 'theme-color-rc-color-primary-light' }, { $set: { editor: 'expression', value: 'color-gray' } });\n\t\t\tRocketChat.models.Settings.update({ _id: 'theme-color-rc-color-primary-light-medium' }, { $set: { editor: 'expression', value: 'color-gray-medium' } });\n\t\t\tRocketChat.models.Settings.update({ _id: 'theme-color-rc-color-primary-lightest' }, { $set: { editor: 'expression', value: 'color-gray-lightest' } });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 105,\n\tup() {\n\t\tif (RocketChat && RocketChat.models) {\n\t\t\tif (RocketChat.models.Users) {\n\t\t\t\tRocketChat.models.Users.find({ 'settings.preferences.unreadRoomsMode': { $exists: 1 } }).forEach(function(user) {\n\t\t\t\t\tconst newPreference = user.settings.preferences.unreadRoomsMode ? 'unread' : 'category';\n\t\t\t\t\tRocketChat.models.Users.update({ _id: user._id }, { $unset: { 'settings.preferences.unreadRoomsMode': 1 }, $set: { 'settings.preferences.roomsListExhibitionMode': newPreference } });\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (RocketChat.models.Settings) {\n\t\t\t\tconst settingsMap = {\n\t\t\t\t\tDesktop_Notifications_Default_Alert: 'Accounts_Default_User_Preferences_desktopNotifications',\n\t\t\t\t\tMobile_Notifications_Default_Alert: 'Accounts_Default_User_Preferences_mobileNotifications',\n\t\t\t\t\tAudio_Notifications_Default_Alert: 'Accounts_Default_User_Preferences_audioNotifications',\n\t\t\t\t\tDesktop_Notifications_Duration: 'Accounts_Default_User_Preferences_desktopNotificationDuration',\n\t\t\t\t\tAudio_Notifications_Value: undefined,\n\t\t\t\t};\n\t\t\t\tRocketChat.models.Settings.find({ _id: { $in: Object.keys(settingsMap) } }).forEach((oldSetting) => {\n\t\t\t\t\tconst newSettingKey = settingsMap[oldSetting._id];\n\t\t\t\t\tconst newSetting = newSettingKey && RocketChat.models.Settings.findOne({ _id: newSettingKey });\n\n\t\t\t\t\tif (newSetting && newSetting.value !== oldSetting.value) {\n\t\t\t\t\t\tRocketChat.models.Settings.update({ _id: newSettingKey }, {\t$set: {\tvalue: oldSetting.value\t}\t});\n\t\t\t\t\t}\n\t\t\t\t\tRocketChat.models.Settings.remove({ _id: oldSetting._id });\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n});\n","import LivechatVisitors from 'meteor/rocketchat:livechat/server/models/LivechatVisitors';\n\nRocketChat.Migrations.add({\n\tversion: 106,\n\tup() {\n\t\tconst visitors = Meteor.users.find({ type: 'visitor' });\n\t\tconst total = visitors.count();\n\t\tlet current = 1;\n\n\t\tconsole.log('Migrating livechat visitors, this may take a while ...');\n\n\t\tMeteor.setTimeout(() => {\n\t\t\tvisitors.forEach((user) => {\n\t\t\t\tconsole.log(`Migrating visitor ${ current++ }/${ total }`);\n\n\t\t\t\tconst {\n\t\t\t\t\t_id,\n\t\t\t\t\tname,\n\t\t\t\t\tusername,\n\t\t\t\t\tdeparment,\n\t\t\t\t\tuserAgent,\n\t\t\t\t\tip,\n\t\t\t\t\thost,\n\t\t\t\t\tvisitorEmails,\n\t\t\t\t\tphone,\n\t\t\t\t} = user;\n\t\t\t\tLivechatVisitors.insert({\n\t\t\t\t\t_id,\n\t\t\t\t\tname,\n\t\t\t\t\tusername,\n\t\t\t\t\tdeparment,\n\t\t\t\t\tuserAgent,\n\t\t\t\t\tip,\n\t\t\t\t\thost,\n\t\t\t\t\tvisitorEmails,\n\t\t\t\t\tphone,\n\t\t\t\t\ttoken: user.profile.token,\n\t\t\t\t});\n\n\t\t\t\tMeteor.users.remove({ _id });\n\t\t\t});\n\n\t\t\tconsole.log('Livechat visitors migration finished.');\n\t\t}, 1000);\n\t},\n});\n","\n\nRocketChat.Migrations.add({\n\tversion: 107,\n\tup() {\n\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'preferences.roomsListExhibitionMode': 'activity',\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'preferences.roomsListExhibitionMode': 1,\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'preferences.sidebarSortby': 'activity',\n\t\t\t\t'preferences.sidebarShowFavorites': true,\n\t\t\t},\n\t\t});\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'preferences.roomsListExhibitionMode': 'unread',\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'preferences.roomsListExhibitionMode': 1,\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'preferences.sidebarSortby': 'alphabetical',\n\t\t\t\t'preferences.sidebarShowUnread' : true,\n\t\t\t\t'preferences.sidebarShowFavorites': true,\n\t\t\t},\n\t\t});\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'preferences.roomsListExhibitionMode': 'category',\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'preferences.roomsListExhibitionMode': 1,\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'preferences.sidebarSortby': 'alphabetical',\n\t\t\t\t'preferences.sidebarShowFavorites': true,\n\t\t\t},\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 108,\n\tup() {\n\t\tconst roles = RocketChat.models.Roles.find({\n\t\t\t_id: { $ne: 'guest' },\n\t\t\tscope: 'Users',\n\t\t}).fetch().map((role) => role._id);\n\t\tRocketChat.models.Permissions.createOrUpdate('leave-c', roles);\n\t\tRocketChat.models.Permissions.createOrUpdate('leave-d', roles);\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 109,\n\tup() {\n\t\tconst FileUpload_GoogleStorage_Proxy = (RocketChat.models.Settings.findOne({ _id: 'FileUpload_GoogleStorage_Proxy' }) || {}).value === true;\n\t\tconst FileUpload_S3_Proxy = (RocketChat.models.Settings.findOne({ _id: 'FileUpload_S3_Proxy' }) || {}).value === true;\n\n\t\tRocketChat.models.Settings.update({ _id: 'FileUpload_GoogleStorage_Proxy_Avatars' }, { $set: { value: FileUpload_GoogleStorage_Proxy } });\n\t\tRocketChat.models.Settings.update({ _id: 'FileUpload_GoogleStorage_Proxy_Uploads' }, { $set: { value: FileUpload_GoogleStorage_Proxy } });\n\n\t\tRocketChat.models.Settings.update({ _id: 'FileUpload_S3_Proxy_Avatars' }, { $set: { value: FileUpload_S3_Proxy } });\n\t\tRocketChat.models.Settings.update({ _id: 'FileUpload_S3_Proxy_Uploads' }, { $set: { value: FileUpload_S3_Proxy } });\n\n\t\tRocketChat.models.Settings.remove({ _id: 'FileUpload_GoogleStorage_Proxy' });\n\t\tRocketChat.models.Settings.remove({ _id: 'FileUpload_S3_Proxy' });\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 110,\n\tup() {\n\t\tif (RocketChat && RocketChat.models) {\n\n\t\t\tif (RocketChat.models.Settings) {\n\t\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Accounts_Default_User_Preferences_viewMode' });\n\t\t\t\tif (setting && setting.value) {\n\t\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t\t{ _id: 'Accounts_Default_User_Preferences_messageViewMode' },\n\t\t\t\t\t\t{ $set: { value: setting.value } }\n\t\t\t\t\t);\n\n\t\t\t\t\tRocketChat.models.Settings.remove(\n\t\t\t\t\t\t{ _id: 'Accounts_Default_User_Preferences_viewMode' }\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (RocketChat.models.Users) {\n\t\t\t\tRocketChat.models.Users.update(\n\t\t\t\t\t{ 'settings.preferences.viewMode': { $exists: 1 } },\n\t\t\t\t\t{ $rename: { 'settings.preferences.viewMode': 'user.settings.preferences.messageViewMode' } },\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t},\n\tdown() {\n\t\tif (RocketChat && RocketChat.models) {\n\n\t\t\tif (RocketChat.models.Settings) {\n\t\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Accounts_Default_User_Preferences_messageViewMode' });\n\t\t\t\tif (setting && setting.value) {\n\t\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t\t{ _id: 'Accounts_Default_User_Preferences_viewMode' },\n\t\t\t\t\t\t{ $set: { value: setting.value } }\n\t\t\t\t\t);\n\n\t\t\t\t\tRocketChat.models.Settings.remove(\n\t\t\t\t\t\t{ _id: 'Accounts_Default_User_Preferences_messageViewMode' }\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (RocketChat.models.Users) {\n\t\t\t\tRocketChat.models.Users.update(\n\t\t\t\t\t{ 'settings.preferences.messageViewMode': { $exists: 1 } },\n\t\t\t\t\t{ $rename: { 'settings.preferences.messageViewMode': 'user.settings.preferences.viewMode' } },\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t},\n});\n","// Migration to give delete channel, delete group permissions to owner\nRocketChat.Migrations.add({\n\tversion: 111,\n\tup() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\t\t\tRocketChat.models.Permissions.update({ _id: 'delete-c' }, { $addToSet: { roles: 'owner' } });\n\t\t\tRocketChat.models.Permissions.update({ _id: 'delete-p' }, { $addToSet: { roles: 'owner' } });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 112,\n\tup() {\n\t\tif (RocketChat && RocketChat.models) {\n\t\t\tif (RocketChat.models.Settings) {\n\t\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Accounts_Default_User_Preferences_idleTimeoutLimit' });\n\t\t\t\tif (setting && setting.value) {\n\t\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t\t{ _id: 'Accounts_Default_User_Preferences_idleTimeoutLimit' },\n\t\t\t\t\t\t{ $set: { value: setting.value / 1000 } }\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (RocketChat.models.Users) {\n\t\t\t\tRocketChat.models.Users.find({ 'settings.preferences.idleTimeLimit': { $exists: 1 } }).forEach(function(user) {\n\t\t\t\t\tRocketChat.models.Users.update(\n\t\t\t\t\t\t{ _id: user._id },\n\t\t\t\t\t\t{ $set: { 'settings.preferences.idleTimeLimit': user.settings.preferences.idleTimeLimit / 1000 } }\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 113,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Uploads && RocketChat.models.Messages) {\n\t\t\tconst fileQuery = {\n\t\t\t\tuserId: null,\n\t\t\t};\n\n\t\t\tconst filesToUpdate = RocketChat.models.Uploads.find(fileQuery);\n\t\t\tfilesToUpdate.forEach((file) => {\n\t\t\t\tconst messageQuery = {\n\t\t\t\t\t'file._id' : file._id,\n\t\t\t\t};\n\t\t\t\tconst message = RocketChat.models.Messages.findOne(messageQuery);\n\t\t\t\tif (message) {\n\t\t\t\t\tconst filter = {\n\t\t\t\t\t\t_id: file._id,\n\t\t\t\t\t};\n\n\t\t\t\t\tconst update = {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\tuserId: message.u._id,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\n\t\t\t\t\tRocketChat.models.Uploads.model.direct.update(filter, update);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 114,\n\tup() {\n\t\tif (RocketChat && RocketChat.models) {\n\t\t\tif (RocketChat.models.Settings) {\n\t\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Message_GlobalSearch' });\n\t\t\t\tif (setting && setting.value) {\n\t\t\t\t\tRocketChat.models.Settings.upsert(\n\t\t\t\t\t\t{ _id: 'Search.defaultProvider.GlobalSearchEnabled' },\n\t\t\t\t\t\t{ $set: { value: setting.value } }\n\t\t\t\t\t);\n\n\t\t\t\t\tRocketChat.models.Settings.removeById('Message_GlobalSearch');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 115,\n\tup() {\n\t\tRocketChat.models.Rooms.update({\n\t\t\t'announcement.message': { $exists: true },\n\t\t}, {\n\t\t\t$unset: { announcement: 1 },\n\t\t}, { multi: true });\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 116,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex({\n\t\t\tunread: 1,\n\t\t});\n\n\t\t// set pref origin to all existing preferences\n\t\tRocketChat.models.Subscriptions.update({\n\t\t\tdesktopNotifications: { $exists: true },\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tdesktopPrefOrigin: 'subscription',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\t\tRocketChat.models.Subscriptions.update({\n\t\t\tmobilePushNotifications: { $exists: true },\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tmobilePrefOrigin: 'subscription',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\t\tRocketChat.models.Subscriptions.update({\n\t\t\temailNotifications: { $exists: true },\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\temailPrefOrigin: 'subscription',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\n\t\t// set user preferences on subscriptions\n\t\tRocketChat.models.Users.find({\n\t\t\t$or: [\n\t\t\t\t{ 'settings.preferences.desktopNotifications': { $exists: true } },\n\t\t\t\t{ 'settings.preferences.mobileNotifications': { $exists: true } },\n\t\t\t\t{ 'settings.preferences.emailNotificationMode': { $exists: true } },\n\t\t\t],\n\t\t}).forEach((user) => {\n\t\t\tif (user.settings.preferences.desktopNotifications && user.settings.preferences.desktopNotifications !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\tdesktopPrefOrigin: { $exists: false },\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tdesktopNotifications: user.settings.preferences.desktopNotifications,\n\t\t\t\t\t\tdesktopPrefOrigin: 'user',\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (user.settings.preferences.mobileNotifications && user.settings.preferences.mobileNotifications !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\tmobilePrefOrigin: { $exists: false },\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tmobileNotifications: user.settings.preferences.mobileNotifications,\n\t\t\t\t\t\tmobilePrefOrigin: 'user',\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (user.settings.preferences.emailNotificationMode && user.settings.preferences.emailNotificationMode !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\temailPrefOrigin: { $exists: false },\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\temailNotifications: user.settings.preferences.emailNotificationMode === 'disabled' || user.settings.preferences.emailNotificationMode === 'nothing' ? 'nothing' : 'mentions',\n\t\t\t\t\t\temailPrefOrigin: 'user',\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 117,\n\tup() {\n\t\tif (RocketChat.authz &&\n\t\tRocketChat.models &&\n\t\tRocketChat.models.Settings &&\n\t\tRocketChat.authz.getUsersInRole('admin').count()) {\n\t\t\tRocketChat.models.Settings.upsert(\n\t\t\t\t{\n\t\t\t\t\t_id: 'Show_Setup_Wizard',\n\t\t\t\t}, {\n\t\t\t\t\t$set: { value: 'completed' },\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 118,\n\tup() {\n\t\tRocketChat.models.Subscriptions.update({\n\t\t\temailNotifications: 'all',\n\t\t\temailPrefOrigin: 'user',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\temailNotifications: 'mentions',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti:true,\n\t\t});\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.emailNotificationMode': 'disabled',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'settings.preferences.emailNotificationMode': 'nothing',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti:true,\n\t\t});\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.emailNotificationMode': 'all',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'settings.preferences.emailNotificationMode': 'mentions',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti:true,\n\t\t});\n\n\t\tRocketChat.models.Settings.update({\n\t\t\t_id: 'Accounts_Default_User_Preferences_emailNotificationMode',\n\t\t\tvalue: 'disabled',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tvalue: 'nothing',\n\t\t\t},\n\t\t});\n\n\t\tRocketChat.models.Settings.update({\n\t\t\t_id: 'Accounts_Default_User_Preferences_emailNotificationMode',\n\t\t\tvalue: 'all',\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tvalue: 'mentions',\n\t\t\t},\n\t\t});\n\n\t\t// set user highlights on subscriptions\n\t\tRocketChat.models.Users.find({\n\t\t\t'settings.preferences.highlights.0': { $exists: true },\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t'settings.preferences.highlights': 1,\n\t\t\t},\n\t\t}).forEach((user) => {\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t'u._id': user._id,\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tuserHighlights: user.settings.preferences.highlights,\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tmulti: true,\n\t\t\t});\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 119,\n\tup() {\n\t\tif (RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.update({\n\t\t\t\t_id: 'Show_Setup_Wizard',\n\t\t\t\tvalue: true,\n\t\t\t}, {\n\t\t\t\t$set: { value: 'pending' },\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.update({\n\t\t\t\t_id: 'Show_Setup_Wizard',\n\t\t\t\tvalue: false,\n\t\t\t}, {\n\t\t\t\t$set: { value: 'completed' },\n\t\t\t});\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 120,\n\tup() {\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.roomsListExhibitionMode': 'activity',\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'settings.preferences.roomsListExhibitionMode': 1,\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'settings.preferences.sidebarSortby': 'activity',\n\t\t\t\t'settings.preferences.sidebarShowFavorites': true,\n\t\t\t},\n\t\t});\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.roomsListExhibitionMode': 'unread',\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'settings.preferences.roomsListExhibitionMode': 1,\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'settings.preferences.sidebarSortby': 'alphabetical',\n\t\t\t\t'settings.preferences.sidebarShowUnread' : true,\n\t\t\t\t'settings.preferences.sidebarShowFavorites': true,\n\t\t\t},\n\t\t});\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.roomsListExhibitionMode': 'category',\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'settings.preferences.roomsListExhibitionMode': 1,\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'settings.preferences.sidebarSortby': 'alphabetical',\n\t\t\t\t'settings.preferences.sidebarShowFavorites': true,\n\t\t\t},\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 121,\n\tup() {\n\n\t\t// set user preferences on subscriptions\n\t\tRocketChat.models.Users.find({\n\t\t\t$or: [\n\t\t\t\t{ 'settings.preferences.desktopNotifications': { $exists: true } },\n\t\t\t\t{ 'settings.preferences.mobileNotifications': { $exists: true } },\n\t\t\t\t{ 'settings.preferences.emailNotificationMode': { $exists: true } },\n\t\t\t],\n\t\t}).forEach((user) => {\n\t\t\tif (user.settings.preferences.desktopNotifications && user.settings.preferences.desktopNotifications !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\tdesktopPrefOrigin: { $exists: false },\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tdesktopNotifications: user.settings.preferences.desktopNotifications,\n\t\t\t\t\t\tdesktopPrefOrigin: 'user',\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (user.settings.preferences.mobileNotifications && user.settings.preferences.mobileNotifications !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\tmobilePrefOrigin: { $exists: false },\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tmobileNotifications: user.settings.preferences.mobileNotifications,\n\t\t\t\t\t\tmobilePrefOrigin: 'user',\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (user.settings.preferences.emailNotificationMode && user.settings.preferences.emailNotificationMode !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\temailPrefOrigin: { $exists: false },\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\temailNotifications: user.settings.preferences.emailNotificationMode === 'disabled' || user.settings.preferences.emailNotificationMode === 'nothing' ? 'nothing' : 'mentions',\n\t\t\t\t\t\temailPrefOrigin: 'user',\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 122,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex('u._id_1_name_1_t_1_code_1');\n\t\tconsole.log('Fixing ChatSubscription u._id_1_name_1_t_1_code_1');\n\t},\n});\n","let pageVisitedCollection;\nlet messageCollection;\nlet roomCollection;\n\nconst roomIdByToken = {};\n\nconst batchSize = 5000;\n\nasync function migrateHistory(total, current) {\n\tconsole.log(`Livechat history migration ${ current }/${ total }`);\n\n\tconst items = await pageVisitedCollection.find({}).limit(batchSize).toArray();\n\n\tconst tokens = items.filter((item) => item.token && !roomIdByToken[item.token]).map((item) => item.token);\n\tconst rooms = await roomCollection.find({\n\t\t'v.token': {\n\t\t\t$in: tokens,\n\t\t},\n\t}, {\n\t\tfields: {\n\t\t\t'v.token': 1,\n\t\t},\n\t}).toArray();\n\n\trooms.forEach((room) => {\n\t\troomIdByToken[room.v.token] = room._id;\n\t});\n\n\tconst actions = items.reduce((result, item) => {\n\t\tconst msg = {\n\t\t\tt: 'livechat_navigation_history',\n\t\t\trid: roomIdByToken[item.token] || null, // prevent from being `undefined`\n\t\t\tts: item.ts,\n\t\t\tmsg: `${ item.page.title } - ${ item.page.location.href }`,\n\t\t\tu: {\n\t\t\t\t_id : 'rocket.cat',\n\t\t\t\tusername : 'rocket.cat',\n\t\t\t},\n\t\t\tgroupable : false,\n\t\t\tnavigation : {\n\t\t\t\tpage: item.page,\n\t\t\t\ttoken: item.token,\n\t\t\t},\n\t\t};\n\t\tif (!roomIdByToken[item.token] && item.expireAt) {\n\t\t\tmsg.expireAt = item.expireAt;\n\t\t}\n\t\tresult.insert.push(msg);\n\t\tresult.remove.push(item._id);\n\n\t\treturn result;\n\t}, { insert: [], remove: [] });\n\n\tconst ops = [];\n\n\tif (actions.insert.length > 0) {\n\t\tops.push(messageCollection.insertMany(actions.insert));\n\t}\n\n\tif (actions.remove.length > 0) {\n\t\tops.push(pageVisitedCollection.removeMany({ _id: { $in: actions.remove } }));\n\t}\n\n\tconst batch = Promise.all(ops);\n\tif (actions.remove.length === batchSize) {\n\t\tawait batch;\n\t\treturn migrateHistory(total, current + batchSize);\n\t}\n\n\treturn batch;\n}\n\n\nRocketChat.Migrations.add({\n\tversion: 123,\n\tup() {\n\t\tpageVisitedCollection = RocketChat.models.LivechatPageVisited.model.rawCollection();\n\t\tmessageCollection = RocketChat.models.Messages.model.rawCollection();\n\t\troomCollection = RocketChat.models.Rooms.model.rawCollection();\n\n\t\t/*\n\t\t * Move visitor navigation history to messages\n\t\t */\n\t\tMeteor.setTimeout(async() => {\n\t\t\tconst pages = pageVisitedCollection.find({});\n\t\t\tconst total = await pages.count();\n\t\t\tawait pages.close();\n\n\t\t\tconsole.log('Migrating livechat visitors navigation history to livechat messages. This might take a long time ...');\n\n\t\t\tawait migrateHistory(total, 0);\n\n\t\t\tconsole.log('Livechat visitors navigation history migration finished.');\n\t\t}, 1000);\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 124,\n\tup() {\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.mergeChannels': true,\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'settings.preferences.mergeChannels': 1,\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'settings.preferences.groupByType': false,\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.mergeChannels': false,\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'settings.preferences.mergeChannels': 1,\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'settings.preferences.groupByType': true,\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 125,\n\tup() {\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.groupByType': { $exists: true },\n\t\t}, {\n\t\t\t$rename: {\n\t\t\t\t'settings.preferences.groupByType': 'settings.preferences.sidebarGroupByType',\n\t\t\t},\n\t\t}, {\n\t\t\tmulti: true,\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 126,\n\tup() {\n\t\tif (!RocketChat.models || !RocketChat.models.Settings) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst query = {\n\t\t\t_id: 'Accounts_Default_User_Preferences_idleTimeoutLimit',\n\t\t};\n\t\tconst setting = RocketChat.models.Settings.findOne(query);\n\n\t\tif (setting) {\n\t\t\tdelete setting._id;\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'Accounts_Default_User_Preferences_idleTimeLimit' }, setting);\n\t\t\tRocketChat.models.Settings.remove(query);\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 127,\n\tup() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\tconst newPermission = RocketChat.models.Permissions.findOne('view-livechat-manager');\n\t\t\tif (newPermission && newPermission.roles.length) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'remove-closed-livechat-rooms' }, { $set: { roles: newPermission.roles } });\n\t\t\t}\n\t\t}\n\t},\n\n\tdown() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Revert permission\n\t\t\tRocketChat.models.Permissions.remove({ _id: 'remove-closed-livechat-rooms' });\n\t\t}\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 128,\n\tup() {\n\t\tconst _id = 'theme-font-body-font-family';\n\t\tconst oldValue = '-apple-system, BlinkMacSystemFont, Roboto, \\'Helvetica Neue\\', Arial, sans-serif, \\'Apple Color Emoji\\', \\'Segoe UI\\', \\'Segoe UI Emoji\\', \\'Segoe UI Symbol\\', \\'Meiryo UI\\'';\n\t\tconst newValue = '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, Oxygen, Ubuntu, Cantarell, \\'Helvetica Neue\\', \\'Apple Color Emoji\\', \\'Segoe UI Emoji\\', \\'Segoe UI Symbol\\', \\'Meiryo UI\\', Arial, sans-serif';\n\n\t\tRocketChat.models.Settings.update({ _id, value: oldValue }, {\n\t\t\t$set: {\n\t\t\t\tvalue: newValue,\n\t\t\t},\n\t\t});\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 129,\n\tup() {\n\t\tRocketChat.models.Users.find({\n\t\t\t$or: [\n\t\t\t\t{ 'settings.preferences.desktopNotifications': { $exists: true, $ne: 'default' } },\n\t\t\t\t{ 'settings.preferences.mobileNotifications': { $exists: true, $ne: 'default' } },\n\t\t\t\t{ 'settings.preferences.emailNotificationMode': { $exists: true, $ne: 'default' } },\n\t\t\t],\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t'settings.preferences.desktopNotifications': 1,\n\t\t\t\t'settings.preferences.mobileNotifications': 1,\n\t\t\t\t'settings.preferences.emailNotificationMode': 1,\n\t\t\t},\n\t\t}).forEach((user) => {\n\t\t\tif (user.settings.preferences.desktopNotifications && user.settings.preferences.desktopNotifications !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\tdesktopPrefOrigin: 'user',\n\t\t\t\t\tdesktopNotifications: null,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tdesktopNotifications: user.settings.preferences.desktopNotifications,\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (user.settings.preferences.mobileNotifications && user.settings.preferences.mobileNotifications !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\tmobilePrefOrigin: 'user',\n\t\t\t\t\tmobilePushNotifications: null,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tmobilePushNotifications: user.settings.preferences.mobileNotifications,\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (user.settings.preferences.emailNotificationMode && user.settings.preferences.emailNotificationMode !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\temailPrefOrigin: 'user',\n\t\t\t\t\temailNotifications: null,\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\temailNotifications: user.settings.preferences.emailNotificationMode === 'disabled' || user.settings.preferences.emailNotificationMode === 'nothing' ? 'nothing' : 'mentions',\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n});\n","import Future from 'fibers/future';\n\nRocketChat.Migrations.add({\n\tversion: 130,\n\tup() {\n\t\tRocketChat.models.Rooms._db.originals.update(\n\t\t\t{\n\t\t\t\tt: { $ne: 'd' },\n\t\t\t},\n\t\t\t{\n\t\t\t\t$unset: { usernames: 1 },\n\t\t\t},\n\t\t\t{\n\t\t\t\tmulti: true,\n\t\t\t}\n\t\t);\n\n\t\tRocketChat.models.Rooms.find(\n\t\t\t{\n\t\t\t\tusersCount: { $exists: false },\n\t\t\t},\n\t\t\t{\n\t\t\t\tfields: {\n\t\t\t\t\t_id: 1,\n\t\t\t\t},\n\t\t\t}\n\t\t).forEach(({ _id }) => {\n\t\t\tconst usersCount = RocketChat.models.Subscriptions.findByRoomId(\n\t\t\t\t_id\n\t\t\t).count();\n\n\t\t\tRocketChat.models.Rooms._db.originals.update(\n\t\t\t\t{\n\t\t\t\t\t_id,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tusersCount,\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\n\t\t// Getting all subscriptions and users to memory allow us to process in batches,\n\t\t// all other solutions takes hundreds or thousands times more to process.\n\t\tconst subscriptions = RocketChat.models.Subscriptions.find(\n\t\t\t{\n\t\t\t\tt: 'd',\n\t\t\t\tname: { $exists: true },\n\t\t\t\tfname: { $exists: false },\n\t\t\t},\n\t\t\t{\n\t\t\t\tfields: {\n\t\t\t\t\tname: 1,\n\t\t\t\t},\n\t\t\t}\n\t\t).fetch();\n\n\t\tconst users = RocketChat.models.Users.find(\n\t\t\t{ username: { $exists: true }, name: { $exists: true } },\n\t\t\t{ fields: { username: 1, name: 1 } }\n\t\t).fetch();\n\t\tconst usersByUsername = users.reduce((obj, user) => {\n\t\t\tobj[user.username] = user.name;\n\t\t\treturn obj;\n\t\t}, {});\n\n\t\tconst updateSubscription = (subscription) => new Promise((resolve) => {\n\t\t\tMeteor.defer(() => {\n\t\t\t\tconst name = usersByUsername[subscription.name];\n\n\t\t\t\tif (!name) {\n\t\t\t\t\treturn resolve();\n\t\t\t\t}\n\n\t\t\t\tRocketChat.models.Subscriptions._db.originals.update(\n\t\t\t\t\t{\n\t\t\t\t\t\t_id: subscription._id,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\tfname: name,\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\n\t\t// Use FUTURE to process itens in batchs and wait the final one\n\t\tconst fut = new Future();\n\n\t\tconst processBatch = () => {\n\t\t\tconst itens = subscriptions.splice(0, 1000);\n\n\t\t\tconsole.log(\n\t\t\t\t'Migrating',\n\t\t\t\titens.length,\n\t\t\t\t'of',\n\t\t\t\tsubscriptions.length,\n\t\t\t\t'subscriptions'\n\t\t\t);\n\n\t\t\tif (itens.length) {\n\t\t\t\tPromise.all(itens.map((s) => updateSubscription(s))).then(() => {\n\t\t\t\t\tprocessBatch();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tfut.return();\n\t\t\t}\n\t\t};\n\n\t\tprocessBatch();\n\n\t\tfut.wait();\n\t},\n});\n","RocketChat.Migrations.add({\n\tversion: 131,\n\tup() {\n\t\tconst userOptions = {\n\t\t\tfields: {\n\t\t\t\t_id : 1,\n\t\t\t},\n\t\t};\n\n\t\tconst users = RocketChat.models.Users.model.find({}, userOptions).fetch();\n\t\tconst userIds = users.map((user) => user._id);\n\n\t\tconst subscriptionQuery = {\n\t\t\t'u._id' : {\n\t\t\t\t$nin : userIds,\n\t\t\t},\n\t\t};\n\n\t\tconst subscriptionOptions = {\n\t\t\tfields : {\n\t\t\t\t_id : 1,\n\t\t\t\trid : 1,\n\t\t\t\t'u._id' : 1,\n\t\t\t},\n\t\t};\n\n\t\tconst subscriptions = RocketChat.models.Subscriptions.find(subscriptionQuery, subscriptionOptions);\n\n\t\tsubscriptions.forEach((subscription) => {\n\t\t\tconst room = RocketChat.models.Rooms.findOneById(subscription.rid);\n\t\t\tif (room) {\n\t\t\t\t// Remove direct messages and also non-channel rooms with only 1 user (the one being deleted)\n\t\t\t\tif (room.t === 'd' || (room.t !== 'c' && RocketChat.models.Subscriptions.findByRoomId(room._id).count() === 1)) {\n\t\t\t\t\tRocketChat.models.Subscriptions.removeByRoomId(subscription.rid);\n\t\t\t\t\tRocketChat.models.Messages.removeFilesByRoomId(subscription.rid);\n\t\t\t\t\tRocketChat.models.Messages.removeByRoomId(subscription.rid);\n\t\t\t\t\tRocketChat.models.Rooms.removeById(subscription.rid);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tRocketChat.models.Subscriptions.model.remove({ _id: subscription._id.toString() });\n\t\t});\n\t},\n});\n","import _ from 'underscore';\n\nif (RocketChat.Migrations.getVersion() !== 0) {\n\tRocketChat.Migrations.migrateTo(process.env.MIGRATION_VERSION || 'latest');\n} else {\n\tconst control = RocketChat.Migrations._getControl();\n\tcontrol.version = _.last(RocketChat.Migrations._list).version;\n\tRocketChat.Migrations._setControl(control);\n}\n","if (Meteor.AppCache) {\n\tMeteor.AppCache.config({\n\t\tonlineOnly: ['/elements/', '/landing/', '/moment-locales/', '/scripts/'],\n\t});\n}\n","/* globals FileUpload */\nimport _ from 'underscore';\nimport sharp from 'sharp';\nimport { Cookies } from 'meteor/ostrio:cookies';\n\nconst cookie = new Cookies();\n\nfunction isUserAuthenticated(req) {\n\tconst headers = req.headers || {};\n\tconst query = req.query || {};\n\n\tlet { rc_uid, rc_token } = query;\n\n\tif (!rc_uid && headers.cookie) {\n\t\trc_uid = cookie.get('rc_uid', headers.cookie) ;\n\t\trc_token = cookie.get('rc_token', headers.cookie);\n\t}\n\n\tif (!rc_uid || !rc_token || !RocketChat.models.Users.findOneByIdAndLoginToken(rc_uid, rc_token)) {\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nconst warnUnauthenticatedAccess = _.debounce(() => {\n\tconsole.warn('The server detected an unauthenticated access to an user avatar. This type of request will soon be blocked by default.');\n}, 60000 * 30); // 30 minutes\n\nfunction userCanAccessAvatar(req) {\n\tif (RocketChat.settings.get('Accounts_AvatarBlockUnauthenticatedAccess') === true) {\n\t\treturn isUserAuthenticated(req);\n\t}\n\n\tif (!isUserAuthenticated(req)) {\n\t\twarnUnauthenticatedAccess();\n\t}\n\n\treturn true;\n}\n\nMeteor.startup(function() {\n\tWebApp.connectHandlers.use('/avatar/', Meteor.bindEnvironment(function(req, res/* , next*/) {\n\t\tconst params = {\n\t\t\tusername: decodeURIComponent(req.url.replace(/^\\//, '').replace(/\\?.*$/, '')),\n\t\t};\n\t\tconst cacheTime = req.query.cacheTime || RocketChat.settings.get('Accounts_AvatarCacheTime');\n\n\t\tif (_.isEmpty(params.username) || !userCanAccessAvatar(req)) {\n\t\t\tres.writeHead(403);\n\t\t\tres.write('Forbidden');\n\t\t\tres.end();\n\t\t\treturn;\n\t\t}\n\n\t\tconst match = /^\\/([^?]*)/.exec(req.url);\n\n\t\tif (match[1]) {\n\t\t\tlet username = decodeURIComponent(match[1]);\n\t\t\tlet file;\n\n\t\t\tusername = username.replace(/\\.jpg$/, '');\n\n\t\t\tif (username[0] !== '@') {\n\t\t\t\tif (Meteor.settings && Meteor.settings.public && Meteor.settings.public.sandstorm) {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneByUsername(username);\n\t\t\t\t\tif (user && user.services && user.services.sandstorm && user.services.sandstorm.picture) {\n\t\t\t\t\t\tres.setHeader('Location', user.services.sandstorm.picture);\n\t\t\t\t\t\tres.writeHead(302);\n\t\t\t\t\t\tres.end();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfile = RocketChat.models.Avatars.findOneByName(username);\n\t\t\t}\n\n\t\t\tif (file) {\n\t\t\t\tres.setHeader('Content-Security-Policy', 'default-src \\'none\\'');\n\n\t\t\t\tconst reqModifiedHeader = req.headers['if-modified-since'];\n\t\t\t\tif (reqModifiedHeader && reqModifiedHeader === (file.uploadedAt && file.uploadedAt.toUTCString())) {\n\t\t\t\t\tres.setHeader('Last-Modified', reqModifiedHeader);\n\t\t\t\t\tres.writeHead(304);\n\t\t\t\t\tres.end();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tres.setHeader('Cache-Control', `public, max-age=${ cacheTime }`);\n\t\t\t\tres.setHeader('Expires', '-1');\n\t\t\t\tres.setHeader('Content-Disposition', 'inline');\n\t\t\t\tres.setHeader('Last-Modified', file.uploadedAt.toUTCString());\n\t\t\t\tres.setHeader('Content-Type', file.type);\n\t\t\t\tres.setHeader('Content-Length', file.size);\n\n\t\t\t\treturn FileUpload.get(file, req, res);\n\t\t\t} else {\n\t\t\t\tres.setHeader('Content-Type', 'image/svg+xml');\n\t\t\t\tres.setHeader('Cache-Control', `public, max-age=${ cacheTime }`);\n\t\t\t\tres.setHeader('Expires', '-1');\n\t\t\t\tres.setHeader('Last-Modified', 'Thu, 01 Jan 2015 00:00:00 GMT');\n\n\t\t\t\tconst reqModifiedHeader = req.headers['if-modified-since'];\n\n\t\t\t\tif (reqModifiedHeader) {\n\t\t\t\t\tif (reqModifiedHeader === 'Thu, 01 Jan 2015 00:00:00 GMT') {\n\t\t\t\t\t\tres.writeHead(304);\n\t\t\t\t\t\tres.end();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (RocketChat.settings.get('UI_Use_Name_Avatar')) {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneByUsername(username, {\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tname: 1,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tif (user && user.name) {\n\t\t\t\t\t\tusername = user.name;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet color = '';\n\t\t\t\tlet initials = '';\n\n\t\t\t\tif (username === '?') {\n\t\t\t\t\tcolor = '#000';\n\t\t\t\t\tinitials = username;\n\t\t\t\t} else {\n\t\t\t\t\tcolor = RocketChat.getAvatarColor(username);\n\n\t\t\t\t\tinitials = username.replace(/[^A-Za-z0-9]/g, '').substr(0, 1).toUpperCase();\n\t\t\t\t}\n\n\t\t\t\tconst viewSize = parseInt(req.query.size) || 200;\n\t\t\t\tconst fontSize = viewSize / 1.6;\n\n\t\t\t\tconst svg = `<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 ${ viewSize } ${ viewSize }\\\">\\n<rect width=\\\"100%\\\" height=\\\"100%\\\" fill=\\\"${ color }\\\"/>\\n<text x=\\\"50%\\\" y=\\\"50%\\\" dy=\\\"0.36em\\\" text-anchor=\\\"middle\\\" pointer-events=\\\"none\\\" fill=\\\"#ffffff\\\" font-family=\\\"Helvetica, Arial, Lucida Grande, sans-serif\\\" font-size=\"${ fontSize }\">\\n${ initials }\\n</text>\\n</svg>`;\n\n\t\t\t\tif (['png', 'jpg', 'jpeg'].includes(req.query.format)) {\n\t\t\t\t\tres.setHeader('Content-Type', `image/${ req.query.format }`);\n\t\t\t\t\tsharp(new Buffer(svg))\n\t\t\t\t\t\t.toFormat(req.query.format)\n\t\t\t\t\t\t.pipe(res);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tres.write(svg);\n\t\t\t\tres.end();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tres.writeHead(404);\n\t\tres.end();\n\t\treturn;\n\t}));\n});\n","/* global SyncedCron */\n\nconst logger = new Logger('SyncedCron');\n\nSyncedCron.config({\n\tlogger(opts) {\n\t\treturn logger[opts.level].call(logger, opts.message);\n\t},\n\tcollectionName: 'rocketchat_cron_history',\n});\n\nfunction generateStatistics() {\n\tconst statistics = RocketChat.statistics.save();\n\n\tstatistics.host = Meteor.absoluteUrl();\n\n\tif (RocketChat.settings.get('Statistics_reporting')) {\n\t\ttry {\n\t\t\tHTTP.post('https://collector.rocket.chat/', {\n\t\t\t\tdata: statistics,\n\t\t\t});\n\t\t} catch (error) {\n\t\t\t/* error*/\n\t\t\tlogger.warn('Failed to send usage report');\n\t\t}\n\t}\n}\n\nfunction cleanupOEmbedCache() {\n\treturn Meteor.call('OEmbedCacheCleanup');\n}\n\nMeteor.startup(function() {\n\treturn Meteor.defer(function() {\n\t\tgenerateStatistics();\n\n\t\tSyncedCron.add({\n\t\t\tname: 'Generate and save statistics',\n\t\t\tschedule(parser) {\n\t\t\t\treturn parser.cron(`${ new Date().getMinutes() } * * * *`);\n\t\t\t},\n\t\t\tjob: generateStatistics,\n\t\t});\n\n\t\tSyncedCron.add({\n\t\t\tname: 'Cleanup OEmbed cache',\n\t\t\tschedule(parser) {\n\t\t\t\tconst now = new Date();\n\t\t\t\treturn parser.cron(`${ now.getMinutes() } ${ now.getHours() } * * *`);\n\t\t\t},\n\t\t\tjob: cleanupOEmbedCache,\n\t\t});\n\n\t\treturn SyncedCron.start();\n\t});\n});\n","import _ from 'underscore';\nimport s from 'underscore.string';\n\nfunction flat(obj, newObj = {}, path = '') {\n\tfor (const key of Object.keys(obj)) {\n\t\tconst value = obj[key];\n\n\t\tif (_.isObject(value)) {\n\t\t\tflat(value, newObj, `${ key }.`);\n\t\t} else {\n\t\t\tnewObj[path + key] = value;\n\t\t}\n\t}\n\n\treturn newObj;\n}\n\nRocketChat.i18nValidation = function i18nValidation() {\n\tconst l = {};\n\tconst keys = {};\n\tconst errors = [];\n\tconst langs = Object.keys(TAPi18next.options.resStore);\n\n\tfor (const lang of Object.keys(TAPi18next.options.resStore)) {\n\t\tconst value = TAPi18next.options.resStore[lang];\n\n\t\tl[lang] = flat(value);\n\n\t\tfor (const key of Object.keys(l[lang])) {\n\t\t\tif (keys[key] == null) {\n\t\t\t\tkeys[key] = [];\n\t\t\t}\n\t\t\tkeys[key].push(lang);\n\t\t}\n\t}\n\n\tlet len = 0;\n\tfor (const key of Object.keys(keys)) {\n\t\tconst present = keys[key];\n\n\t\tif (!(present.length !== langs.length)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst error = (`${ _.difference(langs, present).join(',') }: missing translation for `).red + key.white + (`. Present in [${ present.join(',') }]`).red;\n\n\t\terrors.push(error);\n\n\t\tif (error.length > len) {\n\t\t\tlen = error.length;\n\t\t}\n\t}\n\n\tif (errors.length > 0) {\n\t\tconsole.log('+'.red + s.rpad('', len - 28, '-').red + '+'.red);\n\n\t\tfor (const error of errors) {\n\t\t\tconsole.log('|'.red, s.rpad(`${ error }`, len).red, '|'.red);\n\t\t}\n\n\t\treturn console.log('+'.red + s.rpad('', len - 28, '-').red + '+'.red);\n\t}\n};\n\n// Meteor.startup(function() {\n// \tRocketChat.i18nValidation();\n// });\n","import _ from 'underscore';\n\nMeteor.startup(function() {\n\tMeteor.defer(() => {\n\t\tif (!RocketChat.models.Rooms.findOneById('GENERAL')) {\n\t\t\tRocketChat.models.Rooms.createWithIdTypeAndName('GENERAL', 'c', 'general', {\n\t\t\t\tdefault: true,\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.models.Users.findOneById('rocket.cat')) {\n\t\t\tRocketChat.models.Users.create({\n\t\t\t\t_id: 'rocket.cat',\n\t\t\t\tname: 'Rocket.Cat',\n\t\t\t\tusername: 'rocket.cat',\n\t\t\t\tstatus: 'online',\n\t\t\t\tstatusDefault: 'online',\n\t\t\t\tutcOffset: 0,\n\t\t\t\tactive: true,\n\t\t\t\ttype: 'bot',\n\t\t\t});\n\n\t\t\tRocketChat.authz.addUserRoles('rocket.cat', 'bot');\n\n\t\t\tconst rs = RocketChatFile.bufferToStream(new Buffer(Assets.getBinary('avatars/rocketcat.png'), 'utf8'));\n\t\t\tconst fileStore = FileUpload.getStore('Avatars');\n\t\t\tfileStore.deleteByName('rocket.cat');\n\n\t\t\tconst file = {\n\t\t\t\tuserId: 'rocket.cat',\n\t\t\t\ttype: 'image/png',\n\t\t\t};\n\n\t\t\tMeteor.runAsUser('rocket.cat', () => {\n\t\t\t\tfileStore.insert(file, rs, () => RocketChat.models.Users.setAvatarOrigin('rocket.cat', 'local'));\n\t\t\t});\n\t\t}\n\n\t\tif (process.env.ADMIN_PASS) {\n\t\t\tif (_.isEmpty(RocketChat.authz.getUsersInRole('admin').fetch())) {\n\t\t\t\tconsole.log('Inserting admin user:'.green);\n\t\t\t\tconst adminUser = {\n\t\t\t\t\tname: 'Administrator',\n\t\t\t\t\tusername: 'admin',\n\t\t\t\t\tstatus: 'offline',\n\t\t\t\t\tstatusDefault: 'online',\n\t\t\t\t\tutcOffset: 0,\n\t\t\t\t\tactive: true,\n\t\t\t\t};\n\n\t\t\t\tif (process.env.ADMIN_NAME) {\n\t\t\t\t\tadminUser.name = process.env.ADMIN_NAME;\n\t\t\t\t}\n\n\t\t\t\tconsole.log((`Name: ${ adminUser.name }`).green);\n\n\t\t\t\tif (process.env.ADMIN_EMAIL) {\n\t\t\t\t\tconst re = /^[^@].*@[^@]+$/i;\n\n\t\t\t\t\tif (re.test(process.env.ADMIN_EMAIL)) {\n\t\t\t\t\t\tif (!RocketChat.models.Users.findOneByEmailAddress(process.env.ADMIN_EMAIL)) {\n\t\t\t\t\t\t\tadminUser.emails = [{\n\t\t\t\t\t\t\t\taddress: process.env.ADMIN_EMAIL,\n\t\t\t\t\t\t\t\tverified: true,\n\t\t\t\t\t\t\t}];\n\n\t\t\t\t\t\t\tconsole.log((`Email: ${ process.env.ADMIN_EMAIL }`).green);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Email provided already exists; Ignoring environment variables ADMIN_EMAIL'.red);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('Email provided is invalid; Ignoring environment variables ADMIN_EMAIL'.red);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (process.env.ADMIN_USERNAME) {\n\t\t\t\t\tlet nameValidation;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tnameValidation = new RegExp(`^${ RocketChat.settings.get('UTF8_Names_Validation') }$`);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tnameValidation = new RegExp('^[0-9a-zA-Z-_.]+$');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (nameValidation.test(process.env.ADMIN_USERNAME)) {\n\t\t\t\t\t\tif (RocketChat.checkUsernameAvailability(process.env.ADMIN_USERNAME)) {\n\t\t\t\t\t\t\tadminUser.username = process.env.ADMIN_USERNAME;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Username provided already exists; Ignoring environment variables ADMIN_USERNAME'.red);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('Username provided is invalid; Ignoring environment variables ADMIN_USERNAME'.red);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconsole.log((`Username: ${ adminUser.username }`).green);\n\n\t\t\t\tadminUser.type = 'user';\n\n\t\t\t\tconst id = RocketChat.models.Users.create(adminUser);\n\n\t\t\t\tAccounts.setPassword(id, process.env.ADMIN_PASS);\n\n\t\t\t\tconsole.log((`Password: ${ process.env.ADMIN_PASS }`).green);\n\n\t\t\t\tRocketChat.authz.addUserRoles(id, 'admin');\n\t\t\t} else {\n\t\t\t\tconsole.log('Users with admin role already exist; Ignoring environment variables ADMIN_PASS'.red);\n\t\t\t}\n\t\t}\n\n\t\tif (typeof process.env.INITIAL_USER === 'string' && process.env.INITIAL_USER.length > 0) {\n\t\t\ttry {\n\t\t\t\tconst initialUser = JSON.parse(process.env.INITIAL_USER);\n\n\t\t\t\tif (!initialUser._id) {\n\t\t\t\t\tconsole.log('No _id provided; Ignoring environment variable INITIAL_USER'.red);\n\t\t\t\t} else if (!RocketChat.models.Users.findOneById(initialUser._id)) {\n\t\t\t\t\tconsole.log('Inserting initial user:'.green);\n\t\t\t\t\tconsole.log(JSON.stringify(initialUser, null, 2).green);\n\t\t\t\t\tRocketChat.models.Users.create(initialUser);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('Error processing environment variable INITIAL_USER'.red, e);\n\t\t\t}\n\t\t}\n\n\t\tif (_.isEmpty(RocketChat.authz.getUsersInRole('admin').fetch())) {\n\t\t\tconst oldestUser = RocketChat.models.Users.findOne({\n\t\t\t\t_id: {\n\t\t\t\t\t$ne: 'rocket.cat',\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1,\n\t\t\t\t},\n\t\t\t\tsort: {\n\t\t\t\t\tcreatedAt: 1,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (oldestUser) {\n\t\t\t\tRocketChat.authz.addUserRoles(oldestUser._id, 'admin');\n\t\t\t\tconsole.log(`No admins are found. Set ${ oldestUser.username || oldestUser.name } as admin for being the oldest user`);\n\t\t\t}\n\t\t}\n\n\t\tif (!_.isEmpty(RocketChat.authz.getUsersInRole('admin').fetch())) {\n\t\t\tif (RocketChat.settings.get('Show_Setup_Wizard') === 'pending') {\n\t\t\t\tconsole.log('Setting Setup Wizard to \"in_progress\" because, at least, one admin was found');\n\t\t\t\tRocketChat.models.Settings.updateValueById('Show_Setup_Wizard', 'in_progress');\n\t\t\t}\n\t\t}\n\n\t\tRocketChat.models.Users.removeById('rocketchat.internal.admin.test');\n\n\t\tif (process.env.TEST_MODE === 'true') {\n\t\t\tconsole.log('Inserting admin test user:'.green);\n\n\t\t\tconst adminUser = {\n\t\t\t\t_id: 'rocketchat.internal.admin.test',\n\t\t\t\tname: 'RocketChat Internal Admin Test',\n\t\t\t\tusername: 'rocketchat.internal.admin.test',\n\t\t\t\temails: [\n\t\t\t\t\t{\n\t\t\t\t\t\taddress: 'rocketchat.internal.admin.test@rocket.chat',\n\t\t\t\t\t\tverified: true,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tstatus: 'offline',\n\t\t\t\tstatusDefault: 'online',\n\t\t\t\tutcOffset: 0,\n\t\t\t\tactive: true,\n\t\t\t\ttype: 'user',\n\t\t\t};\n\n\t\t\tconsole.log((`Name: ${ adminUser.name }`).green);\n\t\t\tconsole.log((`Email: ${ adminUser.emails[0].address }`).green);\n\t\t\tconsole.log((`Username: ${ adminUser.username }`).green);\n\t\t\tconsole.log((`Password: ${ adminUser._id }`).green);\n\n\t\t\tif (RocketChat.models.Users.findOneByEmailAddress(adminUser.emails[0].address)) {\n\t\t\t\tthrow new Meteor.Error(`Email ${ adminUser.emails[0].address } already exists`, 'Rocket.Chat can\\'t run in test mode');\n\t\t\t}\n\n\t\t\tif (!RocketChat.checkUsernameAvailability(adminUser.username)) {\n\t\t\t\tthrow new Meteor.Error(`Username ${ adminUser.username } already exists`, 'Rocket.Chat can\\'t run in test mode');\n\t\t\t}\n\n\t\t\tRocketChat.models.Users.create(adminUser);\n\n\t\t\tAccounts.setPassword(adminUser._id, adminUser._id);\n\n\t\t\tRocketChat.authz.addUserRoles(adminUser._id, 'admin');\n\n\t\t\tif (RocketChat.settings.get('Show_Setup_Wizard') === 'pending') {\n\t\t\t\tRocketChat.models.Settings.updateValueById('Show_Setup_Wizard', 'in_progress');\n\t\t\t}\n\n\t\t\treturn RocketChat.addUserToDefaultChannels(adminUser, true);\n\t\t}\n\t});\n});\n","/* globals InstanceStatus, UserPresence, UserPresenceMonitor */\n\nMeteor.startup(function() {\n\tconst instance = {\n\t\thost: 'localhost',\n\t\tport: String(process.env.PORT).trim(),\n\t};\n\n\tif (process.env.INSTANCE_IP) {\n\t\tinstance.host = String(process.env.INSTANCE_IP).trim();\n\t}\n\n\tInstanceStatus.registerInstance('rocket.chat', instance);\n\n\tUserPresence.start();\n\n\treturn UserPresenceMonitor.start();\n});\n","/* globals MongoInternals, SystemLogger */\n\nimport fs from 'fs';\nimport path from 'path';\nimport semver from 'semver';\n\nMeteor.startup(function() {\n\tlet oplogState = 'Disabled';\n\tif (MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle && MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle.onOplogEntry) {\n\t\toplogState = 'Enabled';\n\t\tif (RocketChat.settings.get('Force_Disable_OpLog_For_Cache') === true) {\n\t\t\toplogState += ' (Disabled for Cache Sync)';\n\t\t}\n\t}\n\n\tconst desiredNodeVersion = semver.clean(fs.readFileSync(path.join(process.cwd(), '../../.node_version.txt')).toString());\n\tconst desiredNodeVersionMajor = String(semver.parse(desiredNodeVersion).major);\n\n\treturn Meteor.setTimeout(function() {\n\t\tlet msg = [\n\t\t\t`Rocket.Chat Version: ${ RocketChat.Info.version }`,\n\t\t\t`     NodeJS Version: ${ process.versions.node } - ${ process.arch }`,\n\t\t\t`           Platform: ${ process.platform }`,\n\t\t\t`       Process Port: ${ process.env.PORT }`,\n\t\t\t`           Site URL: ${ RocketChat.settings.get('Site_Url') }`,\n\t\t\t`   ReplicaSet OpLog: ${ oplogState }`,\n\t\t];\n\n\t\tif (RocketChat.Info.commit && RocketChat.Info.commit.hash) {\n\t\t\tmsg.push(`        Commit Hash: ${ RocketChat.Info.commit.hash.substr(0, 10) }`);\n\t\t}\n\n\t\tif (RocketChat.Info.commit && RocketChat.Info.commit.branch) {\n\t\t\tmsg.push(`      Commit Branch: ${ RocketChat.Info.commit.branch }`);\n\t\t}\n\n\t\tmsg = msg.join('\\n');\n\n\t\tif (semver.satisfies(process.versions.node, desiredNodeVersionMajor)) {\n\t\t\treturn SystemLogger.startup_box(msg, 'SERVER RUNNING');\n\t\t}\n\n\t\tmsg += ['', '', 'YOUR CURRENT NODEJS VERSION IS NOT SUPPORTED,', `PLEASE UPGRADE / DOWNGRADE TO VERSION ${ desiredNodeVersionMajor }.X.X`].join('\\n');\n\n\t\tSystemLogger.error_box(msg, 'SERVER ERROR');\n\n\t\treturn process.exit();\n\t}, 100);\n});\n","import _ from 'underscore';\n\nconst orig_updateOrCreateUserFromExternalService = Accounts.updateOrCreateUserFromExternalService;\n\nAccounts.updateOrCreateUserFromExternalService = function(serviceName, serviceData = {}, ...args /* , options*/) {\n\tconst services = [\n\t\t'facebook',\n\t\t'github',\n\t\t'gitlab',\n\t\t'google',\n\t\t'meteor-developer',\n\t\t'linkedin',\n\t\t'twitter',\n\t\t'sandstorm',\n\t];\n\n\tif (services.includes(serviceName) === false && serviceData._OAuthCustom !== true) {\n\t\treturn;\n\t}\n\n\tif (serviceName === 'meteor-developer') {\n\t\tif (Array.isArray(serviceData.emails)) {\n\t\t\tconst primaryEmail = serviceData.emails.sort((a) => a.primary !== true).filter((item) => item.verified === true)[0];\n\t\t\tserviceData.email = primaryEmail && primaryEmail.address;\n\t\t}\n\t}\n\n\tif (serviceName === 'linkedin') {\n\t\tserviceData.email = serviceData.emailAddress;\n\t}\n\n\tif (serviceData.email) {\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(serviceData.email);\n\t\tif (user != null) {\n\t\t\tconst findQuery = {\n\t\t\t\taddress: serviceData.email,\n\t\t\t\tverified: true,\n\t\t\t};\n\n\t\t\tif (!_.findWhere(user.emails, findQuery)) {\n\t\t\t\tRocketChat.models.Users.resetPasswordAndSetRequirePasswordChange(user._id, true, 'This_email_has_already_been_used_and_has_not_been_verified__Please_change_your_password');\n\t\t\t}\n\n\t\t\tRocketChat.models.Users.setServiceId(user._id, serviceName, serviceData.id);\n\t\t\tRocketChat.models.Users.setEmailVerified(user._id, serviceData.email);\n\t\t}\n\t}\n\n\treturn orig_updateOrCreateUserFromExternalService.apply(this, [serviceName, serviceData, ...args]);\n};\n","Meteor.methods({\n\tOEmbedCacheCleanup() {\n\t\tif (Meteor.userId() && !RocketChat.authz.hasRole(Meteor.userId(), 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'OEmbedCacheCleanup',\n\t\t\t});\n\t\t}\n\n\t\tconst date = new Date();\n\t\tconst expirationDays = RocketChat.settings.get('API_EmbedCacheExpirationDays');\n\t\tdate.setDate(date.getDate() - expirationDays);\n\t\tRocketChat.models.OEmbedCache.removeAfterDate(date);\n\t\treturn {\n\t\t\tmessage: 'cache_cleared',\n\t\t};\n\t},\n});\n","Meteor.methods({\n\taddAllUserToRoom(rid, activeUsersOnly = false) {\n\n\t\tcheck (rid, String);\n\t\tcheck (activeUsersOnly, Boolean);\n\n\t\tif (RocketChat.authz.hasRole(this.userId, 'admin') === true) {\n\t\t\tconst userCount = RocketChat.models.Users.find().count();\n\t\t\tif (userCount > RocketChat.settings.get('API_User_Limit')) {\n\t\t\t\tthrow new Meteor.Error('error-user-limit-exceeded', 'User Limit Exceeded', {\n\t\t\t\t\tmethod: 'addAllToRoom',\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\t\tif (room == null) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\t\tmethod: 'addAllToRoom',\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst userFilter = {};\n\t\t\tif (activeUsersOnly === true) {\n\t\t\t\tuserFilter.active = true;\n\t\t\t}\n\n\t\t\tconst users = RocketChat.models.Users.find(userFilter).fetch();\n\t\t\tconst now = new Date();\n\t\t\tusers.forEach(function(user) {\n\t\t\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\t\t\t\tif (subscription != null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tRocketChat.callbacks.run('beforeJoinRoom', user, room);\n\t\t\t\tRocketChat.models.Subscriptions.createWithRoomAndUser(room, user, {\n\t\t\t\t\tts: now,\n\t\t\t\t\topen: true,\n\t\t\t\t\talert: true,\n\t\t\t\t\tunread: 1,\n\t\t\t\t\tuserMentions: 1,\n\t\t\t\t\tgroupMentions: 0,\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Messages.createUserJoinWithRoomIdAndUser(rid, user, {\n\t\t\t\t\tts: now,\n\t\t\t\t});\n\t\t\t\tMeteor.defer(function() {});\n\t\t\t\treturn RocketChat.callbacks.run('afterJoinRoom', user, room);\n\t\t\t});\n\t\t\treturn true;\n\t\t} else {\n\t\t\tthrow (new Meteor.Error(403, 'Access to Method Forbidden', {\n\t\t\t\tmethod: 'addAllToRoom',\n\t\t\t}));\n\t\t}\n\t},\n});\n","Meteor.methods({\n\taddRoomLeader(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomLeader',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-leader', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomLeader',\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomLeader',\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomLeader',\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('leader') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-leader', 'User is already a leader', {\n\t\t\t\tmethod: 'addRoomLeader',\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'leader');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username,\n\t\t\t},\n\t\t\trole: 'leader',\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'leader',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name,\n\t\t\t\t},\n\t\t\t\tscope: rid,\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t},\n});\n","Meteor.methods({\n\taddRoomModerator(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomModerator',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-moderator', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomModerator',\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomModerator',\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomModerator',\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('moderator') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-moderator', 'User is already a moderator', {\n\t\t\t\tmethod: 'addRoomModerator',\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'moderator');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username,\n\t\t\t},\n\t\t\trole: 'moderator',\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'moderator',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: fromUser.name,\n\t\t\t\t},\n\t\t\t\tscope: rid,\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t},\n});\n","Meteor.methods({\n\taddRoomOwner(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomOwner',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-owner', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomOwner',\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomOwner',\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomOwner',\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('owner') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-owner', 'User is already an owner', {\n\t\t\t\tmethod: 'addRoomOwner',\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'owner');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username,\n\t\t\t},\n\t\t\trole: 'owner',\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'owner',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name,\n\t\t\t\t},\n\t\t\t\tscope: rid,\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t},\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tafterVerifyEmail() {\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'afterVerifyEmail',\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tconst verifiedEmail = _.find(user.emails, (email) => email.verified);\n\n\t\tif (verifiedEmail) {\n\t\t\tRocketChat.models.Roles.addUserRoles(user._id, 'user');\n\t\t\tRocketChat.models.Roles.removeUserRoles(user._id, 'anonymous');\n\t\t}\n\t},\n});\n","import s from 'underscore.string';\n\nconst sortChannels = function(field, direction) {\n\tswitch (field) {\n\t\tcase 'createdAt':\n\t\t\treturn {\n\t\t\t\tts: direction === 'asc' ? 1 : -1,\n\t\t\t};\n\t\tdefault:\n\t\t\treturn {\n\t\t\t\t[field]: direction === 'asc' ? 1 : -1,\n\t\t\t};\n\t}\n};\n\nconst sortUsers = function(field, direction) {\n\tswitch (field) {\n\t\tdefault:\n\t\t\treturn {\n\t\t\t\t[field]: direction === 'asc' ? 1 : -1,\n\t\t\t};\n\t}\n};\n\nMeteor.methods({\n\tbrowseChannels({ text = '', type = 'channels', sortBy = 'name', sortDirection = 'asc', page, offset, limit = 10 }) {\n\t\tconst regex = new RegExp(s.trim(s.escapeRegExp(text)), 'i');\n\n\t\tif (!['channels', 'users'].includes(type)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!['asc', 'desc'].includes(sortDirection)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ((!page && page !== 0) && (!offset && offset !== 0)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!['name', 'createdAt', 'usersCount', ...type === 'channels' ? ['usernames'] : [], ...type === 'users' ? ['username'] : []].includes(sortBy)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst skip = Math.max(0, offset || (page > -1 ? limit * page : 0));\n\n\t\tlimit = limit > 0 ? limit : 10;\n\n\t\tconst options = {\n\t\t\tskip,\n\t\t\tlimit,\n\t\t};\n\n\t\tconst user = Meteor.user();\n\t\tif (type === 'channels') {\n\n\t\t\tconst sort = sortChannels(sortBy, sortDirection);\n\t\t\tif (!RocketChat.authz.hasPermission(user._id, 'view-c-room')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tresults: RocketChat.models.Rooms.findByNameAndType(regex, 'c', {\n\t\t\t\t\t...options,\n\t\t\t\t\tsort,\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tdescription: 1,\n\t\t\t\t\t\ttopic: 1,\n\t\t\t\t\t\tname: 1,\n\t\t\t\t\t\tlastMessage: 1,\n\t\t\t\t\t\tts: 1,\n\t\t\t\t\t\tarchived: 1,\n\t\t\t\t\t\tusersCount: 1,\n\t\t\t\t\t},\n\t\t\t\t}).fetch(),\n\t\t\t\ttotal: RocketChat.models.Rooms.findByNameAndType(regex, 'c').count(),\n\t\t\t};\n\t\t}\n\n\t\t// type === users\n\t\tif (!RocketChat.authz.hasPermission(user._id, 'view-outside-room') || !RocketChat.authz.hasPermission(user._id, 'view-d-room')) {\n\t\t\treturn;\n\t\t}\n\t\tconst sort = sortUsers(sortBy, sortDirection);\n\t\treturn {\n\t\t\tresults: RocketChat.models.Users.findByActiveUsersExcept(text, [user.username], {\n\t\t\t\t...options,\n\t\t\t\tsort,\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1,\n\t\t\t\t\tname: 1,\n\t\t\t\t\tcreatedAt: 1,\n\t\t\t\t\temails: 1,\n\t\t\t\t},\n\t\t\t}).fetch(),\n\t\t\ttotal: RocketChat.models.Users.findByActiveUsersExcept(text, [user.username]).count(),\n\t\t};\n\t},\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'browseChannels',\n\tuserId(/* userId*/) {\n\t\treturn true;\n\t},\n}, 100, 100000);\n","Meteor.methods({\n\tcanAccessRoom(rid, userId, extraData) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, Match.Maybe(String));\n\n\t\tlet user;\n\n\t\tif (userId) {\n\t\t\tuser = RocketChat.models.Users.findOneById(userId, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (!user || !user.username) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\t\tmethod: 'canAccessRoom',\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (!rid) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'canAccessRoom',\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\tif (room) {\n\t\t\tif (RocketChat.authz.canAccessRoom.call(this, room, user, extraData)) {\n\t\t\t\tif (user) {\n\t\t\t\t\troom.username = user.username;\n\t\t\t\t}\n\t\t\t\treturn room;\n\t\t\t}\n\n\t\t\tif (!userId && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\t\tmethod: 'canAccessRoom',\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn false;\n\t\t} else {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'canAccessRoom',\n\t\t\t});\n\t\t}\n\t},\n});\n","import _ from 'underscore';\nimport s from 'underscore.string';\n\nMeteor.methods({\n\tchannelsList(filter, channelType, limit, sort) {\n\t\tthis.unblock();\n\n\t\tcheck(filter, String);\n\t\tcheck(channelType, String);\n\t\tcheck(limit, Match.Optional(Number));\n\t\tcheck(sort, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'channelsList',\n\t\t\t});\n\t\t}\n\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1,\n\t\t\t},\n\t\t\tsort: {\n\t\t\t\tmsgs: -1,\n\t\t\t},\n\t\t};\n\n\t\tif (_.isNumber(limit)) {\n\t\t\toptions.limit = limit;\n\t\t}\n\n\t\tif (s.trim(sort)) {\n\t\t\tswitch (sort) {\n\t\t\t\tcase 'name':\n\t\t\t\t\toptions.sort = {\n\t\t\t\t\t\tname: 1,\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'msgs':\n\t\t\t\t\toptions.sort = {\n\t\t\t\t\t\tmsgs: -1,\n\t\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tlet channels = [];\n\n\t\tconst userId = Meteor.userId();\n\n\t\tif (channelType !== 'private') {\n\t\t\tif (RocketChat.authz.hasPermission(userId, 'view-c-room')) {\n\t\t\t\tif (filter) {\n\t\t\t\t\tchannels = channels.concat(RocketChat.models.Rooms.findByType('c', options).fetch());\n\t\t\t\t} else {\n\t\t\t\t\tchannels = channels.concat(RocketChat.models.Rooms.findByTypeAndNameContaining('c', filter, options).fetch());\n\t\t\t\t}\n\t\t\t} else if (RocketChat.authz.hasPermission(userId, 'view-joined-room')) {\n\t\t\t\tconst roomIds = RocketChat.models.Subscriptions.findByTypeAndUserId('c', userId, { fields: { rid: 1 } }).fetch().map((s) => s.rid);\n\t\t\t\tif (filter) {\n\t\t\t\t\tchannels = channels.concat(RocketChat.models.Rooms.findByTypeInIds('c', roomIds, options).fetch());\n\t\t\t\t} else {\n\t\t\t\t\tchannels = channels.concat(RocketChat.models.Rooms.findByTypeInIdsAndNameContaining('c', roomIds, filter, options).fetch());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (channelType !== 'public' && RocketChat.authz.hasPermission(userId, 'view-p-room')) {\n\t\t\tconst user = RocketChat.models.Users.findOne(userId, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1,\n\t\t\t\t\t'settings.preferences.sidebarGroupByType': 1,\n\t\t\t\t},\n\t\t\t});\n\t\t\tconst userPref = RocketChat.getUserPreference(user, 'sidebarGroupByType');\n\t\t\t// needs to negate globalPref because userPref represents its opposite\n\t\t\tconst groupByType = userPref !== undefined ? userPref : RocketChat.settings.get('UI_Group_Channels_By_Type');\n\n\t\t\tif (!groupByType) {\n\t\t\t\tconst roomIds = RocketChat.models.Subscriptions.findByTypeAndUserId('p', userId, { fields: { rid: 1 } }).fetch().map((s) => s.rid);\n\t\t\t\tif (filter) {\n\t\t\t\t\tchannels = channels.concat(RocketChat.models.Rooms.findByTypeInIds('p', roomIds, options).fetch());\n\t\t\t\t} else {\n\t\t\t\t\tchannels = channels.concat(RocketChat.models.Rooms.findByTypeInIdsAndNameContaining('p', roomIds, filter, options).fetch());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tchannels,\n\t\t};\n\t},\n});\n","Meteor.methods({\n\tcreateDirectMessage(username) {\n\t\tcheck(username, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage',\n\t\t\t});\n\t\t}\n\n\t\tconst me = Meteor.user();\n\n\t\tif (!me.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage',\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.settings.get('Message_AllowDirectMessagesToYourself') === false && me.username === username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'create-d')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'createDirectMessage',\n\t\t\t});\n\t\t}\n\n\t\tconst to = RocketChat.models.Users.findOneByUsername(username);\n\n\t\tif (!to) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(to._id, 'view-d-room')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Target user not allowed to receive messages', {\n\t\t\t\tmethod: 'createDirectMessage',\n\t\t\t});\n\t\t}\n\n\t\tconst rid = [me._id, to._id].sort().join('');\n\n\t\tconst now = new Date();\n\n\t\t// Make sure we have a room\n\t\tRocketChat.models.Rooms.upsert({\n\t\t\t_id: rid,\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tusernames: [me.username, to.username],\n\t\t\t},\n\t\t\t$setOnInsert: {\n\t\t\t\tt: 'd',\n\t\t\t\tmsgs: 0,\n\t\t\t\tts: now,\n\t\t\t\tusersCount: 2,\n\t\t\t},\n\t\t});\n\n\t\tconst myNotificationPref = RocketChat.getDefaultSubscriptionPref(me);\n\n\t\t// Make user I have a subcription to this room\n\t\tconst upsertSubscription = {\n\t\t\t$set: {\n\t\t\t\tts: now,\n\t\t\t\tls: now,\n\t\t\t\topen: true,\n\t\t\t},\n\t\t\t$setOnInsert: {\n\t\t\t\tfname: to.name,\n\t\t\t\tname: to.username,\n\t\t\t\tt: 'd',\n\t\t\t\talert: false,\n\t\t\t\tunread: 0,\n\t\t\t\tuserMentions: 0,\n\t\t\t\tgroupMentions: 0,\n\t\t\t\tcustomFields: me.customFields,\n\t\t\t\tu: {\n\t\t\t\t\t_id: me._id,\n\t\t\t\t\tusername: me.username,\n\t\t\t\t},\n\t\t\t\t...myNotificationPref,\n\t\t\t},\n\t\t};\n\n\t\tif (to.active === false) {\n\t\t\tupsertSubscription.$set.archived = true;\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.upsert({\n\t\t\trid,\n\t\t\t$and: [{ 'u._id': me._id }], // work around to solve problems with upsert and dot\n\t\t}, upsertSubscription);\n\n\t\tconst toNotificationPref = RocketChat.getDefaultSubscriptionPref(to);\n\n\t\tRocketChat.models.Subscriptions.upsert({\n\t\t\trid,\n\t\t\t$and: [{ 'u._id': to._id }], // work around to solve problems with upsert and dot\n\t\t}, {\n\t\t\t$setOnInsert: {\n\t\t\t\tfname: me.username,\n\t\t\t\tname: me.username,\n\t\t\t\tt: 'd',\n\t\t\t\topen: false,\n\t\t\t\talert: false,\n\t\t\t\tunread: 0,\n\t\t\t\tuserMentions: 0,\n\t\t\t\tgroupMentions: 0,\n\t\t\t\tcustomFields: to.customFields,\n\t\t\t\tu: {\n\t\t\t\t\t_id: to._id,\n\t\t\t\t\tusername: to.username,\n\t\t\t\t},\n\t\t\t\t...toNotificationPref,\n\t\t\t},\n\t\t});\n\n\t\treturn {\n\t\t\trid,\n\t\t};\n\t},\n});\n\nRocketChat.RateLimiter.limitMethod('createDirectMessage', 10, 60000, {\n\tuserId(userId) {\n\t\treturn !RocketChat.authz.hasPermission(userId, 'send-many-messages');\n\t},\n});\n","/* global FileUpload */\nMeteor.methods({\n\tdeleteFileMessage(fileID) {\n\t\tcheck(fileID, String);\n\n\t\tconst msg = RocketChat.models.Messages.getMessageByFileId(fileID);\n\n\t\tif (msg) {\n\t\t\treturn Meteor.call('deleteMessage', msg);\n\t\t}\n\n\t\treturn FileUpload.getStore('Uploads').deleteById(fileID);\n\t},\n});\n","Meteor.methods({\n\tdeleteUser(userId) {\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'deleteUser',\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'delete-user') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'deleteUser',\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'deleteUser',\n\t\t\t});\n\t\t}\n\n\t\tconst adminCount = Meteor.users.find({ roles: 'admin' }).count();\n\n\t\tconst userIsAdmin = user.roles.indexOf('admin') > -1;\n\n\t\tif (adminCount === 1 && userIsAdmin) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Leaving the app without admins is not allowed', {\n\t\t\t\tmethod: 'deleteUser',\n\t\t\t\taction: 'Remove_last_admin',\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.deleteUser(userId);\n\n\t\treturn true;\n\t},\n});\n","/* globals RocketChat */\n\nMeteor.methods({\n\teraseRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'eraseRoom',\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'eraseRoom',\n\t\t\t});\n\t\t}\n\n\t\tif (Apps && Apps.isLoaded()) {\n\t\t\tconst prevent = Promise.await(Apps.getBridges().getListenerBridge().roomEvent('IPreRoomDeletePrevent', room));\n\t\t\tif (prevent) {\n\t\t\t\tthrow new Meteor.Error('error-app-prevented-deleting', 'A Rocket.Chat App prevented the room erasing.');\n\t\t\t}\n\t\t}\n\n\t\tif (!RocketChat.roomTypes.roomTypes[room.t].canBeDeleted(room)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'eraseRoom',\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Messages.removeFilesByRoomId(rid);\n\t\tRocketChat.models.Messages.removeByRoomId(rid);\n\t\tRocketChat.models.Subscriptions.removeByRoomId(rid);\n\t\tconst result = RocketChat.models.Rooms.removeById(rid);\n\n\t\tif (Apps && Apps.isLoaded()) {\n\t\t\tApps.getBridges().getListenerBridge().roomEvent('IPostRoomDeleted', room);\n\t\t}\n\n\t\treturn result;\n\t},\n});\n","/* global Gravatar */\n\nfunction getAvatarSuggestionForUser(user) {\n\tcheck(user, Object);\n\n\tconst avatars = [];\n\n\tif (user.services.facebook && user.services.facebook.id && RocketChat.settings.get('Accounts_OAuth_Facebook')) {\n\t\tavatars.push({\n\t\t\tservice: 'facebook',\n\t\t\turl: `https://graph.facebook.com/${ user.services.facebook.id }/picture?type=large`,\n\t\t});\n\t}\n\n\tif (user.services.google && user.services.google.picture && user.services.google.picture !== 'https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg' && RocketChat.settings.get('Accounts_OAuth_Google')) {\n\t\tavatars.push({\n\t\t\tservice: 'google',\n\t\t\turl: user.services.google.picture,\n\t\t});\n\t}\n\n\tif (user.services.github && user.services.github.username && RocketChat.settings.get('Accounts_OAuth_Github')) {\n\t\tavatars.push({\n\t\t\tservice: 'github',\n\t\t\turl: `https://avatars.githubusercontent.com/${ user.services.github.username }?s=200`,\n\t\t});\n\t}\n\n\tif (user.services.linkedin && user.services.linkedin.pictureUrl && RocketChat.settings.get('Accounts_OAuth_Linkedin')) {\n\t\tavatars.push({\n\t\t\tservice: 'linkedin',\n\t\t\turl: user.services.linkedin.pictureUrl,\n\t\t});\n\t}\n\n\tif (user.services.twitter && user.services.twitter.profile_image_url_https && RocketChat.settings.get('Accounts_OAuth_Twitter')) {\n\t\tavatars.push({\n\t\t\tservice: 'twitter',\n\t\t\turl: user.services.twitter.profile_image_url_https.replace(/_normal|_bigger/, ''),\n\t\t});\n\t}\n\n\tif (user.services.gitlab && user.services.gitlab.avatar_url && RocketChat.settings.get('Accounts_OAuth_Gitlab')) {\n\t\tavatars.push({\n\t\t\tservice: 'gitlab',\n\t\t\turl: user.services.gitlab.avatar_url,\n\t\t});\n\t}\n\n\tif (user.services.sandstorm && user.services.sandstorm.picture && Meteor.settings.public.sandstorm) {\n\t\tavatars.push({\n\t\t\tservice: 'sandstorm',\n\t\t\turl: user.services.sandstorm.picture,\n\t\t});\n\t}\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tfor (const email of user.emails) {\n\t\t\tif (email.verified === true) {\n\t\t\t\tavatars.push({\n\t\t\t\t\tservice: 'gravatar',\n\t\t\t\t\turl: Gravatar.imageUrl(email.address, {\n\t\t\t\t\t\tdefault: '404',\n\t\t\t\t\t\tsize: 200,\n\t\t\t\t\t\tsecure: true,\n\t\t\t\t\t}),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (email.verified !== true) {\n\t\t\t\tavatars.push({\n\t\t\t\t\tservice: 'gravatar',\n\t\t\t\t\turl: Gravatar.imageUrl(email.address, {\n\t\t\t\t\t\tdefault: '404',\n\t\t\t\t\t\tsize: 200,\n\t\t\t\t\t\tsecure: true,\n\t\t\t\t\t}),\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tconst validAvatars = {};\n\tfor (const avatar of avatars) {\n\t\ttry {\n\t\t\tconst result = HTTP.get(avatar.url, {\n\t\t\t\tnpmRequestOptions: {\n\t\t\t\t\tencoding: 'binary',\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (result.statusCode === 200) {\n\t\t\t\tlet blob = `data:${ result.headers['content-type'] };base64,`;\n\t\t\t\tblob += Buffer.from(result.content, 'binary').toString('base64');\n\t\t\t\tavatar.blob = blob;\n\t\t\t\tavatar.contentType = result.headers['content-type'];\n\t\t\t\tvalidAvatars[avatar.service] = avatar;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t// error;\n\t\t}\n\t}\n\treturn validAvatars;\n}\n\nthis.getAvatarSuggestionForUser = getAvatarSuggestionForUser;\n\nMeteor.methods({\n\tgetAvatarSuggestion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getAvatarSuggestion',\n\t\t\t});\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tconst user = Meteor.user();\n\n\t\treturn getAvatarSuggestionForUser(user);\n\t},\n});\n","// DEPRECATE\nMeteor.methods({\n\tgetRoomIdByNameOrId(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId',\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid) || RocketChat.models.Rooms.findOneByName(rid);\n\n\t\tif (room == null) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.canAccessRoom(room, Meteor.user())) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId',\n\t\t\t});\n\t\t}\n\n\t\treturn room._id;\n\t},\n});\n","Meteor.methods({\n\tgetRoomNameById(rid) {\n\t\tcheck(rid, String);\n\t\tconst userId = Meteor.userId();\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getRoomNameById',\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (room == null) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomNameById',\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, userId, { fields: { _id: 1 } });\n\t\tif (subscription) {\n\t\t\treturn room.name;\n\t\t}\n\n\t\tif (room.t !== 'c' || RocketChat.authz.hasPermission(userId, 'view-c-room') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomNameById',\n\t\t\t});\n\t\t}\n\n\t\treturn room.name;\n\t},\n});\n","Meteor.methods({\n\tgetTotalChannels() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getTotalChannels',\n\t\t\t});\n\t\t}\n\n\t\tconst query = {\n\t\t\tt: 'c',\n\t\t};\n\t\treturn RocketChat.models.Rooms.find(query).count();\n\t},\n});\n","/* global slugify */\nimport _ from 'underscore';\n\nfunction slug(text) {\n\ttext = slugify(text, '.');\n\treturn text.replace(/[^0-9a-z-_.]/g, '');\n}\n\nfunction usernameIsAvaliable(username) {\n\tif (username.length < 1) {\n\t\treturn false;\n\t}\n\n\tif (username === 'all') {\n\t\treturn false;\n\t}\n\n\treturn !RocketChat.models.Users.findOneByUsername(username);\n}\n\nfunction generateSuggestion(user) {\n\tlet usernames = [];\n\tlet username = undefined;\n\n\tif (Meteor.settings.public.sandstorm) {\n\t\tusernames.push(user.services.sandstorm.preferredHandle);\n\t}\n\n\tif (Match.test(user && user.name, String)) {\n\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\tusernames.push(slug(user.name));\n\t\t} else {\n\t\t\tusernames.push(user.name);\n\t\t}\n\n\t\tconst nameParts = user.name.split(' ');\n\n\t\tif (nameParts.length > 1) {\n\t\t\tconst first = nameParts[0];\n\t\t\tconst last = nameParts[nameParts.length - 1];\n\n\t\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\t\tusernames.push(slug(first[0] + last));\n\t\t\t\tusernames.push(slug(first + last[0]));\n\t\t\t} else {\n\t\t\t\tusernames.push(first[0] + last);\n\t\t\t\tusernames.push(first + last[0]);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.profile && user.profile.name) {\n\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\tusernames.push(slug(user.profile.name));\n\t\t} else {\n\t\t\tusernames.push(user.profile.name);\n\t\t}\n\t}\n\n\tif (Array.isArray(user.services)) {\n\t\tlet services = user.services.map((service) => _.values(_.pick(service, 'name', 'username', 'firstName', 'lastName')));\n\n\t\tservices = _.uniq(_.flatten(services));\n\n\t\tfor (const service of services) {\n\t\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\t\tusernames.push(slug(service));\n\t\t\t} else {\n\t\t\t\tusernames.push(service);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tfor (const email of user.emails) {\n\t\t\tif (email.address && email.verified === true) {\n\t\t\t\tusernames.push(slug(email.address.replace(/@.+$/, '')));\n\t\t\t\tusernames.push(slug(email.address.replace(/(.+)@(\\w+).+/, '$1.$2')));\n\t\t\t}\n\t\t}\n\t}\n\n\tusernames = _.compact(usernames);\n\n\tfor (const item of usernames) {\n\t\tif (usernameIsAvaliable(item)) {\n\t\t\treturn item;\n\t\t}\n\t}\n\n\tif (usernames.length === 0 || usernames[0].length === 0) {\n\t\tusernames.push(RocketChat.settings.get('Accounts_DefaultUsernamePrefixSuggestion'));\n\t}\n\n\tlet index = 0;\n\twhile (!username) {\n\t\tindex++;\n\t\tif (usernameIsAvaliable(`${ usernames[0] }-${ index }`)) {\n\t\t\tusername = `${ usernames[0] }-${ index }`;\n\t\t}\n\t}\n\n\tif (usernameIsAvaliable(username)) {\n\t\treturn username;\n\t}\n}\n\nRocketChat.generateUsernameSuggestion = generateSuggestion;\n\nMeteor.methods({\n\tgetUsernameSuggestion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getUsernameSuggestion',\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\treturn generateSuggestion(user);\n\t},\n});\n","Meteor.methods({\n\tgetUsersOfRoom(rid, showAll) {\n\t\tconst userId = Meteor.userId();\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getUsersOfRoom' });\n\t\t}\n\n\t\tconst room = Meteor.call('canAccessRoom', rid, userId);\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'getUsersOfRoom' });\n\t\t}\n\n\t\tif (room.broadcast && !RocketChat.authz.hasPermission(userId, 'view-broadcast-member-list', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'getUsersOfRoom' });\n\t\t}\n\n\t\tconst subscriptions = RocketChat.models.Subscriptions.findByRoomIdWhenUsernameExists(rid, { fields: { 'u._id': 1 } }).fetch();\n\t\tconst userIds = subscriptions.map((s) => s.u._id); // TODO: CACHE: expensive\n\t\tconst options = { fields: { username: 1, name: 1 } };\n\n\t\tconst users = showAll === true\n\t\t\t? RocketChat.models.Users.findUsersWithUsernameByIds(userIds, options).fetch()\n\t\t\t: RocketChat.models.Users.findUsersWithUsernameByIdsNotOffline(userIds, options).fetch();\n\n\t\treturn {\n\t\t\ttotal: userIds.length,\n\t\t\trecords: users,\n\t\t};\n\t},\n});\n","Meteor.methods({\n\thideRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'hideRoom',\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.hideByRoomIdAndUserId(rid, Meteor.userId());\n\t},\n});\n","/* globals RocketChat */\n\nMeteor.methods({\n\tignoreUser({ rid, userId: ignoredUser, ignore = true }) {\n\t\tcheck(ignoredUser, String);\n\t\tcheck(rid, String);\n\t\tcheck(ignore, Boolean);\n\n\t\tconst userId = Meteor.userId();\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'ignoreUser',\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, userId);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-subscription', 'Invalid subscription', { method: 'ignoreUser' });\n\t\t}\n\n\t\tconst subscriptionIgnoredUser = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, ignoredUser);\n\n\t\tif (!subscriptionIgnoredUser) {\n\t\t\tthrow new Meteor.Error('error-invalid-subscription', 'Invalid subscription', { method: 'ignoreUser' });\n\t\t}\n\n\t\treturn !!RocketChat.models.Subscriptions.ignoreUser({ _id: subscription._id, ignoredUser, ignore });\n\t},\n});\n","const hideMessagesOfType = [];\n\nRocketChat.settings.get(/Message_HideType_.+/, function(key, value) {\n\tconst type = key.replace('Message_HideType_', '');\n\tconst types = type === 'mute_unmute' ? ['user-muted', 'user-unmuted'] : [type];\n\n\treturn types.forEach((type) => {\n\t\tconst index = hideMessagesOfType.indexOf(type);\n\n\t\tif (value === true && index === -1) {\n\t\t\treturn hideMessagesOfType.push(type);\n\t\t}\n\n\t\tif (index > -1) {\n\t\t\treturn hideMessagesOfType.splice(index, 1);\n\t\t}\n\t});\n});\n\nMeteor.methods({\n\tloadHistory(rid, end, limit = 20, ls) {\n\t\tthis.unblock();\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId() && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadHistory',\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\t\tconst room = Meteor.call('canAccessRoom', rid, fromId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst canAnonymous = RocketChat.settings.get('Accounts_AllowAnonymousRead');\n\t\tconst canPreview = RocketChat.authz.hasPermission(fromId, 'preview-c-room');\n\n\t\tif (room.t === 'c' && !canAnonymous && !canPreview && !RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, fromId, { fields: { _id: 1 } })) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn RocketChat.loadMessageHistory({ userId: fromId, rid, end, limit, ls });\n\t},\n});\n","Meteor.methods({\n\tloadLocale(locale) {\n\t\tcheck(locale, String);\n\n\t\ttry {\n\t\t\treturn Assets.getText(`moment-locales/${ locale.toLowerCase() }.js`);\n\t\t} catch (error) {\n\t\t\ttry {\n\t\t\t\treturn Assets.getText(`moment-locales/${ locale.split('-').shift().toLowerCase() }.js`);\n\t\t\t} catch (error) {\n\t\t\t\treturn console.log(error);\n\t\t\t}\n\t\t}\n\t},\n});\n","Meteor.methods({\n\tloadMissedMessages(rid, start) {\n\t\tcheck(rid, String);\n\t\tcheck(start, Date);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadMissedMessages',\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1,\n\t\t\t},\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0,\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(rid, start, options).fetch();\n\t},\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tloadNextMessages(rid, end, limit = 20) {\n\t\tcheck(rid, String);\n\t\tcheck(limit, Number);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadNextMessages',\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: 1,\n\t\t\t},\n\t\t\tlimit,\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0,\n\t\t\t};\n\t\t}\n\n\t\tlet records;\n\t\tif (end) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(rid, end, options).fetch();\n\t\t} else {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomId(rid, options).fetch();\n\t\t}\n\n\t\tconst messages = records.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId,\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\treturn {\n\t\t\tmessages,\n\t\t};\n\t},\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tloadSurroundingMessages(message, limit = 50) {\n\t\tcheck(message, Object);\n\t\tcheck(limit, Number);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadSurroundingMessages',\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!message._id) {\n\t\t\treturn false;\n\t\t}\n\n\t\tmessage = RocketChat.models.Messages.findOneById(message._id);\n\n\t\tif (!message || !message.rid) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Meteor.call('canAccessRoom', message.rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlimit = limit - 1;\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1,\n\t\t\t},\n\t\t\tlimit: Math.ceil(limit / 2),\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0,\n\t\t\t};\n\t\t}\n\n\t\tconst recordsBefore = RocketChat.models.Messages.findVisibleByRoomIdBeforeTimestamp(message.rid, message.ts, options).fetch();\n\n\t\tconst messages = recordsBefore.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId,\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\tconst moreBefore = messages.length === options.limit;\n\n\t\tmessages.push(message);\n\n\t\toptions.sort = {\n\t\t\tts: 1,\n\t\t};\n\n\t\toptions.limit = Math.floor(limit / 2);\n\n\t\tconst recordsAfter = RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(message.rid, message.ts, options).fetch();\n\t\tconst afterMessages = recordsAfter.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId,\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\tconst moreAfter = afterMessages.length === options.limit;\n\n\t\treturn {\n\t\t\tmessages: messages.concat(afterMessages),\n\t\t\tmoreBefore,\n\t\t\tmoreAfter,\n\t\t};\n\t},\n});\n","Meteor.methods({\n\tlogoutCleanUp(user) {\n\t\tcheck(user, Object);\n\n\t\tMeteor.defer(function() {\n\t\t\tRocketChat.callbacks.run('afterLogoutCleanUp', user);\n\t\t});\n\t},\n});\n","import s from 'underscore.string';\n\nMeteor.methods({\n\tmessageSearch(text, rid, limit) {\n\t\tcheck(text, String);\n\t\tcheck(rid, Match.Maybe(String));\n\t\tcheck(limit, Match.Optional(Number));\n\n\t\t// TODO: Evaluate why we are returning `users` and `channels`, as the only thing that gets set is the `messages`.\n\t\tconst result = {\n\t\t\tmessage: {\n\t\t\t\tdocs:[],\n\t\t\t},\n\t\t};\n\n\t\tconst currentUserId = Meteor.userId();\n\t\tif (!currentUserId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'messageSearch',\n\t\t\t});\n\t\t}\n\n\t\t// Don't process anything else if the user can't access the room\n\t\tif (rid) {\n\t\t\tif (!Meteor.call('canAccessRoom', rid, currentUserId)) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t} else if (RocketChat.settings.get('Search.defaultProvider.GlobalSearchEnabled') !== true) {\n\t\t\treturn result;\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tconst currentUserName = user.username;\n\t\tconst currentUserTimezoneOffset = user.utcOffset;\n\n\t\tconst query = {};\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1,\n\t\t\t},\n\t\t\tlimit: limit || 20,\n\t\t};\n\n\t\t// I would place these methods at the bottom of the file for clarity but travis doesn't appreciate that.\n\t\t// (no-use-before-define)\n\n\t\tfunction filterStarred() {\n\t\t\tquery['starred._id'] = currentUserId;\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterUrl() {\n\t\t\tquery['urls.0'] = {\n\t\t\t\t$exists: true,\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterPinned() {\n\t\t\tquery.pinned = true;\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterLocation() {\n\t\t\tquery.location = {\n\t\t\t\t$exist: true,\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterBeforeDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tconst beforeDate = new Date(year, month, day);\n\t\t\tbeforeDate.setHours(beforeDate.getUTCHours() + beforeDate.getTimezoneOffset() / 60 + currentUserTimezoneOffset);\n\t\t\tquery.ts = {\n\t\t\t\t$lte: beforeDate,\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterAfterDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tday++;\n\t\t\tconst afterDate = new Date(year, month, day);\n\t\t\tafterDate.setUTCHours(afterDate.getUTCHours() + afterDate.getTimezoneOffset() / 60 + currentUserTimezoneOffset);\n\t\t\tif (query.ts) {\n\t\t\t\tquery.ts.$gte = afterDate;\n\t\t\t} else {\n\t\t\t\tquery.ts = {\n\t\t\t\t\t$gte: afterDate,\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterOnDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tconst date = new Date(year, month, day);\n\t\t\tdate.setUTCHours(date.getUTCHours() + date.getTimezoneOffset() / 60 + currentUserTimezoneOffset);\n\t\t\tconst dayAfter = new Date(date);\n\t\t\tdayAfter.setDate(dayAfter.getDate() + 1);\n\t\t\tdelete query.ts;\n\t\t\tquery.ts = {\n\t\t\t\t$gte: date,\n\t\t\t\t$lt: dayAfter,\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterLabel(_, tag) {\n\t\t\tquery['attachments.0.labels'] = new RegExp(s.escapeRegExp(tag), 'i');\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction sortByTimestamp(_, direction) {\n\t\t\tif (direction.startsWith('asc')) {\n\t\t\t\toptions.sort.ts = 1;\n\t\t\t} else if (direction.startsWith('desc')) {\n\t\t\t\toptions.sort.ts = -1;\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\n\t\t/*\n\t\t text = 'from:rodrigo mention:gabriel chat'\n\t\t */\n\n\t\t// Query for senders\n\t\tconst from = [];\n\t\ttext = text.replace(/from:([a-z0-9.-_]+)/ig, function(match, username) {\n\t\t\tif (username === 'me' && !from.includes(currentUserName)) {\n\t\t\t\tusername = currentUserName;\n\t\t\t}\n\t\t\tfrom.push(username);\n\t\t\treturn '';\n\t\t});\n\n\t\tif (from.length > 0) {\n\t\t\tquery['u.username'] = {\n\t\t\t\t$regex: from.join('|'),\n\t\t\t\t$options: 'i',\n\t\t\t};\n\t\t}\n\n\t\t// Query for senders\n\t\tconst mention = [];\n\t\ttext = text.replace(/mention:([a-z0-9.-_]+)/ig, function(match, username) {\n\t\t\tmention.push(username);\n\t\t\treturn '';\n\t\t});\n\n\t\tif (mention.length > 0) {\n\t\t\tquery['mentions.username'] = {\n\t\t\t\t$regex: mention.join('|'),\n\t\t\t\t$options: 'i',\n\t\t\t};\n\t\t}\n\n\t\t// Filter on messages that are starred by the current user.\n\t\ttext = text.replace(/has:star/g, filterStarred);\n\t\t// Filter on messages that have an url.\n\t\ttext = text.replace(/has:url|has:link/g, filterUrl);\n\t\t// Filter on pinned messages.\n\t\ttext = text.replace(/is:pinned|has:pin/g, filterPinned);\n\t\t// Filter on messages which have a location attached.\n\t\ttext = text.replace(/has:location|has:map/g, filterLocation);\n\t\t// Filter image tags\n\t\ttext = text.replace(/label:(\\w+)/g, filterLabel);\n\t\t// Filtering before/after/on a date\n\t\t// matches dd-MM-yyyy, dd/MM/yyyy, dd-MM-yyyy, prefixed by before:, after: and on: respectively.\n\t\t// Example: before:15/09/2016 after: 10-08-2016\n\t\t// if \"on:\" is set, \"before:\" and \"after:\" are ignored.\n\t\ttext = text.replace(/before:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterBeforeDate);\n\t\ttext = text.replace(/after:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterAfterDate);\n\t\ttext = text.replace(/on:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterOnDate);\n\t\t// Sort order\n\t\ttext = text.replace(/(?:order|sort):(asc|ascend|ascending|desc|descend|descending)/g, sortByTimestamp);\n\n\t\t// Query in message text\n\t\ttext = text.trim().replace(/\\s\\s/g, ' ');\n\t\tif (text !== '') {\n\t\t\tif (/^\\/.+\\/[imxs]*$/.test(text)) {\n\t\t\t\tconst r = text.split('/');\n\t\t\t\tquery.msg = {\n\t\t\t\t\t$regex: r[1],\n\t\t\t\t\t$options: r[2],\n\t\t\t\t};\n\t\t\t} else if (RocketChat.settings.get('Message_AlwaysSearchRegExp')) {\n\t\t\t\tquery.msg = {\n\t\t\t\t\t$regex: text,\n\t\t\t\t\t$options: 'i',\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tquery.$text = {\n\t\t\t\t\t$search: text,\n\t\t\t\t};\n\t\t\t\toptions.fields = {\n\t\t\t\t\tscore: {\n\t\t\t\t\t\t$meta: 'textScore',\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (Object.keys(query).length > 0) {\n\t\t\tquery.t = {\n\t\t\t\t$ne: 'rm', // hide removed messages (useful when searching for user messages)\n\t\t\t};\n\t\t\tquery._hidden = {\n\t\t\t\t$ne: true, // don't return _hidden messages\n\t\t\t};\n\n\t\t\tif (rid) {\n\t\t\t\tquery.rid = rid;\n\t\t\t} else {\n\t\t\t\tquery.rid = {\n\t\t\t\t\t$in: RocketChat.models.Subscriptions.findByUserId(user._id)\n\t\t\t\t\t\t.fetch()\n\t\t\t\t\t\t.map((subscription) => subscription.rid),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\t\toptions.fields = {\n\t\t\t\t\teditedAt: 0,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tresult.message.docs = RocketChat.models.Messages.find(query, options).fetch();\n\t\t}\n\n\t\treturn result;\n\t},\n});\n","Meteor.methods({\n\tmigrateTo(version) {\n\t\tcheck(version, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'migrateTo',\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\tif (!user || RocketChat.authz.hasPermission(user._id, 'run-migration') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'migrateTo',\n\t\t\t});\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tRocketChat.Migrations.migrateTo(version);\n\n\t\treturn version;\n\t},\n\n\tgetMigrationVersion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getMigrationVersion',\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.Migrations.getVersion();\n\t},\n});\n","Meteor.methods({\n\tmuteUserInRoom(data) {\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String,\n\t\t}));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'muteUserInRoom',\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'mute-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'muteUserInRoom',\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'muteUserInRoom',\n\t\t\t});\n\t\t}\n\n\t\tif (['c', 'p'].includes(room.t) === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-room-type', `${ room.t } is not a valid room type`, {\n\t\t\t\tmethod: 'muteUserInRoom',\n\t\t\t\ttype: room.t,\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUsername(data.rid, data.username, { fields: { _id: 1 } });\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'muteUserInRoom',\n\t\t\t});\n\t\t}\n\n\t\tconst mutedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tRocketChat.models.Rooms.muteUsernameByRoomId(data.rid, mutedUser.username);\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserMutedWithRoomIdAndUser(data.rid, mutedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username,\n\t\t\t},\n\t\t});\n\n\t\treturn true;\n\t},\n});\n","Meteor.methods({\n\topenRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'openRoom',\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.openByRoomIdAndUserId(rid, Meteor.userId());\n\t},\n});\n","import { ReadReceipt } from '../../imports/message-read-receipt/server/lib/ReadReceipt';\n\nMeteor.methods({\n\treadMessages(rid) {\n\t\tcheck(rid, String);\n\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'readMessages',\n\t\t\t});\n\t\t}\n\n\t\t// this prevents cache from updating object reference/pointer\n\t\tconst userSubscription = Object.assign({}, RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, userId));\n\n\t\tRocketChat.models.Subscriptions.setAsReadByRoomIdAndUserId(rid, userId);\n\n\t\tMeteor.defer(() => {\n\t\t\tReadReceipt.markMessagesAsRead(rid, userId, userSubscription.ls);\n\t\t});\n\t},\n});\n","import s from 'underscore.string';\n\nMeteor.methods({\n\tregisterUser(formData) {\n\t\tconst AllowAnonymousRead = RocketChat.settings.get('Accounts_AllowAnonymousRead');\n\t\tconst AllowAnonymousWrite = RocketChat.settings.get('Accounts_AllowAnonymousWrite');\n\t\tconst manuallyApproveNewUsers = RocketChat.settings.get('Accounts_ManuallyApproveNewUsers');\n\t\tif (AllowAnonymousRead === true && AllowAnonymousWrite === true && formData.email == null) {\n\t\t\tconst userId = Accounts.insertUserDoc({}, {\n\t\t\t\tglobalRoles: [\n\t\t\t\t\t'anonymous',\n\t\t\t\t],\n\t\t\t});\n\n\t\t\tconst { id, token } = Accounts._loginUser(this, userId);\n\n\t\t\treturn { id, token };\n\t\t} else {\n\t\t\tcheck(formData, Match.ObjectIncluding({\n\t\t\t\temail: String,\n\t\t\t\tpass: String,\n\t\t\t\tname: String,\n\t\t\t\tsecretURL: Match.Optional(String),\n\t\t\t\treason: Match.Optional(String),\n\t\t\t}));\n\t\t}\n\n\t\tif (RocketChat.settings.get('Accounts_RegistrationForm') === 'Disabled') {\n\t\t\tthrow new Meteor.Error('error-user-registration-disabled', 'User registration is disabled', { method: 'registerUser' });\n\t\t} else if (RocketChat.settings.get('Accounts_RegistrationForm') === 'Secret URL' && (!formData.secretURL || formData.secretURL !== RocketChat.settings.get('Accounts_RegistrationForm_SecretURL'))) {\n\t\t\tthrow new Meteor.Error ('error-user-registration-secret', 'User registration is only allowed via Secret URL', { method: 'registerUser' });\n\t\t}\n\n\t\tRocketChat.passwordPolicy.validate(formData.pass);\n\n\t\tRocketChat.validateEmailDomain(formData.email);\n\n\t\tconst userData = {\n\t\t\temail: s.trim(formData.email.toLowerCase()),\n\t\t\tpassword: formData.pass,\n\t\t\tname: formData.name,\n\t\t\treason: formData.reason,\n\t\t};\n\n\t\t// Check if user has already been imported and never logged in. If so, set password and let it through\n\t\tconst importedUser = RocketChat.models.Users.findOneByEmailAddress(s.trim(formData.email.toLowerCase()));\n\t\tlet userId;\n\t\tif (importedUser && importedUser.importIds && importedUser.importIds.length && !importedUser.lastLogin) {\n\t\t\tAccounts.setPassword(importedUser._id, userData.password);\n\t\t\tuserId = importedUser._id;\n\t\t} else {\n\t\t\tuserId = Accounts.createUser(userData);\n\t\t}\n\n\t\tRocketChat.models.Users.setName(userId, s.trim(formData.name));\n\n\t\tconst reason = s.trim(formData.reason);\n\t\tif (manuallyApproveNewUsers && reason) {\n\t\t\tRocketChat.models.Users.setReason(userId, reason);\n\t\t}\n\n\t\tRocketChat.saveCustomFields(userId, formData);\n\n\t\ttry {\n\t\t\tif (RocketChat.settings.get('Verification_Customized')) {\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email_Subject') || '');\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email') || '');\n\t\t\t\tAccounts.emailTemplates.verifyEmail.subject = () => subject;\n\t\t\t\tAccounts.emailTemplates.verifyEmail.html = (userModel, url) => html.replace(/\\[Verification_Url]/g, url);\n\t\t\t}\n\n\t\t\tAccounts.sendVerificationEmail(userId, userData.email);\n\t\t} catch (error) {\n\t\t\t// throw new Meteor.Error 'error-email-send-failed', 'Error trying to send email: ' + error.message, { method: 'registerUser', message: error.message }\n\t\t}\n\n\t\treturn userId;\n\t},\n});\n","Meteor.methods({\n\tremoveRoomLeader(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomLeader',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-leader', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomLeader',\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomLeader',\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'removeRoomLeader',\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('leader') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-leader', 'User is not a leader', {\n\t\t\t\tmethod: 'removeRoomLeader',\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'leader');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username,\n\t\t\t},\n\t\t\trole: 'leader',\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'leader',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name,\n\t\t\t\t},\n\t\t\t\tscope: rid,\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t},\n});\n","Meteor.methods({\n\tremoveRoomModerator(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomModerator',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-moderator', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomModerator',\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomModerator',\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'removeRoomModerator',\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === false || subscription.roles.includes('moderator') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-moderator', 'User is not a moderator', {\n\t\t\t\tmethod: 'removeRoomModerator',\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'moderator');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username,\n\t\t\t},\n\t\t\trole: 'moderator',\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'moderator',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name,\n\t\t\t\t},\n\t\t\t\tscope: rid,\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t},\n});\n","Meteor.methods({\n\tremoveRoomOwner(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomOwner',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-owner', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomOwner',\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomOwner',\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'removeRoomOwner',\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === false || subscription.roles.includes('owner') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-owner', 'User is not an owner', {\n\t\t\t\tmethod: 'removeRoomOwner',\n\t\t\t});\n\t\t}\n\n\t\tconst numOwners = RocketChat.authz.getUsersInRole('owner', rid).count();\n\n\t\tif (numOwners === 1) {\n\t\t\tthrow new Meteor.Error('error-remove-last-owner', 'This is the last owner. Please set a new owner before removing this one.', {\n\t\t\t\tmethod: 'removeRoomOwner',\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'owner');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username,\n\t\t\t},\n\t\t\trole: 'owner',\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'owner',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name,\n\t\t\t\t},\n\t\t\t\tscope: rid,\n\t\t\t});\n\t\t}\n\t\treturn true;\n\t},\n});\n","Meteor.methods({\n\tremoveUserFromRoom(data) {\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String,\n\t\t}));\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!fromId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeUserFromRoom',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'remove-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeUserFromRoom',\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room || room.t === 'd') {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeUserFromRoom',\n\t\t\t});\n\t\t}\n\n\t\tconst removedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(data.rid, removedUser._id, { fields: { _id: 1 } });\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'removeUserFromRoom',\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasRole(removedUser._id, 'owner', room._id)) {\n\t\t\tconst numOwners = RocketChat.authz.getUsersInRole('owner', room._id).fetch().length;\n\n\t\t\tif (numOwners === 1) {\n\t\t\t\tthrow new Meteor.Error('error-you-are-last-owner', 'You are the last owner. Please set new owner before leaving the room.', {\n\t\t\t\t\tmethod: 'removeUserFromRoom',\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeByRoomIdAndUserId(data.rid, removedUser._id);\n\n\t\tif (['c', 'p'].includes(room.t) === true) {\n\t\t\tRocketChat.authz.removeUserFromRoles(removedUser._id, ['moderator', 'owner'], data.rid);\n\t\t}\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserRemovedWithRoomIdAndUser(data.rid, removedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username,\n\t\t\t},\n\t\t});\n\n\t\treturn true;\n\t},\n});\n","Meteor.methods({\n\treportMessage(messageId, description) {\n\t\tcheck(messageId, String);\n\t\tcheck(description, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'reportMessage',\n\t\t\t});\n\t\t}\n\n\t\tif ((description == null) || description.trim() === '') {\n\t\t\tthrow new Meteor.Error('error-invalid-description', 'Invalid description', {\n\t\t\t\tmethod: 'reportMessage',\n\t\t\t});\n\t\t}\n\n\t\tconst message = RocketChat.models.Messages.findOneById(messageId);\n\t\tif (!message) {\n\t\t\tthrow new Meteor.Error('error-invalid-message_id', 'Invalid message id', {\n\t\t\t\tmethod: 'reportMessage',\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Reports.createWithMessageDescriptionAndUserId(message, description, Meteor.userId());\n\t},\n});\n","import fs from 'fs';\nimport path from 'path';\n\nlet tempFolder = '/tmp/userData';\nif (RocketChat.settings.get('UserData_FileSystemPath') != null) {\n\tif (RocketChat.settings.get('UserData_FileSystemPath').trim() !== '') {\n\t\ttempFolder = RocketChat.settings.get('UserData_FileSystemPath');\n\t}\n}\n\nMeteor.methods({\n\trequestDataDownload({ fullExport = false }) {\n\t\tconst currentUserData = Meteor.user();\n\t\tconst userId = currentUserData._id;\n\n\t\tconst lastOperation = RocketChat.models.ExportOperations.findLastOperationByUser(userId, fullExport);\n\n\t\tif (lastOperation) {\n\t\t\tconst yesterday = new Date();\n\t\t\tyesterday.setUTCDate(yesterday.getUTCDate() - 1);\n\n\t\t\tif (lastOperation.createdAt > yesterday) {\n\t\t\t\treturn {\n\t\t\t\t\trequested: false,\n\t\t\t\t\texportOperation: lastOperation,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (!fs.existsSync(tempFolder)) {\n\t\t\tfs.mkdirSync(tempFolder);\n\t\t}\n\n\t\tconst subFolderName = fullExport ? 'full' : 'partial';\n\t\tconst baseFolder = path.join(tempFolder, userId);\n\t\tif (!fs.existsSync(baseFolder)) {\n\t\t\tfs.mkdirSync(baseFolder);\n\t\t}\n\n\t\tconst folderName = path.join(baseFolder, subFolderName);\n\t\tif (!fs.existsSync(folderName)) {\n\t\t\tfs.mkdirSync(folderName);\n\t\t}\n\t\tconst assetsFolder = path.join(folderName, 'assets');\n\t\tif (!fs.existsSync(assetsFolder)) {\n\t\t\tfs.mkdirSync(assetsFolder);\n\t\t}\n\n\t\tconst exportOperation = {\n\t\t\tuserId : currentUserData._id,\n\t\t\troomList: null,\n\t\t\tstatus: 'pending',\n\t\t\texportPath: folderName,\n\t\t\tassetsPath: assetsFolder,\n\t\t\tfileList: [],\n\t\t\tgeneratedFile: null,\n\t\t\tfullExport,\n\t\t};\n\n\t\tRocketChat.models.ExportOperations.create(exportOperation);\n\n\t\treturn {\n\t\t\trequested: true,\n\t\t\texportOperation,\n\t\t};\n\t},\n});\n","Meteor.methods({\n\tresetAvatar() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'resetAvatar',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserAvatarChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'resetAvatar',\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tFileUpload.getStore('Avatars').deleteByName(user.username);\n\t\tRocketChat.models.Users.unsetAvatarOrigin(user._id);\n\t\tRocketChat.Notifications.notifyLogged('updateAvatar', {\n\t\t\tusername: user.username,\n\t\t});\n\t},\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'resetAvatar',\n\tuserId() {\n\t\treturn true;\n\t},\n}, 1, 60000);\n","Meteor.methods({\n\troomNameExists(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'roomExists',\n\t\t\t});\n\t\t}\n\t\tconst room = RocketChat.models.Rooms.findOneByName(rid);\n\t\treturn !!room;\n\t},\n});\n","Meteor.methods({\n\tsaveUserPreferences(settings) {\n\t\tconst keys = {\n\t\t\tlanguage: Match.Optional(String),\n\t\t\tnewRoomNotification: Match.Optional(String),\n\t\t\tnewMessageNotification: Match.Optional(String),\n\t\t\tuseEmojis: Match.Optional(Boolean),\n\t\t\tconvertAsciiEmoji: Match.Optional(Boolean),\n\t\t\tsaveMobileBandwidth: Match.Optional(Boolean),\n\t\t\tcollapseMediaByDefault: Match.Optional(Boolean),\n\t\t\tautoImageLoad: Match.Optional(Boolean),\n\t\t\temailNotificationMode: Match.Optional(String),\n\t\t\tunreadAlert: Match.Optional(Boolean),\n\t\t\tnotificationsSoundVolume: Match.Optional(Number),\n\t\t\tdesktopNotifications: Match.Optional(String),\n\t\t\tmobileNotifications: Match.Optional(String),\n\t\t\tenableAutoAway: Match.Optional(Boolean),\n\t\t\thighlights: Match.Optional([String]),\n\t\t\tdesktopNotificationDuration: Match.Optional(Number),\n\t\t\tmessageViewMode: Match.Optional(Number),\n\t\t\thideUsernames: Match.Optional(Boolean),\n\t\t\thideRoles: Match.Optional(Boolean),\n\t\t\thideAvatars: Match.Optional(Boolean),\n\t\t\thideFlexTab: Match.Optional(Boolean),\n\t\t\tsendOnEnter: Match.Optional(String),\n\t\t\troomCounterSidebar: Match.Optional(Boolean),\n\t\t\tidleTimeLimit: Match.Optional(Number),\n\t\t\tsidebarShowFavorites: Match.Optional(Boolean),\n\t\t\tsidebarShowUnread: Match.Optional(Boolean),\n\t\t\tsidebarSortby: Match.Optional(String),\n\t\t\tsidebarViewMode: Match.Optional(String),\n\t\t\tsidebarHideAvatar: Match.Optional(Boolean),\n\t\t\tsidebarGroupByType: Match.Optional(Boolean),\n\t\t\tmuteFocusedConversations: Match.Optional(Boolean),\n\t\t};\n\t\tcheck(settings, Match.ObjectIncluding(keys));\n\t\tconst user = Meteor.user();\n\n\t\tif (!user) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst {\n\t\t\tdesktopNotifications: oldDesktopNotifications,\n\t\t\tmobileNotifications: oldMobileNotifications,\n\t\t\temailNotificationMode: oldEmailNotifications,\n\t\t} = (user.settings && user.settings.preferences) || {};\n\n\t\tif (user.settings == null) {\n\t\t\tRocketChat.models.Users.clearSettings(user._id);\n\t\t}\n\n\t\tif (settings.language != null) {\n\t\t\tRocketChat.models.Users.setLanguage(user._id, settings.language);\n\t\t}\n\n\t\t// Keep compatibility with old values\n\t\tif (settings.emailNotificationMode === 'all') {\n\t\t\tsettings.emailNotificationMode = 'mentions';\n\t\t} else if (settings.emailNotificationMode === 'disabled') {\n\t\t\tsettings.emailNotificationMode = 'nothing';\n\t\t}\n\n\t\tif (settings.idleTimeLimit != null && settings.idleTimeLimit < 60) {\n\t\t\tthrow new Meteor.Error('invalid-idle-time-limit-value', 'Invalid idleTimeLimit');\n\t\t}\n\n\t\tRocketChat.models.Users.setPreferences(user._id, settings);\n\n\t\t// propagate changed notification preferences\n\t\tMeteor.defer(() => {\n\t\t\tif (settings.desktopNotifications && oldDesktopNotifications !== settings.desktopNotifications) {\n\t\t\t\tif (settings.desktopNotifications === 'default') {\n\t\t\t\t\tRocketChat.models.Subscriptions.clearDesktopNotificationUserPreferences(user._id);\n\t\t\t\t} else {\n\t\t\t\t\tRocketChat.models.Subscriptions.updateDesktopNotificationUserPreferences(user._id, settings.desktopNotifications);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (settings.mobileNotifications && oldMobileNotifications !== settings.mobileNotifications) {\n\t\t\t\tif (settings.mobileNotifications === 'default') {\n\t\t\t\t\tRocketChat.models.Subscriptions.clearMobileNotificationUserPreferences(user._id);\n\t\t\t\t} else {\n\t\t\t\t\tRocketChat.models.Subscriptions.updateMobileNotificationUserPreferences(user._id, settings.mobileNotifications);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (settings.emailNotificationMode && oldEmailNotifications !== settings.emailNotificationMode) {\n\t\t\t\tif (settings.emailNotificationMode === 'default') {\n\t\t\t\t\tRocketChat.models.Subscriptions.clearEmailNotificationUserPreferences(user._id);\n\t\t\t\t} else {\n\t\t\t\t\tRocketChat.models.Subscriptions.updateEmailNotificationUserPreferences(user._id, settings.emailNotificationMode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (Array.isArray(settings.highlights)) {\n\t\t\t\tRocketChat.models.Subscriptions.updateUserHighlights(user._id, settings.highlights);\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t},\n});\n","Meteor.methods({\n\tsaveUserProfile(settings, customFields) {\n\t\tcheck(settings, Object);\n\t\tcheck(customFields, Match.Maybe(Object));\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserProfileChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'saveUserProfile',\n\t\t\t});\n\t\t}\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'saveUserProfile',\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tfunction checkPassword(user = {}, typedPassword) {\n\t\t\tif (!(user.services && user.services.password && user.services.password.bcrypt && user.services.password.bcrypt.trim())) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst passCheck = Accounts._checkPassword(user, {\n\t\t\t\tdigest: typedPassword,\n\t\t\t\talgorithm: 'sha-256',\n\t\t\t});\n\n\t\t\tif (passCheck.error) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tif (settings.realname) {\n\t\t\tMeteor.call('setRealName', settings.realname);\n\t\t}\n\n\t\tif (settings.username) {\n\t\t\tMeteor.call('setUsername', settings.username);\n\t\t}\n\n\t\tif (settings.email) {\n\t\t\tif (!checkPassword(user, settings.typedPassword)) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', {\n\t\t\t\t\tmethod: 'saveUserProfile',\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tMeteor.call('setEmail', settings.email);\n\t\t}\n\n\t\t// Should be the last check to prevent error when trying to check password for users without password\n\t\tif ((settings.newPassword) && RocketChat.settings.get('Accounts_AllowPasswordChange') === true) {\n\t\t\tif (!checkPassword(user, settings.typedPassword)) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', {\n\t\t\t\t\tmethod: 'saveUserProfile',\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tRocketChat.passwordPolicy.validate(settings.newPassword);\n\n\t\t\tAccounts.setPassword(Meteor.userId(), settings.newPassword, {\n\t\t\t\tlogout: false,\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Users.setProfile(Meteor.userId(), {});\n\n\t\tif (customFields && Object.keys(customFields).length) {\n\t\t\tRocketChat.saveCustomFields(Meteor.userId(), customFields);\n\t\t}\n\n\t\treturn true;\n\t},\n});\n","Meteor.methods({\n\tsendConfirmationEmail(email) {\n\t\tcheck(email, String);\n\t\temail = email.trim();\n\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(email);\n\n\t\tif (user) {\n\t\t\tif (RocketChat.settings.get('Verification_Customized')) {\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email_Subject') || '');\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email') || '');\n\n\t\t\t\tAccounts.emailTemplates.verifyEmail.subject = function(/* userModel*/) {\n\t\t\t\t\treturn subject;\n\t\t\t\t};\n\n\t\t\t\tAccounts.emailTemplates.verifyEmail.html = function(userModel, url) {\n\t\t\t\t\treturn html.replace(/\\[Verification_Url]/g, url);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tAccounts.sendVerificationEmail(user._id, email);\n\t\t\t} catch (error) {\n\t\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ error.message }`, {\n\t\t\t\t\tmethod: 'registerUser',\n\t\t\t\t\tmessage: error.message,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t},\n});\n","import s from 'underscore.string';\n\nMeteor.methods({\n\tsendForgotPasswordEmail(email) {\n\t\tcheck(email, String);\n\n\t\temail = email.trim();\n\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(email);\n\n\t\tif (user) {\n\t\t\tconst regex = new RegExp(`^${ s.escapeRegExp(email) }$`, 'i');\n\t\t\temail = (user.emails || []).map((item) => item.address).find((userEmail) => regex.test(userEmail));\n\n\t\t\tif (RocketChat.settings.get('Forgot_Password_Customized')) {\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Forgot_Password_Email_Subject') || '', {\n\t\t\t\t\tname: user.name,\n\t\t\t\t\temail,\n\t\t\t\t});\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Forgot_Password_Email') || '', {\n\t\t\t\t\tname: s.escapeHTML(user.name),\n\t\t\t\t\temail: s.escapeHTML(email),\n\t\t\t\t});\n\n\t\t\t\tAccounts.emailTemplates.from = `${ RocketChat.settings.get('Site_Name') } <${ RocketChat.settings.get('From_Email') }>`;\n\n\t\t\t\tAccounts.emailTemplates.resetPassword.subject = function(/* userModel*/) {\n\t\t\t\t\treturn subject;\n\t\t\t\t};\n\n\t\t\t\tAccounts.emailTemplates.resetPassword.html = function(userModel, url) {\n\t\t\t\t\treturn html.replace(/\\[Forgot_Password_Url]/g, url);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tAccounts.sendResetPasswordEmail(user._id, email);\n\t\t\t} catch (error) {\n\t\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ error.message }`, {\n\t\t\t\t\tmethod: 'registerUser',\n\t\t\t\t\tmessage: error.message,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t},\n});\n","Meteor.methods({\n\tsetAvatarFromService(dataURI, contentType, service) {\n\t\tcheck(dataURI, String);\n\t\tcheck(contentType, Match.Optional(String));\n\t\tcheck(service, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setAvatarFromService',\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserAvatarChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setAvatarFromService',\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\treturn RocketChat.setUserAvatar(user, dataURI, contentType, service);\n\t},\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'setAvatarFromService',\n\tuserId() {\n\t\treturn true;\n\t},\n}, 1, 5000);\n","Meteor.methods({\n\tsetUserActiveStatus(userId, active) {\n\t\tcheck(userId, String);\n\t\tcheck(active, Boolean);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setUserActiveStatus',\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'edit-other-user-active-status') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setUserActiveStatus',\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (user) {\n\t\t\tRocketChat.models.Users.setUserActive(userId, active);\n\n\t\t\tif (user.username) {\n\t\t\t\tRocketChat.models.Subscriptions.setArchivedByUsername(user.username, !active);\n\t\t\t}\n\n\t\t\tif (active === false) {\n\t\t\t\tRocketChat.models.Users.unsetLoginTokens(userId);\n\t\t\t} else {\n\t\t\t\tRocketChat.models.Users.unsetReason(userId);\n\t\t\t}\n\n\t\t\tconst destinations = Array.isArray(user.emails) && user.emails.map((email) => `${ user.name || user.username }<${ email.address }>`);\n\n\t\t\tif (destinations) {\n\t\t\t\tconst email = {\n\t\t\t\t\tto: destinations,\n\t\t\t\t\tfrom: RocketChat.settings.get('From_Email'),\n\t\t\t\t\tsubject: Accounts.emailTemplates.userActivated.subject({ active }),\n\t\t\t\t\thtml: Accounts.emailTemplates.userActivated.html({ active, name: user.name, username: user.username }),\n\t\t\t\t};\n\n\t\t\t\tMeteor.defer(() => Email.send(email));\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t},\n});\n","Meteor.methods({\n\tsetUserPassword(password) {\n\t\tcheck(password, String);\n\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setUserPassword',\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (user && user.requirePasswordChange !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setUserPassword',\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.passwordPolicy.validate(password);\n\n\t\tAccounts.setPassword(userId, password, {\n\t\t\tlogout: false,\n\t\t});\n\n\t\treturn RocketChat.models.Users.unsetRequirePasswordChange(userId);\n\t},\n});\n","Meteor.methods({\n\ttoggleFavorite(rid, f) {\n\t\tcheck(rid, String);\n\n\t\tcheck(f, Match.Optional(Boolean));\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'toggleFavorite',\n\t\t\t});\n\t\t}\n\n\t\tconst userSubscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, Meteor.userId());\n\t\tif (!userSubscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-subscription',\n\t\t\t\t'You must be part of a room to favorite it',\n\t\t\t\t{ method: 'toggleFavorite' }\n\t\t\t);\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.setFavoriteByRoomIdAndUserId(rid, Meteor.userId(), f);\n\t},\n});\n","Meteor.methods({\n\tunmuteUserInRoom(data) {\n\t\tconst fromId = Meteor.userId();\n\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String,\n\t\t}));\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'mute-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'unmuteUserInRoom',\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'unmuteUserInRoom',\n\t\t\t});\n\t\t}\n\n\t\tif (['c', 'p'].includes(room.t) === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-room-type', `${ room.t } is not a valid room type`, {\n\t\t\t\tmethod: 'unmuteUserInRoom',\n\t\t\t\ttype: room.t,\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUsername(data.rid, data.username, { fields: { _id: 1 } });\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'unmuteUserInRoom',\n\t\t\t});\n\t\t}\n\n\t\tconst unmutedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tRocketChat.models.Rooms.unmuteUsernameByRoomId(data.rid, unmutedUser.username);\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserUnmutedWithRoomIdAndUser(data.rid, unmutedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username,\n\t\t\t},\n\t\t});\n\n\t\treturn true;\n\t},\n});\n","Meteor.methods({\n\tuserSetUtcOffset(utcOffset) {\n\t\tcheck(utcOffset, Number);\n\n\t\tif (this.userId == null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.unblock();\n\n\t\treturn RocketChat.models.Users.setUtcOffset(this.userId, utcOffset);\n\t},\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'userSetUtcOffset',\n\tuserId() {\n\t\treturn true;\n\t},\n}, 1, 60000);\n","Meteor.publish('activeUsers', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Users.findUsersNotOffline({\n\t\tfields: {\n\t\t\tusername: 1,\n\t\t\tname: 1,\n\t\t\tstatus: 1,\n\t\t\tutcOffset: 1,\n\t\t},\n\t});\n});\n","Meteor.publish('channelAndPrivateAutocomplete', function(selector) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\tconst pub = this;\n\tconst options = {\n\t\tfields: {\n\t\t\t_id: 1,\n\t\t\tname: 1,\n\t\t},\n\t\tlimit: 10,\n\t\tsort: {\n\t\t\tname: 1,\n\t\t},\n\t};\n\n\tconst cursorHandle = RocketChat.models.Rooms.findChannelAndPrivateByNameStarting(selector.name, options).observeChanges({\n\t\tadded(_id, record) {\n\t\t\treturn pub.added('autocompleteRecords', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\treturn pub.changed('autocompleteRecords', _id, record);\n\t\t},\n\t\tremoved(_id, record) {\n\t\t\treturn pub.removed('autocompleteRecords', _id, record);\n\t\t},\n\t});\n\n\tthis.ready();\n\n\tthis.onStop(function() {\n\t\treturn cursorHandle.stop();\n\t});\n});\n","Meteor.publish('fullUserData', function(filter, limit) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst result = RocketChat.getFullUserData({\n\t\tuserId: this.userId,\n\t\tfilter,\n\t\tlimit,\n\t});\n\n\tif (!result) {\n\t\treturn this.ready();\n\t}\n\n\treturn result;\n});\n","import _ from 'underscore';\n\nMeteor.publish('messages', function(rid/* , start*/) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst publication = this;\n\n\tif (typeof rid !== 'string') {\n\t\treturn this.ready();\n\t}\n\n\tif (!Meteor.call('canAccessRoom', rid, this.userId)) {\n\t\treturn this.ready();\n\t}\n\n\tconst cursor = RocketChat.models.Messages.findVisibleByRoomId(rid, {\n\t\tsort: {\n\t\t\tts: -1,\n\t\t},\n\t\tlimit: 50,\n\t});\n\n\tconst cursorHandle = cursor.observeChanges({\n\t\tadded(_id, record) {\n\t\t\trecord.starred = _.findWhere(record.starred, {\n\t\t\t\t_id: publication.userId,\n\t\t\t});\n\t\t\treturn publication.added('rocketchat_message', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\trecord.starred = _.findWhere(record.starred, {\n\t\t\t\t_id: publication.userId,\n\t\t\t});\n\t\t\treturn publication.changed('rocketchat_message', _id, record);\n\t\t},\n\t});\n\n\tconst cursorDelete = RocketChat.models.Messages.findInvisibleByRoomId(rid, {\n\t\tfields: {\n\t\t\t_id: 1,\n\t\t},\n\t});\n\n\tconst cursorDeleteHandle = cursorDelete.observeChanges({\n\t\tadded(_id/* , record*/) {\n\t\t\treturn publication.added('rocketchat_message', _id, {\n\t\t\t\t_hidden: true,\n\t\t\t});\n\t\t},\n\t\tchanged(_id/* , record*/) {\n\t\t\treturn publication.added('rocketchat_message', _id, {\n\t\t\t\t_hidden: true,\n\t\t\t});\n\t\t},\n\t});\n\n\tthis.ready();\n\n\treturn this.onStop(function() {\n\t\tcursorHandle.stop();\n\t\treturn cursorDeleteHandle.stop();\n\t});\n});\n\nMeteor.methods({\n\t'messages/get'(rid, { lastUpdate, latestDate = new Date(), oldestDate, inclusive = false, count = 20, unreads = false }) {\n\t\tcheck(rid, String);\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!fromId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'messages/get',\n\t\t\t});\n\t\t}\n\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'messages/get',\n\t\t\t});\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1,\n\t\t\t},\n\t\t};\n\n\t\tif (lastUpdate instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdated: RocketChat.models.Messages.findForUpdates(rid, lastUpdate, options).fetch(),\n\t\t\t\tdeleted: RocketChat.models.Messages.trashFindDeletedAfter(lastUpdate, { rid }, { ...options, fields: { _id: 1, _deletedAt: 1 } }).fetch(),\n\t\t\t};\n\t\t}\n\n\t\treturn Meteor.call('getChannelHistory', { rid, latest: latestDate, oldest: oldestDate, inclusive, count, unreads });\n\n\t},\n});\n","import _ from 'underscore';\n\nconst fields = {\n\t_id: 1,\n\tname: 1,\n\tfname: 1,\n\tt: 1,\n\tcl: 1,\n\tu: 1,\n\t// usernames: 1,\n\ttopic: 1,\n\tannouncement: 1,\n\tannouncementDetails: 1,\n\tmuted: 1,\n\t_updatedAt: 1,\n\tarchived: 1,\n\tjitsiTimeout: 1,\n\tdescription: 1,\n\tdefault: 1,\n\tcustomFields: 1,\n\tlastMessage: 1,\n\tretention: 1,\n\n\t// @TODO create an API to register this fields based on room type\n\tlivechatData: 1,\n\ttags: 1,\n\tsms: 1,\n\tfacebook: 1,\n\tcode: 1,\n\tjoinCodeRequired: 1,\n\topen: 1,\n\tv: 1,\n\tlabel: 1,\n\tro: 1,\n\treactWhenReadOnly: 1,\n\tsysMes: 1,\n\tsentiment: 1,\n\ttokenpass: 1,\n\tstreamingOptions: 1,\n\tbroadcast: 1,\n};\n\nconst roomMap = (record) => {\n\tif (record) {\n\t\treturn _.pick(record, ...Object.keys(fields));\n\t}\n\treturn {};\n};\n\nMeteor.methods({\n\t'rooms/get'(updatedAt) {\n\t\tlet options = { fields };\n\n\t\tif (!Meteor.userId()) {\n\t\t\tif (RocketChat.settings.get('Accounts_AllowAnonymousRead') === true) {\n\t\t\t\treturn RocketChat.models.Rooms.findByDefaultAndTypes(true, ['c'], options).fetch();\n\t\t\t}\n\t\t\treturn [];\n\t\t}\n\n\t\tthis.unblock();\n\n\t\toptions = {\n\t\t\tfields,\n\t\t};\n\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: RocketChat.models.Rooms.findBySubscriptionUserIdUpdatedAfter(Meteor.userId(), updatedAt, options).fetch(),\n\t\t\t\tremove: RocketChat.models.Rooms.trashFindDeletedAfter(updatedAt, {}, { fields: { _id: 1, _deletedAt: 1 } }).fetch(),\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.models.Rooms.findBySubscriptionUserId(Meteor.userId(), options).fetch();\n\t},\n\n\tgetRoomByTypeAndName(type, name) {\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\tconst roomFind = RocketChat.roomTypes.getRoomFind(type);\n\n\t\tlet room;\n\n\t\tif (roomFind) {\n\t\t\troom = roomFind.call(this, name);\n\t\t} else {\n\t\t\troom = RocketChat.models.Rooms.findByTypeAndName(type, name).fetch();\n\t\t}\n\n\t\tif (!room || room.length === 0) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\troom = room[0];\n\n\t\tif (!Meteor.call('canAccessRoom', room._id, userId)) {\n\t\t\tthrow new Meteor.Error('error-no-permission', 'No permission', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\tif (RocketChat.settings.get('Store_Last_Message') && !RocketChat.authz.hasPermission(userId, 'preview-c-room')) {\n\t\t\tdelete room.lastMessage;\n\t\t}\n\n\t\treturn roomMap(room);\n\t},\n});\n\nRocketChat.models.Rooms.on('change', ({ clientAction, id, data }) => {\n\tswitch (clientAction) {\n\t\tcase 'updated':\n\t\tcase 'inserted':\n\t\t\t// Override data cuz we do not publish all fields\n\t\t\tdata = RocketChat.models.Rooms.findOneById(id, { fields });\n\t\t\tbreak;\n\n\t\tcase 'removed':\n\t\t\tdata = { _id: id };\n\t\t\tbreak;\n\t}\n\n\tif (data) {\n\t\tRocketChat.models.Subscriptions.findByRoomId(id, { fields: { 'u._id': 1 } }).forEach(({ u }) => {\n\t\t\tRocketChat.Notifications.notifyUserInThisInstance(u._id, 'rooms-changed', clientAction, data);\n\t\t});\n\t}\n});\n","import { roomFiles } from '../lib/roomFiles';\n\nMeteor.publish('roomFiles', function(rid, limit = 50) {\n\treturn roomFiles(this, { rid, limit });\n});\n","import { roomFiles } from '../lib/roomFiles';\n\nMeteor.publish('roomFilesWithSearchText', function(rid, searchText, limit = 50) {\n\treturn roomFiles(this, { rid, searchText, limit });\n});\n","Meteor.publish('roomSubscriptionsByRole', function(rid, role) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Subscriptions.findByRoomIdAndRoles(rid, role, {\n\t\tfields: {\n\t\t\trid: 1,\n\t\t\tname: 1,\n\t\t\troles: 1,\n\t\t\tu: 1,\n\t\t},\n\t\tsort: {\n\t\t\tname: 1,\n\t\t},\n\t});\n});\n","import s from 'underscore.string';\n\nfunction fetchRooms(userId, rooms) {\n\tif (!RocketChat.settings.get('Store_Last_Message') || RocketChat.authz.hasPermission(userId, 'preview-c-room')) {\n\t\treturn rooms;\n\t}\n\n\treturn rooms.map((room) => {\n\t\tdelete room.lastMessage;\n\t\treturn room;\n\t});\n}\n\nMeteor.methods({\n\tspotlight(text, usernames, type = { users: true, rooms: true }, rid) {\n\t\tconst searchForChannels = text[0] === '#';\n\t\tconst searchForDMs = text[0] === '@';\n\t\tif (searchForChannels) {\n\t\t\ttype.users = false;\n\t\t\ttext = text.slice(1);\n\t\t}\n\t\tif (searchForDMs) {\n\t\t\ttype.rooms = false;\n\t\t\ttext = text.slice(1);\n\t\t}\n\t\tconst regex = new RegExp(s.trim(s.escapeRegExp(text)), 'i');\n\t\tconst result = {\n\t\t\tusers: [],\n\t\t\trooms: [],\n\t\t};\n\t\tconst roomOptions = {\n\t\t\tlimit: 5,\n\t\t\tfields: {\n\t\t\t\tt: 1,\n\t\t\t\tname: 1,\n\t\t\t\tlastMessage: 1,\n\t\t\t},\n\t\t\tsort: {\n\t\t\t\tname: 1,\n\t\t\t},\n\t\t};\n\t\tconst { userId } = this;\n\t\tif (userId == null) {\n\t\t\tif (RocketChat.settings.get('Accounts_AllowAnonymousRead') === true) {\n\t\t\t\tresult.rooms = fetchRooms(userId, RocketChat.models.Rooms.findByNameAndTypeNotDefault(regex, 'c', roomOptions).fetch());\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t\tconst userOptions = {\n\t\t\tlimit: 5,\n\t\t\tfields: {\n\t\t\t\tusername: 1,\n\t\t\t\tname: 1,\n\t\t\t\tstatus: 1,\n\t\t\t},\n\t\t\tsort: {},\n\t\t};\n\t\tif (RocketChat.settings.get('UI_Use_Real_Name')) {\n\t\t\tuserOptions.sort.name = 1;\n\t\t} else {\n\t\t\tuserOptions.sort.username = 1;\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(userId, 'view-outside-room')) {\n\t\t\tif (type.users === true && RocketChat.authz.hasPermission(userId, 'view-d-room')) {\n\t\t\t\tresult.users = RocketChat.models.Users.findByActiveUsersExcept(text, usernames, userOptions).fetch();\n\t\t\t}\n\n\t\t\tif (type.rooms === true && RocketChat.authz.hasPermission(userId, 'view-c-room')) {\n\t\t\t\tconst searchableRoomTypes = Object.entries(RocketChat.roomTypes.roomTypes)\n\t\t\t\t\t.filter((roomType) => roomType[1].includeInRoomSearch())\n\t\t\t\t\t.map((roomType) => roomType[0]);\n\n\t\t\t\tconst roomIds = RocketChat.models.Subscriptions.findByUserIdAndTypes(userId, searchableRoomTypes, { fields: { rid: 1 } }).fetch().map((s) => s.rid);\n\t\t\t\tresult.rooms = fetchRooms(userId, RocketChat.models.Rooms.findByNameAndTypesNotInIds(regex, searchableRoomTypes, roomIds, roomOptions).fetch());\n\t\t\t}\n\t\t} else if (type.users === true && rid) {\n\t\t\tconst subscriptions = RocketChat.models.Subscriptions.find({\n\t\t\t\trid, 'u.username': {\n\t\t\t\t\t$regex: regex,\n\t\t\t\t\t$nin: [...usernames, Meteor.user().username],\n\t\t\t\t},\n\t\t\t}, { limit: userOptions.limit }).fetch().map(({ u }) => u._id);\n\t\t\tresult.users = RocketChat.models.Users.find({ _id: { $in: subscriptions } }, {\n\t\t\t\tfields: userOptions.fields,\n\t\t\t\tsort: userOptions.sort,\n\t\t\t}).fetch();\n\t\t}\n\n\t\treturn result;\n\t},\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'spotlight',\n\tuserId(/* userId*/) {\n\t\treturn true;\n\t},\n}, 100, 100000);\n","const fields = {\n\tt: 1,\n\tts: 1,\n\tls: 1,\n\tname: 1,\n\tfname: 1,\n\trid: 1,\n\tcode: 1,\n\tf: 1,\n\tu: 1,\n\topen: 1,\n\talert: 1,\n\troles: 1,\n\tunread: 1,\n\tuserMentions: 1,\n\tgroupMentions: 1,\n\tarchived: 1,\n\taudioNotifications: 1,\n\taudioNotificationValue: 1,\n\tdesktopNotifications: 1,\n\tdesktopNotificationDuration: 1,\n\tmobilePushNotifications: 1,\n\temailNotifications: 1,\n\tunreadAlert: 1,\n\t_updatedAt: 1,\n\tblocked: 1,\n\tblocker: 1,\n\tautoTranslate: 1,\n\tautoTranslateLanguage: 1,\n\tdisableNotifications: 1,\n\thideUnreadStatus: 1,\n\tmuteGroupMentions: 1,\n\tignored: 1,\n};\n\nMeteor.methods({\n\t'subscriptions/get'(updatedAt) {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn [];\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tconst options = { fields };\n\n\t\tconst records = RocketChat.models.Subscriptions.findByUserId(Meteor.userId(), options).fetch();\n\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: records.filter(function(record) {\n\t\t\t\t\treturn record._updatedAt > updatedAt;\n\t\t\t\t}),\n\t\t\t\tremove: RocketChat.models.Subscriptions.trashFindDeletedAfter(updatedAt, {\n\t\t\t\t\t'u._id': Meteor.userId(),\n\t\t\t\t}, {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\t_id: 1,\n\t\t\t\t\t\t_deletedAt: 1,\n\t\t\t\t\t},\n\t\t\t\t}).fetch(),\n\t\t\t};\n\t\t}\n\n\t\treturn records;\n\t},\n});\n\nRocketChat.models.Subscriptions.on('change', ({ clientAction, id, data }) => {\n\tswitch (clientAction) {\n\t\tcase 'updated':\n\t\tcase 'inserted':\n\t\t\t// Override data cuz we do not publish all fields\n\t\t\tdata = RocketChat.models.Subscriptions.findOneById(id, { fields });\n\t\t\tbreak;\n\n\t\tcase 'removed':\n\t\t\tdata = RocketChat.models.Subscriptions.trashFindOneById(id, { fields: { u: 1 } });\n\t\t\tbreak;\n\t}\n\n\tRocketChat.Notifications.notifyUserInThisInstance(data.u._id, 'subscriptions-changed', clientAction, data);\n});\n","import _ from 'underscore';\n\nMeteor.publish('userAutocomplete', function(selector) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (!_.isObject(selector)) {\n\t\treturn this.ready();\n\t}\n\n\tconst options = {\n\t\tfields: {\n\t\t\tname: 1,\n\t\t\tusername: 1,\n\t\t\tstatus: 1,\n\t\t},\n\t\tsort: {\n\t\t\tusername: 1,\n\t\t},\n\t\tlimit: 10,\n\t};\n\n\tconst pub = this;\n\tconst exceptions = selector.exceptions || [];\n\n\tconst cursorHandle = RocketChat.models.Users.findActiveByUsernameOrNameRegexWithExceptions(selector.term, exceptions, options).observeChanges({\n\t\tadded(_id, record) {\n\t\t\treturn pub.added('autocompleteRecords', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\treturn pub.changed('autocompleteRecords', _id, record);\n\t\t},\n\t\tremoved(_id, record) {\n\t\t\treturn pub.removed('autocompleteRecords', _id, record);\n\t\t},\n\t});\n\n\tthis.ready();\n\n\tthis.onStop(function() {\n\t\treturn cursorHandle.stop();\n\t});\n});\n","Meteor.publish('userChannels', function(userId) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Subscriptions.findByUserId(userId, {\n\t\tfields: {\n\t\t\trid: 1,\n\t\t\tname: 1,\n\t\t\tt: 1,\n\t\t\tu: 1,\n\t\t},\n\t\tsort: {\n\t\t\tt: 1,\n\t\t\tname: 1,\n\t\t},\n\t});\n});\n","Meteor.publish('userData', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Users.find(this.userId, {\n\t\tfields: {\n\t\t\tname: 1,\n\t\t\tusername: 1,\n\t\t\tstatus: 1,\n\t\t\tstatusDefault: 1,\n\t\t\tstatusConnection: 1,\n\t\t\tavatarOrigin: 1,\n\t\t\tutcOffset: 1,\n\t\t\tlanguage: 1,\n\t\t\tsettings: 1,\n\t\t\tenableAutoAway: 1,\n\t\t\tidleTimeLimit: 1,\n\t\t\troles: 1,\n\t\t\tactive: 1,\n\t\t\tdefaultRoom: 1,\n\t\t\tcustomFields: 1,\n\t\t\t'services.github': 1,\n\t\t\t'services.gitlab': 1,\n\t\t\t'services.tokenpass': 1,\n\t\t\trequirePasswordChange: 1,\n\t\t\trequirePasswordChangeReason: 1,\n\t\t\t'services.password.bcrypt': 1,\n\t\t\t'services.totp.enabled': 1,\n\t\t\tstatusLivechat: 1,\n\t\t\tbanners: 1,\n\t\t},\n\t});\n});\n","const msgStream = new Meteor.Streamer('room-messages');\nthis.msgStream = msgStream;\n\nmsgStream.allowWrite('none');\n\nmsgStream.allowRead(function(eventName, args) {\n\ttry {\n\t\tconst room = Meteor.call('canAccessRoom', eventName, this.userId, args);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (room.t === 'c' && !RocketChat.authz.hasPermission(this.userId, 'preview-c-room') && !RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(room._id, this.userId, { fields: { _id: 1 } })) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (error) {\n\t\t/* error*/\n\t\treturn false;\n\t}\n});\n\nmsgStream.allowRead('__my_messages__', 'all');\n\nmsgStream.allowEmit('__my_messages__', function(eventName, msg, options) {\n\ttry {\n\t\tconst room = Meteor.call('canAccessRoom', msg.rid, this.userId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\toptions.roomParticipant = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(room._id, this.userId, { fields: { _id: 1 } }) != null;\n\t\toptions.roomType = room.t;\n\n\t\treturn true;\n\t} catch (error) {\n\t\t/* error*/\n\t\treturn false;\n\t}\n});\n\nMeteor.startup(function() {\n\tfunction publishMessage(type, record) {\n\t\tif (record._hidden !== true && (record.imported == null)) {\n\t\t\tconst UI_Use_Real_Name = RocketChat.settings.get('UI_Use_Real_Name') === true;\n\n\t\t\tif (record.u && record.u._id && UI_Use_Real_Name) {\n\t\t\t\tconst user = RocketChat.models.Users.findOneById(record.u._id);\n\t\t\t\trecord.u.name = user && user.name;\n\t\t\t}\n\n\t\t\tif (record.mentions && record.mentions.length && UI_Use_Real_Name) {\n\t\t\t\trecord.mentions.forEach((mention) => {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneById(mention._id);\n\t\t\t\t\tmention.name = user && user.name;\n\t\t\t\t});\n\t\t\t}\n\t\t\tmsgStream.emitWithoutBroadcast('__my_messages__', record, {});\n\t\t\treturn msgStream.emitWithoutBroadcast(record.rid, record);\n\t\t}\n\t}\n\n\treturn RocketChat.models.Messages.on('change', function({ clientAction, id, data/* , oplog*/ }) {\n\t\tswitch (clientAction) {\n\t\t\tcase 'inserted':\n\t\t\tcase 'updated':\n\t\t\t\tconst message = data || RocketChat.models.Messages.findOne({ _id: id });\n\t\t\t\tpublishMessage(clientAction, message);\n\t\t\t\tbreak;\n\t\t}\n\t});\n});\n","/* global InstanceStatus, DDP, LoggerManager */\n\nimport _ from 'underscore';\nimport { DDPCommon } from 'meteor/ddp-common';\n\nprocess.env.PORT = String(process.env.PORT).trim();\nprocess.env.INSTANCE_IP = String(process.env.INSTANCE_IP).trim();\n\nconst connections = {};\nthis.connections = connections;\n\nconst logger = new Logger('StreamBroadcast', {\n\tsections: {\n\t\tconnection: 'Connection',\n\t\tauth: 'Auth',\n\t\tstream: 'Stream',\n\t},\n});\n\nfunction _authorizeConnection(instance) {\n\tlogger.auth.info(`Authorizing with ${ instance }`);\n\n\treturn connections[instance].call('broadcastAuth', InstanceStatus.id(), connections[instance].instanceId, function(err, ok) {\n\t\tif (err != null) {\n\t\t\treturn logger.auth.error(`broadcastAuth error ${ instance } ${ InstanceStatus.id() } ${ connections[instance].instanceId }`, err);\n\t\t}\n\n\t\tconnections[instance].broadcastAuth = ok;\n\t\treturn logger.auth.info(`broadcastAuth with ${ instance }`, ok);\n\t});\n}\n\nfunction authorizeConnection(instance) {\n\tconst query = {\n\t\t_id: InstanceStatus.id(),\n\t};\n\n\tif (!InstanceStatus.getCollection().findOne(query)) {\n\t\treturn Meteor.setTimeout(function() {\n\t\t\treturn authorizeConnection(instance);\n\t\t}, 500);\n\t}\n\n\treturn _authorizeConnection(instance);\n}\n\nfunction startMatrixBroadcast() {\n\tconst query = {\n\t\t'extraInformation.port': {\n\t\t\t$exists: true,\n\t\t},\n\t};\n\n\tconst options = {\n\t\tsort: {\n\t\t\t_createdAt: -1,\n\t\t},\n\t};\n\n\treturn InstanceStatus.getCollection().find(query, options).observe({\n\t\tadded(record) {\n\t\t\tlet instance = `${ record.extraInformation.host }:${ record.extraInformation.port }`;\n\n\t\t\tif (record.extraInformation.port === process.env.PORT && record.extraInformation.host === process.env.INSTANCE_IP) {\n\t\t\t\tlogger.auth.info('prevent self connect', instance);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (record.extraInformation.host === process.env.INSTANCE_IP && RocketChat.isDocker() === false) {\n\t\t\t\tinstance = `localhost:${ record.extraInformation.port }`;\n\t\t\t}\n\n\t\t\tif (connections[instance] && connections[instance].instanceRecord) {\n\t\t\t\tif (connections[instance].instanceRecord._createdAt < record._createdAt) {\n\t\t\t\t\tconnections[instance].disconnect();\n\t\t\t\t\tdelete connections[instance];\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlogger.connection.info('connecting in', instance);\n\n\t\t\tconnections[instance] = DDP.connect(instance, {\n\t\t\t\t_dontPrintErrors: LoggerManager.logLevel < 2,\n\t\t\t});\n\n\t\t\tconnections[instance].instanceRecord = record;\n\t\t\tconnections[instance].instanceId = record._id;\n\n\t\t\treturn connections[instance].onReconnect = function() {\n\t\t\t\treturn authorizeConnection(instance);\n\t\t\t};\n\t\t},\n\n\t\tremoved(record) {\n\t\t\tlet instance = `${ record.extraInformation.host }:${ record.extraInformation.port }`;\n\n\t\t\tif (record.extraInformation.host === process.env.INSTANCE_IP && RocketChat.isDocker() === false) {\n\t\t\t\tinstance = `localhost:${ record.extraInformation.port }`;\n\t\t\t}\n\n\t\t\tconst query = {\n\t\t\t\t'extraInformation.host': record.extraInformation.host,\n\t\t\t\t'extraInformation.port': record.extraInformation.port,\n\t\t\t};\n\n\t\t\tif (connections[instance] && !InstanceStatus.getCollection().findOne(query)) {\n\t\t\t\tlogger.connection.info('disconnecting from', instance);\n\t\t\t\tconnections[instance].disconnect();\n\t\t\t\treturn delete connections[instance];\n\t\t\t}\n\t\t},\n\t});\n}\n\nMeteor.methods({\n\tbroadcastAuth(remoteId, selfId) {\n\t\tcheck(selfId, String);\n\t\tcheck(remoteId, String);\n\n\t\tthis.unblock();\n\n\t\tconst query = {\n\t\t\t_id: remoteId,\n\t\t};\n\n\t\tif (selfId === InstanceStatus.id() && remoteId !== InstanceStatus.id() && (InstanceStatus.getCollection().findOne(query))) {\n\t\t\tthis.connection.broadcastAuth = true;\n\t\t}\n\n\t\treturn this.connection.broadcastAuth === true;\n\t},\n\n\tstream(streamName, eventName, args) {\n\t\tif (!this.connection) {\n\t\t\treturn 'self-not-authorized';\n\t\t}\n\n\t\tif (this.connection.broadcastAuth !== true) {\n\t\t\treturn 'not-authorized';\n\t\t}\n\n\t\tconst instance = Meteor.StreamerCentral.instances[streamName];\n\t\tif (!instance) {\n\t\t\treturn 'stream-not-exists';\n\t\t}\n\n\t\tif (instance.serverOnly) {\n\t\t\tconst scope = {};\n\t\t\tinstance.emitWithScope(eventName, scope, ...args);\n\t\t} else {\n\t\t\tMeteor.StreamerCentral.instances[streamName]._emit(eventName, args);\n\t\t}\n\t},\n});\n\nfunction startStreamCastBroadcast(value) {\n\tconst instance = 'StreamCast';\n\n\tlogger.connection.info('connecting in', instance, value);\n\n\tconst connection = DDP.connect(value, {\n\t\t_dontPrintErrors: LoggerManager.logLevel < 2,\n\t});\n\n\tconnections[instance] = connection;\n\tconnection.instanceId = instance;\n\tconnection.onReconnect = function() {\n\t\treturn authorizeConnection(instance);\n\t};\n\n\tconnection._stream.on('message', function(raw_msg) {\n\t\tconst msg = DDPCommon.parseDDP(raw_msg);\n\t\tif (!msg || msg.msg !== 'changed' || !msg.collection || !msg.fields) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { streamName, eventName, args } = msg.fields;\n\n\t\tif (!streamName || !eventName || !args) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (connection.broadcastAuth !== true) {\n\t\t\treturn 'not-authorized';\n\t\t}\n\n\t\tif (!Meteor.StreamerCentral.instances[streamName]) {\n\t\t\treturn 'stream-not-exists';\n\t\t}\n\n\t\treturn Meteor.StreamerCentral.instances[streamName]._emit(eventName, args);\n\t});\n\n\treturn connection.subscribe('stream');\n}\n\nfunction startStreamBroadcast() {\n\tif (!process.env.INSTANCE_IP) {\n\t\tprocess.env.INSTANCE_IP = 'localhost';\n\t}\n\n\tlogger.info('startStreamBroadcast');\n\n\tRocketChat.settings.get('Stream_Cast_Address', function(key, value) {\n\t\t// var connection, fn, instance;\n\t\tconst fn = function(instance, connection) {\n\t\t\tconnection.disconnect();\n\t\t\treturn delete connections[instance];\n\t\t};\n\n\t\tfor (const instance of Object.keys(connections)) {\n\t\t\tconst connection = connections[instance];\n\t\t\tfn(instance, connection);\n\t\t}\n\n\t\tif (value && value.trim() !== '') {\n\t\t\treturn startStreamCastBroadcast(value);\n\t\t} else {\n\t\t\treturn startMatrixBroadcast();\n\t\t}\n\t});\n\n\tfunction broadcast(streamName, eventName, args/* , userId*/) {\n\t\tconst fromInstance = `${ process.env.INSTANCE_IP }:${ process.env.PORT }`;\n\t\tconst results = [];\n\n\t\tfor (const instance of Object.keys(connections)) {\n\t\t\tconst connection = connections[instance];\n\n\t\t\tif (connection.status().connected === true) {\n\t\t\t\tconnection.call('stream', streamName, eventName, args, function(error, response) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tlogger.error('Stream broadcast error', error);\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch (response) {\n\t\t\t\t\t\tcase 'self-not-authorized':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } to self is not authorized`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\treturn logger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t\tcase 'not-authorized':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } not authorized`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\tlogger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t\t\treturn authorizeConnection(instance);\n\t\t\t\t\t\tcase 'stream-not-exists':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } does not exist`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\treturn logger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\treturn Meteor.StreamerCentral.on('broadcast', function(streamName, eventName, args) {\n\t\treturn broadcast(streamName, eventName, args);\n\t});\n}\n\nMeteor.startup(function() {\n\treturn startStreamBroadcast();\n});\n\nMeteor.methods({\n\t'instances/get'() {\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'view-statistics')) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'List instances is not allowed', {\n\t\t\t\tmethod: 'instances/get',\n\t\t\t});\n\t\t}\n\n\t\treturn Object.keys(connections).map((address) => {\n\t\t\tconst conn = connections[address];\n\t\t\treturn Object.assign({ address, currentStatus: conn._stream.currentStatus }, _.pick(conn, 'instanceRecord', 'broadcastAuth'));\n\t\t});\n\t},\n});\n","import '/imports/startup/server';\n","RegExp.escape = function(s) {\n\treturn s.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n};\n","this.i18n_status_func = function(key, options) {\n\treturn TAPi18n.__(key, options);\n};\n"]}